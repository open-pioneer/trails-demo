var A=t=>{throw TypeError(t)};var b=(t,n,e)=>n.has(t)||A("Cannot "+e);var r=(t,n,e)=>(b(t,n,"read from private field"),e?e.call(t):n.get(t)),h=(t,n,e)=>n.has(t)?A("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(t):n.set(t,e),a=(t,n,e,d)=>(b(t,n,"write to private field"),d?d.call(t,e):n.set(t,e),e),S=(t,n,e)=>(b(t,n,"access private method"),e);import{af as F,a9 as I,ag as j,c as p,r as g,j as u}from"./CP8MVrT81mG9.js";import{E as B}from"./vOBnYnib6xFk.js";import{u as C,a as L}from"./C45KNpS0yFsl.js";import{B as P}from"./CN_7oo9JZIao.js";const m=p("authentication:AuthService");var o,i,s,l,k,x;class K extends B{constructor(e){super();h(this,k);h(this,o);h(this,i);h(this,s);h(this,l);a(this,o,e.references.plugin),a(this,i,r(this,o).getAuthState()),a(this,l,r(this,o).on?.("changed",()=>S(this,k,x).call(this))),m.debug(`Constructed with initial auth state '${r(this,i).kind}'`,r(this,i))}destroy(){r(this,s)?.reject(F()),a(this,s,void 0),a(this,l,I(r(this,l)))}getAuthState(){return r(this,i)}getSessionInfo(){return r(this,i).kind!=="pending"?Promise.resolve(v(r(this,i))):(r(this,s)||a(this,s,j()),r(this,s).promise)}getLoginBehavior(){return r(this,o).getLoginBehavior()}logout(){m.debug("Triggering logout"),r(this,o).logout()}}o=new WeakMap,i=new WeakMap,s=new WeakMap,l=new WeakMap,k=new WeakSet,x=function(){const e=r(this,o).getAuthState();a(this,i,e),e.kind!=="pending"&&r(this,s)&&(r(this,s).resolve(v(e)),a(this,s,void 0)),m.debug(`Auth state changed to '${r(this,i).kind}'`,r(this,i)),this.emit("changed")};function v(t){return t.kind==="authenticated"?t.sessionInfo:void 0}const E="@open-pioneer/authentication",w=C.bind(void 0,E),y=L.bind(void 0,E);function M(t){const n=g.useCallback(c=>{const f=t.on("changed",c);return()=>f.destroy()},[t]),e=g.useCallback(()=>t.getAuthState(),[t]);return g.useSyncExternalStore(n,e)}const O=t=>{const n=w("authentication.AuthService"),e=M(n),d=y(),c=g.useMemo(()=>{if(e.kind==="not-authenticated")return n.getLoginBehavior()},[n,e.kind]);switch(g.useEffect(()=>{e.kind==="not-authenticated"&&c?.kind==="effect"&&c.login()},[c,e.kind]),e.kind){case"pending":return null;case"not-authenticated":{if(!c||c.kind!=="fallback")return null;const f=c.Fallback;return t.renderFallback?u.jsx(u.Fragment,{children:t.renderFallback(f)}):u.jsx(f,{...t.fallbackProps})}case"error":return t.renderErrorFallback?t.renderErrorFallback(e.error):t.errorFallback?u.jsx(t.errorFallback,{error:e.error}):u.jsx(P,{className:"authentication-error",children:d.formatMessage({id:"auth-error"})});case"authenticated":return u.jsx(u.Fragment,{children:t.children})}};export{K as A,O as F,M as u};
