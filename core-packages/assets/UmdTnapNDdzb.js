var m=t=>{throw TypeError(t)};var k=(t,n,e)=>n.has(t)||m("Cannot "+e);var i=(t,n,e)=>(k(t,n,"read from private field"),e?e.call(t):n.get(t)),c=(t,n,e)=>n.has(t)?m("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(t):n.set(t,e),o=(t,n,e,a)=>(k(t,n,"write to private field"),a?a.call(t,e):n.set(t,e),e),A=(t,n,e)=>(k(t,n,"access private method"),e);import{ad as E,ae as x,af as F,c as j,r as l,j as d}from"./FpWhIYPQtjDV.js";import{E as I}from"./vOBnYnib6xFk.js";import{u as C}from"./ybE0yBI8Jih7.js";const b=j("authentication:AuthService");var u,s,r,h,f,v;class R extends I{constructor(e){super();c(this,f);c(this,u);c(this,s);c(this,r);c(this,h);o(this,u,e.references.plugin),o(this,s,i(this,u).getAuthState()),o(this,h,i(this,u).on?.("changed",()=>A(this,f,v).call(this))),b.debug(`Constructed with initial auth state '${i(this,s).kind}'`,i(this,s))}destroy(){i(this,r)?.reject(E()),o(this,r,void 0),o(this,h,x(i(this,h)))}getAuthState(){return i(this,s)}getSessionInfo(){return i(this,s).kind!=="pending"?Promise.resolve(S(i(this,s))):(i(this,r)||o(this,r,F()),i(this,r).promise)}getLoginBehavior(){return i(this,u).getLoginBehavior()}logout(){b.debug("Triggering logout"),i(this,u).logout()}}u=new WeakMap,s=new WeakMap,r=new WeakMap,h=new WeakMap,f=new WeakSet,v=function(){const e=i(this,u).getAuthState();o(this,s,e),e.kind!=="pending"&&i(this,r)&&(i(this,r).resolve(S(e)),o(this,r,void 0)),b.debug(`Auth state changed to '${i(this,s).kind}'`,i(this,s)),this.emit("changed")};function S(t){return t.kind==="authenticated"?t.sessionInfo:void 0}const L="@open-pioneer/authentication",P=C.bind(void 0,L);function w(t){const n=l.useCallback(g=>{const p=t.on("changed",g);return()=>p.destroy()},[t]),e=l.useCallback(()=>t.getAuthState(),[t]);return l.useSyncExternalStore(n,e)}const $=t=>{const n=P("authentication.AuthService"),e=w(n),a=l.useMemo(()=>{if(e.kind==="not-authenticated")return n.getLoginBehavior()},[n,e.kind]);switch(l.useEffect(()=>{e.kind==="not-authenticated"&&a?.kind==="effect"&&a.login()},[a,e.kind]),e.kind){case"pending":return null;case"not-authenticated":{if(!a||a.kind!=="fallback")return null;const g=a.Fallback;return t.renderFallback?d.jsx(d.Fragment,{children:t.renderFallback(g)}):d.jsx(g,{...t.fallbackProps})}case"authenticated":return d.jsx(d.Fragment,{children:t.children})}};export{R as A,$ as F,w as u};
