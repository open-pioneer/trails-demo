var k=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)};var i=(t,n,e)=>(k(t,n,"read from private field"),e?e.call(t):n.get(t)),c=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},o=(t,n,e,a)=>(k(t,n,"write to private field"),a?a.call(t,e):n.set(t,e),e);var m=(t,n,e)=>(k(t,n,"access private method"),e);import{ad as p,ae as E,af as x,c as F,r as l,j as d}from"./DJmFkcIFdodk.js";import{E as j}from"./vOBnYnib6xFk.js";import{u as I}from"./DtzrJf1FMcy1.js";const b=F("authentication:AuthService");var u,s,r,h,f,S;class G extends j{constructor(e){super();c(this,f);c(this,u,void 0);c(this,s,void 0);c(this,r,void 0);c(this,h,void 0);o(this,u,e.references.plugin),o(this,s,i(this,u).getAuthState()),o(this,h,i(this,u).on?.("changed",()=>m(this,f,S).call(this))),b.debug(`Constructed with initial auth state '${i(this,s).kind}'`,i(this,s))}destroy(){i(this,r)?.reject(p()),o(this,r,void 0),o(this,h,E(i(this,h)))}getAuthState(){return i(this,s)}getSessionInfo(){return i(this,s).kind!=="pending"?Promise.resolve(A(i(this,s))):(i(this,r)||o(this,r,x()),i(this,r).promise)}getLoginBehavior(){return i(this,u).getLoginBehavior()}logout(){b.debug("Triggering logout"),i(this,u).logout()}}u=new WeakMap,s=new WeakMap,r=new WeakMap,h=new WeakMap,f=new WeakSet,S=function(){const e=i(this,u).getAuthState();o(this,s,e),e.kind!=="pending"&&i(this,r)&&(i(this,r).resolve(A(e)),o(this,r,void 0)),b.debug(`Auth state changed to '${i(this,s).kind}'`,i(this,s)),this.emit("changed")};function A(t){return t.kind==="authenticated"?t.sessionInfo:void 0}const C="@open-pioneer/authentication",L=I.bind(void 0,C);function P(t){const n=l.useCallback(g=>{const v=t.on("changed",g);return()=>v.destroy()},[t]),e=l.useCallback(()=>t.getAuthState(),[t]);return l.useSyncExternalStore(n,e)}const R=t=>{const n=L("authentication.AuthService"),e=P(n),a=l.useMemo(()=>{if(e.kind==="not-authenticated")return n.getLoginBehavior()},[n,e.kind]);switch(l.useEffect(()=>{e.kind==="not-authenticated"&&a?.kind==="effect"&&a.login()},[a,e.kind]),e.kind){case"pending":return null;case"not-authenticated":{if(!a||a.kind!=="fallback")return null;const g=a.Fallback;return t.renderFallback?d.jsx(d.Fragment,{children:t.renderFallback(g)}):d.jsx(g,{...t.fallbackProps})}case"authenticated":return d.jsx(d.Fragment,{children:t.children})}};export{G as A,R as F,P as u};
