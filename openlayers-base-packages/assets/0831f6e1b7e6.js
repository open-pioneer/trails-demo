var yn=Object.defineProperty;var Sn=(o,e,t)=>e in o?yn(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var $=(o,e,t)=>(Sn(o,typeof e!="symbol"?e+"":e,t),t),Jt=(o,e,t)=>{if(!e.has(o))throw TypeError("Cannot "+t)};var k=(o,e,t)=>(Jt(o,e,"read from private field"),t?t.call(o):e.get(o)),R=(o,e,t)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,t)},D=(o,e,t,s)=>(Jt(o,e,"write to private field"),s?s.call(o,t):e.set(o,t),t);var H=(o,e,t)=>(Jt(o,e,"access private method"),t);import{f as xo,j as c,r as p,u as _n,c as ue,i as Nt,a as ke,g as xn,R as bs,b as kn,E as ne,d as Cn,A as Qt,e as eo,F as ws,B as ko,C as En,t as Pn,h as ys,I as Mn,k as Ln}from"./0defd417557f.js";import{t as Tn}from"./316ed04c9fb4.js";import{b as Ss,B as _s,i as An,g as Rn,a as Fo,t as In,c as Dn,d as xs,S as On,e as jn,f as Nn,h as Fn,j as Vn,r as Bn,C as Gn,k as zn,l as Un,u as Wn,m as ks,M as Cs,o as Hn,n as $n,p as Es,A as qn,T as Co,I as Kn,q as Yn,s as uo,v as ie,w as Xn,x as Zn,V as Ps,y as ct,O as Ms,z as Ie,D as he,E as Ae,F as Eo,G as Xe,P as Jn,H as Qn,J as er,K as Vo,L as tr,N as or,Q as Bo,R as sr,U as nr,W as Ls,X as ge,Y as rr,Z as Ts,_ as Ce,$ as Ve,a0 as Go,a1 as ir,a2 as qt,a3 as ar,a4 as As,a5 as lr,a6 as cr,a7 as Po,a8 as Rs,a9 as ur,aa as dr,ab as Z,ac as hr,ad as Is,ae as pr,af as zo,ag as Ds,ah as fr,ai as Uo,aj as gr,ak as to,al as Wo,am as mr,an as vr,ao as br,ap as wr,aq as yr,ar as Sr,as as Ho,at as _r,au as xr,av as kr,aw as Le,ax as Cr,ay as Er,az as Pr,aA as $o,aB as Mr,aC as qo,aD as Lr,aE as Pt}from"./eeb50ae3cf40.js";import{m as N,a as C,X as Os,p as B,r as O,b as Q,c as Mo,d as ho,e as _e,f as Tr,g as Ar,W as Ct,P as js,h as Ns,i as Rr,j as Ir,k as Dr,l as Or,n as jr,o as Nr,q as Fr,s as Vr,t as Br}from"./71864529e718.js";import{o as Gr,W as zr}from"./55092e67b685.js";import{u as ae,c as Et,T as tt,S as ot,a as ee}from"./7555142b6a33.js";import{G as Kt,M as Ur,a as Fs,b as Vs,c as Wr,T as Hr}from"./34fe70a1a061.js";import{T as de}from"./f21d1ce00b3d.js";import{B as V}from"./15f5f59b4147.js";import{N as $r,W as qr,a as Kr}from"./b6e69dd284e9.js";import{V as Yr,S as Xr,I as Zr,Z as Jr,a as Qr}from"./6ce0c9156e11.js";import{E as Lo}from"./960f2965a833.js";import{L as Be}from"./615c15d15c66.js";import{_ as Ko}from"./a419295615be.js";import{u as pe,a as Yt}from"./2d990ec3c487.js";import{F as ce}from"./2111f96b4ada.js";import{L as Bs}from"./31959e4ebda9.js";import{S as ei}from"./50199efc6b8c.js";import{V as po}from"./cc7b28320892.js";import{I as ti}from"./3be746f89553.js";import{G as oi,F as si}from"./17d08e47ae11.js";import{u as Re}from"./79421c46f367.js";import{F as fo}from"./7ec98ecee63c.js";import{F as go}from"./3fe27408584d.js";import{H as ni}from"./76c7eb1c360f.js";import{S as ri}from"./2b89953b26a5.js";import{R as ii}from"./638e7ad91a66.js";import{c as ai}from"./7d85d02d9573.js";import{c as fe,S as mo}from"./e4cea632540c.js";import{C as li}from"./35c320f7ec43.js";import{D as ci}from"./ae56f74ed8b7.js";import"./13165b38621a.js";import"./bdb008723151.js";import"./e4cbec222b95.js";import"./221bec485250.js";import"./3ccd04744ba7.js";var vo=xo(function(e,t){const{htmlWidth:s,htmlHeight:n,alt:r,...i}=e;return c.jsx("img",{width:s,height:n,ref:t,alt:r,...i})});vo.displayName="NativeImage";function ui(o){const{loading:e,src:t,srcSet:s,onLoad:n,onError:r,crossOrigin:i,sizes:a,ignoreFallback:u}=o,[l,d]=p.useState("pending");p.useEffect(()=>{d(t?"loading":"pending")},[t]);const h=p.useRef(),g=p.useCallback(()=>{if(!t)return;m();const w=new Image;w.src=t,i&&(w.crossOrigin=i),s&&(w.srcset=s),a&&(w.sizes=a),e&&(w.loading=e),w.onload=S=>{m(),d("loaded"),n?.(S)},w.onerror=S=>{m(),d("failed"),r?.(S)},h.current=w},[t,i,s,a,n,r,e]),m=()=>{h.current&&(h.current.onload=null,h.current.onerror=null,h.current=null)};return _n(()=>{if(!u)return l==="loading"&&g(),()=>{m()}},[l,g,u]),u?"loaded":l}var di=(o,e)=>o!=="loaded"&&e==="beforeLoadOrError"||o==="failed"&&e==="onError";function hi(o,e=[]){const t=Object.assign({},o);for(const s of e)s in t&&delete t[s];return t}var Gs=xo(function(e,t){const{fallbackSrc:s,fallback:n,src:r,srcSet:i,align:a,fit:u,loading:l,ignoreFallback:d,crossOrigin:h,fallbackStrategy:g="beforeLoadOrError",referrerPolicy:m,...w}=e,S=s!==void 0||n!==void 0,T=l!=null||d||!S,P=ui({...e,crossOrigin:h,ignoreFallback:T}),I=di(P,g),L={ref:t,objectFit:u,objectPosition:a,...T?w:hi(w,["onError","onLoad"])};return I?n||c.jsx(ue.img,{as:vo,className:"chakra-image__placeholder",src:s,...L}):c.jsx(ue.img,{as:vo,src:r,srcSet:i,crossOrigin:h,loading:l,referrerPolicy:m,className:"chakra-image",...L})});Gs.displayName="Image";var zs=ue("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});zs.displayName="Center";var pi={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};xo(function(e,t){const{axis:s="both",...n}=e;return c.jsx(ue.div,{ref:t,__css:pi[s],...n,position:"absolute"})});const J=[null,"http://www.opengis.net/ows/1.1"],fi=N(J,{ServiceIdentification:C(Vi),ServiceProvider:C(Gi),OperationsMetadata:C(Ni)});class gi extends Os{constructor(){super()}readFromNode(e){const t=B({},fi,e,[]);return t||null}}const mi=N(J,{DeliveryPoint:C(O),City:C(O),AdministrativeArea:C(O),PostalCode:C(O),Country:C(O),ElectronicMailAddress:C(O)}),vi=N(J,{Value:Q(zi)}),bi=N(J,{AllowedValues:C(Ti)}),wi=N(J,{Phone:C(Fi),Address:C(Li)}),yi=N(J,{HTTP:C(Oi)}),Si=N(J,{Get:Q(Di),Post:void 0}),_i=N(J,{DCP:C(Ii)}),xi=N(J,{Operation:ji}),ki=N(J,{Voice:C(O),Facsimile:C(O)}),Ci=N(J,{Constraint:Q(Ai)}),Ei=N(J,{IndividualName:C(O),PositionName:C(O),ContactInfo:C(Ri)}),Pi=N(J,{Abstract:C(O),AccessConstraints:C(O),Fees:C(O),Title:C(O),ServiceTypeVersion:C(O),ServiceType:C(O)}),Mi=N(J,{ProviderName:C(O),ProviderSite:C(Mo),ServiceContact:C(Bi)});function Li(o,e){return B({},mi,o,e)}function Ti(o,e){return B({},vi,o,e)}function Ai(o,e){const t=o.getAttribute("name");if(t)return B({name:t},bi,o,e)}function Ri(o,e){return B({},wi,o,e)}function Ii(o,e){return B({},yi,o,e)}function Di(o,e){const t=Mo(o);if(t)return B({href:t},Ci,o,e)}function Oi(o,e){return B({},Si,o,e)}function ji(o,e){const t=o.getAttribute("name"),s=B({},_i,o,e);if(!s)return;const n=e[e.length-1];n[t]=s}function Ni(o,e){return B({},xi,o,e)}function Fi(o,e){return B({},ki,o,e)}function Vi(o,e){return B({},Pi,o,e)}function Bi(o,e){return B({},Ei,o,e)}function Gi(o,e){return B({},Mi,o,e)}function zi(o,e){return O(o)}const Ui=gi,le=[null,"http://www.opengis.net/wmts/1.0"],st=[null,"http://www.opengis.net/ows/1.1"],Wi=N(le,{Contents:C(oa)});class Hi extends Os{constructor(){super(),this.owsParser_=new Ui}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let s=this.owsParser_.readFromNode(e);return s?(s.version=t,s=B(s,Wi,e,[]),s||null):null}}const $i=N(le,{Layer:Q(sa),TileMatrixSet:Q(na)}),qi=N(le,{Style:Q(ra),Format:Q(O),TileMatrixSetLink:Q(ia),Dimension:Q(aa),ResourceURL:Q(la)},N(st,{Title:C(O),Abstract:C(O),WGS84BoundingBox:C(Us),Identifier:C(O)})),Ki=N(le,{LegendURL:Q(ca)},N(st,{Title:C(O),Identifier:C(O)})),Yi=N(le,{TileMatrixSet:C(O),TileMatrixSetLimits:C(da)}),Xi=N(le,{TileMatrixLimits:ho(ha)}),Zi=N(le,{TileMatrix:C(O),MinTileRow:C(_e),MaxTileRow:C(_e),MinTileCol:C(_e),MaxTileCol:C(_e)}),Ji=N(le,{Default:C(O),Value:Q(O)},N(st,{Identifier:C(O)})),Qi=N(st,{LowerCorner:ho(bo),UpperCorner:ho(bo)}),ea=N(le,{WellKnownScaleSet:C(O),TileMatrix:Q(ua)},N(st,{SupportedCRS:C(O),Identifier:C(O),BoundingBox:C(Us)})),ta=N(le,{TopLeftCorner:C(bo),ScaleDenominator:C(Tr),TileWidth:C(_e),TileHeight:C(_e),MatrixWidth:C(_e),MatrixHeight:C(_e)},N(st,{Identifier:C(O)}));function oa(o,e){return B({},$i,o,e)}function sa(o,e){return B({},qi,o,e)}function na(o,e){return B({},ea,o,e)}function ra(o,e){const t=B({},Ki,o,e);if(!t)return;const s=o.getAttribute("isDefault")==="true";return t.isDefault=s,t}function ia(o,e){return B({},Yi,o,e)}function aa(o,e){return B({},Ji,o,e)}function la(o,e){const t=o.getAttribute("format"),s=o.getAttribute("template"),n=o.getAttribute("resourceType"),r={};return t&&(r.format=t),s&&(r.template=s),n&&(r.resourceType=n),r}function Us(o,e){const t=B([],Qi,o,e);if(t.length==2)return Ss(t)}function ca(o,e){const t={};return t.format=o.getAttribute("format"),t.href=Mo(o),t}function bo(o,e){const t=O(o).split(/\s+/);if(!t||t.length!=2)return;const s=+t[0],n=+t[1];if(!(isNaN(s)||isNaN(n)))return[s,n]}function ua(o,e){return B({},ta,o,e)}function da(o,e){return B([],Xi,o,e)}function ha(o,e){return B({},Zi,o,e)}const pa=Hi,U={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},fa={ERROR:"error"};class ga extends xs{constructor(e){super(fa.ERROR),this.code=e.code,this.message=e.message}}let ma=class extends _s{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=An,this.watchId_=void 0,this.addChangeListener(U.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(U.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Rn(Fo("EPSG:4326"),e),this.position_&&this.set(U.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(U.ACCURACY,t.accuracy),this.set(U.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(U.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(U.HEADING,t.heading===null?void 0:In(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const s=this.transform_(this.position_);this.set(U.POSITION,s.slice()),this.set(U.SPEED,t.speed===null?void 0:t.speed);const n=Dn(this.position_,t.accuracy);n.applyTransform(this.transform_),this.set(U.ACCURACY_GEOMETRY,n),this.changed()}positionError_(e){this.dispatchEvent(new ga(e))}getAccuracy(){return this.get(U.ACCURACY)}getAccuracyGeometry(){return this.get(U.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(U.ALTITUDE)}getAltitudeAccuracy(){return this.get(U.ALTITUDE_ACCURACY)}getHeading(){return this.get(U.HEADING)}getPosition(){return this.get(U.POSITION)}getProjection(){return this.get(U.PROJECTION)}getSpeed(){return this.get(U.SPEED)}getTracking(){return this.get(U.TRACKING)}getTrackingOptions(){return this.get(U.TRACKING_OPTIONS)}setProjection(e){this.set(U.PROJECTION,Fo(e))}setTracking(e){this.set(U.TRACKING,e)}setTrackingOptions(e){this.set(U.TRACKING_OPTIONS,e)}};const va=ma;class Xt extends On{constructor(e,t,s){super(),s!==void 0&&t===void 0?this.setFlatCoordinates(s,e):(t=t||0,this.setCenterAndRadius(e,t,s))}clone(){const e=new Xt(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,s,n){const r=this.flatCoordinates,i=e-r[0],a=t-r[1],u=i*i+a*a;if(u<n){if(u===0)for(let l=0;l<this.stride;++l)s[l]=r[l];else{const l=this.getRadius()/Math.sqrt(u);s[0]=r[0]+l*i,s[1]=r[1]+l*a;for(let d=2;d<this.stride;++d)s[d]=r[d]}return s.length=this.stride,u}return n}containsXY(e,t){const s=this.flatCoordinates,n=e-s[0],r=t-s[1];return n*n+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,s=t[this.stride]-t[0];return jn(t[0]-s,t[1]-s,t[0]+s,t[1]+s,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Nn(e,t)){const s=this.getCenter();return e[0]<=s[0]&&e[2]>=s[0]||e[1]<=s[1]&&e[3]>=s[1]?!0:Fn(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,s=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+s;for(let r=1;r<t;++r)n[t+r]=e[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,s){this.setLayout(s,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let r=Vn(n,0,e,this.stride);n[r++]=n[0]+t;for(let i=1,a=this.stride;i<a;++i)n[r++]=n[i];n.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const s=this.getCenter(),n=this.getStride();this.setCenter(Bn(s,0,s.length,n,e,t,s)),this.changed()}}Xt.prototype.transform;const ba=Xt,K={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class wa extends _s{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Gn,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(K.ELEMENT,this.handleElementChanged),this.addChangeListener(K.MAP,this.handleMapChanged),this.addChangeListener(K.OFFSET,this.handleOffsetChanged),this.addChangeListener(K.POSITION,this.handlePositionChanged),this.addChangeListener(K.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(K.ELEMENT)}getId(){return this.id}getMap(){return this.get(K.MAP)||null}getOffset(){return this.get(K.OFFSET)}getPosition(){return this.get(K.POSITION)}getPositioning(){return this.get(K.POSITIONING)}handleElementChanged(){zn(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Un(this.element),Wn(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=ks(e,Cs.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(K.ELEMENT,e)}setMap(e){this.set(K.MAP,e)}setOffset(e){this.set(K.OFFSET,e)}setPosition(e){this.set(K.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(K.POSITION))return;const s=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),r=this.getRect(n,[Hn(n),$n(n)]);e=e||{};const i=e.margin===void 0?20:e.margin;if(!Es(s,r)){const a=r[0]-s[0],u=s[2]-r[2],l=r[1]-s[1],d=s[3]-r[3],h=[0,0];if(a<0?h[0]=a-i:u<0&&(h[0]=Math.abs(u)+i),l<0?h[1]=l-i:d<0&&(h[1]=Math.abs(d)+i),h[0]!==0||h[1]!==0){const g=t.getView().getCenterInternal(),m=t.getPixelFromCoordinateInternal(g);if(!m)return;const w=[m[0]+h[0],m[1]+h[1]],S=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(w),duration:S.duration,easing:S.easing})}}}getRect(e,t){const s=e.getBoundingClientRect(),n=s.left+window.pageXOffset,r=s.top+window.pageYOffset;return[n,r,n+t[0],r+t[1]]}setPositioning(e){this.set(K.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const s=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(s,n)}updateRenderedPosition(e,t){const s=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const i=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let u="0%",l="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?u="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(u="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?l="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(l="-50%");const d=`translate(${u}, ${l}) translate(${i}, ${a})`;this.rendered.transform_!=d&&(this.rendered.transform_=d,s.transform=d)}getOptions(){return this.options}}const ht=wa,Ee=ke("map:WMTSLayer");var Ge,ze,Ue,We,pt,ft,gt,mt,Bt,Ws,Gt,Hs;class ya extends qn{constructor(t){const s=new Co;super({...t,olLayer:s});R(this,Bt);R(this,Gt);R(this,Ge,void 0);R(this,ze,void 0);R(this,Ue,void 0);R(this,We,void 0);R(this,pt,void 0);R(this,ft,void 0);R(this,gt,void 0);R(this,mt,new AbortController);D(this,Ge,t.url),D(this,ze,t.name),D(this,We,s),D(this,Ue,t.matrixSet),D(this,gt,t.sourceOptions)}destroy(){super.destroy(),k(this,mt).abort()}get legend(){return k(this,ft)}__attach(t){super.__attach(t),H(this,Bt,Ws).call(this).then(s=>{const r=new pa().read(s),i=Gr(r,{layer:k(this,ze),matrixSet:k(this,Ue)});if(!i)throw new Error("Layer was not found in capabilities");const a=new zr({...i,...k(this,gt),tileLoadFunction:(d,h)=>{H(this,Gt,Hs).call(this,d,h)}});D(this,pt,a),k(this,We).setSource(k(this,pt));const u=a.getStyle(),l=_a(r,this.name,u);D(this,ft,l),this.__emitChangeEvent("changed:legend")}).catch(s=>{if(Nt(s)){Ee.error(`Layer ${this.name} has been destroyed before fetching the data`);return}Ee.error(`Failed fetching WMTS capabilities for Layer ${this.name}`,s)})}get layer(){return k(this,We)}get url(){return k(this,Ge)}get name(){return k(this,ze)}get matrixSet(){return k(this,Ue)}get sublayers(){}}Ge=new WeakMap,ze=new WeakMap,Ue=new WeakMap,We=new WeakMap,pt=new WeakMap,ft=new WeakMap,gt=new WeakMap,mt=new WeakMap,Bt=new WeakSet,Ws=async function(){const t=this.map.__sharedDependencies.httpService;return Ar(k(this,Ge),t,k(this,mt).signal)},Gt=new WeakSet,Hs=async function(t,s){const n=this.map.__sharedDependencies.httpService;try{if(!(t instanceof Kn))throw new Error("Only 'ImageTile' is supported for now.");const r=t.getImage();if(!Sa(r))throw new Error("Only <img> tags are supported as tiles for now.");const i=await n.fetch(s);if(!i.ok)throw new Error(`Tile request failed with status ${i.status}.`);const a=await i.blob(),u=URL.createObjectURL(a),l=()=>{URL.revokeObjectURL(u),r.removeEventListener("load",l),r.removeEventListener("error",l)};r.addEventListener("load",l),r.addEventListener("error",l),r.src=u}catch(r){t.setState(Yn.ERROR),Nt(r)||Ee.error("Failed to load tile",r)}};function Sa(o){return o.tagName==="IMG"}function _a(o,e,t){const n=o?.Contents?.Layer;let r=n?.find(l=>l?.Identifier===e);if(!r&&(Ee.debug("Failed to find the active layer in WMTS layer capabilities."),r=n?.[0],!r)){Ee.debug("No layer in WMTS capabilities - giving up.");return}const i=r.Style;let a=i?.find(l=>l?.Identifier===t);if(!a&&(Ee.debug("Failed to find active style in WMTS layer."),a=i?.[0],!a)){Ee.debug("No style in WMTS layer capabilities - giving up.");return}return a.LegendURL?.[0]?.href}const Yo=ya,xa=25.4/.28,ka=39.37;function To(o){return Ao(o,Ca,Ea)}function Ca(o){return o.getView()}function Ea(o,e){return o.on("change:view",e)}function $s(o){return To(o)?.getProjection()}function Pa(o){const e=To(o);return Ao(e,Ma,La)}function Ma(o){return o.getResolution()}function La(o,e){return o.on("change:resolution",e)}function Ta(o){const e=To(o);return Ao(e,Aa,Ra)}function Aa(o){return o.getCenter()}function Ra(o,e){return o.on("change:center",e)}function Ia(o){const e=Ta(o),t=Pa(o),s=$s(o);return p.useMemo(()=>{if(s==null||t==null||e==null)return;const r=uo(s,t,e);return Math.round(r*ka*xa)},[s,t,e])}function Ao(o,e,t){const s=p.useCallback(()=>o?e(o):void 0,[o,e]),n=p.useCallback(r=>{if(!o)return()=>{};const i=t(o,r);return()=>ie(i)},[o,t]);return p.useSyncExternalStore(n,s)}const Da=1.2;function Oa(o,e=Da){ja(o);const t=Xn(o),s=Zn(o),n=t*e,r=s*e;return[o[0]-(n-t)/2,o[1]-(r-s)/2,o[2]+(n-t)/2,o[3]+(r-s)/2]}function ja(o){if(o.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${o.length}).`)}const Na={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function Fa(o){return c.jsxs(V,{children:[c.jsx(de,{children:o.layer.title}),c.jsx(V,{style:Na})]})}const z="main";class Va{mapId=z;vectorSourceFactory;constructor(e){this.vectorSourceFactory=e.references.vectorSourceFactory}async getMapConfig(){const e={Component:Fa};return{advanced:{view:new Ps({center:[404747,5757920],zoom:13,constrainResolution:!0,projection:"EPSG:25832"})},layers:[new Ct({title:"Linfos",visible:!0,url:"https://www.wms.nrw.de/umwelt/linfos",sublayers:[{name:"SonstigeSchutzgebiete",title:"SonstigeSchutzgebiete"},{name:"SCH_GSG",title:"SCH_GSG"}]}),new Yo({isBaseLayer:!0,title:"Topplus grau",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_grau",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new Yo({isBaseLayer:!0,title:"Topplus farbig",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_col",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new ct({title:"OSM",visible:!1,isBaseLayer:!0,olLayer:new Co({source:new Ms})}),new ct({title:"Haltestellen Stadt Rostock",visible:!0,description:"Haltestellen des öffentlichen Personenverkehrs in der Hanse- und Universitätsstadt Rostock.",olLayer:Ba(),attributes:{legend:e}}),new ct({id:"ogc_kitas",title:"Kindertagesstätten",visible:!0,olLayer:Ga(),attributes:{legend:e,resultListMetadata:[{id:"id",displayName:"ID",width:100,getPropertyValue(t){return t.id}},{propertyName:"pointOfContact.address.postCode",displayName:"PLZ",width:120},{propertyName:"name",displayName:"Name"},{propertyName:"inspireId",displayName:"inspireID"},{displayName:"Gefördert",width:160,getPropertyValue(t){switch(t.properties?.gefoerdert){case"ja":return!0;case"nein":return!1;default:return t.properties?.gefoerdert}}}]}}),new ct({id:"ogc_kataster",title:"Liegenschaftskatasterbezirke in NRW (viele Daten)",visible:!1,olLayer:za(this.vectorSourceFactory),attributes:{resultListMetadata:[{propertyName:"id",displayName:"ID",width:600,getPropertyValue(t){return t.id}},{displayName:"Aktualit",width:600,getPropertyValue(t){const s=t.properties?.aktualit;return typeof s=="string"&&!isNaN(Date.parse(s))?new Date(s):s}}]}}),Ha(this.vectorSourceFactory),$a(),qa(),Ua(),Wa()]}}}function Ba(){const o=new Ie({url:"https://geo.sv.rostock.de/download/opendata/haltestellen/haltestellen.json",format:new Kt,attributions:"Haltestellen Stadt Rostock, Creative Commons CC Zero License (cc-zero)"});return new he({source:o})}function Ga(){const o=new Ie({url:"https://ogc-api.nrw.de/inspire-us-kindergarten/v1/collections/governmentalservice/items?f=json&limit=10000",format:new Kt,attributions:'&copy; <a href="http://www.bkg.bund.de" target="_blank">Bundesamt f&uuml;r Kartographie und Geod&auml;sie</a> 2017, <a href="http://sg.geodatenzentrum.de/web_public/Datenquellen_TopPlus_Open.pdf" target="_blank">Datenquellen</a>'});return new he({source:o,style:new Ae({image:new Eo({fill:new Xe({color:"blue"}),radius:4})})})}function za(o){const e=o.createVectorSource({baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"katasterbezirk",limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`});return new he({source:e})}function Ua(){return new Ct({title:"Verwaltungsgebiete",visible:!0,url:"https://www.wms.nrw.de/geobasis/wms_nw_dvg",sublayers:[{name:"nw_dvg_bld",title:"NRW"}]})}function Wa(){return new Ct({title:"Bodenkarte zur Landwirtschaftlichen Standorterkundung",visible:!0,url:"https://www.wms.nrw.de/gd/bk05l",sublayers:[{name:"Versickerung_und_Stofftransport",title:"Versickerung und Stofftransport",sublayers:[{name:"Sickerwasserrate",title:"Sickerwasserrate",sublayers:[{name:"Szenario_Wald",title:"Szenario Wald",sublayers:[{name:"Sickerwasserrate_Wald",title:"Sickerwasserrate Wald"},{name:"Direktabfluss_Wald",title:"Direktabfluss Wald"}]},{name:"Szenario_Gruenland",title:"Szenario Grünland",sublayers:[{name:"Sickerwasserrate_Gruenland",title:"Sickerwasserrate Grünland"},{name:"Direktabfluss_Gruenland",title:"Direktabfluss Grünland"}]}]}]},{name:"Wasserhaushalt",title:"Wasserhaushalt",sublayers:[{name:"Kapillaraufstieg_von_Grundwasser",title:"Kapillaraufstieg von Grundwasser",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/gd/bk05l?request=GetLegendGraphic%26version=1.3.0%26format=image/png%26layer=Kapillaraufstieg_von_Grundwasser"}}},{name:"Luftkapazitaet_We",title:"Luftkapazitaet (We)",attributes:{legend:{}}}]}]})}function Ha(o){const e="https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1",t="governmentalservice",s=o.createVectorSource({baseUrl:e,collectionId:t,limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`}),n=new he({source:s});return new ct({id:"krankenhaus",title:"Krankenhäuser",visible:!0,olLayer:n,attributes:{collectionURL:e+"/collections/"+t}})}function $a(){return new Ct({title:"Schulstandorte",description:"Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.",visible:!0,url:"https://www.wms.nrw.de/wms/wms_nw_inspire-schulen",sublayers:[{name:"US.education",title:"INSPIRE - WMS Schulstandorte NRW",attributes:{legend:{}}}],sourceOptions:{ratio:1}})}function qa(){return new Ct({title:"Straßennetz Landesbetrieb Straßenbau NRW",url:"https://www.wms.nrw.de/wms/strassen_nrw_wms",visible:!0,sublayers:[{name:"1",title:"Verwaltungen",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/legends/wms/strassen_nrw_wms/1.png"}}},{name:"4",title:"Abschnitte und Äste"},{name:"6",title:"Unfälle"}]})}const Ka=Symbol(),Ro=Symbol(),nt="a",jt="w";let Ya=(o,e)=>new Proxy(o,e);const wo=Object.getPrototypeOf,yo=new WeakMap,qs=o=>o&&(yo.has(o)?yo.get(o):wo(o)===Object.prototype||wo(o)===Array.prototype),Xo=o=>typeof o=="object"&&o!==null,Xa=o=>{if(Array.isArray(o))return Array.from(o);const e=Object.getOwnPropertyDescriptors(o);return Object.values(e).forEach(t=>{t.configurable=!0}),Object.create(wo(o),e)},Ks=o=>o[Ro]||o,Ys=(o,e,t,s)=>{if(!qs(o))return o;let n=s&&s.get(o);if(!n){const u=Ks(o);n=(l=>Object.values(Object.getOwnPropertyDescriptors(l)).some(d=>!d.configurable&&!d.writable))(u)?[u,Xa(u)]:[u],s?.set(o,n)}const[r,i]=n;let a=t&&t.get(r);return a&&a[1].f===!!i||(a=((u,l)=>{const d={f:l};let h=!1;const g=(w,S)=>{if(!h){let T=d[nt].get(u);if(T||(T={},d[nt].set(u,T)),w===jt)T[jt]=!0;else{let P=T[w];P||(P=new Set,T[w]=P),P.add(S)}}},m={get:(w,S)=>S===Ro?u:(g("k",S),Ys(Reflect.get(w,S),d[nt],d.c,d.t)),has:(w,S)=>S===Ka?(h=!0,d[nt].delete(u),!0):(g("h",S),Reflect.has(w,S)),getOwnPropertyDescriptor:(w,S)=>(g("o",S),Reflect.getOwnPropertyDescriptor(w,S)),ownKeys:w=>(g(jt),Reflect.ownKeys(w))};return l&&(m.set=m.deleteProperty=()=>!1),[m,d]})(r,!!i),a[1].p=Ya(i||r,a[0]),t&&t.set(r,a)),a[1][nt]=e,a[1].c=t,a[1].t=s,a[1].p},Xs=(o,e,t,s)=>{if(Object.is(o,e))return!1;if(!Xo(o)||!Xo(e))return!0;const n=t.get(Ks(o));if(!n)return!0;if(s){const i=s.get(o);if(i&&i.n===e)return i.g;s.set(o,{n:e,g:!1})}let r=null;try{for(const i of n.h||[])if(r=Reflect.has(o,i)!==Reflect.has(e,i),r)return r;if(n[jt]===!0){if(r=((i,a)=>{const u=Reflect.ownKeys(i),l=Reflect.ownKeys(a);return u.length!==l.length||u.some((d,h)=>d!==l[h])})(o,e),r)return r}else for(const i of n.o||[])if(r=!!Reflect.getOwnPropertyDescriptor(o,i)!=!!Reflect.getOwnPropertyDescriptor(e,i),r)return r;for(const i of n.k||[])if(r=Xs(o[i],e[i],t,s),r)return r;return r===null&&(r=!0),r}finally{s&&s.set(o,{n:e,g:r})}},Za=o=>qs(o)&&o[Ro]||null,Zo=(o,e=!0)=>{yo.set(o,e)};const oo=o=>typeof o=="object"&&o!==null,ve=new WeakMap,ut=new WeakSet,Ja=(o=Object.is,e=(l,d)=>new Proxy(l,d),t=l=>oo(l)&&!ut.has(l)&&(Array.isArray(l)||!(Symbol.iterator in l))&&!(l instanceof WeakMap)&&!(l instanceof WeakSet)&&!(l instanceof Error)&&!(l instanceof Number)&&!(l instanceof Date)&&!(l instanceof String)&&!(l instanceof RegExp)&&!(l instanceof ArrayBuffer),s=l=>{switch(l.status){case"fulfilled":return l.value;case"rejected":throw l.reason;default:throw l}},n=new WeakMap,r=(l,d,h=s)=>{const g=n.get(l);if(g?.[0]===d)return g[1];const m=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l));return Zo(m,!0),n.set(l,[d,m]),Reflect.ownKeys(l).forEach(w=>{if(Object.getOwnPropertyDescriptor(m,w))return;const S=Reflect.get(l,w),{enumerable:T}=Reflect.getOwnPropertyDescriptor(l,w),P={value:S,enumerable:T,configurable:!0};if(ut.has(S))Zo(S,!1);else if(S instanceof Promise)delete P.value,P.get=()=>h(S);else if(ve.has(S)){const[I,L]=ve.get(S);P.value=r(I,L(),h)}Object.defineProperty(m,w,P)}),Object.preventExtensions(m)},i=new WeakMap,a=[1,1],u=l=>{if(!oo(l))throw new Error("object required");const d=i.get(l);if(d)return d;let h=a[0];const g=new Set,m=(b,y=++a[0])=>{h!==y&&(h=y,g.forEach(f=>f(b,y)))};let w=a[1];const S=(b=++a[1])=>(w!==b&&!g.size&&(w=b,P.forEach(([y])=>{const f=y[1](b);f>h&&(h=f)})),h),T=b=>(y,f)=>{const _=[...y];_[1]=[b,..._[1]],m(_,f)},P=new Map,I=(b,y)=>{if(g.size){const f=y[3](T(b));P.set(b,[y,f])}else P.set(b,[y])},L=b=>{var y;const f=P.get(b);f&&(P.delete(b),(y=f[1])==null||y.call(f))},Y=b=>(g.add(b),g.size===1&&P.forEach(([f,_],M)=>{const x=f[3](T(M));P.set(M,[f,x])}),()=>{g.delete(b),g.size===0&&P.forEach(([f,_],M)=>{_&&(_(),P.set(M,[f]))})}),X=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l)),W=e(X,{deleteProperty(b,y){const f=Reflect.get(b,y);L(y);const _=Reflect.deleteProperty(b,y);return _&&m(["delete",[y],f]),_},set(b,y,f,_){const M=Reflect.has(b,y),x=Reflect.get(b,y,_);if(M&&(o(x,f)||i.has(f)&&o(x,i.get(f))))return!0;L(y),oo(f)&&(f=Za(f)||f);let E=f;if(f instanceof Promise)f.then(F=>{f.status="fulfilled",f.value=F,m(["resolve",[y],F])}).catch(F=>{f.status="rejected",f.reason=F,m(["reject",[y],F])});else{!ve.has(f)&&t(f)&&(E=u(f));const F=!ut.has(E)&&ve.get(E);F&&I(y,F)}return Reflect.set(b,y,E,_),m(["set",[y],f,x]),!0}});i.set(l,W);const v=[X,S,r,Y];return ve.set(W,v),Reflect.ownKeys(l).forEach(b=>{const y=Object.getOwnPropertyDescriptor(l,b);"value"in y&&(W[b]=l[b],delete y.value,delete y.writable),Object.defineProperty(X,b,y)}),W})=>[u,ve,ut,o,e,t,s,n,r,i,a],[Qa]=Ja();function Zs(o={}){return Qa(o)}function el(o,e,t){const s=ve.get(o);let n;const r=[],i=s[3];let a=!1;const l=i(d=>{if(r.push(d),t){e(r.splice(0));return}n||(n=Promise.resolve().then(()=>{n=void 0,a&&e(r.splice(0))}))});return a=!0,()=>{a=!1,l()}}function Jo(o,e){const t=ve.get(o),[s,n,r]=t;return r(s,n(),e)}function rt(o){return ut.add(o),o}var Js={exports:{}},Qs={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ze=p;function tl(o,e){return o===e&&(o!==0||1/o===1/e)||o!==o&&e!==e}var ol=typeof Object.is=="function"?Object.is:tl,sl=Ze.useState,nl=Ze.useEffect,rl=Ze.useLayoutEffect,il=Ze.useDebugValue;function al(o,e){var t=e(),s=sl({inst:{value:t,getSnapshot:e}}),n=s[0].inst,r=s[1];return rl(function(){n.value=t,n.getSnapshot=e,so(n)&&r({inst:n})},[o,t,e]),nl(function(){return so(n)&&r({inst:n}),o(function(){so(n)&&r({inst:n})})},[o]),il(t),t}function so(o){var e=o.getSnapshot;o=o.value;try{var t=e();return!ol(o,t)}catch{return!0}}function ll(o,e){return e()}var cl=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ll:al;Qs.useSyncExternalStore=Ze.useSyncExternalStore!==void 0?Ze.useSyncExternalStore:cl;Js.exports=Qs;var ul=Js.exports;const dl=xn(ul),{use:Qo}=bs,{useSyncExternalStore:hl}=dl;const pl=new WeakMap;function Je(o,e){const t=e?.sync,s=p.useRef(),n=p.useRef();let r=!0;const i=hl(p.useCallback(l=>{const d=el(o,l,t);return l(),d},[o,t]),()=>{const l=Jo(o,Qo);try{if(!r&&s.current&&n.current&&!Xs(s.current,l,n.current,new WeakMap))return s.current}catch{}return l},()=>Jo(o,Qo));r=!1;const a=new WeakMap;p.useEffect(()=>{s.current=i,n.current=a});const u=p.useMemo(()=>new WeakMap,[]);return Ys(i,a,u,pl)}function fl(o){const e=Zs({data:Array.from(o||[]),has(t){return this.data.some(s=>s[0]===t)},set(t,s){const n=this.data.find(r=>r[0]===t);return n?n[1]=s:this.data.push([t,s]),this},get(t){var s;return(s=this.data.find(n=>n[0]===t))==null?void 0:s[1]},delete(t){const s=this.data.findIndex(n=>n[0]===t);return s===-1?!1:(this.data.splice(s,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(t){this.data.forEach(s=>{t(s[1],s[0],this)})},keys(){return this.data.map(t=>t[0]).values()},values(){return this.data.map(t=>t[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}class gl{label;filteredTypes;httpService;constructor(e,t,s){this.label=e,this.filteredTypes=t,this.httpService=s}async search(e,{mapProjection:t,signal:s}){const n=await this.request(e,100,s),r=new Kt({dataProjection:"EPSG:4326",featureProjection:t});return n.features.filter(i=>this.filteredTypes.includes(i.properties.type)).map((i,a)=>{const u=r.readGeometry(i.geometry);return{id:i.properties.osm_id||a,label:this.createLabel(i),geometry:u,properties:i.properties}})}async request(e,t,s){const n=new URL("https://photon.komoot.io/api?");n.searchParams.set("q",e),n.searchParams.set("lang","de"),n.searchParams.set("lat","51.961563"),n.searchParams.set("lon","7.628202"),n.searchParams.set("limit",t.toString());const r=await this.httpService.fetch(n,{signal:s});if(!r.ok)throw new Error("Request failed: "+r.status);return await r.json()}createLabel(e){return`${e.properties.name} (${e.properties.osm_value?e.properties.osm_value+", ":""}${e.properties.postcode?e.properties.postcode+", ":""}${e.properties.city?e.properties.city+", ":""}${e.properties.country?e.properties.country+")":")"}`}}const ml=ke("ol-app:AppModel");class vl{_intl;_mapRegistry;_ogcSearchSourceFactory;_vectorSelectionSourceFactory;_httpService;_state;_resources=[];constructor({references:e,intl:t}){this._mapRegistry=e.mapRegistry,this._intl=t,this._ogcSearchSourceFactory=e.ogcSearchSourceFactory,this._vectorSelectionSourceFactory=e.vectorSelectionSourceFactory,this._httpService=e.httpService,this._state=Zs({searchSources:[],selectionSources:[],sourceMetadata:fl(),resultListState:{input:void 0,open:!1,key:0}}),this.initSearchSources(),this.initSelectionSources().catch(s=>{ml.error("Failed to initialize selection sources",s)})}destroy(){this._resources.forEach(e=>e.destroy())}get state(){return this._state}setResultListInput(e){const t=this._state.resultListState.key;this._state.resultListState={open:!0,key:t+1,input:e}}setResultListVisibility(e){this._state.resultListState.open=e}initSearchSources(){const e=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.lika"}),baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"flurstueck",searchProperty:"flurstid",labelProperty:"objid"}),t=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.miningPermissions"}),baseUrl:"https://ogc-api.nrw.de/inspire-am-bergbauberechtigungen/v1",collectionId:"managementrestrictionorregulationzone",searchProperty:"thematicId",labelProperty:"name",renderLabel(n){const r=n?.properties?.name,i=n?.id;return typeof r=="string"?r+" ("+i+")":String(i)},rewriteUrl(n){return n.searchParams.set("properties","name"),n}}),s=new gl("Photon Geocoder",["city","street"],this._httpService);this._state.searchSources=[rt(e),rt(t),rt(s)]}async initSelectionSources(){const e=["ogc_kitas","ogc_kataster"],t=await this._mapRegistry.expectMapModel(z),s=t.layers.getOperationalLayers({sortByDisplayOrder:!0});for(const n of s){if(!e.includes(n.id)||!bl(n.olLayer))continue;const r=this._vectorSelectionSourceFactory.createSelectionSource({vectorLayer:n.olLayer,label:n.title}),i=r.on("changed:status",()=>{r.status!=="available"&&(r.status==="unavailable"||r.status?.kind==="unavailable")&&t.removeHighlight()});this._resources.push(i,r),this._state.selectionSources.unshift(rt(r)),this._state.sourceMetadata.set(rt(r),n.attributes.resultListMetadata)}}}function bl(o){return o instanceof he&&o.getSource()instanceof Ie}const Mt={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Lt extends xs{constructor(e,t){super(e),this.feature=t}}function wl(o,e){const t=[];for(let s=0;s<e.length;++s){const r=e[s].getGeometry();en(o,r,t)}return t}function Tt(o,e){return As(o[0],o[1],e[0],e[1])}function Ne(o,e){const t=o.length;return e<0?o[e+t]:e>=t?o[e-t]:o[e]}function At(o,e,t){let s,n;e<t?(s=e,n=t):(s=t,n=e);const r=Math.ceil(s),i=Math.floor(n);if(r>i){const u=Fe(o,s),l=Fe(o,n);return Tt(u,l)}let a=0;if(s<r){const u=Fe(o,s),l=Ne(o,r);a+=Tt(u,l)}if(i<n){const u=Ne(o,i),l=Fe(o,n);a+=Tt(u,l)}for(let u=r;u<i-1;++u){const l=Ne(o,u),d=Ne(o,u+1);a+=Tt(l,d)}return a}function en(o,e,t){if(e instanceof Be){Rt(o,e.getCoordinates(),!1,t);return}if(e instanceof Fs){const s=e.getCoordinates();for(let n=0,r=s.length;n<r;++n)Rt(o,s[n],!1,t);return}if(e instanceof qt){const s=e.getCoordinates();for(let n=0,r=s.length;n<r;++n)Rt(o,s[n],!0,t);return}if(e instanceof Vs){const s=e.getCoordinates();for(let n=0,r=s.length;n<r;++n){const i=s[n];for(let a=0,u=i.length;a<u;++a)Rt(o,i[a],!0,t)}return}if(e instanceof Wr){const s=e.getGeometries();for(let n=0;n<s.length;++n)en(o,s[n],t);return}}const no={index:-1,endIndex:NaN};function yl(o,e,t,s){const n=o[0],r=o[1];let i=1/0,a=-1,u=NaN;for(let h=0;h<e.targets.length;++h){const g=e.targets[h],m=g.coordinates;let w=1/0,S;for(let T=0;T<m.length-1;++T){const P=m[T],I=m[T+1],L=tn(n,r,P,I);L.squaredDistance<w&&(w=L.squaredDistance,S=T+L.along)}w<i&&(i=w,g.ring&&e.targetIndex===h&&(g.endIndex>g.startIndex?S<g.startIndex&&(S+=m.length):g.endIndex<g.startIndex&&S>g.startIndex&&(S-=m.length)),u=S,a=h)}const l=e.targets[a];let d=l.ring;if(e.targetIndex===a&&d){const h=Fe(l.coordinates,u),g=t.getPixelFromCoordinate(h);Ts(g,e.startPx)>s&&(d=!1)}if(d){const h=l.coordinates,g=h.length,m=l.startIndex,w=u;if(m<w){const S=At(h,m,w);At(h,m,w-g)<S&&(u-=g)}else{const S=At(h,m,w);At(h,m,w+g)<S&&(u+=g)}}return no.index=a,no.endIndex=u,no}function Rt(o,e,t,s){const n=o[0],r=o[1];for(let i=0,a=e.length-1;i<a;++i){const u=e[i],l=e[i+1],d=tn(n,r,u,l);if(d.squaredDistance===0){const h=i+d.along;s.push({coordinates:e,ring:t,startIndex:h,endIndex:h});return}}}const ro={along:0,squaredDistance:0};function tn(o,e,t,s){const n=t[0],r=t[1],i=s[0],a=s[1],u=i-n,l=a-r;let d=0,h=n,g=r;return(u!==0||l!==0)&&(d=cr(((o-n)*u+(e-r)*l)/(u*u+l*l),0,1),h+=u*d,g+=l*d),ro.along=d,ro.squaredDistance=ar(As(o,e,h,g),10),ro}function Fe(o,e){const t=o.length;let s=Math.floor(e);const n=e-s;s>=t?s-=t:s<0&&(s+=t);let r=s+1;r>=t&&(r-=t);const i=o[s],a=i[0],u=i[1],l=o[r],d=l[0]-a,h=l[1]-u;return[a+d*n,u+h*n]}class Sl extends Jn{constructor(e){const t=e;t.stopDown||(t.stopDown=Qn),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=xl(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:er,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let s=e.geometryFunction;if(!s){const n=this.mode_;if(n==="Circle")s=function(r,i,a){const u=i||new ba([NaN,NaN]),l=Vo(r[0]),d=tr(l,Vo(r[r.length-1]));return u.setCenterAndRadius(l,Math.sqrt(d),this.geometryLayout_),u};else{let r;n==="Point"?r=Ve:n==="LineString"?r=Be:n==="Polygon"&&(r=qt),s=function(i,a,u){return a?n==="Polygon"?i[0].length?a.setCoordinates([i[0].concat([i[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(i,this.geometryLayout_):a=new r(i,this.geometryLayout_),a}}}this.geometryFunction_=s,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new he({source:new Ie({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:_l(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:or,this.freehandCondition_,e.freehand?this.freehandCondition_=Bo:this.freehandCondition_=e.freehandCondition?e.freehandCondition:sr,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(nr.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Bo:t=e:t=lr,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Ls.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===ge.POINTERMOVE,s=!0;return!this.freehand_&&this.lastDragTime_&&e.type===ge.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===ge.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),s=!1):this.freehand_&&e.type===ge.POINTERDOWN?s=!1:t&&this.getPointerCount()<2?(s=e.type===ge.POINTERMOVE,s&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===ge.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===ge.DBLCLICK&&(s=!1),super.handleEvent(e)&&s}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new rr(ge.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),s=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),n=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=Ss([s,n]),i=this.traceSource_.getFeaturesInExtent(r);if(i.length===0)return;const a=wl(e.coordinate,i);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const s=e.startIndex<=e.endIndex,n=e.startIndex<=t;s===n?s&&t>e.endIndex||!s&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(s&&t<e.endIndex||!s&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let s=0;if(e<t){const n=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),s=r-n+1}else{const n=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),s=n-r+1}s>0&&this.removeLastPoints_(s)}addTracedCoordinates_(e,t,s){if(t===s)return;const n=[];if(t<s){const r=Math.ceil(t);let i=Math.floor(s);i===s&&(i-=1);for(let a=r;a<=i;++a)n.push(Ne(e.coordinates,a))}else{const r=Math.floor(t);let i=Math.ceil(s);i===s&&(i+=1);for(let a=r;a>=i;--a)n.push(Ne(e.coordinates,a))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Ts(t.startPx,e.pixel)<this.snapTolerance_)return;const s=yl(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==s.index){if(t.targetIndex!==-1){const u=t.targets[t.targetIndex];this.removeTracedCoordinates_(u.startIndex,u.endIndex)}const a=t.targets[s.index];this.addTracedCoordinates_(a,a.startIndex,s.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,s.endIndex)}t.targetIndex=s.index;const n=t.targets[t.targetIndex];n.endIndex=s.endIndex;const r=Fe(n.coordinates,n.endIndex),i=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(i[0]),Math.round(i[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const s=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():!this.freehand_&&(!n||this.mode_==="Point")&&(this.atFinish_(e.pixel,s)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,s=e.pixel,n=t[0]-s[0],r=t[1]-s[1],i=n*n+r*r;if(this.shouldHandle_=this.freehand_?i>this.squaredClickTolerance_:i<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let s=!1;if(this.sketchFeature_){let n=!1,r=[this.finishCoordinate_];const i=this.mode_;if(i==="Point")s=!0;else if(i==="Circle")s=this.sketchCoords_.length===2;else if(i==="LineString")n=!t&&this.sketchCoords_.length>this.minPoints_;else if(i==="Polygon"){const a=this.sketchCoords_;n=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(n){const a=this.getMap();for(let u=0,l=r.length;u<l;u++){const d=r[u],h=a.getPixelFromCoordinate(d),g=e[0]-h[0],m=e[1]-h[1],w=this.freehand_?1:this.snapTolerance_;if(s=Math.sqrt(g*g+m*m)<=w,s){this.finishCoordinate_=d;break}}}}return s}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Ce(new Ve(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Ce);const t=e.getLinearRing(0);let s=this.sketchLine_.getGeometry();s?(s.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),s.changed()):(s=new Be(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(s))}startDrawing_(e){const t=this.getMap().getView().getProjection(),s=Go(this.geometryLayout_);for(;e.length<s;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Ce(new Be(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Ce,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new Lt(Mt.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),s=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),r=Go(this.geometryLayout_);let i,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(i=this.sketchCoords_[0],a=i[i.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(i=this.sketchCoords_,a=i[i.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,s,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),s.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(s):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection();let n,r;const i=this.mode_;i==="LineString"||i==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),this.geometryFunction_(r,t,s)):i==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),n&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,s)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),s=this.getMap().getView().getProjection(),n=this.mode_;for(let r=0;r<e;++r){let i;if(n==="LineString"||n==="Circle"){if(i=this.sketchCoords_,i.splice(-2,1),i.length>=2){this.finishCoordinate_=i[i.length-2].slice();const a=this.finishCoordinate_.slice();i[i.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(i,t,s),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n==="Polygon"){i=this.sketchCoords_[0],i.splice(-2,1);const a=this.sketchLine_.getGeometry();if(i.length>=2){const u=i[i.length-2].slice();i[i.length-1]=u,this.createOrUpdateSketchPoint_(u)}a.setCoordinates(i),this.geometryFunction_(this.sketchCoords_,t,s)}if(i.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const s=e.getGeometry(),n=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,s,n)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,s,n),t=s.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new Ur([t])):this.type_==="MultiLineString"?e.setGeometry(new Fs([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Vs([t])),this.dispatchEvent(new Lt(Mt.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Lt(Mt.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,s=!this.sketchFeature_;s&&this.startDrawing_(e[0]);let n;if(t==="LineString"||t==="Circle")n=this.sketchCoords_;else if(t==="Polygon")n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;s&&n.shift(),n.pop();for(let i=0;i<e.length;i++)this.addToDrawing_(e[i]);const r=e[e.length-1];this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const s=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=s.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new Ce(new Ve(n)),this.updateSketchFeatures_(),this.dispatchEvent(new Lt(Mt.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function _l(){const o=ir();return function(e,t){return o[e.getGeometry().getType()]}}function xl(o){switch(o){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+o)}}const on=Sl;async function kl(o,e,t,s){const r=s.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),i=await o.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${r}>`}});if(!i||!i.ok||i.status!==201)return Promise.reject(new Error("Request failed: "+i.status));const a=i.headers.get("location");if(!a)return Promise.reject(new Error("Request failed: no Location response header"));const u=a.substring(a.lastIndexOf("/")+1);return Promise.resolve(u)}var be;class Cl extends Lo{constructor(t){super();R(this,be,void 0);$(this,"_httpService");$(this,"_intl");$(this,"_map");$(this,"_polygonDrawStyle");$(this,"_state");$(this,"_editLayerURL");$(this,"_drawSource");$(this,"_drawLayer");$(this,"_drawInteraction");$(this,"_olMap");$(this,"_mapContainer");$(this,"_tooltip");$(this,"_enterHandler");$(this,"_escapeHandler");$(this,"_interactionListener");$(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonDrawStyle=t.polygonDrawStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._drawSource=new Ie,this._drawLayer=new he({source:this._drawSource,zIndex:Po,properties:{name:"editing-layer"}}),this._drawInteraction=new on({source:this._drawSource,type:"Polygon",style:this._polygonDrawStyle}),this._tooltip=this._createTooltip(this._olMap),this._enterHandler=s=>{if(s.code==="Enter"&&s.target===this._olMap.getTargetElement()){const n=this._drawInteraction.getOverlay().getSource().getFeatures();n[0]&&n[0].getGeometry().getCoordinates()[0].length>4&&this._drawInteraction.finishDrawing()}},this._escapeHandler=s=>{s.code==="Escape"&&s.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_start(){this._olMap.addLayer(this._drawLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.element.classList.remove("editing-tooltip-hidden");const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.continue"})}),s=this._drawInteraction.on("drawend",r=>{this._setState("active:saving");const i=this._editLayerURL,a=r.feature.getGeometry();if(!a){this._destroy(),k(this,be)?.reject(new Error("no geometry available"));return}const u=this._olMap.getView().getProjection(),d=new Kt({dataProjection:u}).writeGeometryObject(a,{rightHanded:!0,decimals:10});kl(this._httpService,i,d,u).then(h=>{this._destroy(),k(this,be)?.resolve(h)}).catch(h=>{console.log(h),this._destroy(),k(this,be)?.reject(h)})}),n=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(t,s),this._mapListener.push(n)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.begin"}),this._setState("active:initialized")}stop(){this._destroy(),k(this,be)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._drawLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{ie(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._state="inactive"}whenComplete(){return(k(this,be)??D(this,be,kn())).promise}_createTooltip(t){const s=document.createElement("div");s.className="editing-tooltip editing-tooltip-hidden",s.textContent=this._intl.formatMessage({id:"tooltip.begin"});const n=new ht({element:s,offset:[15,0],positioning:"center-left"}),r=t.on("pointermove",i=>{i.dragging||n.setPosition(i.coordinate)});return t.addOverlay(n),{overlay:n,element:s,destroy(){ie(r),t.removeOverlay(n)}}}}be=new WeakMap;class El{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}start(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const s=e.id;let n=this._workflows.get(s);if(n)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return n=new Cl({map:e,ogcApiFeatureLayerUrl:t,polygonDrawStyle:this._serviceOptions.properties.polygonDrawStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(s,n),this._connectToWorkflowComplete(n,s),n}stop(e){const t=this._workflows.get(e);if(t)t.stop();else return new Error("No workflow found for mapId: "+e)}reset(e){const t=this._workflows.get(e);if(t)t.reset();else return new Error("No workflow found for mapId: "+e)}_connectToWorkflowComplete(e,t){e.whenComplete().finally(()=>{this._workflows.delete(t)})}}new Ve([407354,5754673]),new Ve([404740,5757893]);var Pe,we,vt,bt,wt,So;class Pl extends Lo{constructor(t,s,n){super();R(this,wt);$(this,"label");R(this,Pe,{kind:"available"});R(this,we,void 0);R(this,vt,void 0);R(this,bt,void 0);this.label=s,D(this,we,t),D(this,bt,n),H(this,wt,So).call(this),D(this,vt,k(this,we).on("change:visible",()=>{H(this,wt,So).call(this)}))}destroy(){ie(k(this,vt))}get status(){return k(this,Pe)}async select(t,s){if(t.type!=="extent")throw new Error(`Unsupported selection kind: ${t.type}`);if(k(this,Pe).kind!=="available"||k(this,we).getSource()===null)return[];const n=[];k(this,we).getSource().forEachFeatureIntersectingExtent(t.extent,a=>{if(!a.getGeometry())return;const u={...a.getProperties()};delete u.geometries;const l={id:a.getId()?.toString()||Rs(),geometry:a.getGeometry(),properties:u};n.push(l)});const r=n.filter(a=>a!=null);return r.length>s.maxResults?r.slice(0,s.maxResults):r}}Pe=new WeakMap,we=new WeakMap,vt=new WeakMap,bt=new WeakMap,wt=new WeakSet,So=function(){const s=k(this,we).getVisible()?{kind:"available"}:{kind:"unavailable",reason:k(this,bt)};s.kind!==k(this,Pe).kind&&(D(this,Pe,s),this.emit("changed:status"))};var yt;class Ml{constructor({intl:e}){R(this,yt,void 0);D(this,yt,e)}createSelectionSource(e){return new Pl(e.vectorLayer,e.label,k(this,yt).formatMessage({id:"layerNotVisibleReason"}))}}yt=new WeakMap;const Te=ke("local-storage"),Ll=0,re={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var He,te,ye,$e,oe,zt,sn,Ut,nn,Me,dt,Se,je,Wt,rn;class Tl{constructor(e){R(this,zt);R(this,Ut);R(this,Me);R(this,Se);R(this,Wt);R(this,He,void 0);R(this,te,{});R(this,ye,void 0);R(this,$e,void 0);R(this,oe,void 0);D(this,He,Dl(e.properties)),D(this,ye,Ol()),k(this,ye)&&(H(this,Ut,nn).call(this),D(this,$e,H(this,Wt,rn).call(this)))}destroy(){k(this,oe)&&(clearTimeout(k(this,oe)),D(this,oe,void 0)),k(this,ye)&&H(this,Me,dt).call(this)}get isSupported(){return!!k(this,$e)}get(e){return H(this,Se,je).call(this).get(e)}set(e,t){return H(this,Se,je).call(this).set(e,t)}remove(e){return H(this,Se,je).call(this).remove(e)}removeAll(){return H(this,Se,je).call(this).removeAll()}getNamespace(e){return H(this,Se,je).call(this).getNamespace(e)}}He=new WeakMap,te=new WeakMap,ye=new WeakMap,$e=new WeakMap,oe=new WeakMap,zt=new WeakSet,sn=function(){k(this,oe)&&clearTimeout(k(this,oe)),D(this,oe,setTimeout(()=>{D(this,oe,void 0),H(this,Me,dt).call(this)},Ll))},Ut=new WeakSet,nn=function(){try{const e=k(this,ye);if(!e)throw new ne(re.INTERNAL,"Local storage is not available.");const t=e.getItem(k(this,He));if(t==null){D(this,te,{}),H(this,Me,dt).call(this);return}try{const s=JSON.parse(t);if(!Qe(s))throw new ne(re.CORRUPTED_DATA,"Persisted value should be an object.");D(this,te,s)}catch(s){Te.warn("Invalid persisted data, reverting to default.",s),D(this,te,{}),H(this,Me,dt).call(this)}}catch(e){Te.error("Failed to load from local storage",e)}},Me=new WeakSet,dt=function(){try{const e=k(this,ye);if(!e)throw new ne(re.INTERNAL,"Local storage is not available.");const t=JSON.stringify(k(this,te));e.setItem(k(this,He),t)}catch(e){Te.error("Failed to save to local storage",e)}},Se=new WeakSet,je=function(){const e=k(this,$e);if(!e)throw new ne(re.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},Wt=new WeakSet,rn=function(){const e={getByPath:t=>ts(Al(k(this,te),t)),setByPath:(t,s)=>{if(!Il(s))throw new ne(re.INVALID_VALUE,"The value is not supported by local storage.");if(s=ts(s),t.length===0){if(!Qe(s))throw new ne(re.INVALID_VALUE,"The root value must be a plain object.");D(this,te,s)}else Rl(k(this,te),t,s);H(this,zt,sn).call(this)}};return new Io([],e)};class Io{path;access;constructor(e,t){this.path=e,this.access=t}get(e){return this.access.getByPath([...this.path,e])}set(e,t){this.access.setByPath([...this.path,e],t)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const t=this.get(e);if(t===void 0)this.set(e,{});else if(!Qe(t))throw new ne(re.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new Io(this.path.concat([e]),this.access)}}const es="trails-state";function Al(o,e){let t=o;for(const s of e){if(!Qe(t))throw new ne(re.INVALID_PATH,`Cannot get nested property '${s}' because the parent is no object.`);t=t[s]}return t}function Rl(o,e,t){if(!e.length)throw new ne(re.INTERNAL,"Path must not be empty.");let s=o;for(let r=0,i=e.length-1;r<i;++r){const a=e[r],u=s[a];if(!Qe(u))throw new ne(re.INVALID_PATH,`Cannot set property on '${a}' because it is no object.`);s=u}const n=e[e.length-1];s[n]=t}function Qe(o){return!!(o&&typeof o=="object"&&!Array.isArray(o))}function Il(o){const e=typeof o;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||o===null||Array.isArray(o)||Qe(o)}function Dl(o){const e=o.storageId;return!e||typeof e!="string"?(Te.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${es}'.`),es):e}function Ol(){if(typeof Storage>"u"){Te.warn("Local storage is not supported by this browser.");return}try{const o=globalThis.localStorage;if(!o){Te.warn("Local storage is not supported by this browser.");return}return o}catch(o){Te.warn("Local storage is not supported by this browser.",o);return}}function ts(o){return o!=null&&(o=JSON.parse(JSON.stringify(o))),o}const jl={"ol-map":{name:"ol-map",services:{MapConfigProviderImpl:{name:"MapConfigProviderImpl",clazz:Va,provides:[{name:"map.MapConfigProvider",qualifier:void 0}],references:{vectorSourceFactory:{name:"ogc-features.VectorSourceFactory",qualifier:void 0,all:!1}}},AppModel:{name:"AppModel",clazz:vl,provides:[{name:"ol-app.AppModel",qualifier:void 0}],references:{ogcSearchSourceFactory:{name:"ogc-features.SearchSourceFactory",qualifier:void 0,all:!1},vectorSelectionSourceFactory:{name:"selection.VectorSelectionSourceFactory",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1},mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1},{name:"ol-app.AppModel",qualifier:void 0,all:!1},{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"editing.EditingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/runtime":{name:"@open-pioneer/runtime",services:{},ui:{references:[]},properties:{}},"@open-pioneer/chakra-integration":{name:"@open-pioneer/chakra-integration",services:{},ui:{references:[]},properties:{}},"@open-pioneer/http":{name:"@open-pioneer/http",services:{HttpServiceImpl:{name:"HttpServiceImpl",clazz:ur,provides:[{name:"http.HttpService",qualifier:"http.HttpService"}],references:{interceptors:{name:"http.Interceptor",qualifier:void 0,all:!0}}}},ui:{references:[]},properties:{}},"@open-pioneer/theme":{name:"@open-pioneer/theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/notifier":{name:"@open-pioneer/notifier",services:{NotificationServiceImpl:{name:"NotificationServiceImpl",clazz:$r,provides:[{name:"notifier.NotificationService",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/base-theme":{name:"@open-pioneer/base-theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/core":{name:"@open-pioneer/core",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime-react-support":{name:"@open-pioneer/runtime-react-support",services:{},ui:{references:[]},properties:{}},"@open-pioneer/map":{name:"@open-pioneer/map",services:{MapRegistryImpl:{name:"MapRegistryImpl",clazz:dr,provides:[{name:"map.MapRegistry",qualifier:void 0}],references:{providers:{name:"map.MapConfigProvider",qualifier:void 0,all:!0},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/react-utils":{name:"@open-pioneer/react-utils",services:{},ui:{references:[]},properties:{}},"@open-pioneer/ogc-features":{name:"@open-pioneer/ogc-features",services:{VectorSourceFactory:{name:"VectorSourceFactory",clazz:Yr,provides:[{name:"ogc-features.VectorSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}},SearchSourceFactory:{name:"SearchSourceFactory",clazz:Xr,provides:[{name:"ogc-features.SearchSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{}},"@open-pioneer/coordinate-viewer":{name:"@open-pioneer/coordinate-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/overview-map":{name:"@open-pioneer/overview-map",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-bar":{name:"@open-pioneer/scale-bar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-viewer":{name:"@open-pioneer/scale-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/map-navigation":{name:"@open-pioneer/map-navigation",services:{},ui:{references:[]},properties:{}},"@open-pioneer/toc":{name:"@open-pioneer/toc",services:{},ui:{references:[]},properties:{}},"@open-pioneer/experimental-layout-sidebar":{name:"@open-pioneer/experimental-layout-sidebar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/geolocation":{name:"@open-pioneer/geolocation",services:{},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/legend":{name:"@open-pioneer/legend",services:{},ui:{references:[]},properties:{}},"@open-pioneer/editing":{name:"@open-pioneer/editing",services:{EditingServiceImpl:{name:"EditingServiceImpl",clazz:El,provides:[{name:"editing.EditingService",qualifier:void 0}],references:{mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{polygonDrawStyle:{value:{"stroke-color":"yellow","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(0, 0, 255, 0.2)","circle-stroke-color":"rgba(0, 0, 255, 0.7)","circle-stroke-width":2},required:!1}}},"@open-pioneer/result-list":{name:"@open-pioneer/result-list",services:{},ui:{references:[]},properties:{}},"@open-pioneer/measurement":{name:"@open-pioneer/measurement",services:{},ui:{references:[]},properties:{}},"@open-pioneer/selection":{name:"@open-pioneer/selection",services:{VectorSelectionSourceFactory:{name:"VectorSelectionSourceFactory",clazz:Ml,provides:[{name:"selection.VectorSelectionSourceFactory",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/spatial-bookmarks":{name:"@open-pioneer/spatial-bookmarks",services:{},ui:{references:[{name:"local-storage.LocalStorageService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/search":{name:"@open-pioneer/search",services:{},ui:{references:[]},properties:{}},"@open-pioneer/basemap-switcher":{name:"@open-pioneer/basemap-switcher",services:{},ui:{references:[]},properties:{}},"@open-pioneer/local-storage":{name:"@open-pioneer/local-storage",services:{LocalStorageServiceImpl:{name:"LocalStorageServiceImpl",clazz:Tl,provides:[{name:"local-storage.LocalStorageService",qualifier:void 0}],references:{}}},ui:{references:[]},properties:{storageId:{value:null,required:!1}}}},Nl=`.search-box{position:absolute;width:500px;max-width:100%;z-index:1}.spatial-bookmarks{max-height:300px}:root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.editing-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.editing-tooltip-hidden{visibility:hidden}.measurement-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.measurement-active-tooltip{background:rgba(0,0,0,.9);border-radius:4px;border-color:#000000e6;opacity:.9;color:#fff}.measurement-finished-tooltip{background-color:#4cb3ffe6;color:#000;border:1px solid white}.measurement-active-tooltip:before,.measurement-finished-tooltip:before{border-top:6px solid rgba(0,0,0,.9);border-right:6px solid transparent;border-left:6px solid transparent;content:"";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.measurement-finished-tooltip:before{border-top-color:#4cb3ff}.selection-drag-box{background-color:#ffffff4d!important;border:3px solid var(--chakra-colors-background_primary)!important}.selection-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.selection .react-select{cursor:default}.map-container .selection-active{cursor:crosshair}.map-container .selection-inactive{cursor:no-drop}.selection-source-value.selection-source-value--disabled{opacity:.4}.selection-source-value.selection-source-value--disabled span{margin:0 6px 0 0}.search-component .chakra-divider{display:none}.search-component .search-highlighted-match{font-weight:700}.search-component .search-value-container{cursor:text;padding-left:30px!important}.search-component .search-invisible{display:none}.overview-map .ol-overviewmap{position:relative;height:100%;width:100%}.overview-map .ol-overviewmap:not(.ol-collapsed){border:1px solid black}.overview-map .ol-overviewmap .ol-overviewmap-map{border:none;width:100%;height:100%}.overview-map .ol-overviewmap .ol-overviewmap-box{border:2px solid red}.scale-bar .ol-scale-bar{margin-bottom:8px;margin-right:8px}.scale-bar .ol-scale-bar,.scale-bar .ol-scale-line{position:relative;bottom:0;left:0;background:none}.scale-bar .ol-scale-bar .ol-scale-bar-inner,.scale-bar .ol-scale-bar .ol-scale-line-inner,.scale-bar .ol-scale-line .ol-scale-bar-inner,.scale-bar .ol-scale-line .ol-scale-line-inner{color:var(--chakra-white);border-color:var(--chakra-white)}.layout-sidebar{height:100%;position:absolute;top:0}.layout-sidebar[data-theme=light]{background-color:var(--chakra-colors-whiteAlpha-700)}.layout-sidebar[data-theme=dark]{background-color:var(--chakra-colors-blackAlpha-700)}.layout-sidebar .layout-sidebar-main{transition:width .3s ease-out 0s;border-right:1px solid var(--chakra-colors-chakra-border-color)}.layout-sidebar .layout-sidebar-content{overflow:auto;transition:width .3s ease-out 0s}.layout-sidebar .layout-sidebar-content .content-section .content-header{font-size:1.5em;background-color:var(--chakra-colors-blackAlpha-500);padding:.5rem 1rem}.layout-sidebar .layout-sidebar-content .content-section .content-body{padding:1rem}.result-list-no-data-message{text-align:center;margin-top:50px;font-weight:700;font-size:larger}.result-list-table th,.result-list-table td{overflow-wrap:break-word}.result-list-table.result-list-table--is-resizing *{cursor:col-resize}.result-list-table thead{position:sticky;top:0;z-index:1;background:var(--chakra-colors-background_body)}.result-list-table th{position:relative;border-right-width:thin}.result-list-table tbody tr:hover{background:var(--chakra-colors-background_light)}.result-list-table .result-list-resizer{position:absolute;top:0;height:100%;right:0;width:8px;background:var(--chakra-colors-trails-100);transform:scaleX(.25);cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none;padding-left:0}.result-list-table th:last-child .result-list-resizer{width:8px;transform:translate(50%) scaleX(.25)}.result-list-table th .result-list-resizer.result-list-resizer--is-resizing{background:var(--chakra-colors-trails-500);transform:scale(1)}.result-list-table th .result-list-resizer:hover{transform:scale(1)}
`,Fl=["en","de"];function Vl(o){switch(o){case"en":return Ko(()=>import("./715bd5bfa67a.js"),[],import.meta.url).then(e=>e.default);case"de":return Ko(()=>import("./ab9694ac880e.js"),[],import.meta.url).then(e=>e.default)}throw new Error(`Unsupported locale: '${o}'`)}const Bl=Cn(Nl),Gl=Object.freeze(Object.defineProperty({__proto__:null,loadMessages:Vl,locales:Fl,packages:jl,styles:Bl},Symbol.toStringTag,{value:"Module"})),zl="@open-pioneer/coordinate-viewer",Ul=pe.bind(void 0,zl),Wl=4,Hl=o=>{const{mapId:e,precision:t,displayProjectionCode:s}=o,{containerProps:n}=ae("coordinate-viewer",o),{map:r}=Z(e),i=r?.olMap,a=$s(i)?.getCode()??"";let{coordinates:u}=ql(i);u=u&&s?Yl(u,a,s):u;const l=$l(u,t),d=s||a,h=l?l+" "+d:"";return c.jsx(V,{...n,children:c.jsx(de,{className:"coordinate-viewer-text",children:h})})};function $l(o,e){const t=Ul();return o?Kl(o,e,t):""}function ql(o){const[e,t]=p.useState();return p.useEffect(()=>{if(!o)return;const s=o.on("pointermove",n=>{t(n.coordinate)});return()=>ie(s)},[o]),{coordinates:e}}function Kl(o,e,t){if(o[0]==null||o[1]==null)return"";const s=e??Wl,[n,r]=o,i=t.formatNumber(n,{maximumFractionDigits:s,minimumFractionDigits:s}),a=t.formatNumber(r,{maximumFractionDigits:s,minimumFractionDigits:s});return i+" "+a}function Yl(o,e,t){return hr(o,e,t)}var Xl=ai({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const io=.75,It=.1;let Zl=class extends Is{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",s=e.tipLabel!==void 0?e.tipLabel:"Overview map",n=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;const r=e.label!==void 0?e.label:"›";typeof r=="string"?(this.label_=document.createElement("span"),this.label_.textContent=r):this.label_=r;const i=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=s,a.appendChild(i),a.addEventListener(Ls.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const u=new pr({view:e.view,controls:new zo,interactions:new zo});this.ovmap_=u,e.layers&&e.layers.forEach(function(I){u.addLayer(I)});const l=document.createElement("div");l.className="ol-overviewmap-box",l.style.boxSizing="border-box",this.boxOverlay_=new ht({position:[0,0],positioning:"center-center",element:l}),this.ovmap_.addOverlay(this.boxOverlay_);const d=t+" "+Ds+" "+fr+(this.collapsed_&&this.collapsible_?" "+Uo:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=d,h.appendChild(this.ovmapDiv_),h.appendChild(a);const g=this,m=this.boxOverlay_,w=this.boxOverlay_.getElement(),S=function(I){return{clientX:I.clientX,clientY:I.clientY}},T=function(I){const L=S(I),Y=u.getEventCoordinateInternal(L);m.setPosition(Y)},P=function(I){const L=u.getEventCoordinateInternal(I);g.getMap().getView().setCenterInternal(L),window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",P)};w.addEventListener("mousedown",function(){window.addEventListener("mousemove",T),window.addEventListener("mouseup",P)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const s=t.getView();s&&this.unbindView_(s),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(ks(e,gr.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const s=e.getView();s&&(this.bindView_(s),s.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===to.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const s=this.getMap().getView();this.bindView_(s)}else!this.ovmap_.isRendered()&&(e.key===to.TARGET||e.key===to.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new Ps({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(Wo.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(Wo.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const s=e.getSize(),r=e.getView().calculateExtentInternal(s);if(this.viewExtent_&&mr(r,this.viewExtent_))return;this.viewExtent_=r;const i=t.getSize(),u=t.getView().calculateExtentInternal(i),l=t.getPixelFromCoordinateInternal(vr(r)),d=t.getPixelFromCoordinateInternal(br(r)),h=Math.abs(l[0]-d[0]),g=Math.abs(l[1]-d[1]),m=i[0],w=i[1];h<m*It||g<w*It||h>m*io||g>w*io?this.resetExtent_():Es(u,r)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,s=e.getSize(),r=e.getView().calculateExtentInternal(s),i=t.getView(),a=Math.log(io/It)/Math.LN2,u=1/(Math.pow(2,a/2)*It);wr(r,u),i.fitInternal(yr(r))}recenter_(){const e=this.getMap(),t=this.ovmap_,s=e.getView();t.getView().setCenterInternal(s.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const s=e.getSize(),n=e.getView(),r=t.getView(),i=this.rotateWithView_?0:-n.getRotation(),a=this.boxOverlay_,u=this.boxOverlay_.getElement(),l=n.getCenterInternal(),d=n.getResolution(),h=r.getResolution(),g=s[0]*d/h,m=s[1]*d/h;if(a.setPosition(l),u){u.style.width=g+"px",u.style.height=m+"px";const w="rotate("+i+"rad)";u.style.transform=w}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Sr(this.ovmap_,Cs.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Uo),this.collapsed_?Ho(this.collapseLabel_,this.label_):Ho(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};const Jl=Zl,ao="units",Ql=[1,2,5],it=25.4/.28;class ec extends Is{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const s=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=s+"-inner",this.element.className=s+" "+Ds,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(ao,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(ao)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(ao,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,s=e.projection,n=this.getUnits(),r=n=="degrees"?"degrees":"m";let i=uo(s,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||it)/it,u=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||it)/it:void 0;let l=a*i,d="";if(n=="degrees"){const L=_r.degrees;l*=L,l<L/60?(d="″",i*=3600):l<L?(d="′",i*=60):d="°"}else if(n=="imperial")l<.9144?(d="in",i/=.0254):l<1609.344?(d="ft",i/=.3048):(d="mi",i/=1609.344);else if(n=="nautical")i/=1852,d="NM";else if(n=="metric")l<.001?(d="μm",i*=1e6):l<1?(d="mm",i*=1e3):l<1e3?d="m":(d="km",i/=1e3);else if(n=="us")l<.9144?(d="in",i*=39.37):l<1609.344?(d="ft",i/=.30480061):(d="mi",i/=1609.3472);else throw new Error("Invalid units");let h=3*Math.floor(Math.log(a*i)/Math.log(10)),g,m,w,S,T,P;for(;;){w=Math.floor(h/3);const L=Math.pow(10,w);if(g=Ql[(h%3+3)%3]*L,m=Math.round(g/i),isNaN(m)){this.element.style.display="none",this.renderedVisible_=!1;return}if(u!==void 0&&m>=u){g=S,m=T,w=P;break}else if(m>=a)break;S=g,T=m,P=w,++h}const I=this.scaleBar_?this.createScaleBar(m,g,d):g.toFixed(w<0?-w:0)+" "+d;this.renderedHTML_!=I&&(this.innerElement_.innerHTML=I,this.renderedHTML_=I),this.renderedWidth_!=m&&(this.innerElement_.style.width=m+"px",this.renderedWidth_=m),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,s){const n=this.getScaleForResolution(),r=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),i=this.scaleBarSteps_,a=e/i,u=[this.createMarker("absolute")];for(let d=0;d<i;++d){const h=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";u.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(d%2===0||i===2?this.createStepText(d,e,!1,t,s):"")+"</div>")}return u.push(this.createStepText(i,e,!0,t,s)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+u.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,s,n,r){const a=(e===0?0:Math.round(n/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),u=e===0?-3:t/this.scaleBarSteps_*-1,l=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${u}px;text-align: ${e===0?"left":"center"};min-width: ${l}px;left: ${s?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=uo(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||it,s=1e3/25.4;return e*s*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const tc=ec,oc=o=>{const{mapId:e,displayMode:t="line"}=o,{containerProps:s}=ae("scale-bar",o),{map:n}=Z(e),r=p.useRef(null);return p.useEffect(()=>{if(r.current&&n){const i=n.olMap,a=new tc({units:"metric",target:r.current,bar:t==="bar"});return i.addControl(a),()=>{i.removeControl(a)}}},[t,n]),c.jsx(V,{...s,ref:r})},sc="@open-pioneer/scale-viewer",nc=pe.bind(void 0,sc),rc=o=>{const{mapId:e}=o,{containerProps:t}=ae("scale-viewer",o),{map:s}=Z(e),n=nc(),r=Ia(s?.olMap),i=r?n.formatNumber(r):void 0;return c.jsx(V,{...t,children:i&&c.jsxs(de,{children:["1:",i]})})},an="ol-map",xe=Yt.bind(void 0,an),De=pe.bind(void 0,an);let ic=0;function ac(o,e){const t=`atom${++ic}`,s={toString:()=>t};return typeof o=="function"?s.read=o:(s.init=o,s.read=function(n){return n(this)},s.write=function(n,r,i){return r(this,typeof i=="function"?i(n(this)):i)}),e&&(s.write=e),s}const os=o=>"init"in o,ss=o=>!!o.write,Ft=new WeakMap,lc=(o,e)=>{Ft.set(o,e),o.catch(()=>{}).finally(()=>Ft.delete(o))},ns=(o,e)=>{const t=Ft.get(o);t&&(Ft.delete(o),t(e))},rs=(o,e)=>{o.status="fulfilled",o.value=e},is=(o,e)=>{o.status="rejected",o.reason=e},cc=o=>typeof o?.then=="function",at=(o,e)=>!!o&&"v"in o&&"v"in e&&Object.is(o.v,e.v),as=(o,e)=>!!o&&"e"in o&&"e"in e&&Object.is(o.e,e.e),Oe=o=>!!o&&"v"in o&&o.v instanceof Promise,uc=(o,e)=>"v"in o&&"v"in e&&o.v.orig&&o.v.orig===e.v.orig,Dt=o=>{if("e"in o)throw o.e;return o.v},Do=()=>{const o=new WeakMap,e=new WeakMap,t=new Map;let s,n;const r=v=>o.get(v),i=(v,b)=>{const y=o.get(v);if(o.set(v,b),t.has(v)||t.set(v,y),Oe(y)){const f="v"in b?b.v instanceof Promise?b.v:Promise.resolve(b.v):Promise.reject(b.e);y.v!==f&&ns(y.v,f)}},a=(v,b,y)=>{const f=new Map;let _=!1;y.forEach((M,x)=>{!M&&x===v&&(M=b),M&&(f.set(x,M),b.d.get(x)!==M&&(_=!0))}),(_||b.d.size!==f.size)&&(b.d=f)},u=(v,b,y)=>{const f=r(v),_={d:f?.d||new Map,v:b};if(y&&a(v,_,y),at(f,_)&&f.d===_.d)return f;if(Oe(f)&&Oe(_)&&uc(f,_)){if(f.d===_.d)return f;_.v=f.v}return i(v,_),_},l=(v,b,y,f)=>{if(cc(b)){let _;const M=()=>{const E=r(v);if(!Oe(E)||E.v!==x)return;const F=u(v,x,y);e.has(v)&&E.d!==F.d&&X(v,F,E.d)},x=new Promise((E,F)=>{let j=!1;b.then(G=>{j||(j=!0,rs(x,G),E(G),M())},G=>{j||(j=!0,is(x,G),F(G),M())}),_=G=>{j||(j=!0,G.then(q=>rs(x,q),q=>is(x,q)),E(G))}});return x.orig=b,x.status="pending",lc(x,E=>{E&&_(E),f?.()}),u(v,x,y)}return u(v,b,y)},d=(v,b,y)=>{const f=r(v),_={d:f?.d||new Map,e:b};return y&&a(v,_,y),as(f,_)&&f.d===_.d?f:(i(v,_),_)},h=(v,b)=>{const y=r(v);if(!b&&y&&(e.has(v)||Array.from(y.d).every(([j,G])=>{if(j===v)return!0;const q=h(j);return q===G||at(q,G)})))return y;const f=new Map;let _=!0;const M=j=>{if(j===v){const q=r(j);if(q)return f.set(j,q),Dt(q);if(os(j))return f.set(j,void 0),j.init;throw new Error("no atom init")}const G=h(j);return f.set(j,G),Dt(G)};let x,E;const F={get signal(){return x||(x=new AbortController),x.signal},get setSelf(){return!E&&ss(v)&&(E=(...j)=>{if(!_)return I(v,...j)}),E}};try{const j=v.read(M,F);return l(v,j,f,()=>x?.abort())}catch(j){return d(v,j,f)}finally{_=!1}},g=v=>Dt(h(v)),m=v=>{let b=e.get(v);return b||(b=L(v)),b},w=(v,b)=>!b.l.size&&(!b.t.size||b.t.size===1&&b.t.has(v)),S=v=>{const b=e.get(v);b&&w(v,b)&&Y(v)},T=v=>{const b=new Map,y=new WeakMap,f=x=>{var E;const F=new Set((E=e.get(x))==null?void 0:E.t);return t.forEach((j,G)=>{var q;(q=r(G))!=null&&q.d.has(x)&&F.add(G)}),F},_=x=>{f(x).forEach(E=>{E!==x&&(b.set(E,(b.get(E)||new Set).add(x)),y.set(E,(y.get(E)||0)+1),_(E))})};_(v);const M=x=>{f(x).forEach(E=>{var F;if(E!==x){let j=y.get(E);if(j&&y.set(E,--j),!j){let G=!!((F=b.get(E))!=null&&F.size);if(G){const q=r(E),wn=h(E,!0);G=!at(q,wn)}G||b.forEach(q=>q.delete(E))}M(E)}})};M(v)},P=(v,...b)=>{let y=!0;const f=x=>Dt(h(x)),_=(x,...E)=>{let F;if(x===v){if(!os(x))throw new Error("atom not writable");const j=r(x),G=l(x,E[0]);at(j,G)||T(x)}else F=P(x,...E);if(!y){const j=A()}return F},M=v.write(f,_,...b);return y=!1,M},I=(v,...b)=>{const y=P(v,...b),f=A();return y},L=(v,b,y)=>{var f;const _=y||[];(f=r(v))==null||f.d.forEach((x,E)=>{const F=e.get(E);F?F.t.add(v):E!==v&&L(E,v,_)}),h(v);const M={t:new Set(b&&[b]),l:new Set};if(e.set(v,M),ss(v)&&v.onMount){const{onMount:x}=v;_.push(()=>{const E=x((...F)=>I(v,...F));E&&(M.u=E)})}return y||_.forEach(x=>x()),M},Y=v=>{var b;const y=(b=e.get(v))==null?void 0:b.u;y&&y(),e.delete(v);const f=r(v);f&&(Oe(f)&&ns(f.v),f.d.forEach((_,M)=>{if(M!==v){const x=e.get(M);x&&(x.t.delete(v),w(M,x)&&Y(M))}}))},X=(v,b,y)=>{const f=new Set(b.d.keys());y?.forEach((_,M)=>{if(f.has(M)){f.delete(M);return}const x=e.get(M);x&&(x.t.delete(v),w(M,x)&&Y(M))}),f.forEach(_=>{const M=e.get(_);M?M.t.add(v):e.has(v)&&L(_,v)})},A=()=>{let v;for(;t.size;){const b=Array.from(t);t.clear(),b.forEach(([y,f])=>{const _=r(y);if(_){const M=e.get(y);M&&_.d!==f?.d&&X(y,_,f?.d),M&&!(!Oe(f)&&(at(f,_)||as(f,_)))&&M.l.forEach(x=>x())}})}};return{get:g,set:I,sub:(v,b)=>{const y=m(v),f=A(),_=y.l;return _.add(b),()=>{_.delete(b),S(v)}}}};let lo;const dc=()=>(lo||(lo=Do()),lo),ln=p.createContext(void 0),hc=o=>{const e=p.useContext(ln);return o?.store||e||dc()},pc=({children:o,store:e})=>{const t=p.useRef();return!e&&!t.current&&(t.current=Do()),p.createElement(ln.Provider,{value:e||t.current},o)},fc=o=>typeof o?.then=="function",gc=bs.use||(o=>{if(o.status==="pending")throw o;if(o.status==="fulfilled")return o.value;throw o.status==="rejected"?o.reason:(o.status="pending",o.then(e=>{o.status="fulfilled",o.value=e},e=>{o.status="rejected",o.reason=e}),o)});function mc(o,e){const t=hc(e),[[s,n,r],i]=p.useReducer(l=>{const d=t.get(o);return Object.is(l[0],d)&&l[1]===t&&l[2]===o?l:[d,t,o]},void 0,()=>[t.get(o),t,o]);let a=s;(n!==t||r!==o)&&(i(),a=t.get(o));const u=e?.delay;return p.useEffect(()=>{const l=t.sub(o,()=>{if(typeof u=="number"){setTimeout(i,u);return}i()});return i(),l},[t,o,u]),p.useDebugValue(a),fc(a)?gc(a):a}const cn="@open-pioneer/spatial-bookmarks",vc=Yt.bind(void 0,cn),bc=pe.bind(void 0,cn),me=ke("spatial-bookmark:SpatialBookmarkViewModel");class wc{map;packageNamespace;writableBookmarks=ac([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,t){this.map=e,this.packageNamespace=t.getNamespace("spatial-bookmarks"),this.store=Do(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const t=this.map.olMap,s=t.getView().calculateExtent(),n=t.getView().getProjection().getCode(),r={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]},i={id:Rs(),title:e,extent:r,projection:n};me.debug("Created a new bookmark",i);const a=this.writableBookmarks;this.store.set(a,[...this.store.get(a),i])}activateBookmark(e){me.debug("Activating bookmark",e);const t=this.getBookmarkExtent(e);me.debug("Attempting to apply extent",t),this.applyExtent(t)}deleteBookmark(e){me.debug("Deleting bookmark",e);const t=this.writableBookmarks;this.store.set(t,[...this.store.get(t).filter(s=>s.id!==e)])}deleteAllBookmarks(){me.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){me.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{yc(e),this.store.set(this.writableBookmarks,e)}catch(t){me.error("Bookmarks data in local storage is invalid, resetting to default value.",t),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){me.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const s=this.map.olMap.getView(),n=e.extent,r=[n.minX,n.minY,n.maxX,n.maxY],i=s.getProjection(),a=e.projection;return xr(r,a,i)}applyExtent(e){const s=this.map.olMap.getView(),n=kr(e),r=s.getResolutionForExtent(e);s.setCenter(n),s.setResolution(r)}}function yc(o){if(!Array.isArray(o))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of o)Sc(e)}function Sc(o){if(!o||typeof o!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=o;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(_c(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function _c(o){if(!o||typeof o!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=o;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const xc=o=>{const{map:e}=Z(o.mapId),t=vc("local-storage.LocalStorageService"),s=Tc(e,t);return s&&c.jsx(pc,{store:s.store,children:c.jsx(kc,{...o,viewModel:s})})};function kc(o){const{viewModel:e}=o,t=bc(),s=p.useRef([]),[n,r]=p.useState(!1),i=mc(e.bookmarks),[a,u]=p.useState(""),l=a.trim().length>0,{containerProps:d}=ae("spatial-bookmarks",o),[h,g]=p.useState("list"),m=()=>{e.deleteAllBookmarks(),g("list")},w=()=>{l&&(e.createBookmark(a),g("list"),u(""),r(!0))};p.useEffect(()=>{if(n){const L=s.current;L&&L[i.length-1]?.scrollIntoView?.(),r(!1)}},[i,n]);const S=()=>c.jsxs(po,{children:[c.jsxs(Qt,{rounded:"md",status:"warning",children:[c.jsx(eo,{}),t.formatMessage({id:"bookmark.alert.delete"})]}),c.jsx(Mc,{intl:t,onClear:m,onCancel:()=>g("list")})]}),T=()=>c.jsxs(po,{children:[c.jsxs(Qt,{rounded:"md",status:"info",children:[c.jsx(eo,{}),t.formatMessage({id:"bookmark.alert.create"})]}),c.jsx(ti,{"aria-label":t.formatMessage({id:"bookmark.input.label"}),placeholder:t.formatMessage({id:"bookmark.input.placeholder"}),value:a,onChange:L=>{u(L.target.value)},onKeyDown:L=>{L.key==="Enter"&&w()},isRequired:!0,isInvalid:!l,autoFocus:!0}),c.jsx(Lc,{intl:t,isInvalid:!l,onCancel:()=>{u(""),g("list")},onSave:w})]}),P=()=>c.jsxs(c.Fragment,{children:[i.length?Cc(i,e,t,s):c.jsxs(Qt,{rounded:"md",status:"info",children:[c.jsx(eo,{}),t.formatMessage({id:"bookmark.alert.noSaved"})]}),c.jsx(Pc,{intl:t,bookmarks:i,showCreate:()=>g("create"),showDelete:()=>g("delete")})]}),I=c.jsxs(c.Fragment,{children:[h==="list"&&P(),h==="create"&&T(),h==="delete"&&S()]});return c.jsx(ce,{flexDirection:"column",...d,children:I})}function Cc(o,e,t,s){const n=t.formatMessage({id:"bookmark.button.deleteOne"}),r=o.map((i,a)=>c.jsx(Ec,{index:a,listItemNodes:s,bookmark:i,onActivate:()=>e.activateBookmark(i),onDelete:()=>e.deleteBookmark(i.id),deleteBtnLabel:n},i.id));return c.jsx(Bs,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":t.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:r})}const ls={ArrowDown:1,ArrowUp:-1};function Ec(o){const{index:e,listItemNodes:t,bookmark:s,onDelete:n,onActivate:r,deleteBtnLabel:i}=o,a=s.title,u=l=>{const d=l.key;if(d==="Enter"){l.target===l.currentTarget&&r();return}if(ls[d]!=null){const h=t.current?.length;if(!h)return;let g=(e+ls[d])%h;g<0&&(g=h-1),t.current[g]?.focus()}};return c.jsx(V,{as:"li",p:1,ref:l=>{if(!l){t.current.splice(e,1);return}t.current[e]=l},className:Et("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:u,onClick:r,children:c.jsxs(ce,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[c.jsx(zs,{children:c.jsx(js,{})}),c.jsx(de,{ps:2,noOfLines:1,children:a}),c.jsx(ei,{}),c.jsx(ws,{hasArrow:!0,label:i,placement:"right",children:c.jsx(ko,{className:"spatial-bookmarks-item-delete","aria-label":i,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:c.jsx(Ns,{}),onClick:l=>{n(),l.stopPropagation()}})},e)]})})}function Pc(o){const{intl:e,bookmarks:t,showCreate:s,showDelete:n}=o;return c.jsxs(Oo,{children:[c.jsx(et,{isDisabled:t.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:c.jsx(Ns,{}),onClick:n,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),c.jsx(et,{onClick:s,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function Mc(o){const{intl:e,onCancel:t,onClear:s}=o;return c.jsxs(Oo,{children:[c.jsx(et,{variant:"outline",onClick:t,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),c.jsx(et,{onClick:s,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function Lc(o){const{intl:e,onCancel:t,onSave:s,isInvalid:n}=o;return c.jsxs(Oo,{children:[c.jsx(et,{variant:"outline",onClick:()=>t(),children:e.formatMessage({id:"bookmark.button.cancel"})}),c.jsx(et,{isDisabled:n,onClick:()=>s(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function Oo(o){return c.jsx(ce,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:o.children})}function et(o){return c.jsx(ko,{width:"100%",...o})}function Tc(o,e){const[t,s]=p.useState();return p.useEffect(()=>{let n;return o?n=new wc(o,e):n=void 0,s(n),()=>n?.destroy()},[o,e]),t}function Ac(){const o=p.useId(),e=De();return c.jsx(V,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:c.jsx(V,{role:"dialog","aria-labelledby":o,children:c.jsx(tt,{title:c.jsx(ot,{id:o,size:"md",mb:2,children:e.formatMessage({id:"spatialBookmarkTitle"})}),children:c.jsx(xc,{mapId:z})})})})}const Rc="@open-pioneer/legend",un=pe.bind(void 0,Rc),Ic=o=>{const{mapId:e,showBaseLayers:t=!1}=o,{containerProps:s}=ae("legend",o),{map:n}=Z(e);return c.jsx(V,{...s,children:n?c.jsx(Dc,{map:n,showBaseLayers:t}):null})};function Dc(o){const{map:e,showBaseLayers:t}=o,n=Nc(e).map(r=>c.jsx(dn,{layer:r,showBaseLayers:t},r.id));return c.jsx(Bs,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:n})}function dn(o){const{layer:e,showBaseLayers:t}=o,{isVisible:s}=Vc(e),n=Fc(e);if(!s||!t&&!("parentLayer"in e)&&e.isBaseLayer)return;const r=[];return n?.length&&n.forEach(i=>{r.push(c.jsx(dn,{layer:i,showBaseLayers:t},i.id))}),c.jsxs(c.Fragment,{children:[c.jsx(Oc,{layer:e,showBaseLayers:t}),r]})}function Oc(o){const e=un(),{layer:t,showBaseLayers:s}=o,n=Bc(t),r=jc(t);let i;n?.Component?i=c.jsx(n.Component,{layer:t}):n?.imageUrl?i=c.jsx(cs,{layer:t,imageUrl:n.imageUrl}):r&&(i=c.jsx(cs,{layer:t,imageUrl:r}));const a=!("parentLayer"in t)&&t.isBaseLayer;return i?c.jsxs(V,{as:"li",className:Et("legend-item",`layer-${Gc(t.id)}`),children:[s&&a?c.jsx(de,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,i]}):void 0}function cs(o){const e=un(),{layer:t,imageUrl:s}=o;return c.jsxs(V,{children:[c.jsx(de,{children:t.title}),c.jsx(Gs,{maxW:"none",maxH:"none",src:s,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:c.jsx(V,{children:c.jsxs(de,{children:[c.jsx(qr,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function jc(o){const e=p.useCallback(()=>o.legend,[o]),t=p.useCallback(s=>{const n=o.on("changed:legend",s);return()=>n.destroy()},[o]);return p.useSyncExternalStore(t,e)}function Nc(o){const e=p.useCallback(s=>{const n=o.layers.on("changed",s);return()=>n.destroy()},[o]),t=p.useCallback(()=>{let s=o.layers.getAllLayers({sortByDisplayOrder:!0})??[];return s=s.reverse(),s},[o]);return hn(e,t)}function Fc(o){const e=p.useCallback(s=>{const n=o.sublayers?.on("changed",s);return()=>n?.destroy()},[o]),t=p.useCallback(()=>{if(!o.sublayers)return;let n=o.sublayers?.getSublayers({sortByDisplayOrder:!0});return n=n.reverse(),n},[o]);return hn(e,t)}function hn(o,e){const t=p.useRef(),s=p.useCallback(r=>{const i=o(()=>{t.current=void 0,r()});return()=>{t.current=void 0,i()}},[o]),n=p.useCallback(()=>{if(t.current)return t.current.value;const r=e();return t.current={value:r},r},[e]);return p.useSyncExternalStore(s,n)}function Vc(o){const e=p.useCallback(()=>o.visible,[o]),t=p.useCallback(n=>{const r=o.on("changed:visible",n);return()=>r.destroy()},[o]);return{isVisible:p.useSyncExternalStore(t,e)}}function Bc(o){const[e,t]=p.useState(void 0);return p.useEffect(()=>{t(o.attributes.legend);const s=o.on("changed:attributes",()=>{t(o.attributes.legend)});return()=>s.destroy()},[o]),e}function Gc(o){return o.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function zc(){const o=p.useId(),e=De();return c.jsx(V,{role:"dialog","aria-labelledby":o,children:c.jsx(tt,{title:c.jsx(ot,{id:o,size:"md",mb:2,children:e.formatMessage({id:"legendTitle"})}),children:c.jsx(V,{overflowY:"auto",maxHeight:300,children:c.jsx(Ic,{mapId:z,showBaseLayers:!0})})})})}const pn="@open-pioneer/geolocation",Uc=Yt.bind(void 0,pn),Wc=pe.bind(void 0,pn);function Hc(o){return oi({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(o)}const us=ke("geolocation:GeolocationController"),ds=17;class $c extends Lo{olMap;positionHighlightLayer;geolocation;maxZoom=ds;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,t){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Ce,this.accuracyFeature.setStyle(ps()),this.positionFeature=new Ce,this.positionFeature.setStyle(hs()),this.positionHighlightLayer=new he({source:new Ie({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(Po);const s=t||qc();this.geolocation=new va({tracking:!1,trackingOptions:s,projection:e.getView()?.getProjection()}),this.trackingOptions=s,this.geolocation.on("error",n=>this.handleGeolocationError(n))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(s=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const n=this.geolocation.on("change:accuracyGeometry",()=>{const u=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(u),this.accuracyFeature?.getGeometry()!==void 0&&s(),this.isInitialZoom){const l=this?.accuracyFeature?.getGeometry()?.getExtent();if(l){const d=Oa(l);if(!d)return;e.getView().fit(d,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),r=this.geolocation.on("change:position",()=>{const u=this.geolocation.getPosition();u&&(u[0]||u[1])!==void 0&&(this.positionFeature?.setGeometry(new Ve(u)),this.setMapToPosition&&e.getView().setCenter(u),this.positionFeature?.getGeometry()!==void 0&&s())}),i=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),a=e.on("pointermove",u=>{u.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(n,r,i,a),e.addLayer(this.positionHighlightLayer)}).catch(s=>{us.error("Failed to determine location",s)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{ie(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??hs())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??ps())}setMaxZoom(e){this.maxZoom=e??ds}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){us.error("Error from geolocation API:",e.message);const t=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",t)}}const hs=()=>new Ae({image:new Eo({radius:6,fill:new Xe({color:"#3399CC"}),stroke:new Le({color:"#fff",width:2})})}),ps=()=>new Ae({stroke:new Le({color:"#3399CC",width:3}),fill:new Xe({color:"rgba(0, 0, 255, 0.05)"})}),qc=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),Kc=p.forwardRef(function(e,t){const{mapId:s,maxZoom:n,positionFeatureStyle:r,accuracyFeatureStyle:i,trackingOptions:a}=e,{containerProps:u}=ae("geolocation",e),l=!!navigator.geolocation,[d,h]=p.useState(!1),[g,m]=p.useState(!1),{map:w}=Z(s),S=Wc(),T=Uc("notifier.NotificationService"),P=Yc(w,n,a,r,i),I=(()=>l?d?S.formatMessage({id:"locateMeEnd"}):S.formatMessage({id:"locateMeStart"}):S.formatMessage({id:"locateNotSupported"}))();p.useEffect(()=>{if(P===void 0)return;const Y=P.on("error",function(X){const A=S.formatMessage({id:"error"}),W=(()=>{switch(X){case"permission-denied":return S.formatMessage({id:"permissionDenied"});case"position-unavailable":return S.formatMessage({id:"positionUnavailable"});case"timeout":return S.formatMessage({id:"timeout"});case"unknown":return S.formatMessage({id:"unknownError"})}})();m(!1),h(!1),T.notify({level:"error",title:A,message:W})});return()=>{Y.destroy()}},[P,S,T]),p.useEffect(()=>{if(!P){m(!1);return}return d&&(m(!0),P.startGeolocation().then(()=>{m(!1)})),()=>{P?.stopGeolocation(),m(!1)}},[P,d]);const L=()=>{w&&h(!d)};return c.jsx(ee,{ref:t,label:I,icon:c.jsx(Hc,{}),onClick:()=>L(),isActive:d,isLoading:g,isDisabled:!l,...u})});function Yc(o,e,t,s,n){const[r,i]=p.useState();return p.useEffect(()=>{if(!o)return;const a=new $c(o.olMap,t);return i(a),()=>{a.destroy(),i(void 0)}},[o,t]),p.useEffect(()=>{r?.setPositionFeatureStyle(s)},[r,s]),p.useEffect(()=>{r?.setAccuracyFeatureStyle(n)},[r,n]),p.useEffect(()=>{r?.setMaxZoom(e)},[r,e]),r}function Xc(o){const{toolState:e,onToolStateChange:t}=o,s=De(),n=xe("ol-app.AppModel"),r=Je(n.state).resultListState,i=r.open,{map:a}=Z(z),u=xe("editing.EditingService"),l=xe("notifier.NotificationService"),d=Re((h,g)=>{t(h,g??!e[h])});return Zc(a,u,l,s,e,d),c.jsxs(ce,{role:"toolbar","aria-label":s.formatMessage({id:"ariaLabel.toolbar"}),direction:"column",gap:1,padding:1,children:[c.jsx(ee,{label:e.editingActive?s.formatMessage({id:"stopEditingTitle"}):s.formatMessage({id:"startEditingTitle"}),icon:e.editingActive?c.jsx(Rr,{}):c.jsx(Ir,{}),isActive:e.editingActive,onClick:()=>d("editingActive")}),c.jsx(ee,{label:s.formatMessage({id:"resetEditingTitle"}),icon:c.jsx(Dr,{}),onClick:()=>u.reset(z)}),r.input&&c.jsx(ee,{label:s.formatMessage({id:"resultListTitle"}),icon:c.jsx(Or,{}),isActive:r.open,onClick:()=>n.setResultListVisibility(!i)}),c.jsx(ee,{label:s.formatMessage({id:"spatialBookmarkTitle"}),icon:c.jsx(jr,{}),isActive:e.bookmarksActive,onClick:()=>d("bookmarksActive")}),c.jsx(Kc,{mapId:z}),c.jsx(ee,{label:s.formatMessage({id:"tocTitle"}),icon:c.jsx(Nr,{}),isActive:e.tocActive,onClick:()=>d("tocActive")}),c.jsx(ee,{label:s.formatMessage({id:"legendTitle"}),icon:c.jsx(Fr,{}),isActive:e.legendActive,onClick:()=>d("legendActive")}),c.jsx(ee,{label:s.formatMessage({id:"measurementTitle"}),icon:c.jsx(Vr,{}),isActive:e.measurementActive,onClick:()=>d("measurementActive")}),c.jsx(ee,{label:s.formatMessage({id:"selectionTitle"}),icon:c.jsx(Br,{}),isActive:e.selectionActive,onClick:()=>d("selectionActive")}),c.jsx(ee,{label:s.formatMessage({id:"overviewMapTitle"}),icon:c.jsx(js,{}),isActive:e.overviewMapActive,onClick:()=>d("overviewMapActive")}),c.jsx(Zr,{mapId:z}),c.jsx(Jr,{mapId:z}),c.jsx(Qr,{mapId:z})]})}function Zc(o,e,t,s,n,r){p.useEffect(()=>{if(!o)return;function i(){if(!o)throw Error("map is undefined");try{const u=o.layers.getLayerById("krankenhaus"),l=new URL(u.attributes.collectionURL+"/items");e.start(o,l).whenComplete().then(h=>{if(!h)return;t.notify({level:"info",message:s.formatMessage({id:"editing.featureCreated"},{featureId:h}),displayDuration:4e3}),(u?.olLayer).getSource()?.refresh()}).catch(h=>{console.error(h)}).finally(()=>{r("editingActive",!1)})}catch(u){console.log(u)}}function a(){e.stop(z)}n.editingActive?i():a()},[o,e,t,s,n.editingActive,r])}const Jc="@open-pioneer/measurement",Qc=pe.bind(void 0,Jc);class eu{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,t){this.olMap=e,this.messages=t;const s=this.source=new Ie;this.layer=new he({source:s}),this.layer.setZIndex(Po),e.addLayer(this.layer);const n=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){ie(n)}});const r=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",r),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",r)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const t=Cr(e);this.activeFeatureStyle=(s,...n)=>{const r=s?.getGeometry()?.getType();if(r==="Polygon"||r==="LineString"||r==="Point")return t(s,...n)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",s=this.draw=new on({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(s);let n,r;s.on("drawstart",i=>{n=this.measureTooltip=this.createMeasureTooltip();const a=this.sketch=i.feature;if(!a)return;let u;r=a.getGeometry()?.on("change",l=>{const d=l.target,h=this.olMap.getView().getProjection();let g="";d instanceof qt?(g=ou(d,h,this.messages),u=d.getInteriorPoint().getCoordinates()||null):d instanceof Be&&(g=su(d,h,this.messages),u=d.getLastCoordinate()||null),n&&(n.element.innerHTML=g,u&&n?.overlay.setPosition(u))})}),s.on("drawend",()=>{if(n){const i=n.element.classList;i.remove("measurement-active-tooltip"),i.add("measurement-finished-tooltip"),n.overlay.setOffset([0,-7]),this.overlayTooltips.push(n),this.measureTooltip=n=void 0}this.sketch=void 0,r&&ie(r)}),s.on("drawabort",()=>{n&&(n.destroy(),this.measureTooltip=n=void 0),this.sketch=void 0,r&&ie(r)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip";const t=new ht({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),s=this.olMap;return s.addOverlay(t),{overlay:t,element:e,destroy(){s.removeOverlay(t)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip hidden";const t=new ht({element:e,offset:[15,0],positioning:"center-left"}),s=this.olMap;return s.addOverlay(t),{overlay:t,element:e,destroy(){s.removeOverlay(t)}}}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,s=tu(this.messages,this.sketch);t.element.textContent=s,t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}}function tu(o,e){if(e){const t=e.getGeometry();if(t instanceof qt||t instanceof Be)return o.getContinueMessage()}return o.getHelpMessage()}function ou(o,e,t){const s=Er(o,{projection:e});let n;return s>=1e6?n=`${t.formatNumber(s/1e6)} km<sup>2</sup>`:n=`${t.formatNumber(s)} m<sup>2</sup>`,n}function su(o,e,t){const s=Pr(o,{projection:e});let n;return s>=1e3?n=`${t.formatNumber(s/1e3)} km`:n=`${t.formatNumber(s)} m`,n}const nu=o=>{const e=Qc(),{mapId:t,activeFeatureStyle:s,finishedFeatureStyle:n}=o,{containerProps:r}=ae("measurement",o),[i,a]=p.useState("distance"),u=m=>e.formatMessage({id:m}),l=Z(t),d=ru(l.map,e);p.useEffect(()=>{d?.setActiveFeatureStyle(s??iu())},[d,s]),p.useEffect(()=>{d?.setFinishedFeatureStyle(n??au())},[d,n]),p.useEffect(()=>{if(d)return d.startMeasurement(i),()=>{d.stopMeasurement()}},[d,i]);function h(m){if(m==="distance"||m==="area")a(m);else throw new Error(`Unexpected measurement type: '${m}'.`)}function g(){d?.clearMeasurements()}return c.jsxs(V,{...r,children:[c.jsx(de,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),c.jsx(fo,{mb:4,alignItems:"center",children:c.jsxs(ni,{mb:2,children:[c.jsx(go,{mb:1,children:u("measurementLabel")}),c.jsxs(ri,{value:i,onChange:m=>h(m.target.value),className:"measurement-select",children:[c.jsx("option",{value:"distance",children:u("distance")}),c.jsx("option",{value:"area",children:u("area")})]})]})}),c.jsx(ko,{padding:2,className:"measurement-delete-button",onClick:g,width:"100%",children:u("deleteMeasurementLabel")})]})};function ru(o,e){const[t,s]=p.useState(void 0);return p.useEffect(()=>{if(!o)return;const n=new eu(o.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(r){return e.formatNumber(r,{maximumFractionDigits:2})}});return s(n),()=>{n.destroy(),s(void 0)}},[o,e]),t}function iu(){return[new Ae({stroke:new Le({color:"#fff",lineDash:[10,10],width:5})}),new Ae({fill:new Xe({color:"rgba(0,0,0,0.15)"}),stroke:new Le({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new Eo({radius:5,stroke:new Le({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new Xe({color:"rgba(255, 255, 255, 0.2)"})})})]}function au(){return[new Ae({stroke:new Le({color:"#fff",width:5})}),new Ae({stroke:new Le({color:"#0b96fc",width:3}),fill:new Xe({color:"rgba(11,150,252,0.15)"})})]}function lu(){const o=p.useId(),e=De();return c.jsx(V,{role:"dialog","aria-labelledby":o,children:c.jsx(tt,{title:c.jsx(ot,{id:o,size:"md",mb:2,children:e.formatMessage({id:"measurementTitle"})}),children:c.jsx(nu,{mapId:z})})})}const cu="200px",uu="300px",du=o=>{const{mapId:e,olLayer:t,height:s=cu,width:n=uu}=o,{containerProps:r}=ae("overview-map",o),i=p.useRef(null),{map:a}=Z(e);return p.useEffect(()=>{if(i.current&&a&&t){const u=a.olMap,l=new Jl({className:"ol-overviewmap",layers:[t],collapsible:!1,collapsed:!1,target:i.current});return u.addControl(l),()=>{u.removeControl(l)}}},[a,t]),c.jsx(V,{height:s,width:n,ref:i,...r})};function hu(){const o=p.useMemo(()=>new Co({source:new Ms}),[]);return c.jsx(V,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",maxWidth:325,children:c.jsx(V,{role:"dialog",children:c.jsx(du,{mapId:z,olLayer:o})})})}function pu(){const o=xe("ol-app.AppModel"),e=Je(o.state).resultListState,[t,s]=p.useState([]),[n,r]=p.useState([]),i=p.useCallback(a=>{s(a.features),r(a.getFeatureIds())},[]);return p.useEffect(()=>{console.log("Anzahl Features: "+t.length),console.log("SelectedIds: "+n.toString())},[t,n]),e.input&&c.jsx(V,{className:"result-list-container",position:"absolute",visibility:e.open?"visible":"hidden",bottom:"0",backgroundColor:"white",width:"100%",height:"400px",zIndex:1,borderTop:"2px solid",borderBottom:"2px solid",borderColor:"trails.100",children:c.jsx(ii,{input:e.input,mapId:z,onSelectionChange:i},e.key)})}const fu="@open-pioneer/search",Zt=pe.bind(void 0,fu);function gu(o){const e=o.selectProps.inputValue.length>0,t={...o,className:Et(o.className,{"search-invisible":!e})};return c.jsx(fe.Menu,{...t,children:o.children})}function mu(o){const t=Zt().formatMessage({id:"noOptionsText"});return c.jsx(fe.NoOptionsMessage,{...o,children:c.jsx(ue.span,{className:"search-no-match",children:t})})}function vu(o){const t=Zt().formatMessage({id:"loadingText"});return c.jsx(fe.LoadingMessage,{...o,children:c.jsx(ue.span,{className:"search-loading-text",children:t})})}function bu({children:o,...e}){const t={...e,className:Et(e.className,"search-value-container")};return c.jsxs(fe.ValueContainer,{...t,children:[!!o&&c.jsx(Xl,{style:{position:"absolute",left:8}}),o]})}function wu(o){const e={...o,isHidden:!1};return c.jsx(fe.Input,{...e})}function yu(o){return null}function Su(o){return c.jsxs(fe.IndicatorsContainer,{...o,children:[o.children,!o.selectProps.isLoading&&o.selectProps.inputValue&&c.jsx(_u,{selectProps:o.selectProps,clearValue:o.clearValue})]})}function _u(o){const t=Zt().formatMessage({id:"ariaLabel.clearButton"}),s=n=>{n.preventDefault(),n.stopPropagation(),o.clearValue()};return c.jsx(En,{role:"button",size:"md",mr:1,"aria-label":t,onClick:s,onTouchEnd:s,onMouseDown:n=>n.preventDefault()})}function xu(o){return null}function ku(o){const e=o.selectProps.inputValue,t=o.data.label,s={...o,className:Et(o.className,"search-option")};return c.jsx(fe.Option,{...s,children:c.jsx(ue.div,{className:"search-option-label",children:e.trim().length>0?Cu(t,e):t})})}function Cu(o,e){const t=o.toLowerCase().indexOf(e.toLowerCase());return t>=0?c.jsxs(c.Fragment,{children:[o.substring(0,t),c.jsx(ue.span,{className:"search-highlighted-match",children:o.substring(t,t+e.length)},"highlighted"),o.substring(t+e.length)]}):o}const fs=ke("search:SearchController"),gs=200,ms=5;var St,qe,Ke,Ye,se,Ht,fn;class Eu{constructor(e,t){R(this,Ht);R(this,St,void 0);R(this,qe,[]);R(this,Ke,ms);R(this,Ye,gs);R(this,se,void 0);D(this,St,e),D(this,qe,t)}destroy(){k(this,se)?.abort(),D(this,se,void 0)}async search(e){if(k(this,se)?.abort(),D(this,se,void 0),!e)return[];const t=D(this,se,new AbortController);try{return await Pu(t.signal,k(this,Ye)),t.signal.aborted&&(fs.debug(`search canceled with ${e}`),Pn()),(await Promise.all(k(this,qe).map(n=>H(this,Ht,fn).call(this,n,e,t.signal)))).filter(n=>n!=null)}finally{k(this,se)===t&&D(this,se,void 0)}}get searchTypingDelay(){return k(this,Ye)}set searchTypingDelay(e){D(this,Ye,e??gs)}get maxResultsPerSource(){return k(this,Ke)}set maxResultsPerSource(e){D(this,Ke,e??ms)}get sources(){return k(this,qe)}}St=new WeakMap,qe=new WeakMap,Ke=new WeakMap,Ye=new WeakMap,se=new WeakMap,Ht=new WeakSet,fn=async function(e,t,s){const n=e.label,r=k(this,St).olMap.getView().getProjection();try{const i=k(this,Ke);let a=await e.search(t,{maxResults:i,signal:s,mapProjection:r});return a.length>i&&(a=a.slice(0,i)),{label:n,source:e,results:a}}catch(i){Nt(i)||fs.error(`search for source ${n} failed`,i);return}};async function Pu(o,e){o.aborted||await new Promise(t=>{const s=()=>{o.removeEventListener("abort",s),clearTimeout(n),t()};o.addEventListener("abort",s);const n=setTimeout(s,e)})}const Vt=ke("search:Search"),Mu=o=>{const{mapId:e,sources:t,searchTypingDelay:s,maxResultsPerGroup:n,onSelect:r,onClear:i}=o,{containerProps:a}=ae("search",o),{map:u}=Z(e),l=Zt(),d=Ru(t,s,n,u),{input:h,search:g,selectedOption:m,onInputChanged:w,onResultConfirmed:S}=Iu(d),T=Au(),P=Lu(l),I=Tu(),L=Re((A,W)=>{W.action==="input-change"&&w(A)}),Y=Re((A,W)=>{switch(W.action){case"select-option":A&&(S(A),r?.({source:A.source,result:A.result}));break;case"clear":w(""),X.current?.blur(),X.current?.focus(),i?.();break;default:Vt.debug(`Unhandled action type '${W.action}'.`);break}}),X=p.useRef(null);return c.jsx(V,{...a,children:c.jsx(mo,{className:"search-component",classNamePrefix:"react-select",ref:X,inputValue:h,onInputChange:L,"aria-label":l.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:P,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:T,isClearable:!0,placeholder:l.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:g.kind==="loading",options:g.kind==="ready"?g.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:I,onChange:Y,value:m,menuPosition:"fixed"})})};function Lu(o){return p.useMemo(()=>({onFocus:({focused:r})=>`${r.label} ${o.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:r,label:i})=>{let a="";switch(r){case"select-option":a=`${i} ${o.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":a=`${i} ${o.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return a},guidance:()=>`${o.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[o])}function Tu(){return p.useMemo(()=>({Menu:gu,Input:wu,SingleValue:yu,Option:ku,NoOptionsMessage:mu,LoadingMessage:vu,ValueContainer:bu,IndicatorsContainer:Su,ClearIndicator:xu}),[])}function Au(){const[o,e]=ys("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return p.useMemo(()=>({groupHeading:s=>({...s,backgroundColor:o,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:s=>({...s,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:s=>({...s,display:"none"})}),[o,e])}function Ru(o,e,t,s){const[n,r]=p.useState(void 0);return p.useEffect(()=>{if(!s)return;const i=new Eu(s,o);return r(i),()=>{i.destroy(),r(void 0)}},[s,o]),p.useEffect(()=>{n&&(n.searchTypingDelay=e)},[n,e]),p.useEffect(()=>{n&&(n.maxResultsPerSource=t)},[n,t]),n}function Iu(o){const[e,t]=p.useReducer((a,u)=>{switch(u.kind){case"input":return{...a,query:u.query,selectedOption:null};case"select-option":return{...a,selectedOption:u.option,query:u.option.label};case"load-results":return{...a,search:{kind:"loading"}};case"accept-results":return{...a,search:{kind:"ready",results:u.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),s=p.useRef(),n=Re(a=>{if(!o){s.current=void 0,t({kind:"accept-results",results:[]});return}Vt.isDebug()&&Vt.debug(`Starting new search for query ${JSON.stringify(a)}.`),t({kind:"load-results"});const u=s.current=Du(o,a).then(l=>{s.current===u&&t({kind:"accept-results",results:l})})}),r=p.useCallback(a=>{t({kind:"select-option",option:a})},[]),i=p.useCallback(a=>{t({kind:"input",query:a}),n(a)},[n]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:r,onInputChanged:i}}async function Du(o,e){let t;try{t=await o.search(e)}catch(s){Nt(s)||Vt.error("Search failed",s),t=[]}return Ou(t)}function Ou(o){return o.map((t,s)=>({label:t.label,options:t.results.map(n=>({value:`${s}-${n.id}`,label:n.label,source:t.source,result:n}))}))}function gn(o,e){const t=o.olMap.getViewport();o.highlightAndZoom(e,{viewPadding:t&&t.offsetWidth<1e3?{top:150,right:75,bottom:50,left:75}:{top:150,right:400,bottom:50,left:400}})}function ju(){const{map:o}=Z(z),e=xe("ol-app.AppModel"),t=Je(e.state).searchSources;function s(r){if(console.debug("The user selected the following item: ",r.result),!o)return;const i=r.result.geometry;i&&gn(o,[i])}function n(){console.debug("The user cleared the search"),o?.removeHighlight()}return c.jsx(V,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",mt:5,className:"search-box",children:c.jsx(Mu,{mapId:z,sources:t,maxResultsPerGroup:10,onSelect:s,onClear:n})})}const mn="@open-pioneer/selection",Nu=Yt.bind(void 0,mn),jo=pe.bind(void 0,mn),lt="selection-active",Ot="selection-inactive";class Fu{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,s,n,r){let i;switch(t){case No.extent:default:i=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,r,i,this.interactionResources)),this.interactionResources.push(this.createDrag(e,i,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,s),this.olMap=e,this.tooltipMessage=s,this.tooltipDisabledMessage=n}initViewport(e){const t=e.getViewport();return t.classList.add(lt),t.oncontextmenu=s=>(s.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(s=>this.olMap.addInteraction(s.interaction)),this.tooltip.element.textContent=this.tooltipMessage,t.classList.remove(Ot),t.classList.add(lt),this.isActive=!0):(this.interactionResources.forEach(s=>this.olMap.removeInteraction(s.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,t.classList.remove(lt),t.classList.add(Ot),this.isActive=!1)}createDragBox(e,t,s,n){const r=new $o({className:"selection-drag-box",condition:Mr});return e.addInteraction(r),r.on("boxend",function(){t(r.getGeometry())}),{interaction:r,destroy(){e.removeInteraction(r),n.splice(n.indexOf(this)),r.dispose(),s.classList.remove(lt),s.classList.remove(Ot),s.oncontextmenu=null}}}createDrag(e,t,s){const n=function(a){return a.originalEvent.button==2},r=new qo({condition:n});return e.addInteraction(r),{interaction:r,destroy(){e.removeInteraction(r),s.splice(s.indexOf(this)),r.dispose(),t.classList.remove(lt),t.classList.remove(Ot),t.oncontextmenu=null}}}createHelpTooltip(e,t){const s=document.createElement("div");s.className="selection-tooltip",s.textContent=t;const n=new ht({element:s,offset:[15,0],positioning:"center-left"}),r=e.on("pointermove",i=>{n.setPosition(i.coordinate)});return e.addOverlay(n),{overlay:n,element:s,destroy(){e.removeOverlay(n),n.dispose(),ie(r)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof $o)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof qo)}}const co=ke("selection:SelectionController"),Vu=1e4;var _t,xt,kt,$t,vn;class Bu{constructor(e){R(this,$t);R(this,_t,void 0);R(this,xt,void 0);R(this,kt,void 0);const{mapModel:t,onError:s,maxResults:n=Vu}=e;D(this,_t,t),D(this,xt,n),D(this,kt,s)}destroy(){}async select(e,t){if(t)return await H(this,$t,vn).call(this,e,t)}}_t=new WeakMap,xt=new WeakMap,kt=new WeakMap,$t=new WeakSet,vn=async function(e,t){const s=k(this,_t).olMap.getView().getProjection();try{co.debug(`Starting selection on source '${e.label}'`);const n=k(this,xt);let r=await e.select({type:"extent",extent:t},{maxResults:n,mapProjection:s,signal:new AbortController().signal});return r.length>n&&(r=r.slice(0,n)),co.debug(`Found ${r.length} results on source '${e.label}'`),{source:e,results:r}}catch(n){co.error(`selection from source ${e.label} failed`,n),k(this,kt).call(this);return}};var No=(o=>(o.extent="EXTENT",o.polygon="POLYGON",o.free="FREEPOLYGON",o.circle="CIRCLE",o))(No||{});const vs={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},Gu=o=>{const e=jo(),{mapId:t,sources:s,onSelectionComplete:n,onSelectionSourceChanged:r}=o,{containerProps:i}=ae("selection",o),[a,u]=p.useState(()=>s.find(A=>(A.status??"available")==="available")),l=Z(t),{onExtentSelected:d}=Wu(l.map,s,a,n),h=qu(),m=p.useCallback(A=>{const W=[];if(A||(A=["EXTENT"]),A.forEach(v=>{Object.values(No).includes(v)&&W.push({label:e.formatMessage({id:v}),value:v})}),W.length===0)throw new Error("methods does not contain valid values");return W},[e])(void 0),[w,S]=p.useState(m[0]),T=Re(A=>{S(A)}),[P,I]=p.useState(!0);$u(l.map,w,e,d,P);const L=p.useMemo(()=>s.map(A=>({label:A.label,value:A})),[s]),Y=p.useMemo(()=>L.find(A=>A.value===a),[L,a]),X=Re(A=>{u(A?.value),r&&r({source:A?.value})});return p.useEffect(()=>{if(!a){I(!1);return}const A=e.formatMessage({id:"sourceNotAvailable"}),W=()=>a&&_o(a,A).kind==="available";I(W());const v=a.on("changed:status",()=>{I(W())});return()=>v.destroy()},[a,I,e]),c.jsxs(po,{...i,spacing:2,children:[m.length>1&&c.jsxs(fo,{children:[c.jsx(go,{children:e.formatMessage({id:"selectMethod"})}),c.jsx(mo,{className:"selection-method react-select",...vs,options:m,onChange:T,value:w,chakraStyles:h})]}),c.jsxs(fo,{children:[c.jsx(go,{children:e.formatMessage({id:"selectSource"})}),c.jsx(mo,{className:"selection-source react-select",...vs,options:L,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:Y,onChange:X,components:{Option:zu,SingleValue:Uu},isOptionDisabled:A=>A.value===void 0||A.value.status==="unavailable",getOptionLabel:A=>A.label+(A.value===void 0||A.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:h})]})]})};function zu(o){const{value:e}=o.data,{isAvailable:t,content:s}=bn(e,!1);return c.jsx(fe.Option,{...o,isDisabled:!t,className:"selection-source-option",children:s})}function Uu(o){const{value:e}=o.data,{isAvailable:t,content:s}=bn(e,!0),n=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return c.jsx(fe.SingleValue,{...o,isDisabled:!t,className:n,children:s})}function bn(o,e){const t=o?.label,s=Hu(o);return{isAvailable:s.kind==="available",content:c.jsxs(ce,{direction:"row",alignItems:"center",grow:1,children:[!e&&c.jsx(ce,{grow:1,children:t}),s.kind==="unavailable"&&c.jsx(V,{ml:2,children:c.jsx(ws,{label:s.reason,placement:"right",openDelay:500,children:c.jsx(ue.span,{children:c.jsx(Mn,{as:si,color:"red",className:"warning-icon","aria-label":s.reason})})})}),e&&t]})}}function Wu(o,e,t,s){const n=Nu("notifier.NotificationService"),r=jo(),[i,a]=p.useState(void 0);p.useEffect(()=>{if(!o)return;const l=new Bu({mapModel:o,onError(){n.notify({level:"error",message:r.formatMessage({id:"selectionFailed"})})}});return a(l),()=>{l.destroy()}},[o,n,e,r]);const u=Re(async l=>{if(!i||!t)return;const d=await i.select(t,l.getExtent());d&&s?.(d)});return{controller:i,onExtentSelected:u}}function _o(o,e){const t=o.status??"available",s=typeof t=="string"?{kind:t}:t;return s.kind==="available"?s:{kind:"unavailable",reason:s.reason??e}}function Hu(o){const e=jo(),[t,s]=p.useState(()=>({kind:"available"}));return p.useEffect(()=>{if(!o){s({kind:"available"});return}const n=e.formatMessage({id:"sourceNotAvailable"});s(_o(o,n));const r=o.on?.("changed:status",()=>{s(_o(o,n))});return()=>r?.destroy()},[o,e]),t}function $u(o,e,t,s,n){p.useEffect(()=>{if(!o)return;const r=new Fu(o.olMap,e.value,t.formatMessage({id:"tooltip"}),t.formatMessage({id:"disabledTooltip"}),s);return r.setActive(n),()=>{r?.destroy()}},[o,e,t,s,n])}function qu(){const[o,e]=ys("colors",["background_body","border"],["#ffffff","#ffffff"]);return p.useMemo(()=>({control:s=>({...s,cursor:"pointer"}),indicatorSeparator:s=>({...s,borderColor:e}),dropdownIndicator:s=>({...s,backgroundColor:o})}),[o,e])}function Ku(){const o=De(),e=xe("notifier.NotificationService"),t=p.useId(),{map:s}=Z(z),n=xe("ol-app.AppModel"),r=Je(n.state).selectionSources,i=Je(n.state).sourceMetadata,a={numberOptions:{maximumFractionDigits:3},dateOptions:{dateStyle:"medium",timeStyle:"medium",timeZone:"UTC"}};function u(d){const{source:h,results:g}=d;if(!s){console.debug("Map not ready");return}s?.removeHighlight();const m=g.map(S=>S.geometry);m.length>0&&gn(s,m);const w=i.get(h);if(!w){console.warn("Can not show results because no metadata could be found");return}n.setResultListInput({columns:w,data:g,formatOptions:a}),e.notify({level:"info",message:o.formatMessage({id:"foundResults"},{resultsCount:g.length}),displayDuration:4e3})}function l(d){s?.removeHighlight()}return c.jsx(V,{role:"dialog","aria-labelledby":t,children:c.jsx(tt,{title:c.jsx(ot,{id:t,size:"md",mb:2,children:o.formatMessage({id:"selectionTitle"})}),children:c.jsx(Gu,{mapId:z,sources:r,onSelectionComplete:u,onSelectionSourceChanged:l})})})}function Yu(o){const e=p.useId(),t=De();return c.jsx(V,{role:"dialog","aria-labelledby":e,children:c.jsx(tt,{title:c.jsx(ot,{id:e,size:"md",mb:2,children:c.jsx(de,{children:t.formatMessage({id:"tocTitle"})})}),children:c.jsx(V,{overflowY:"auto",maxHeight:o.maxHeight,children:c.jsx(Hr,{mapId:z,showTools:!0,basemapSwitcherProps:{allowSelectingEmptyBasemap:!0}})})})})}const Xu={bookmarksActive:!1,legendActive:!0,overviewMapActive:!0,tocActive:!0};function Zu(){const o=De(),{map:e}=Z(z),[t,s]=p.useState(),[n,r]=p.useState(Xu),i={...n,editingActive:t==="editing",measurementActive:t==="measurement",selectionActive:t==="selection"},a=(g,m)=>{if(g==="selectionActive"||g==="measurementActive"||g==="editingActive"){let w;switch(g){case"editingActive":w="editing";break;case"measurementActive":w="measurement";break;case"selectionActive":w="selection";break}w!==t&&m?(s(w),e?.removeHighlight()):w===t&&!m&&(s(void 0),e?.removeHighlight())}else r({...n,[g]:m})},u=xe("ol-app.AppModel"),l=Je(u.state).resultListState,d=l.input&&l.open,h=[i.tocActive&&c.jsx(Yu,{maxHeight:i.legendActive||t?"300px":"75vh"},"toc"),i.legendActive&&c.jsx(zc,{},"legend"),t==="selection"?c.jsx(Ku,{},"selection"):t==="measurement"?c.jsx(lu,{},"measurement"):void 0];return c.jsxs(ce,{height:"100%",direction:"column",overflow:"hidden",children:[c.jsx(Kr,{position:"top-right"}),c.jsxs(tt,{title:c.jsx(V,{role:"region","aria-label":o.formatMessage({id:"ariaLabel.header"}),textAlign:"center",py:1,children:c.jsx(ot,{size:"md",children:"OpenLayers Base Packages - Default Sample"})}),children:[c.jsx(ce,{flex:"1",direction:"column",position:"relative",children:c.jsxs(Lr,{mapId:z,role:"main","aria-label":o.formatMessage({id:"ariaLabel.map"}),viewPadding:d?{bottom:400}:void 0,children:[c.jsx(li,{centerContent:!0,children:c.jsx(ju,{})}),c.jsx(Pt,{position:"top-left",horizontalGap:20,verticalGap:20,children:c.jsx(Ju,{children:h})}),c.jsx(Pt,{position:"top-right",horizontalGap:20,verticalGap:20,children:i.overviewMapActive&&c.jsx(hu,{})}),c.jsx(Pt,{horizontalGap:20,position:"bottom-left",children:i.bookmarksActive&&c.jsx(Ac,{})}),c.jsx(Pt,{position:"bottom-right",horizontalGap:10,verticalGap:45,children:c.jsx(Xc,{toolState:i,onToolStateChange:a})}),c.jsx(pu,{})]})}),c.jsxs(ce,{role:"region","aria-label":o.formatMessage({id:"ariaLabel.footer"}),gap:3,alignItems:"center",justifyContent:"center",children:[c.jsx(Hl,{mapId:z,precision:2,displayProjectionCode:"EPSG:4326"}),c.jsx(oc,{mapId:z}),c.jsx(rc,{mapId:z})]})]})]})}function Ju(o){const e=o.children,t=[];for(const s of e)s&&(t.length&&t.push(c.jsx(ci,{mt:4,mb:4},t.length)),t.push(s));if(t.length!==0)return c.jsx(V,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",width:350,maxWidth:350,children:t})}const Qu=Ln({component:Zu,theme:Tn,appMetadata:Gl,config:{properties:{"@open-pioneer/local-storage":{storageId:"ol-app-state"},"@open-pioneer/editing":{polygonDrawStyle:{"stroke-color":"red","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(255, 0, 0, 0.2)","circle-stroke-color":"rgba(255, 0, 0, 0.7)","circle-stroke-width":2}}}},async resolveConfig(o){const e=o.getAttribute("forced-locale");if(e)return{locale:e}}});customElements.define("ol-map-app",Qu);const ed=document.getElementsByTagName("body")[0];td();function td(){const o=window.location.search,t=new URLSearchParams(o).get("lang"),s=document.createElement("ol-map-app");s.classList.add("full-height"),s.classList.add("app"),s.setAttribute("id","test"),t&&s.setAttribute("forced-locale",t),ed.appendChild(s)}
