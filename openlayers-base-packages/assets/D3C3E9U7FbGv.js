const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CfN1QXXOFTIQ.js","./CmsKOCeNyeyo.js","./CoIg-_MEOQ7q.js","./Bh0CuZ3gy5tC.js","./X05UpbM2-kuA.js","./Cq1ZpfgEg4XJ.js","./BO_q12Vdyug-.js","./Tz2xttM4F6S2.js","./DUys4rac0YQP.js","./CL_VRsbiqLzM.js"])))=>i.map(i=>d[i]);
var en=Object.defineProperty;var Je=i=>{throw TypeError(i)};var tn=(i,e,t)=>e in i?en(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var _=(i,e,t)=>tn(i,typeof e!="symbol"?e+"":e,t),Ie=(i,e,t)=>e.has(i)||Je("Cannot "+t);var v=(i,e,t)=>(Ie(i,e,"read from private field"),t?t.call(i):e.get(i)),x=(i,e,t)=>e.has(i)?Je("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),w=(i,e,t,s)=>(Ie(i,e,"write to private field"),s?s.call(i,t):e.set(i,t),t),ne=(i,e,t)=>(Ie(i,e,"access private method"),t);import{aJ as nn,bc as sn,bd as rn,be as on,bf as an,aU as ln,b0 as cn,bg as un,bh as dn,a5 as hn,bi as gn,b5 as fn,j as N,bj as mn,bk as pn,bl as yn,bm as St,bn as _n,bo as vn,a as ee,b as Ce,aQ as _e,bp as Xe,bq as K,I as Ze,a3 as j,br as Te,b3 as Z,as as Qe,bs as me,bt as et,bu as A,o as C,bv as U,bw as Oe,bx as Sn,by as xn,E as wn,bz as je,bA as bn,bB as Mn,bC as xt,at as wt,bD as En,bE as Cn,bF as tt,bG as Pn,bH as nt,bI as Fn,bJ as st,r as He,b4 as Be,bK as bt,bL as Ln,b6 as In,f as $e,u as z,b2 as H,i as B,B as P,bM as Tn,b9 as Pe,bN as An,ar as ve,bO as Nn,bP as kn,c as Se,aC as ie,F as Re,C as On,bQ as it,bR as jn,bS as rt,k as ot}from"./X05UpbM2-kuA.js";import{u as Rn,m as Dn,r as m,n as Gn,h as Ue,o as Mt,p as Et,q as Ct,j as d,f as D,s as Vn,t as Hn,c as fe,b as Pt,v as at,B as Ft,C as Bn,w as $n,i as Lt,x as It,l as Un,I as Wn}from"./Bh0CuZ3gy5tC.js";import{G as Tt}from"./ZoLJd0R5aSwV.js";import{a as zn}from"./O4mrD0KJSF-Q.js";import{D as At,S as Kn,I as qn,c as Yn,a as Jn}from"./BbDtNgXSWzWZ.js";import{u as V}from"./Cq1ZpfgEg4XJ.js";import{T as Q,L as Xn,V as Zn}from"./Tz2xttM4F6S2.js";import{u as te,F as k,r as Nt}from"./CoIg-_MEOQ7q.js";import{c as kt}from"./D03oE8cEQPSj.js";import{L as De}from"./ixdUxu1X4zfV.js";import{u as Ot,F as xe}from"./BO_q12Vdyug-.js";import{F as we}from"./CreVQ-qFRzOc.js";import{H as Ge}from"./L25RkWOQSN8A.js";import{F as Qn}from"./CL_VRsbiqLzM.js";import{_ as es}from"./CmsKOCeNyeyo.js";function ts(i){const{theme:e}=Rn(),t=Dn();return m.useMemo(()=>Gn(e.direction,{...t,...i}),[i,e.direction,t])}var We=Ue(function(e,t){const{htmlSize:s,...n}=e,r=Mt("Input",n),o=Et(n),a=Ot(o),l=Ct("chakra-input",e.className);return d.jsx(D.input,{size:s,...a,__css:r.field,ref:t,className:l})});We.displayName="Input";We.id="Input";var jt=Ue(function(e,t){const{children:s,placeholder:n,className:r,...o}=e;return d.jsxs(D.select,{...o,ref:t,className:Ct("chakra-select",r),children:[n&&d.jsx("option",{value:"",children:n}),s]})});jt.displayName="SelectField";function ns(i,e){const t={},s={};for(const[n,r]of Object.entries(i))e.includes(n)?t[n]=r:s[n]=r;return[t,s]}var ze=Ue((i,e)=>{var t;const s=Mt("Select",i),{rootProps:n,placeholder:r,icon:o,color:a,height:l,h:c,minH:u,minHeight:h,iconColor:f,iconSize:g,...p}=Et(i),[y,b]=ns(p,Hn),F=Ot(b),O={width:"100%",height:"fit-content",position:"relative",color:a},S={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(t=s.field)==null?void 0:t._focus}};return d.jsxs(D.div,{className:"chakra-select__wrapper",__css:O,...y,...n,children:[d.jsx(jt,{ref:e,height:c??l,minH:u??h,placeholder:r,...F,__css:S,children:i.children}),d.jsx(Rt,{"data-disabled":Vn(F.disabled),...(f||a)&&{color:f||a},__css:s.icon,...g&&{fontSize:g},children:o})]})});ze.displayName="Select";var ss=i=>d.jsx("svg",{viewBox:"0 0 24 24",...i,children:d.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),is=D("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Rt=i=>{const{children:e=d.jsx(ss,{}),...t}=i,s=m.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return d.jsx(is,{...t,className:"chakra-select__icon-wrapper",children:m.isValidElement(e)?s:null})};Rt.displayName="SelectIcon";function rs(i){return"olLayer"in i}const M={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Fe extends nn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+sn,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(M.ELEMENT,this.handleElementChanged),this.addChangeListener(M.MAP,this.handleMapChanged),this.addChangeListener(M.OFFSET,this.handleOffsetChanged),this.addChangeListener(M.POSITION,this.handlePositionChanged),this.addChangeListener(M.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(M.ELEMENT)}getId(){return this.id}getMap(){return this.get(M.MAP)||null}getOffset(){return this.get(M.OFFSET)}getPosition(){return this.get(M.POSITION)}getPositioning(){return this.get(M.POSITIONING)}handleElementChanged(){rn(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(on(this.element),an(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=ln(e,cn.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(M.ELEMENT,e)}setMap(e){this.set(M.MAP,e)}setOffset(e){this.set(M.OFFSET,e)}setPosition(e){this.set(M.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(M.POSITION))return;const s=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),r=this.getRect(n,[un(n),dn(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!hn(s,r)){const a=r[0]-s[0],l=s[2]-r[2],c=r[1]-s[1],u=s[3]-r[3],h=[0,0];if(a<0?h[0]=a-o:l<0&&(h[0]=Math.abs(l)+o),c<0?h[1]=c-o:u<0&&(h[1]=Math.abs(u)+o),h[0]!==0||h[1]!==0){const f=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(f);if(!g)return;const p=[g[0]+h[0],g[1]+h[1]],y=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(p),duration:y.duration,easing:y.easing})}}}getRect(e,t){const s=e.getBoundingClientRect(),n=s.left+window.pageXOffset,r=s.top+window.pageYOffset;return[n,r,n+t[0],r+t[1]]}setPositioning(e){this.set(M.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const s=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(s,n)}updateRenderedPosition(e,t){const s=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let l="0%",c="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?c="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(c="-50%");const u=`translate(${l}, ${c}) translate(${o}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,s.transform=u)}getOptions(){return this.options}}const cr=gn,os=25.4/.28,as=39.37;function Ke(i){return qe(i,ls,cs)}function ls(i){return i.getView()}function cs(i,e){return i.on("change:view",e)}function Dt(i){return Ke(i)?.getProjection()}function us(i){const e=Ke(i);return qe(e,ds,hs)}function ds(i){return i.getResolution()}function hs(i,e){return i.on("change:resolution",e)}function gs(i){const e=Ke(i);return qe(e,fs,ms)}function fs(i){return i.getCenter()}function ms(i,e){return i.on("change:center",e)}function ps(i){const e=gs(i),t=us(i),s=Dt(i);return m.useMemo(()=>{if(s==null||t==null||e==null)return;const r=fn(s,t,e);return Math.round(r*as*os)},[s,t,e])}function qe(i,e,t){const s=m.useCallback(()=>i?e(i):void 0,[i,e]),n=m.useCallback(r=>{if(!i)return()=>{};const o=t(i,r);return()=>N(o)},[i,t]);return m.useSyncExternalStore(n,s)}const lt=0,re=1,ct=[0,0,0,0],q=[],Ae={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ne extends wt{constructor(e,t,s){super(e),this.features=t,this.mapBrowserEvent=s}}class ys extends mn{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:pn,this.defaultDeleteCondition_=function(s){return yn(s)&&St(s)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:_n,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new vn,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new ee({source:new Ce({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:vs(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new _e(this.source_.getFeatures()),this.source_.addEventListener(Xe.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Xe.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(K.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(K.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const s=this.getMap();s&&s.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,s),e.addEventListener(Ze.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new _e;const s=this.featuresBeingModified_.getArray();for(let n=0,r=t.length;n<r;++n){const o=t[n];for(let a=0,l=o.length;a<l;++a){const c=o[a].feature;c&&!s.includes(c)&&this.featuresBeingModified_.push(c)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ne(Ae.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Ze.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,s=[];t.forEach(function(n){e===n.feature&&s.push(n)});for(let n=s.length-1;n>=0;--n){const r=s[n];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const s=t.getCoordinates(),n={feature:e,geometry:t,segment:[s,s]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const o=s[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length-1;n<r;++n){const o=s.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert(j(o),a)}}writeMultiLineStringGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const o=s[n];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),u={feature:e,geometry:t,depth:[n],index:a,segment:c};this.rBush_.insert(j(c),u)}}}writePolygonGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const o=s[n];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),u={feature:e,geometry:t,depth:[n],index:a,segment:c};this.rBush_.insert(j(c),u)}}}writeMultiPolygonGeometry_(e,t){const s=t.getCoordinates();for(let n=0,r=s.length;n<r;++n){const o=s[n];for(let a=0,l=o.length;a<l;++a){const c=o[a];for(let u=0,h=c.length-1;u<h;++u){const f=c.slice(u,u+2),g={feature:e,geometry:t,depth:[a,n],index:u,segment:f};this.rBush_.insert(j(f),g)}}}}writeCircleGeometry_(e,t){const s=t.getCenter(),n={feature:e,geometry:t,index:lt,segment:[s,s]},r={feature:e,geometry:t,index:re,segment:[s,s]},o=[n,r];n.featureSegments=o,r.featureSegments=o,this.rBush_.insert(Te(s),n);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const s=t.getGeometriesArray();for(let n=0;n<s.length;++n){const r=s[n],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,s){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new Z(new Qe(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",s),n}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==me.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=me.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==me.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],s=[],n=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],c=l.feature;s.includes(c)||s.push(c);const u=l.geometry;n.includes(u)||n.push(u);const h=l.depth;let f;const g=l.segment,p=a[1];for(;t.length<u.getStride();)t.push(g[p][t.length]);switch(u.getType()){case"Point":f=t,g[0]=t,g[1]=t;break;case"MultiPoint":f=u.getCoordinates(),f[l.index]=t,g[0]=t,g[1]=t;break;case"LineString":f=u.getCoordinates(),f[l.index+p]=t,g[p]=t;break;case"MultiLineString":f=u.getCoordinates(),f[h[0]][l.index+p]=t,g[p]=t;break;case"Polygon":f=u.getCoordinates(),f[h[0]][l.index+p]=t,g[p]=t;break;case"MultiPolygon":f=u.getCoordinates(),f[h[1]][h[0]][l.index+p]=t,g[p]=t;break;case"Circle":if(g[0]=t,g[1]=t,l.index===lt)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let y=et(A(u.getCenter()),A(t));u.setRadius(y),this.changingFeature_=!1}break}f&&this.setGeometryCoordinates_(u,f)}this.createOrUpdateVertexFeature_(t,s,n)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const s=this.vertexFeature_;if(s){e.map.getView().getProjection();const n=[],r=s.getGeometry().getCoordinates(),o=j([r]),a=this.rBush_.getInExtent(o),l={};a.sort(_s);for(let c=0,u=a.length;c<u;++c){const h=a[c],f=h.segment;let g=C(h.geometry);const p=h.depth;if(p&&(g+="-"+p.join("-")),l[g]||(l[g]=new Array(2)),h.geometry.getType()==="Circle"&&h.index===re){const y=dt(t,h);U(y,r)&&!l[g][0]&&(this.dragSegments_.push([h,0]),l[g][0]=h);continue}if(U(f[0],r)&&!l[g][0]){this.dragSegments_.push([h,0]),l[g][0]=h;continue}if(U(f[1],r)&&!l[g][1]){if(l[g][0]&&l[g][0].index===0){let y=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":y=y[p[1]];case"Polygon":if(h.index!==y[p[0]].length-2)continue;break}}this.dragSegments_.push([h,1]),l[g][1]=h;continue}C(f)in this.vertexSegments_&&!l[g][0]&&!l[g][1]&&this.insertVertexCondition_(e)&&n.push(h)}n.length&&this.willModifyFeatures_(e,[n]);for(let c=n.length-1;c>=0;--c)this.insertVertex_(n[c],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const s=this.dragSegments_[t][0],n=s.geometry;if(n.getType()==="Circle"){const r=n.getCenter(),o=s.featureSegments[0],a=s.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(Te(r),o);let l=n;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(j(s.segment),s)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ne(Ae.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,s){const n=s||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(l,c){return ut(n,l)-ut(n,c)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(c,u,h)=>{h&&h.getType()==="Point"&&(h=new Qe(Oe(h.getCoordinates())));const f=h||c.getGeometry();if(c instanceof Z&&this.features_.getArray().includes(c)){a=f;const g=c.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:c,geometry:a,segment:[g,g]}]}return!0},{layerFilter:l})}if(!o){const l=Sn(Te(n,ct)),c=t.getView().getResolution()*this.pixelTolerance_,u=xn(wn(l,c,ct));o=this.rBush_.getInExtent(u)}if(o&&o.length>0){const l=o.sort(r)[0],c=l.segment;let u=dt(n,l);const h=t.getPixelFromCoordinate(u);let f=et(e,h);if(a||f<=this.pixelTolerance_){const g={};if(g[C(c)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-n[0],this.delta_[1]=u[1]-n[1]),l.geometry.getType()==="Circle"&&l.index===re)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);else{const p=t.getPixelFromCoordinate(c[0]),y=t.getPixelFromCoordinate(c[1]),b=je(h,p),F=je(h,y);f=Math.sqrt(Math.min(b,F)),this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(u=b>F?c[1]:c[0]),this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);const O={};O[C(l.geometry)]=!0;for(let S=1,L=o.length;S<L;++S){const E=o[S].segment;if(U(c[0],E[0])&&U(c[1],E[1])||U(c[0],E[1])&&U(c[1],E[0])){const $=C(o[S].geometry);$ in O||(O[$]=!0,g[C(E)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const s=e.segment,n=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(r,l);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(r,a,o,1);const u={segment:[s[0],t],feature:n,geometry:r,depth:o,index:a};c.insert(j(u.segment),u),this.dragSegments_.push([u,1]);const h={segment:[t,s[1]],feature:n,geometry:r,depth:o,index:a+1};c.insert(j(h.segment),h),this.dragSegments_.push([h,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=me.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ne(Ae.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let s=!1,n,r,o,a,l,c,u,h,f,g,p;for(l=e.length-1;l>=0;--l)o=e[l],g=o[0],p=C(g.feature),g.depth&&(p+="-"+g.depth.join("-")),p in t||(t[p]={}),o[1]===0?(t[p].right=g,t[p].index=g.index):o[1]==1&&(t[p].left=g,t[p].index=g.index+1);for(p in t){switch(f=t[p].right,u=t[p].left,c=t[p].index,h=c-1,u!==void 0?g=u:g=f,h<0&&(h=0),a=g.geometry,r=a.getCoordinates(),n=r,s=!1,a.getType()){case"MultiLineString":r[g.depth[0]].length>2&&(r[g.depth[0]].splice(c,1),s=!0);break;case"LineString":r.length>2&&(r.splice(c,1),s=!0);break;case"MultiPolygon":n=n[g.depth[1]];case"Polygon":n=n[g.depth[0]],n.length>4&&(c==n.length-1&&(c=0),n.splice(c,1),s=!0,c===0&&(n.pop(),n.push(n[0]),h=n.length-1));break}if(s){this.setGeometryCoordinates_(a,r);const y=[];if(u!==void 0&&(this.rBush_.remove(u),y.push(u.segment[0])),f!==void 0&&(this.rBush_.remove(f),y.push(f.segment[1])),u!==void 0&&f!==void 0){const b={depth:g.depth,feature:g.feature,geometry:g.geometry,index:h,segment:y};this.rBush_.insert(j(b.segment),b)}this.updateSegmentIndices_(a,c,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return s}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,s,n){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(s===void 0||r.depth===void 0||bn(r.depth,s))&&r.index>t&&(r.index+=n)})}}function _s(i,e){return i.index-e.index}function ut(i,e,t){const s=e.geometry;if(s.getType()==="Circle"){let r=s;if(e.index===re){const o=je(r.getCenter(),A(i)),a=Math.sqrt(o)-r.getRadius();return a*a}}const n=A(i);return q[0]=A(e.segment[0]),q[1]=A(e.segment[1]),En(n,q)}function dt(i,e,t){const s=e.geometry;if(s.getType()==="Circle"&&e.index===re)return Oe(s.getClosestPoint(A(i)));const n=A(i);return q[0]=A(e.segment[0]),q[1]=A(e.segment[1]),Oe(Mn(n,q))}function vs(){const i=xt();return function(e,t){return i.Point}}const Ss={SELECT:"select"};class xs extends wt{constructor(e,t,s,n){super(e),this.selected=t,this.deselected=s,this.mapBrowserEvent=n}}const pe={};class Gt extends Cn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:St,this.addCondition_=e.addCondition?e.addCondition:tt,this.removeCondition_=e.removeCondition?e.removeCondition:tt,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Pn,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:nt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:ws(),this.features_=e.features||new _e;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const s=e.layers;t=function(n){return s.includes(n)}}else t=nt;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[C(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[C(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(K.ADD,this.boundAddFeature_),this.features_.addEventListener(K.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(K.ADD,this.boundAddFeature_),this.features_.removeEventListener(K.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const s=this.getMap().getAllLayers().find(function(n){if(n instanceof ee&&n.getSource()&&n.getSource().hasFeature(t))return n});s&&this.addFeatureLayerAssociation_(t,s)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=C(e);t in pe||(pe[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let n=t.length-1;n>=0;--n){const r=t[n];if(r!==this&&r instanceof Gt&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const s=C(e);e.setStyle(pe[s]),delete pe[s]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[C(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),s=this.removeCondition_(e),n=this.toggleCondition_(e),r=!t&&!s&&!n,o=e.map,a=this.getFeatures(),l=[],c=[];if(r){Fn(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(u,h)=>{if(!(!(u instanceof Z)||!this.filter_(u,h)))return this.addFeatureLayerAssociation_(u,h),c.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=a.getLength()-1;u>=0;--u){const h=a.item(u),f=c.indexOf(h);f>-1?c.splice(f,1):(a.remove(h),l.push(h))}c.length!==0&&a.extend(c)}else{o.forEachFeatureAtPixel(e.pixel,(u,h)=>{if(!(!(u instanceof Z)||!this.filter_(u,h)))return(t||n)&&!a.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,h),c.push(u)):(s||n)&&a.getArray().includes(u)&&(l.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=l.length-1;u>=0;--u)a.remove(l[u]);a.extend(c)}return(c.length>0||l.length>0)&&this.dispatchEvent(new xs(Ss.SELECT,c,l,e)),!0}}function ws(){const i=xt();return st(i.Polygon,i.LineString),st(i.GeometryCollection,i.LineString),function(e){return e.getGeometry()?i[e.getGeometry().getType()]:null}}async function bs(i,e,t,s){const r=s.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),o=await i.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${r}>`}});if(!o||!o.ok||o.status!==201)throw new Error("Request failed: "+o.status);const a=o.headers.get("location");if(!a)throw new Error("Request failed: no Location response header");const l=a.substring(a.lastIndexOf("/")+1);return Promise.resolve(l)}async function Ms(i,e,t,s,n){const o=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=new URL(`${e.toString()}/${t}`),l=await i.fetch(a,{method:"PATCH",body:JSON.stringify({type:"Feature",properties:{},geometry:s}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${o}>`}});if(!l||!l.ok||l.status!==204)throw new Error("Request failed: "+l.status);return Promise.resolve(t)}function Vt(i,e){const t=document.createElement("div");t.className="editing-tooltip editing-tooltip-hidden",t.role="tooltip";const s=document.createElement("span");s.textContent=e,t.appendChild(s);const n=new Fe({element:t,offset:[15,0],positioning:"center-left"}),r=i.on("pointermove",o=>{o.dragging||n.setPosition(o.coordinate)});return i.addOverlay(n),{destroy(){N(r),i.removeOverlay(n)},setVisible(o){t.classList.toggle("editing-tooltip-hidden",!o)},setText(o){s.textContent=o}}}function Ht(i){let e=ht(i.polygon);Array.isArray(e)&&(e=e[0]);let t=ht(i.vertex);Array.isArray(t)&&(t=t[0]);const s=[];return e&&s.push(e),t&&(t.setGeometry(Es),s.push(t)),s}const Es=i=>{if(i){const e=i.getGeometry();if(e&&e.getType()==="Polygon"){const t=e.getCoordinates()[0];if(t)return new zn(t)}}},ht=i=>{const e=new Z,s=new ee({style:i}).getStyleFunction();if(!s)throw new Error("can't retrieve style function");const n=s(e,1);if(!n)throw new Error("can't retrieve styles from feature style function");return Array.isArray(n)&&n.length?n.length>1?n:n[0]:n},Cs=fe("editing:EditingCreateWorkflowImpl");var R;class Ps{constructor(e){x(this,R);_(this,"_httpService");_(this,"_intl");_(this,"_map");_(this,"_polygonStyle");_(this,"_vertexStyle");_(this,"_state");_(this,"_editLayerURL");_(this,"_featureId");_(this,"_editingSource");_(this,"_editingLayer");_(this,"_drawInteraction");_(this,"_olMap");_(this,"_tooltip");_(this,"_enterHandler");_(this,"_escapeHandler");_(this,"_error");_(this,"_interactionListener");_(this,"_mapListener");this._httpService=e.httpService,this._intl=e.intl,this._polygonStyle=e.polygonStyle,this._vertexStyle=e.vertexStyle,this._map=e.map,this._olMap=e.map.olMap,this._state=He("active:initialized"),this._editLayerURL=e.ogcApiFeatureLayerUrl,this._editingSource=new Ce,this._editingLayer=new ee({source:this._editingSource,zIndex:Be,properties:{name:"editing-layer"}}),this._drawInteraction=new At({source:this._editingSource,type:"Polygon",style:Ht({polygon:this._polygonStyle,vertex:this._vertexStyle})}),this._tooltip=Vt(this._olMap,this._intl.formatMessage({id:"create.tooltip.begin"})),this._enterHandler=t=>{if((t.code==="Enter"||t.code==="NumpadEnter")&&t.target===this._olMap.getTargetElement()){const s=this._drawInteraction.getOverlay().getSource()?.getFeatures()??[];s[0]&&s[0].getGeometry().getCoordinates()[0].length>4&&this.triggerSave()}},this._escapeHandler=t=>{t.code==="Escape"&&t.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state.value}_setState(e){this._state.value=e}_save(e){this._setState("active:saving");const t=this._editLayerURL,s=e.getGeometry();if(!s){this._destroy(),this._error=new Error("no geometry available"),v(this,R)?.reject(this._error);return}const n=this._olMap.getView().getProjection(),o=new Tt({dataProjection:n}).writeGeometryObject(s,{rightHanded:!0,decimals:10});this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),bs(this._httpService,t,o,n).then(a=>{this._featureId=a,this._destroy(),v(this,R)?.resolve({featureId:this._featureId})}).catch(a=>{Cs.error(a),this._destroy(),this._error=new Error("Failed to save feature",{cause:a}),v(this,R)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._drawInteraction);const e=bt(()=>{const n=this._map.container;if(n)return n.addEventListener("keydown",this._enterHandler,!1),n.addEventListener("keydown",this._escapeHandler,!1),()=>{n.removeEventListener("keydown",this._enterHandler),n.removeEventListener("keydown",this._escapeHandler)}});this._tooltip.setVisible(!0);const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.continue"}))}),s=this._drawInteraction.on("drawend",n=>{const r=n.feature;if(!r){this._destroy(),this._error=new Error("no feature available"),v(this,R)?.reject(this._error);return}this._save(r)});this._interactionListener.push(t,s),this._mapListener.push(e)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.begin"})),this._setState("active:initialized")}stop(){this._destroy(),v(this,R)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.forEach(e=>{N(e)}),this._mapListener.forEach(e=>{e.destroy()}),this._setState("destroyed")}triggerSave(){this._drawInteraction.finishDrawing()}whenComplete(){return this._state.value==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(v(this,R)??w(this,R,Pt())).promise}}R=new WeakMap;var I;class Fs{constructor(e){x(this,I);_(this,"_httpService");_(this,"_intl");_(this,"_map");_(this,"_polygonStyle");_(this,"_vertexStyle");_(this,"_state");_(this,"_editLayerURL");_(this,"_featureId");_(this,"_initialFeature");_(this,"_editFeature");_(this,"_editingSource");_(this,"_editingLayer");_(this,"_modifyInteraction");_(this,"_olMap");_(this,"_tooltip");_(this,"_enterHandler");_(this,"_escapeHandler");_(this,"_error");_(this,"_interactionListener");_(this,"_mapListener");this._httpService=e.httpService,this._intl=e.intl,this._polygonStyle=e.polygonStyle,this._vertexStyle=e.vertexStyle,this._map=e.map,this._olMap=e.map.olMap,this._state=He("active:initialized"),this._editLayerURL=e.ogcApiFeatureLayerUrl,this._initialFeature=e.feature.clone(),this._initialFeature.setId(e.feature.getId()),this._editFeature=e.feature.clone(),this._editFeature.setId(e.feature.getId()),this._editFeature.setStyle(Ht({polygon:this._polygonStyle,vertex:this._vertexStyle})),this._editingSource=new Ce({features:new _e([this._editFeature])}),this._editingLayer=new ee({source:this._editingSource,zIndex:Be,properties:{name:"editing-layer"}}),this._modifyInteraction=new ys({source:this._editingSource}),this._tooltip=Vt(this._olMap,this._intl.formatMessage({id:"create.tooltip.deselect"})),this._enterHandler=t=>{if((t.code==="Enter"||t.code==="NumpadEnter")&&t.target===this._olMap.getTargetElement()){const s=this._editingSource.getFeatures()[0];if(!s)throw Error("no updated feature found");this._save(s)}},this._escapeHandler=t=>{t.code==="Escape"&&t.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getModifyInteraction(){return this._modifyInteraction}getState(){return this._state.value}_setState(e){this._state.value=e}_save(e){this._setState("active:saving");const t=this._editLayerURL;if(this._featureId=e.getId()?.toString(),!this._featureId){this._destroy(),this._error=new Error("no feature id available"),v(this,I)?.reject(this._error);return}const s=e?.getGeometry();if(!s){this._destroy(),this._error=new Error("no geometry available"),v(this,I)?.reject(this._error);return}const n=this._olMap.getView().getProjection(),o=new Tt({dataProjection:n}).writeGeometryObject(s,{rightHanded:!0,decimals:10});this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),Ms(this._httpService,t,this._featureId,o,n).then(a=>{this._destroy(),v(this,I)?.resolve({featureId:a})}).catch(a=>{this._destroy(),this._error=new Error("Failed to save feature",{cause:a}),v(this,I)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._modifyInteraction);const e=this._editingSource.getFeatures()[0];if(e&&!e.getId()?.toString()){this._destroy(),this._error=new Error("no feature id available"),v(this,I)?.reject(this._error);return}const t=bt(()=>{const r=this._map.container;if(r)return r.addEventListener("keydown",this._enterHandler,!1),r.addEventListener("keydown",this._escapeHandler,!1),()=>{r.removeEventListener("keydown",this._enterHandler),r.removeEventListener("keydown",this._escapeHandler)}});this._tooltip.setVisible(!0);const s=this._map.olMap.on("click",r=>{const o=r.coordinate,a=r.originalEvent.altKey,l=this._editingSource.getFeaturesAtCoordinate(o);a||l.length===0&&this.triggerSave()}),n=this._modifyInteraction.on("modifystart",()=>{this._setState("active:drawing")});this._interactionListener.push(s,n),this._mapListener.push(t)}reset(){const e=this._initialFeature.getGeometry()?.clone(),t=this._editingSource.getFeatures()[0];if(!t)throw Error("no updated feature found");t.setGeometry(e),this._setState("active:initialized")}stop(){this._destroy(),v(this,I)?.resolve(void 0)}_destroy(){this._editingSource.clear(),this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),this._interactionListener.forEach(e=>{N(e)}),this._mapListener.forEach(e=>{e.destroy()}),this._setState("destroyed")}triggerSave(){const e=this._editingSource.getFeatures()[0];if(!e)throw Error("no updated feature found");this._save(e)}whenComplete(){return this._state.value==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(v(this,I)??w(this,I,Pt())).promise}}I=new WeakMap;class ur{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}createFeature(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const s=e.id;let n=this._workflows.get(s);if(n)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return n=new Ps({map:e,ogcApiFeatureLayerUrl:t,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(s,n),this._connectToWorkflowDestroyEvent(n,s),n}updateFeature(e,t,s){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let r=this._workflows.get(n);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new Fs({map:e,ogcApiFeatureLayerUrl:t,feature:s,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,r),this._connectToWorkflowDestroyEvent(r,n),r}stop(e){const t=this._workflows.get(e);t&&t.stop()}reset(e){const t=this._workflows.get(e);if(t)t.reset();else throw new Error("No workflow found for mapId: "+e)}_connectToWorkflowDestroyEvent(e,t){const s=Ln(()=>[e.getState()],([n])=>{n==="destroyed"&&(this._workflows.get(t)===e&&this._workflows.delete(t),s.destroy())})}}var W,G,oe,ae,le,Ve;class Ls{constructor(e,t,s){x(this,le);_(this,"label");x(this,W,He({kind:"available"}));x(this,G);x(this,oe);x(this,ae);this.label=t,w(this,G,e),w(this,ae,s),ne(this,le,Ve).call(this),w(this,oe,v(this,G).on("change:visible",()=>{ne(this,le,Ve).call(this)}))}destroy(){N(v(this,oe))}get status(){return v(this,W).value}async select(e,t){if(e.type!=="extent")throw new Error(`Unsupported selection kind: ${e.type}`);if(v(this,W).value.kind!=="available"||v(this,G).getSource()===null)return[];const s=[];v(this,G).getSource().forEachFeatureIntersectingExtent(e.extent,o=>{if(!o.getGeometry())return;const a={...o.getProperties()};delete a.geometries;const l={id:o.getId()?.toString()||In(),geometry:o.getGeometry(),properties:a};s.push(l)});const n=s.filter(o=>o!=null);return n.length>t.maxResults?n.slice(0,t.maxResults):n}}W=new WeakMap,G=new WeakMap,oe=new WeakMap,ae=new WeakMap,le=new WeakSet,Ve=function(){const t=v(this,G).getVisible()?{kind:"available"}:{kind:"unavailable",reason:v(this,ae)};t.kind!==v(this,W).value.kind&&(v(this,W).value=t)};var ce;class dr{constructor({intl:e}){x(this,ce);w(this,ce,e)}createSelectionSource(e){return new Ls(e.vectorLayer,e.label,v(this,ce).formatMessage({id:"layerNotVisibleReason"}))}}ce=new WeakMap;const Is="@open-pioneer/notifier",Ts=$e.bind(void 0,Is),As=kt({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"}),Bt=kt({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Ns=!1;function hr(i){const{position:e="top-right"}=i,t=ts(),s=Ts("notifier.NotificationService"),[n,r]=m.useState(!Ns),o=V(l=>{const c=l.level==="error"?d.jsx(Bt,{h:"100%",w:"100%"}):void 0;t({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:c})}),a=V(()=>{t.closeAll()});return m.useEffect(()=>{const l=s.registerHandler({showNotification:o,closeAll:a});return()=>l.destroy()},[n,s,o,a]),d.jsx(d.Fragment,{})}const ks="@open-pioneer/coordinate-viewer",Os=z.bind(void 0,ks),js=4,Rs="decimal",gr=i=>{const{precision:e,displayProjectionCode:t,format:s}=i,{containerProps:n}=H("coordinate-viewer",i),{map:r}=B(i),o=r?.olMap,a=Dt(o)?.getCode()??"";let{coordinates:l}=Gs(o);l=l&&t?Hs(l,a,t):l;const c=Ds(l,e,s),u=t||a,h=c?c+" "+u:"";return d.jsx(P,{...n,children:d.jsx(Q,{className:"coordinate-viewer-text",children:h})})};function Ds(i,e,t){const s=Os();return i?Vs(i,e,s,t):""}function Gs(i){const[e,t]=m.useState();return m.useEffect(()=>{if(!i)return;const s=i.on("pointermove",n=>{t(n.coordinate)});return()=>N(s)},[i]),{coordinates:e}}function Vs(i,e,t,s){if(i[0]==null||i[1]==null)return"";const n=e??js,r=s??Rs,[o,a]=i;let l;if(r==="degree"&&isFinite(o)&&isFinite(a)){const[c,u,h]=gt(o,t,n),[f,g,p]=gt(a,t,n),y=`${Math.abs(c)}°${u}'${h}"${0<=c?"(E)":"(W)"}`,b=`${Math.abs(f)}°${g}'${p}"${0<=f?"(N)":"(S)"}`;l=y+" "+b}else{const c=t.formatNumber(o,{maximumFractionDigits:n,minimumFractionDigits:n}),u=t.formatNumber(a,{maximumFractionDigits:n,minimumFractionDigits:n});l=c+" "+u}return l}function gt(i,e,t){const s=Math.floor(i),n=i-s,r=Math.floor(60*n),a=60*(60*n-r),l=e.formatNumber(a,{maximumFractionDigits:t,minimumFractionDigits:t});return[s,r,l]}function Hs(i,e,t){return Tn(i,e,t)}const fr=i=>{const{displayMode:e="line"}=i,{containerProps:t}=H("scale-bar",i),{map:s}=B(i),n=m.useRef(null);return m.useEffect(()=>{if(n.current&&s){const r=s.olMap,o=new Kn({units:"metric",target:n.current,bar:e==="bar"});return r.addControl(o),()=>{r.removeControl(o)}}},[e,s]),d.jsx(P,{...t,ref:n})},Bs="@open-pioneer/scale-viewer",$s=z.bind(void 0,Bs),mr=i=>{const{containerProps:e}=H("scale-viewer",i),{map:t}=B(i),s=$s(),n=ps(t?.olMap),r=n?s.formatNumber(n):void 0;return d.jsx(P,{...e,children:r&&d.jsxs(Q,{children:["1:",r]})})},Us="@open-pioneer/legend",$t=z.bind(void 0,Us),pr=i=>{const{showBaseLayers:e=!1}=i,{containerProps:t}=H("legend",i),{map:s}=B(i);return d.jsx(P,{...t,children:s?d.jsx(Ws,{map:s,showBaseLayers:e}):null})};function Ws(i){const{map:e,showBaseLayers:t}=i,n=Ks(e).map(r=>d.jsx(Ut,{layer:r,showBaseLayers:t},r.id));return d.jsx(Xn,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:n})}function Ut(i){const{layer:e,showBaseLayers:t}=i,s=te(()=>e.visible,[e]),n=qs(e);if(!s||!t&&rs(e)&&Wt(e))return;const r=[];return n?.length&&n.forEach(o=>{r.push(d.jsx(Ut,{layer:o,showBaseLayers:t},o.id))}),d.jsxs(d.Fragment,{children:[d.jsx(zs,{layer:e,showBaseLayers:t}),r]})}function zs(i){const e=$t(),{layer:t,showBaseLayers:s}=i,n=Wt(t),r=Ys(t),o=te(()=>t.legend,[t]);let a;return r?.Component?a=d.jsx(r.Component,{layer:t}):r?.imageUrl?a=d.jsx(ft,{layer:t,imageUrl:r.imageUrl}):o&&(a=d.jsx(ft,{layer:t,imageUrl:o})),a?d.jsxs(P,{as:"li",className:Pe("legend-item",`layer-${Js(t.id)}`),children:[s&&n?d.jsx(Q,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,a]}):void 0}function ft(i){const e=$t(),{layer:t,imageUrl:s}=i;return d.jsxs(P,{children:[d.jsx(Q,{children:t.title}),d.jsx(qn,{maxW:"none",maxH:"none",src:s,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:d.jsx(P,{children:d.jsxs(Q,{children:[d.jsx(Bt,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function Ks(i){return te(()=>{const e=i.layers.getAllLayers({sortByDisplayOrder:!0})??[];return e.reverse(),e},[i])}function qs(i){return te(()=>{const e=i.sublayers?.getSublayers({sortByDisplayOrder:!0});if(e)return e.reverse(),e},[i])}function Ys(i){return te(()=>i.attributes.legend,[i])}function Wt(i){return!("parentLayer"in i)&&i.isBaseLayer}function Js(i){return i.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const Xs="@open-pioneer/measurement",Zs=z.bind(void 0,Xs);class Qs{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;activeMeasurement;predefinedMeasurements=new Map;finishedMeasurements=new Set;helpTooltip;resources=[];measurementChangedHandler;constructor(e,t){this.olMap=e,this.messages=t;const s=this.source=new Ce;this.layer=new ee({source:s,zIndex:Be,properties:{name:"measurement-layer"}}),e.addLayer(this.layer);const n=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){N(n)}});const r=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",r),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",r)}}),this.helpTooltip=ti(this.olMap)}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.activeMeasurement=at(this.activeMeasurement);for(const e of this.finishedMeasurements)e.destroy();this.finishedMeasurements.clear(),this.helpTooltip.destroy(),this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose(),this.measurementChangedHandler=void 0,this.predefinedMeasurements.clear()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setMeasurementSourceChangedHandler(e){this.measurementChangedHandler=e}setPredefinedMeasurements(e){this.updatePredefinedMeasurements(e)}setActiveFeatureStyle(e){const t=An(e);this.activeFeatureStyle=(s,...n)=>{const r=s?.getGeometry()?.getType();if(r==="Polygon"||r==="LineString"||r==="Point")return t(s,...n)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){const e=this.source.getFeatures();this.source.clear(),e.forEach(t=>{this.raiseMeasurementsChangeEvent("remove-measurement",t)}),this.predefinedMeasurements.clear();for(const t of this.finishedMeasurements)t.destroy();this.finishedMeasurements.clear()}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",s=this.draw=new At({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(s);let n,r;s.on("drawstart",o=>{const a=o.feature;a&&(n=this.activeMeasurement=new mt("active",a,this),r=a.getGeometry()?.on("change",()=>{n?.updateTooltipContent(),n?.updateTooltipPosition()}))}),s.on("drawend",()=>{if(n&&n===this.activeMeasurement){const o=n;o.updateState("finished"),this.finishedMeasurements.add(o),this.raiseMeasurementsChangeEvent("add-measurement",o.feature),this.activeMeasurement=n=void 0}n=void 0,r&&N(r)}),s.on("drawabort",()=>{n&&(n.destroy(),n===this.activeMeasurement&&(this.activeMeasurement=void 0),n=void 0),r&&N(r)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.activeMeasurement=at(this.activeMeasurement)}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,s=si(this.messages,this.activeMeasurement);t.setText(s),t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}updatePredefinedMeasurements(e){const t=e.filter(n=>!this.predefinedMeasurements.has(n)),s=[];for(const n of this.predefinedMeasurements.keys())e.includes(n)||s.push(n);t.forEach(n=>{const r=new Z(n);this.source.addFeature(r);const o=new mt("finished",r,this);this.finishedMeasurements.add(o),this.predefinedMeasurements.set(n,o),this.raiseMeasurementsChangeEvent("add-measurement",r)}),s.forEach(n=>{const r=this.predefinedMeasurements.get(n);r&&(this.source.removeFeature(r.feature),this.finishedMeasurements.delete(r),r.destroy(),this.raiseMeasurementsChangeEvent("remove-measurement",r.feature)),this.predefinedMeasurements.delete(n)})}raiseMeasurementsChangeEvent(e,t){const s=t.getGeometry();this.measurementChangedHandler&&s&&this.measurementChangedHandler({kind:e,geometry:(s instanceof ve,s)})}}class mt{controller;feature;_state;tooltip;constructor(e,t,s){this.controller=s,this._state=e,this.feature=t,this.tooltip=ni(this.olMap),this.updateTooltipContent(),this.updateTooltipPosition(),this.tooltip.setActive(e==="active")}destroy(){this.tooltip.destroy()}get state(){return this._state}updateState(e){this._state!==e&&(this._state=e,this.tooltip.setActive(e==="active"))}updateTooltipContent(){const e=this.feature.getGeometry();if(!e)return;const t=this.olMap.getView().getProjection();let s;e instanceof ve?s=ii(e,t,this.messages):e instanceof De&&(s=ri(e,t,this.messages)),s&&this.tooltip.setHtml(s)}updateTooltipPosition(){const e=this.feature.getGeometry();if(!e)return;let t;if(e instanceof ve)t=e.getInteriorPoint().getCoordinates()||null;else if(e instanceof De)t=e.getLastCoordinate()||null;else return;this.tooltip.overlay.setPosition(t)}get olMap(){return this.controller.olMap}get messages(){return this.controller.messages}}const pt=[0,-15],ei=[0,-7];function ti(i){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const s=new Fe({element:e,offset:[15,0],positioning:"center-left"});return i.addOverlay(s),{overlay:s,element:e,destroy(){i.removeOverlay(s)},setText(n){t.textContent=n},setHtml(n){t.innerHTML=n}}}function ni(i){const e=document.createElement("div");e.role="tooltip",e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=document.createElement("span");e.appendChild(t);const s=new Fe({element:e,offset:pt,positioning:"bottom-center",stopEvent:!1,insertFirst:!1});return i.addOverlay(s),{overlay:s,element:e,destroy(){i.removeOverlay(s)},setActive(n){n?(e.className="measurement-tooltip measurement-active-tooltip printing-hide",s.setOffset(pt)):(e.className="measurement-tooltip measurement-finished-tooltip",s.setOffset(ei))},setText(n){t.textContent=n},setHtml(n){t.innerHTML=n}}}function si(i,e){if(e){const t=e.feature.getGeometry();if(t instanceof ve||t instanceof De)return i.getContinueMessage()}return i.getHelpMessage()}function ii(i,e,t){const s=Nn(i,{projection:e});let n;return s>=1e6?n=`${t.formatNumber(s/1e6)} km<sup>2</sup>`:n=`${t.formatNumber(s)} m<sup>2</sup>`,n}function ri(i,e,t){const s=kn(i,{projection:e});let n;return s>=1e3?n=`${t.formatNumber(s/1e3)} km`:n=`${t.formatNumber(s)} m`,n}const yr=i=>{const e=Zs(),{containerProps:t}=H("measurement",i),[s,n]=m.useState("distance"),r=u=>e.formatMessage({id:u}),o=B(i),a=oi(o.map,i,e);m.useEffect(()=>{if(a)return a.startMeasurement(s),()=>{a.stopMeasurement()}},[a,s]);function l(u){if(u==="distance"||u==="area")n(u);else throw new Error(`Unexpected measurement type: '${u}'.`)}function c(){a?.clearMeasurements()}return d.jsxs(P,{...t,children:[d.jsx(Q,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),d.jsx(xe,{mb:4,alignItems:"center",children:d.jsxs(Ge,{mb:2,children:[d.jsx(we,{mb:1,children:r("measurementLabel")}),d.jsxs(ze,{value:s,onChange:u=>l(u.target.value),className:"measurement-select",children:[d.jsx("option",{value:"distance",children:r("distance")}),d.jsx("option",{value:"area",children:r("area")})]})]})}),d.jsx(Ft,{padding:2,className:"measurement-delete-button",onClick:c,width:"100%",children:r("deleteMeasurementLabel")})]})};function oi(i,e,t){const{activeFeatureStyle:s,finishedFeatureStyle:n,onMeasurementsChange:r,predefinedMeasurements:o}=e,[a,l]=m.useState(void 0);return m.useEffect(()=>{if(!i)return;const c=new Qs(i.olMap,{getContinueMessage(){return t.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return t.formatMessage({id:"tooltips.help"})},formatNumber(u){return t.formatNumber(u,{maximumFractionDigits:2})}});return l(c),()=>{c.destroy(),l(void 0)}},[i,t]),m.useEffect(()=>{a?.setActiveFeatureStyle(s??ai())},[a,s]),m.useEffect(()=>{a?.setFinishedFeatureStyle(n??li())},[a,n]),m.useEffect(()=>{a?.setMeasurementSourceChangedHandler(r)},[a,r]),m.useEffect(()=>{a?.setPredefinedMeasurements(o??[])},[a,o]),a}function ai(){return[new Se({stroke:new ie({color:"#fff",lineDash:[10,10],width:5})}),new Se({fill:new Re({color:"rgba(0,0,0,0.15)"}),stroke:new ie({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new On({radius:5,stroke:new ie({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new Re({color:"rgba(255, 255, 255, 0.2)"})})})]}function li(){return[new Se({stroke:new ie({color:"#fff",width:5})}),new Se({stroke:new ie({color:"#0b96fc",width:3}),fill:new Re({color:"rgba(11,150,252,0.15)"})})]}const ci="@open-pioneer/search",Le=z.bind(void 0,ci);function ui(i){const e=i.selectProps.inputValue.length>0,t={...i,className:Pe(i.className,{"search-invisible":!e})};return d.jsx(k.Menu,{...t,children:i.children})}function di(i){const e=i.data.label,t={...i.innerProps,"aria-label":e,role:"group"};return d.jsx(k.Group,{...i,innerProps:t})}function hi(i){const t=Le().formatMessage({id:"noOptionsText"});return d.jsx(k.NoOptionsMessage,{...i,children:d.jsx(D.span,{className:"search-no-match",children:t})})}function gi(i){const t=Le().formatMessage({id:"loadingText"});return d.jsx(k.LoadingMessage,{...i,children:d.jsx(D.span,{className:"search-loading-text",children:t})})}function fi({children:i,...e}){const t={...e,className:Pe(e.className,"search-value-container")};return d.jsxs(k.ValueContainer,{...t,children:[!!i&&d.jsx(As,{style:{position:"absolute",left:8}}),i]})}function mi(i){const e={...i,isHidden:!1};return d.jsx(k.Input,{...e})}function pi(i){return null}function yi(i){return d.jsxs(k.IndicatorsContainer,{...i,children:[i.children,!i.selectProps.isLoading&&i.selectProps.inputValue&&d.jsx(_i,{selectProps:i.selectProps,clearValue:i.clearValue})]})}function _i(i){const t=Le().formatMessage({id:"ariaLabel.clearButton"}),s=n=>{n.preventDefault(),n.stopPropagation(),i.clearValue()};return d.jsx(Bn,{role:"button",size:"md",mr:1,"aria-label":t,onClick:s,onTouchEnd:s,onMouseDown:n=>n.preventDefault()})}function vi(i){return null}function Si(i){const e=i.selectProps.inputValue,t=i.data.label,s={...i,className:Pe(i.className,"search-option")};return d.jsx(k.Option,{...s,children:d.jsx(D.div,{className:"search-option-label",children:e.trim().length>0?xi(t,e):t})})}function xi(i,e){const t=i.toLowerCase().indexOf(e.toLowerCase());return t>=0?d.jsxs(d.Fragment,{children:[i.substring(0,t),d.jsx(D.span,{className:"search-highlighted-match",children:i.substring(t,t+e.length)},"highlighted"),i.substring(t+e.length)]}):i}const yt=fe("search:SearchController"),_t=200,vt=5;var ue,Y,J,X,T,Me,zt;class wi{constructor(e,t){x(this,Me);x(this,ue);x(this,Y,[]);x(this,J,vt);x(this,X,_t);x(this,T);w(this,ue,e),w(this,Y,t)}destroy(){v(this,T)?.abort(),w(this,T,void 0)}async search(e){if(v(this,T)?.abort(),w(this,T,void 0),!e)return[];const t=w(this,T,new AbortController);try{return await bi(t.signal,v(this,X)),t.signal.aborted&&(yt.debug(`search canceled with ${e}`),$n()),(await Promise.all(v(this,Y).map(n=>ne(this,Me,zt).call(this,n,e,t.signal)))).filter(n=>n!=null)}finally{v(this,T)===t&&w(this,T,void 0)}}get searchTypingDelay(){return v(this,X)}set searchTypingDelay(e){w(this,X,e??_t)}get maxResultsPerSource(){return v(this,J)}set maxResultsPerSource(e){w(this,J,e??vt)}get sources(){return v(this,Y)}}ue=new WeakMap,Y=new WeakMap,J=new WeakMap,X=new WeakMap,T=new WeakMap,Me=new WeakSet,zt=async function(e,t,s){const n=e.label,r=v(this,ue).olMap.getView().getProjection();try{const o=v(this,J);let a=await e.search(t,{maxResults:o,signal:s,mapProjection:r});return a.length>o&&(a=a.slice(0,o)),{label:n,source:e,results:a}}catch(o){Lt(o)||yt.error(`search for source ${n} failed`,o);return}};async function bi(i,e){i.aborted||await new Promise(t=>{const s=()=>{i.removeEventListener("abort",s),clearTimeout(n),t()};i.addEventListener("abort",s);const n=setTimeout(s,e)})}const be=fe("search:Search"),_r=i=>{const{sources:e,searchTypingDelay:t,maxResultsPerGroup:s,onSelect:n,onClear:r}=i,{containerProps:o}=H("search",i),{map:a}=B(i),l=Le(),c=Pi(e,t,s,a),{input:u,search:h,selectedOption:f,onInputChanged:g,onResultConfirmed:p}=Fi(c),y=Ci(),b=Mi(l),F=Ei(),O=V((E,$)=>{$.action==="input-change"&&g(E)}),S=V((E,$)=>{switch($.action){case"select-option":E&&(p(E),n?.({source:E.source,result:E.result}));break;case"clear":g(""),L.current?.blur(),L.current?.focus(),r?.();break;default:be.debug(`Unhandled action type '${$.action}'.`);break}}),L=m.useRef(null);return d.jsx(P,{...o,children:d.jsx(Nt,{className:"search-component",classNamePrefix:"react-select",ref:L,inputValue:u,onInputChange:O,"aria-label":l.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:b,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:y,isClearable:!0,placeholder:l.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:h.kind==="loading",options:h.kind==="ready"?h.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:F,onChange:S,value:f,menuPosition:"fixed"})})};function Mi(i){return m.useMemo(()=>({onFocus:()=>"",onChange:()=>"",guidance:()=>`${i.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[i])}function Ei(){return m.useMemo(()=>({Menu:ui,Input:mi,SingleValue:pi,Option:Si,NoOptionsMessage:hi,LoadingMessage:gi,ValueContainer:fi,IndicatorsContainer:yi,ClearIndicator:vi,Group:di}),[])}function Ci(){const[i,e]=It("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return m.useMemo(()=>({groupHeading:s=>({...s,backgroundColor:i,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:s=>({...s,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:s=>({...s,display:"none"})}),[i,e])}function Pi(i,e,t,s){const[n,r]=m.useState(void 0);return m.useEffect(()=>{if(!s)return;const o=new wi(s,i);return r(o),()=>{o.destroy(),r(void 0)}},[s,i]),m.useEffect(()=>{n&&(n.searchTypingDelay=e)},[n,e]),m.useEffect(()=>{n&&(n.maxResultsPerSource=t)},[n,t]),n}function Fi(i){const[e,t]=m.useReducer((a,l)=>{switch(l.kind){case"input":return{...a,query:l.query,selectedOption:null};case"select-option":return{...a,selectedOption:l.option,query:l.option.label};case"load-results":return{...a,search:{kind:"loading"}};case"accept-results":return{...a,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),s=m.useRef(),n=V(a=>{if(!i){s.current=void 0,t({kind:"accept-results",results:[]});return}be.isDebug()&&be.debug(`Starting new search for query ${JSON.stringify(a)}.`),t({kind:"load-results"});const l=s.current=Li(i,a).then(c=>{s.current===l&&t({kind:"accept-results",results:c})})}),r=m.useCallback(a=>{t({kind:"select-option",option:a})},[]),o=m.useCallback(a=>{t({kind:"input",query:a}),n(a)},[n]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:r,onInputChanged:o}}async function Li(i,e){let t;try{t=await i.search(e)}catch(s){Lt(s)||be.error("Search failed",s),t=[]}return Ii(t)}function Ii(i){return i.map((t,s)=>({label:t.label,options:t.results.map(n=>({value:`${s}-${n.id}`,label:n.label,source:t.source,result:n}))}))}const Kt="@open-pioneer/selection",Ti=$e.bind(void 0,Kt),Ye=z.bind(void 0,Kt),se="selection-active",ye="selection-inactive";class Ai{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,s,n){const r=this.initViewport(e);this.interactionResources.push(this.createDragBox(e,n,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources)),this.tooltip=this.createHelpTooltip(e,t),this.olMap=e,this.tooltipMessage=t,this.tooltipDisabledMessage=s}initViewport(e){const t=e.getViewport();return t.classList.add(se),t.oncontextmenu=s=>(s.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(s=>this.olMap.addInteraction(s.interaction)),this.tooltip.setText(this.tooltipMessage),t.classList.remove(ye),t.classList.add(se),this.isActive=!0):(this.interactionResources.forEach(s=>this.olMap.removeInteraction(s.interaction)),this.tooltip.setText(this.tooltipDisabledMessage),t.classList.remove(se),t.classList.add(ye),this.isActive=!1)}createDragBox(e,t,s,n){const r=new it({className:"selection-drag-box",condition:jn});return e.addInteraction(r),r.on("boxend",function(){t(r.getGeometry())}),{interaction:r,destroy(){e.removeInteraction(r),n.splice(n.indexOf(this)),r.dispose(),s.classList.remove(se),s.classList.remove(ye),s.oncontextmenu=null}}}createDrag(e,t,s){const n=function(a){return a.originalEvent.button==2},r=new rt({condition:n});return e.addInteraction(r),{interaction:r,destroy(){e.removeInteraction(r),s.splice(s.indexOf(this)),r.dispose(),t.classList.remove(se),t.classList.remove(ye),t.oncontextmenu=null}}}createHelpTooltip(e,t){const s=document.createElement("div");s.className="selection-tooltip printing-hide",s.role="tooltip";const n=document.createElement("span");n.textContent=t,s.appendChild(n);const r=new Fe({element:s,offset:[15,0],positioning:"center-left"}),o=e.on("pointermove",a=>{r.setPosition(a.coordinate)});return e.addOverlay(r),{overlay:r,element:s,destroy(){e.removeOverlay(r),r.dispose(),N(o)},setText(a){n.textContent=a}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof it)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof rt)}}const ke=fe("selection:SelectionController"),Ni=1e4;var de,he,ge,Ee,qt;class ki{constructor(e){x(this,Ee);x(this,de);x(this,he);x(this,ge);const{mapModel:t,onError:s,maxResults:n=Ni}=e;w(this,de,t),w(this,he,n),w(this,ge,s)}destroy(){}async select(e,t){if(t)return await ne(this,Ee,qt).call(this,e,t)}}de=new WeakMap,he=new WeakMap,ge=new WeakMap,Ee=new WeakSet,qt=async function(e,t){const s=v(this,de).olMap.getView().getProjection();try{ke.debug(`Starting selection on source '${e.label}'`);const n=v(this,he);let r=await e.select({type:"extent",extent:t},{maxResults:n,mapProjection:s,signal:new AbortController().signal});return r.length>n&&(r=r.slice(0,n)),ke.debug(`Found ${r.length} results on source '${e.label}'`),{source:e,results:r}}catch(n){ke.error(`selection from source ${e.label} failed`,n),v(this,ge).call(this);return}};const Oi={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},vr=i=>{const e=Ye(),{sources:t,onSelectionComplete:s,onSelectionSourceChanged:n}=i,{containerProps:r}=H("selection",i),o=e.formatMessage({id:"sourceNotAvailable"}),[a,l]=Di(t,n),c=Xt(a,o),u=B(i),{onExtentSelected:h}=Gi(u.map,t,a,s),f=Hi(),[g,p]=m.useState(!1);Vi(u.map,e,h,c.kind==="available",!!a);const y=m.useMemo(()=>t.map(S=>({label:S.label,value:S})),[t]),b=m.useMemo(()=>y.find(L=>L.value===a)||null,[y,a]),F=V(S=>{l(S?.value)}),O=V(S=>{!g&&S.key==="Enter"&&p(!0)});return d.jsx(Zn,{...r,spacing:2,children:d.jsxs(xe,{children:[d.jsx(we,{children:e.formatMessage({id:"selectSource"})}),d.jsx(Nt,{className:"selection-source react-select",...Oi,options:y,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:b,onChange:F,components:{Option:ji,SingleValue:Ri},isOptionDisabled:()=>!1,getOptionLabel:S=>{const L=S.label,E=Jt(S.value,o);return E.kind=="available"?L:L+" "+E.reason},ariaLiveMessages:{guidance:()=>"",onChange:S=>S.action=="select-option"||S.action=="initial-input-focus"?S.label+" "+e.formatMessage({id:"selected"}):"",onFilter:()=>"",onFocus:()=>""},chakraStyles:f,onKeyDown:O,menuIsOpen:g,onMenuOpen:()=>p(!0),onMenuClose:()=>p(!1)})]})})};function ji(i){const{value:e}=i.data,{isAvailable:t,content:s}=Yt(e,!1);return d.jsx(k.Option,{...i,isDisabled:!t,className:"selection-source-option",children:s})}function Ri(i){const{value:e}=i.data,{isAvailable:t,content:s}=Yt(e,!0),n=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return d.jsx(k.SingleValue,{...i,isDisabled:!t,className:n,children:s})}function Di(i,e){const[t,s]=m.useState(()=>i[0]);m.useEffect(()=>{t&&!i.includes(t)&&s(void 0)},[i,t]);const n=m.useRef(void 0);return m.useEffect(()=>{t!==n.current&&(n.current=t,e?.({source:t}))},[t,e]),[t,s]}function Yt(i,e){const t=Ye(),s=i?.label,n=t.formatMessage({id:"sourceNotAvailable"}),r=Xt(i,n);return{isAvailable:r.kind==="available",content:d.jsxs(ot,{direction:"row",alignItems:"center",grow:1,children:[!e&&d.jsx(ot,{grow:1,children:s}),r.kind==="unavailable"&&d.jsx(P,{ml:2,children:d.jsx(Un,{label:r.reason,placement:"right",openDelay:500,children:d.jsx(D.span,{children:d.jsx(Wn,{as:Qn,color:"red",className:"warning-icon","aria-label":r.reason})})})}),e&&s]})}}function Gi(i,e,t,s){const n=Ti("notifier.NotificationService"),r=Ye(),[o,a]=m.useState(void 0);m.useEffect(()=>{if(!i)return;const c=new ki({mapModel:i,onError(){n.notify({level:"error",message:r.formatMessage({id:"selectionFailed"})})}});return a(c),()=>{c.destroy()}},[i,n,e,r]);const l=V(async c=>{if(!o||!t)return;const u=await o.select(t,c.getExtent());u&&s?.(u)});return{controller:o,onExtentSelected:l}}function Jt(i,e){const t=i.status??"available",s=typeof t=="string"?{kind:t}:t;return s.kind==="available"?s:{kind:"unavailable",reason:s.reason??e}}function Xt(i,e){return te(()=>i?Jt(i,e):{kind:"unavailable",reason:e},[i,e])}function Vi(i,e,t,s,n){m.useEffect(()=>{if(!i)return;const r=n?e.formatMessage({id:"disabledTooltip"}):e.formatMessage({id:"noSourceTooltip"}),o=new Ai(i.olMap,e.formatMessage({id:"tooltip"}),r,t);return o.setActive(s),()=>{o?.destroy()}},[i,e,t,s,n])}function Hi(){const[i,e]=It("colors",["background_body","border"],["#ffffff","#ffffff"]);return m.useMemo(()=>({control:s=>({...s,cursor:"pointer"}),indicatorSeparator:s=>({...s,borderColor:e}),dropdownIndicator:s=>({...s,backgroundColor:i})}),[i,e])}const Zt="@open-pioneer/printing",Qt=$e.bind(void 0,Zt),Bi=z.bind(void 0,Zt),$i="map";class Ui{olMap;i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,s){this.olMap=e,this.printingService=t,this.i18n=s}destroy(){this.reset()}setViewPadding(e){this.viewPadding=e}async handleMapExport(e){if(this.olMap)try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const t=this.printMap.getCanvas();if(t)e.fileFormat=="png"?await this.exportMapInPNG(t,e):await this.exportMapInPDF(t,e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Yn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(e){const t=e.title||"",s=e.title||$i;return{title:t,fileName:s}}async exportMapInPNG(e,t){const s=document.createElement("canvas");s.width=e.width,s.height=e.height+50,s.style.backgroundColor="#fff";const n=s.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:r,fileName:o}=this.getTitleAndFileName(t);n.fillStyle="#fff",n.fillRect(0,0,s.width,s.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const a=s.width/2;n.fillText(r,a,20),n.drawImage(e,0,50);const l=document.createElement("a");l.setAttribute("download",o+".png");const c=Jn(s);if(!c)throw new Error("Failed to get image data URL");l.href=c,l.click()}async exportMapInPDF(e,t){const{jsPDF:s}=await es(async()=>{const{jsPDF:F}=await import("./CfN1QXXOFTIQ.js");return{jsPDF:F}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),n=new s({orientation:"landscape",unit:"mm",format:"a4"}),r=n.internal.pageSize.getWidth(),o=n.internal.pageSize.getHeight(),a=15,l=20,c=o-l;n.setFontSize(20);const{title:u,fileName:h}=this.getTitleAndFileName(t);n.text(u,r/2,a,{align:"center"});const f=e.width/e.height;let g=c,p=g*f;p>=r&&(p=r,g=p/f);const y=(r-p)/2,b=l+(c-g)/2;n.addImage(e,"",y,b,p,g),n.save(h+".pdf")}}const Wi=fe("printing"),Sr=i=>{const e=Bi(),{viewPadding:t="auto"}=i,{containerProps:s}=H("printing",i),[n,r]=m.useState("pdf"),[o,a]=m.useState(""),[l,c]=m.useState(!1),u=Qt("notifier.NotificationService"),{map:h}=B(i),f=zi(h,e,t);function g(y){(y==="png"||y==="pdf")&&r(y)}function p(){l||!f||(c(!0),f.handleMapExport({title:o,fileFormat:n}).catch(y=>{const b=e.formatMessage({id:"printingFailed"});u.notify({level:"error",message:b}),Wi.error("Failed to print the map",y)}).finally(()=>{c(!1)}))}return d.jsx(P,{...s,children:d.jsxs(P,{as:"form",m:2,alignItems:"center",onSubmit:y=>{y.preventDefault(),p()},children:[d.jsxs(xe,{as:Ge,mb:2,children:[d.jsx(we,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),d.jsx(We,{placeholder:e.formatMessage({id:"input.placeholder"}),value:o,onChange:y=>{a(y.target.value)},autoFocus:!0})]}),d.jsxs(xe,{as:Ge,mb:2,children:[d.jsx(we,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),d.jsxs(ze,{value:n,onChange:y=>g(y.target.value),className:"printing-select",children:[d.jsx("option",{value:"png",children:"PNG"}),d.jsx("option",{value:"pdf",children:"PDF"})]})]}),d.jsx(Ft,{isLoading:l,loadingText:e.formatMessage({id:"printingMap"}),disabled:l,mt:2,p:2,className:"printing-export-button",type:"submit",width:"100%",children:e.formatMessage({id:"export"})})]})})};function zi(i,e,t){const s=Qt("printing.PrintingService"),[n,r]=m.useState(void 0);return m.useEffect(()=>{if(!i)return;const o=new Ui(i.olMap,s,{overlayText:e.formatMessage({id:"printingMap"})});return r(o),()=>{o.destroy(),r(void 0)}},[i,e,s]),m.useEffect(()=>{n?.setViewPadding(t)},[n,t]),n}export{gr as C,ur as E,We as I,pr as L,yr as M,hr as N,Fe as O,Sr as P,Gt as S,dr as V,cr as W,fr as a,mr as b,_r as c,vr as d,ze as e,ps as u};
