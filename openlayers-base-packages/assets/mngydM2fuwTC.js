const __vite__fileDeps=["./7-g9C1bxAnkj.js","./Dch09mLNbtBx.js","./Bk9HVjNxo0ig.js","./BRUkeKPMUtGr.js","./CuZfWsxpZb-X.js","./CvQ9dl9pBk82.js","./CVL8Edkgx5nO.js","./fS1r4tdqlkjX.js","./D15aQat9QBuV.js","./BbxB2IgCGgnB.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Bs=Object.defineProperty;var Gs=(s,e,t)=>e in s?Bs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var kt=(s,e,t)=>(Gs(s,typeof e!="symbol"?e+"":e,t),t),nt=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var C=(s,e,t)=>(nt(s,e,"read from private field"),t?t.call(s):e.get(s)),A=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},I=(s,e,t,n)=>(nt(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t);var V=(s,e,t)=>(nt(s,e,"access private method"),t);import{b7 as Jt,b8 as $s,ao as Hs,an as _t,b9 as Us,ba as zs,B as Ws,bb as Ks,bc as Ys,bd as Zs,be as Xs,bf as qt,bg as Qt,bh as Js,bi as qs,ax as es,bj as Qs,bk as en,L as ae,bl as tn,bm as sn,Z as $,bn as nn,E as on,aX as rn,f as Mt,bo as an,bp as cn,bq as Pt,br as ln,bs as ot,V as un,bt as At,au as dn,az as hn,bu as fn,bv as gn,bw as pn,bx as mn,by as It,l as ht,N as ts,bz as ss,Y as te,bA as z,a1 as W,bB as vn,X as De,bC as bn,bD as yn,a0 as Pe,bE as Be,k as Tt,b as ns,a as os,Q as is,c as Se,C as rs,F as Ae,b0 as de,bF as wn,aT as as,bG as Sn,bH as xn,bI as Lt,bJ as En,bK as Ot}from"./CuZfWsxpZb-X.js";import{u as Cn,e as kn,r as u,f as _n,h as Qe,i as cs,o as ls,k as us,j as a,l as K,m as Mn,n as Pn,c as fe,E as q,R as An,A as it,p as rt,F as ds,B as et,C as In,t as Tn,q as hs,s as fs,I as Ln}from"./BRUkeKPMUtGr.js";import{T as ce,V as ft,L as gs}from"./D15aQat9QBuV.js";import{u as ee}from"./CvQ9dl9pBk82.js";import{S as On,c as Nn,a as jn,I as Rn,D as Fn}from"./DGlOxLr4WgZG.js";import{j as Vn,k as ps}from"./-WeDDRZc2yPK.js";import{S as Dn}from"./DhCpT-ZqQ-QE.js";import{_ as Bn}from"./Dch09mLNbtBx.js";import{u as ms,F as Ue}from"./fS1r4tdqlkjX.js";import{F as Ie}from"./DjsnGbxXyt9a.js";import{H as gt}from"./nYkQeMnj7Sj4.js";import{c as vs}from"./mX8ZIL3GNFDp.js";import{T as Gn}from"./BqHZNTy7UMMQ.js";import{G as $n,F as Hn}from"./CVL8Edkgx5nO.js";import{L as bs}from"./DnlPTSZ_81fG.js";import{c as se,S as pt}from"./Bk9HVjNxo0ig.js";function Un(s){const{theme:e}=Cn(),t=kn();return u.useMemo(()=>_n(e.direction,{...t,...s}),[s,e.direction,t])}var tt=Qe(function(e,t){const{htmlSize:n,...o}=e,i=cs("Input",o),r=ls(o),c=ms(r),l=us("chakra-input",e.className);return a.jsx(K.input,{size:n,...c,__css:i.field,ref:t,className:l})});tt.displayName="Input";tt.id="Input";var ys=K("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});ys.displayName="Center";var zn={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Qe(function(e,t){const{axis:n="both",...o}=e;return a.jsx(K.div,{ref:t,__css:zn[n],...o,position:"absolute"})});var ws=Qe(function(e,t){const{children:n,placeholder:o,className:i,...r}=e;return a.jsxs(K.select,{...r,ref:t,className:us("chakra-select",i),children:[o&&a.jsx("option",{value:"",children:o}),n]})});ws.displayName="SelectField";function Wn(s,e){const t={},n={};for(const[o,i]of Object.entries(s))e.includes(o)?t[o]=i:n[o]=i;return[t,n]}var bt=Qe((s,e)=>{var t;const n=cs("Select",s),{rootProps:o,placeholder:i,icon:r,color:c,height:l,h:f,minH:g,minHeight:w,iconColor:x,iconSize:S,...M}=ls(s),[P,R]=Wn(M,Pn),_=ms(R),O={width:"100%",height:"fit-content",position:"relative",color:c},j={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(t=n.field)==null?void 0:t._focus}};return a.jsxs(K.div,{className:"chakra-select__wrapper",__css:O,...P,...o,children:[a.jsx(ws,{ref:e,height:f??l,minH:g??w,placeholder:i,..._,__css:j,children:s.children}),a.jsx(Ss,{"data-disabled":Mn(_.disabled),...(x||c)&&{color:x||c},__css:n.icon,...S&&{fontSize:S},children:r})]})});bt.displayName="Select";var Kn=s=>a.jsx("svg",{viewBox:"0 0 24 24",...s,children:a.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Yn=K("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Ss=s=>{const{children:e=a.jsx(Kn,{}),...t}=s,n=u.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return a.jsx(Yn,{...t,className:"chakra-select__icon-wrapper",children:u.isValidElement(e)?n:null})};Ss.displayName="SelectIcon";const N={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Zn={ERROR:"error"};class Xn extends Ws{constructor(e){super(Zn.ERROR),this.code=e.code,this.message=e.message}}let Jn=class extends Jt{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=$s,this.watchId_=void 0,this.addChangeListener(N.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(N.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Hs(_t("EPSG:4326"),e),this.position_&&this.set(N.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(N.ACCURACY,t.accuracy),this.set(N.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(N.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(N.HEADING,t.heading===null?void 0:Us(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const n=this.transform_(this.position_);this.set(N.POSITION,n.slice()),this.set(N.SPEED,t.speed===null?void 0:t.speed);const o=zs(this.position_,t.accuracy);o.applyTransform(this.transform_),this.set(N.ACCURACY_GEOMETRY,o),this.changed()}positionError_(e){this.dispatchEvent(new Xn(e))}getAccuracy(){return this.get(N.ACCURACY)}getAccuracyGeometry(){return this.get(N.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(N.ALTITUDE)}getAltitudeAccuracy(){return this.get(N.ALTITUDE_ACCURACY)}getHeading(){return this.get(N.HEADING)}getPosition(){return this.get(N.POSITION)}getProjection(){return this.get(N.PROJECTION)}getSpeed(){return this.get(N.SPEED)}getTracking(){return this.get(N.TRACKING)}getTrackingOptions(){return this.get(N.TRACKING_OPTIONS)}setProjection(e){this.set(N.PROJECTION,_t(e))}setTracking(e){this.set(N.TRACKING,e)}setTrackingOptions(e){this.set(N.TRACKING_OPTIONS,e)}};const D={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class ze extends Jt{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Ks,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(D.ELEMENT,this.handleElementChanged),this.addChangeListener(D.MAP,this.handleMapChanged),this.addChangeListener(D.OFFSET,this.handleOffsetChanged),this.addChangeListener(D.POSITION,this.handlePositionChanged),this.addChangeListener(D.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(D.ELEMENT)}getId(){return this.id}getMap(){return this.get(D.MAP)||null}getOffset(){return this.get(D.OFFSET)}getPosition(){return this.get(D.POSITION)}getPositioning(){return this.get(D.POSITIONING)}handleElementChanged(){Ys(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Zs(this.element),Xs(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=qt(e,Qt.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(D.ELEMENT,e)}setMap(e){this.set(D.MAP,e)}setOffset(e){this.set(D.OFFSET,e)}setPosition(e){this.set(D.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(D.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),o=this.getElement(),i=this.getRect(o,[Js(o),qs(o)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!es(n,i)){const c=i[0]-n[0],l=n[2]-i[2],f=i[1]-n[1],g=n[3]-i[3],w=[0,0];if(c<0?w[0]=c-r:l<0&&(w[0]=Math.abs(l)+r),f<0?w[1]=f-r:g<0&&(w[1]=Math.abs(g)+r),w[0]!==0||w[1]!==0){const x=t.getView().getCenterInternal(),S=t.getPixelFromCoordinateInternal(x);if(!S)return;const M=[S[0]+w[0],S[1]+w[1]],P=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(M),duration:P.duration,easing:P.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),o=n.left+window.pageXOffset,i=n.top+window.pageYOffset;return[o,i,o+t[0],i+t[1]]}setPositioning(e){this.set(D.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),o=e.getSize();this.updateRenderedPosition(n,o)}updateRenderedPosition(e,t){const n=this.element.style,o=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const r=Math.round(e[0]+o[0])+"px",c=Math.round(e[1]+o[1])+"px";let l="0%",f="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?l="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(l="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?f="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(f="-50%");const g=`translate(${l}, ${f}) translate(${r}, ${c})`;this.rendered.transform_!=g&&(this.rendered.transform_=g,n.transform=g)}getOptions(){return this.options}}const Nr=Qs,qn=25.4/.28,Qn=39.37;function yt(s){return wt(s,eo,to)}function eo(s){return s.getView()}function to(s,e){return s.on("change:view",e)}function xs(s){return yt(s)?.getProjection()}function so(s){const e=yt(s);return wt(e,no,oo)}function no(s){return s.getResolution()}function oo(s,e){return s.on("change:resolution",e)}function io(s){const e=yt(s);return wt(e,ro,ao)}function ro(s){return s.getCenter()}function ao(s,e){return s.on("change:center",e)}function co(s){const e=io(s),t=so(s),n=xs(s);return u.useMemo(()=>{if(n==null||t==null||e==null)return;const i=en(n,t,e);return Math.round(i*Qn*qn)},[n,t,e])}function wt(s,e,t){const n=u.useCallback(()=>s?e(s):void 0,[s,e]),o=u.useCallback(i=>{if(!s)return()=>{};const r=t(s,i);return()=>ae(r)},[s,t]);return u.useSyncExternalStore(o,n)}const lo=1.2;function uo(s,e=lo){ho(s);const t=tn(s),n=sn(s),o=t*e,i=n*e;return[s[0]-(o-t)/2,s[1]-(i-n)/2,s[2]+(o-t)/2,s[3]+(i-n)/2]}function ho(s){if(s.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${s.length}).`)}const fo={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function jr(s){return a.jsxs($,{children:[a.jsx(ce,{children:s.layer.title}),a.jsx($,{style:fo})]})}const at=.75,Ge=.1;let go=class extends nn{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",o=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const i=e.label!==void 0?e.label:"›";typeof i=="string"?(this.label_=document.createElement("span"),this.label_.textContent=i):this.label_=i;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,c=document.createElement("button");c.setAttribute("type","button"),c.title=n,c.appendChild(r),c.addEventListener(on.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new rn({view:e.view,controls:new Mt,interactions:new Mt});this.ovmap_=l,e.layers&&e.layers.forEach(function(O){l.addLayer(O)});const f=document.createElement("div");f.className="ol-overviewmap-box",f.style.boxSizing="border-box",this.boxOverlay_=new ze({position:[0,0],positioning:"center-center",element:f}),this.ovmap_.addOverlay(this.boxOverlay_);const g=t+" "+an+" "+cn+(this.collapsed_&&this.collapsible_?" "+Pt:"")+(this.collapsible_?"":" ol-uncollapsible"),w=this.element;w.className=g,w.appendChild(this.ovmapDiv_),w.appendChild(c);const x=this,S=this.boxOverlay_,M=this.boxOverlay_.getElement(),P=function(O){return{clientX:O.clientX,clientY:O.clientY}},R=function(O){const j=P(O),B=l.getEventCoordinateInternal(j);S.setPosition(B)},_=function(O){const j=l.getEventCoordinateInternal(O);x.getMap().getView().setCenterInternal(j),window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",_)};M.addEventListener("mousedown",function(){window.addEventListener("mousemove",R),window.addEventListener("mouseup",_)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const n=t.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(qt(e,ln.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===ot.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===ot.TARGET||e.key===ot.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new un({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(At.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(At.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const n=e.getSize(),i=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&dn(i,this.viewExtent_))return;this.viewExtent_=i;const r=t.getSize(),l=t.getView().calculateExtentInternal(r),f=t.getPixelFromCoordinateInternal(hn(i)),g=t.getPixelFromCoordinateInternal(fn(i)),w=Math.abs(f[0]-g[0]),x=Math.abs(f[1]-g[1]),S=r[0],M=r[1];w<S*Ge||x<M*Ge||w>S*at||x>M*at?this.resetExtent_():es(l,i)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,n=e.getSize(),i=e.getView().calculateExtentInternal(n),r=t.getView(),c=Math.log(at/Ge)/Math.LN2,l=1/(Math.pow(2,c/2)*Ge);gn(i,l),r.fitInternal(pn(i))}recenter_(){const e=this.getMap(),t=this.ovmap_,n=e.getView();t.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const n=e.getSize(),o=e.getView(),i=t.getView(),r=this.rotateWithView_?0:-o.getRotation(),c=this.boxOverlay_,l=this.boxOverlay_.getElement(),f=o.getCenterInternal(),g=o.getResolution(),w=i.getResolution(),x=n[0]*g/w,S=n[1]*g/w;if(c.setPosition(f),l){l.style.width=x+"px",l.style.height=S+"px";const M="rotate("+r+"rad)";l.style.transform=M}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=mn(this.ovmap_,Qt.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Pt),this.collapsed_?It(this.collapseLabel_,this.label_):It(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};new ht([407354,5754673]),new ht([404740,5757893]);var le,oe,Te,Le,Oe,mt;class po extends ts{constructor(t,n,o){super();A(this,Oe);kt(this,"label");A(this,le,{kind:"available"});A(this,oe,void 0);A(this,Te,void 0);A(this,Le,void 0);this.label=n,I(this,oe,t),I(this,Le,o),V(this,Oe,mt).call(this),I(this,Te,C(this,oe).on("change:visible",()=>{V(this,Oe,mt).call(this)}))}destroy(){ae(C(this,Te))}get status(){return C(this,le)}async select(t,n){if(t.type!=="extent")throw new Error(`Unsupported selection kind: ${t.type}`);if(C(this,le).kind!=="available"||C(this,oe).getSource()===null)return[];const o=[];C(this,oe).getSource().forEachFeatureIntersectingExtent(t.extent,c=>{if(!c.getGeometry())return;const l={...c.getProperties()};delete l.geometries;const f={id:c.getId()?.toString()||ss(),geometry:c.getGeometry(),properties:l};o.push(f)});const i=o.filter(c=>c!=null);return i.length>n.maxResults?i.slice(0,n.maxResults):i}}le=new WeakMap,oe=new WeakMap,Te=new WeakMap,Le=new WeakMap,Oe=new WeakSet,mt=function(){const n=C(this,oe).getVisible()?{kind:"available"}:{kind:"unavailable",reason:C(this,Le)};n.kind!==C(this,le).kind&&(I(this,le,n),this.emit("changed:status"))};var Ne;class Fr{constructor({intl:e}){A(this,Ne,void 0);I(this,Ne,e)}createSelectionSource(e){return new po(e.vectorLayer,e.label,C(this,Ne).formatMessage({id:"layerNotVisibleReason"}))}}Ne=new WeakMap;const he=fe("local-storage"),mo=0,Q={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var me,Z,ie,ve,X,Ye,Es,Ze,Cs,ue,Me,re,pe,Xe,ks;class Vr{constructor(e){A(this,Ye);A(this,Ze);A(this,ue);A(this,re);A(this,Xe);A(this,me,void 0);A(this,Z,{});A(this,ie,void 0);A(this,ve,void 0);A(this,X,void 0);I(this,me,wo(e.properties)),I(this,ie,So()),C(this,ie)&&(V(this,Ze,Cs).call(this),I(this,ve,V(this,Xe,ks).call(this)))}destroy(){C(this,X)&&(clearTimeout(C(this,X)),I(this,X,void 0)),C(this,ie)&&V(this,ue,Me).call(this)}get isSupported(){return!!C(this,ve)}get(e){return V(this,re,pe).call(this).get(e)}set(e,t){return V(this,re,pe).call(this).set(e,t)}remove(e){return V(this,re,pe).call(this).remove(e)}removeAll(){return V(this,re,pe).call(this).removeAll()}getNamespace(e){return V(this,re,pe).call(this).getNamespace(e)}}me=new WeakMap,Z=new WeakMap,ie=new WeakMap,ve=new WeakMap,X=new WeakMap,Ye=new WeakSet,Es=function(){C(this,X)&&clearTimeout(C(this,X)),I(this,X,setTimeout(()=>{I(this,X,void 0),V(this,ue,Me).call(this)},mo))},Ze=new WeakSet,Cs=function(){try{const e=C(this,ie);if(!e)throw new q(Q.INTERNAL,"Local storage is not available.");const t=e.getItem(C(this,me));if(t==null){I(this,Z,{}),V(this,ue,Me).call(this);return}try{const n=JSON.parse(t);if(!xe(n))throw new q(Q.CORRUPTED_DATA,"Persisted value should be an object.");I(this,Z,n)}catch(n){he.warn("Invalid persisted data, reverting to default.",n),I(this,Z,{}),V(this,ue,Me).call(this)}}catch(e){he.error("Failed to load from local storage",e)}},ue=new WeakSet,Me=function(){try{const e=C(this,ie);if(!e)throw new q(Q.INTERNAL,"Local storage is not available.");const t=JSON.stringify(C(this,Z));e.setItem(C(this,me),t)}catch(e){he.error("Failed to save to local storage",e)}},re=new WeakSet,pe=function(){const e=C(this,ve);if(!e)throw new q(Q.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},Xe=new WeakSet,ks=function(){const e={getByPath:t=>jt(vo(C(this,Z),t)),setByPath:(t,n)=>{if(!yo(n))throw new q(Q.INVALID_VALUE,"The value is not supported by local storage.");if(n=jt(n),t.length===0){if(!xe(n))throw new q(Q.INVALID_VALUE,"The root value must be a plain object.");I(this,Z,n)}else bo(C(this,Z),t,n);V(this,Ye,Es).call(this)}};return new St([],e)};class St{path;access;constructor(e,t){this.path=e,this.access=t}get(e){return this.access.getByPath([...this.path,e])}set(e,t){this.access.setByPath([...this.path,e],t)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const t=this.get(e);if(t===void 0)this.set(e,{});else if(!xe(t))throw new q(Q.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new St(this.path.concat([e]),this.access)}}const Nt="trails-state";function vo(s,e){let t=s;for(const n of e){if(!xe(t))throw new q(Q.INVALID_PATH,`Cannot get nested property '${n}' because the parent is no object.`);t=t[n]}return t}function bo(s,e,t){if(!e.length)throw new q(Q.INTERNAL,"Path must not be empty.");let n=s;for(let i=0,r=e.length-1;i<r;++i){const c=e[i],l=n[c];if(!xe(l))throw new q(Q.INVALID_PATH,`Cannot set property on '${c}' because it is no object.`);n=l}const o=e[e.length-1];n[o]=t}function xe(s){return!!(s&&typeof s=="object"&&!Array.isArray(s))}function yo(s){const e=typeof s;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||s===null||Array.isArray(s)||xe(s)}function wo(s){const e=s.storageId;return!e||typeof e!="string"?(he.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${Nt}'.`),Nt):e}function So(){if(typeof Storage>"u"){he.warn("Local storage is not supported by this browser.");return}try{const s=globalThis.localStorage;if(!s){he.warn("Local storage is not supported by this browser.");return}return s}catch(s){he.warn("Local storage is not supported by this browser.",s);return}}function jt(s){return s!=null&&(s=JSON.parse(JSON.stringify(s))),s}const xo="@open-pioneer/coordinate-viewer",Eo=te.bind(void 0,xo),Co=4,Dr=s=>{const{mapId:e,precision:t,displayProjectionCode:n}=s,{containerProps:o}=z("coordinate-viewer",s),{map:i}=W(e),r=i?.olMap,c=xs(r)?.getCode()??"";let{coordinates:l}=_o(r);l=l&&n?Po(l,c,n):l;const f=ko(l,t),g=n||c,w=f?f+" "+g:"";return a.jsx($,{...o,children:a.jsx(ce,{className:"coordinate-viewer-text",children:w})})};function ko(s,e){const t=Eo();return s?Mo(s,e,t):""}function _o(s){const[e,t]=u.useState();return u.useEffect(()=>{if(!s)return;const n=s.on("pointermove",o=>{t(o.coordinate)});return()=>ae(n)},[s]),{coordinates:e}}function Mo(s,e,t){if(s[0]==null||s[1]==null)return"";const n=e??Co,[o,i]=s,r=t.formatNumber(o,{maximumFractionDigits:n,minimumFractionDigits:n}),c=t.formatNumber(i,{maximumFractionDigits:n,minimumFractionDigits:n});return r+" "+c}function Po(s,e,t){return vn(s,e,t)}const Ao="@open-pioneer/notifier",Io=De.bind(void 0,Ao);var _s=vs({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),To=vs({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const Lo=!1;function Br(s){const{position:e="top-right"}=s,t=Un(),n=Io("notifier.NotificationService"),[o,i]=u.useState(!Lo),r=ee(l=>{const f=l.level==="error"?a.jsx(_s,{h:"100%",w:"100%"}):void 0;t({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:f})}),c=ee(()=>{t.closeAll()});return u.useEffect(()=>{const l=n.registerHandler({showNotification:r,closeAll:c});return()=>l.destroy()},[o,n,r,c]),a.jsx(a.Fragment,{})}const Gr=s=>{const{mapId:e,displayMode:t="line"}=s,{containerProps:n}=z("scale-bar",s),{map:o}=W(e),i=u.useRef(null);return u.useEffect(()=>{if(i.current&&o){const r=o.olMap,c=new On({units:"metric",target:i.current,bar:t==="bar"});return r.addControl(c),()=>{r.removeControl(c)}}},[t,o]),a.jsx($,{...n,ref:i})},Oo="@open-pioneer/scale-viewer",No=te.bind(void 0,Oo),$r=s=>{const{mapId:e}=s,{containerProps:t}=z("scale-viewer",s),{map:n}=W(e),o=No(),i=co(n?.olMap),r=i?o.formatNumber(i):void 0;return a.jsx($,{...t,children:r&&a.jsxs(ce,{children:["1:",r]})})};var F={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let jo=0;function Ro(s,e){const t=`atom${++jo}`,n={toString:()=>t};return typeof s=="function"?n.read=s:(n.init=s,n.read=Fo,n.write=Vo),n}function Fo(s){return s(this)}function Vo(s,e,t){return e(this,typeof t=="function"?t(s(this)):t)}const ct=(s,e)=>s.unstable_is?s.unstable_is(e):e===s,lt=s=>"init"in s,ut=s=>!!s.write,We=new WeakMap,Do=(s,e)=>{We.set(s,e),s.catch(()=>{}).finally(()=>We.delete(s))},Rt=(s,e)=>{const t=We.get(s);t&&(We.delete(s),t(e))},Ft=(s,e)=>{s.status="fulfilled",s.value=e},Vt=(s,e)=>{s.status="rejected",s.reason=e},Bo=s=>typeof s?.then=="function",Ce=(s,e)=>!!s&&"v"in s&&"v"in e&&Object.is(s.v,e.v),Dt=(s,e)=>!!s&&"e"in s&&"e"in e&&Object.is(s.e,e.e),ge=s=>!!s&&"v"in s&&s.v instanceof Promise,Go=(s,e)=>"v"in s&&"v"in e&&s.v.orig&&s.v.orig===e.v.orig,$e=s=>{if("e"in s)throw s.e;return s.v},Ms=()=>{const s=new WeakMap,e=new WeakMap,t=[],n=new WeakMap;let o,i;(F?"production":void 0)!=="production"&&(o=new Set,i=new Set);const r=d=>s.get(d),c=(d,h)=>{h.d.forEach((y,m)=>{var b;if(!n.has(m)){const p=r(m);(b=t[t.length-1])==null||b.add(m),n.set(m,[p,new Set]),p&&c(m,p)}n.get(m)[1].add(d)})},l=(d,h)=>{var y;(F?"production":void 0)!=="production"&&Object.freeze(h);const m=r(d);if(s.set(d,h),n.has(d)||((y=t[t.length-1])==null||y.add(d),n.set(d,[m,new Set]),c(d,h)),ge(m)){const b="v"in h?h.v instanceof Promise?h.v:Promise.resolve(h.v):Promise.reject(h.e);m.v!==b&&Rt(m.v,b)}},f=(d,h,y,m)=>{const b=new Map(m?h.d:null);let p=!1;y.forEach((v,E)=>{!v&&ct(d,E)&&(v=h),v?(b.set(E,v),h.d.get(E)!==v&&(p=!0)):(F?"production":void 0)!=="production"&&console.warn("[Bug] atom state not found")}),(p||h.d.size!==b.size)&&(h.d=b)},g=(d,h,y,m)=>{const b=r(d),p={d:b?.d||new Map,v:h};if(y&&f(d,p,y,m),Ce(b,p)&&b.d===p.d)return b;if(ge(b)&&ge(p)&&Go(b,p)){if(b.d===p.d)return b;p.v=b.v}return l(d,p),p},w=(d,h,y,m)=>{if(Bo(h)){let b;const p=()=>{const E=r(d);if(!ge(E)||E.v!==v)return;const T=g(d,v,y);e.has(d)&&E.d!==T.d&&H(d,T,E.d)},v=new Promise((E,T)=>{let k=!1;h.then(L=>{k||(k=!0,Ft(v,L),E(L),p())},L=>{k||(k=!0,Vt(v,L),T(L),p())}),b=L=>{k||(k=!0,L.then(Y=>Ft(v,Y),Y=>Vt(v,Y)),E(L))}});return v.orig=h,v.status="pending",Do(v,E=>{E&&b(E),m?.()}),g(d,v,y,!0)}return g(d,h,y)},x=(d,h,y)=>{const m=r(d),b={d:m?.d||new Map,e:h};return y&&f(d,b,y),Dt(m,b)&&m.d===b.d?m:(l(d,b),b)},S=(d,h)=>{const y=r(d);if(!h&&y&&(e.has(d)||Array.from(y.d).every(([k,L])=>{if(k===d)return!0;const Y=S(k);return Y===L||Ce(Y,L)})))return y;const m=new Map;let b=!0;const p=k=>{if(ct(d,k)){const Y=r(k);if(Y)return m.set(k,Y),$e(Y);if(lt(k))return m.set(k,void 0),k.init;throw new Error("no atom init")}const L=S(k);return m.set(k,L),$e(L)};let v,E;const T={get signal(){return v||(v=new AbortController),v.signal},get setSelf(){return(F?"production":void 0)!=="production"&&!ut(d)&&console.warn("setSelf function cannot be used with read-only atom"),!E&&ut(d)&&(E=(...k)=>{if((F?"production":void 0)!=="production"&&b&&console.warn("setSelf function cannot be called in sync"),!b)return _(d,...k)}),E}};try{const k=d.read(p,T);return w(d,k,m,()=>v?.abort())}catch(k){return x(d,k,m)}finally{b=!1}},M=d=>$e(S(d)),P=d=>{const h=v=>{var E,T;const k=new Set((E=e.get(v))==null?void 0:E.t);return(T=n.get(v))==null||T[1].forEach(L=>{k.add(L)}),k},y=new Array,m=new Set,b=v=>{if(!m.has(v)){m.add(v);for(const E of h(v))v!==E&&b(E);y.push(v)}};b(d);const p=new Set([d]);for(let v=y.length-1;v>=0;--v){const E=y[v],T=r(E);if(!T)continue;let k=!1;for(const L of T.d.keys())if(L!==E&&p.has(L)){k=!0;break}if(k){const L=S(E,!0);Ce(T,L)||p.add(E)}}},R=(d,...h)=>{const y=p=>$e(S(p)),m=(p,...v)=>{const E=t.length>0;E||t.push(new Set([p]));let T;if(ct(d,p)){if(!lt(p))throw new Error("atom not writable");const k=r(p),L=w(p,v[0]);Ce(k,L)||P(p)}else T=R(p,...v);if(!E){const k=G(t.pop());(F?"production":void 0)!=="production"&&o.forEach(L=>L({type:"async-write",flushed:k}))}return T};return d.write(y,m,...h)},_=(d,...h)=>{t.push(new Set([d]));const y=R(d,...h),m=G(t.pop());return(F?"production":void 0)!=="production"&&o.forEach(b=>b({type:"write",flushed:m})),y},O=(d,h,y)=>{var m;const b=e.get(d);if(b)return h&&b.t.add(h),b;const p=y||[];(m=r(d))==null||m.d.forEach((E,T)=>{T!==d&&O(T,d,p)}),S(d);const v={t:new Set(h&&[h]),l:new Set};if(e.set(d,v),(F?"production":void 0)!=="production"&&i.add(d),ut(d)&&d.onMount){const{onMount:E}=d;p.push(()=>{const T=E((...k)=>_(d,...k));T&&(v.u=T)})}return y||p.forEach(E=>E()),v},j=(d,h)=>!h.l.size&&(!h.t.size||h.t.size===1&&h.t.has(d)),B=(d,h)=>{if(!j(d,h))return;const y=h.u;y&&y(),e.delete(d),(F?"production":void 0)!=="production"&&i.delete(d);const m=r(d);m?(ge(m)&&Rt(m.v),m.d.forEach((b,p)=>{if(p!==d){const v=e.get(p);v&&(v.t.delete(d),B(p,v))}})):(F?"production":void 0)!=="production"&&console.warn("[Bug] could not find atom state to unmount",d)},H=(d,h,y)=>{const m=new Set(h.d.keys()),b=new Set;y?.forEach((p,v)=>{if(m.has(v)){m.delete(v);return}b.add(v);const E=e.get(v);E&&E.t.delete(d)}),m.forEach(p=>{O(p,d)}),b.forEach(p=>{const v=e.get(p);v&&B(p,v)})},G=d=>{let h;(F?"production":void 0)!=="production"&&(h=new Set);const y=[],m=b=>{var p;if(!n.has(b))return;const[v,E]=n.get(b);n.delete(b),y.push([b,v]),E.forEach(m),(p=r(b))==null||p.d.forEach((T,k)=>m(k))};if(d.forEach(m),y.forEach(([b,p])=>{const v=r(b);if(!v){(F?"production":void 0)!=="production"&&console.warn("[Bug] no atom state to flush");return}if(v!==p){const E=e.get(b);E&&v.d!==p?.d&&H(b,v,p?.d),E&&!(!ge(p)&&(Ce(p,v)||Dt(p,v)))&&(E.l.forEach(T=>T()),(F?"production":void 0)!=="production"&&h.add(b))}}),(F?"production":void 0)!=="production")return h},U=(d,h)=>{const y=O(d),m=G([d]),b=y.l;return b.add(h),(F?"production":void 0)!=="production"&&o.forEach(p=>p({type:"sub",flushed:m})),()=>{b.delete(h),B(d,y),(F?"production":void 0)!=="production"&&o.forEach(p=>p({type:"unsub"}))}};return(F?"production":void 0)!=="production"?{get:M,set:_,sub:U,dev_subscribe_store:d=>(o.add(d),()=>{o.delete(d)}),dev_get_mounted_atoms:()=>i.values(),dev_get_atom_state:d=>s.get(d),dev_get_mounted:d=>e.get(d),dev_restore_atoms:d=>{t.push(new Set);for(const[y,m]of d)lt(y)&&(w(y,m),P(y));const h=G(t.pop());o.forEach(y=>y({type:"restore",flushed:h}))}}:{get:M,set:_,sub:U}};let ke;const $o=()=>(ke||(ke=Ms(),(F?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=ke),globalThis.__JOTAI_DEFAULT_STORE__!==ke&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),ke),Ps=Ms,Ho=$o,As=u.createContext(void 0),Uo=s=>u.useContext(As)||Ho(),zo=({children:s,store:e})=>{const t=u.useRef();return!e&&!t.current&&(t.current=Ps()),u.createElement(As.Provider,{value:e||t.current},s)},Wo=s=>typeof s?.then=="function",Ko=An.use||(s=>{if(s.status==="pending")throw s;if(s.status==="fulfilled")return s.value;throw s.status==="rejected"?s.reason:(s.status="pending",s.then(e=>{s.status="fulfilled",s.value=e},e=>{s.status="rejected",s.reason=e}),s)});function Yo(s,e){const t=Uo(),[[n,o,i],r]=u.useReducer(f=>{const g=t.get(s);return Object.is(f[0],g)&&f[1]===t&&f[2]===s?f:[g,t,s]},void 0,()=>[t.get(s),t,s]);let c=n;return(o!==t||i!==s)&&(r(),c=t.get(s)),u.useEffect(()=>{const f=t.sub(s,()=>{r()});return r(),f},[t,s,void 0]),u.useDebugValue(c),Wo(c)?Ko(c):c}const Is="@open-pioneer/spatial-bookmarks",Zo=De.bind(void 0,Is),Xo=te.bind(void 0,Is),ne=fe("spatial-bookmark:SpatialBookmarkViewModel");class Jo{map;packageNamespace;writableBookmarks=Ro([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,t){this.map=e,this.packageNamespace=t.getNamespace("spatial-bookmarks"),this.store=Ps(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const t=this.map.olMap,n=t.getView().calculateExtent(),o=t.getView().getProjection().getCode(),i={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},r={id:ss(),title:e,extent:i,projection:o};ne.debug("Created a new bookmark",r);const c=this.writableBookmarks;this.store.set(c,[...this.store.get(c),r])}activateBookmark(e){ne.debug("Activating bookmark",e);const t=this.getBookmarkExtent(e);ne.debug("Attempting to apply extent",t),this.applyExtent(t)}deleteBookmark(e){ne.debug("Deleting bookmark",e);const t=this.writableBookmarks;this.store.set(t,[...this.store.get(t).filter(n=>n.id!==e)])}deleteAllBookmarks(){ne.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){ne.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{qo(e),this.store.set(this.writableBookmarks,e)}catch(t){ne.error("Bookmarks data in local storage is invalid, resetting to default value.",t),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){ne.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const n=this.map.olMap.getView(),o=e.extent,i=[o.minX,o.minY,o.maxX,o.maxY],r=n.getProjection(),c=e.projection;return bn(i,c,r)}applyExtent(e){const n=this.map.olMap.getView(),o=yn(e),i=n.getResolutionForExtent(e);n.setCenter(o),n.setResolution(i)}}function qo(s){if(!Array.isArray(s))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of s)Qo(e)}function Qo(s){if(!s||typeof s!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=s;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(ei(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function ei(s){if(!s||typeof s!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=s;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const Hr=s=>{const{map:e}=W(s.mapId),t=Zo("local-storage.LocalStorageService"),n=ai(e,t);return n&&a.jsx(zo,{store:n.store,children:a.jsx(ti,{...s,viewModel:n})})};function ti(s){const{viewModel:e}=s,t=Xo(),n=u.useRef([]),[o,i]=u.useState(!1),r=Yo(e.bookmarks),[c,l]=u.useState(""),f=c.trim().length>0,{containerProps:g}=z("spatial-bookmarks",s),[w,x]=u.useState("list"),S=()=>{e.deleteAllBookmarks(),x("list")},M=()=>{f&&(e.createBookmark(c),x("list"),l(""),i(!0))};u.useEffect(()=>{if(o){const j=n.current;j&&j[r.length-1]?.scrollIntoView?.(),i(!1)}},[r,o]);const P=()=>a.jsxs(ft,{children:[a.jsxs(it,{rounded:"md",status:"warning",children:[a.jsx(rt,{}),t.formatMessage({id:"bookmark.alert.delete"})]}),a.jsx(ii,{intl:t,onClear:S,onCancel:()=>x("list")})]}),R=()=>a.jsxs(ft,{children:[a.jsxs(it,{rounded:"md",status:"info",children:[a.jsx(rt,{}),t.formatMessage({id:"bookmark.alert.create"})]}),a.jsx(tt,{"aria-label":t.formatMessage({id:"bookmark.input.label"}),placeholder:t.formatMessage({id:"bookmark.input.placeholder"}),value:c,onChange:j=>{l(j.target.value)},onKeyDown:j=>{j.key==="Enter"&&M()},isRequired:!0,isInvalid:!f,autoFocus:!0}),a.jsx(ri,{intl:t,isInvalid:!f,onCancel:()=>{l(""),x("list")},onSave:M})]}),_=()=>a.jsxs(a.Fragment,{children:[r.length?si(r,e,t,n):a.jsxs(it,{rounded:"md",status:"info",children:[a.jsx(rt,{}),t.formatMessage({id:"bookmark.alert.noSaved"})]}),a.jsx(oi,{intl:t,bookmarks:r,showCreate:()=>x("create"),showDelete:()=>x("delete")})]}),O=a.jsxs(a.Fragment,{children:[w==="list"&&_(),w==="create"&&R(),w==="delete"&&P()]});return a.jsx(Pe,{flexDirection:"column",...g,children:O})}function si(s,e,t,n){const o=t.formatMessage({id:"bookmark.button.deleteOne"}),i=s.map((r,c)=>a.jsx(ni,{index:c,listItemNodes:n,bookmark:r,onActivate:()=>e.activateBookmark(r),onDelete:()=>e.deleteBookmark(r.id),deleteBtnLabel:o},r.id));return a.jsx(gs,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":t.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:i})}const Bt={ArrowDown:1,ArrowUp:-1};function ni(s){const{index:e,listItemNodes:t,bookmark:n,onDelete:o,onActivate:i,deleteBtnLabel:r}=s,c=n.title,l=f=>{const g=f.key;if(g==="Enter"){f.target===f.currentTarget&&i();return}if(Bt[g]!=null){const w=t.current?.length;if(!w)return;let x=(e+Bt[g])%w;x<0&&(x=w-1),t.current[x]?.focus()}};return a.jsx($,{as:"li",p:1,ref:f=>{if(!f){t.current.splice(e,1);return}t.current[e]=f},className:Be("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:l,onClick:i,children:a.jsxs(Pe,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[a.jsx(ys,{children:a.jsx(Vn,{})}),a.jsx(ce,{ps:2,noOfLines:1,children:c}),a.jsx(Dn,{}),a.jsx(ds,{hasArrow:!0,label:r,placement:"right",children:a.jsx(et,{className:"spatial-bookmarks-item-delete","aria-label":r,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:a.jsx(ps,{}),onClick:f=>{o(),f.stopPropagation()}})},e)]})})}function oi(s){const{intl:e,bookmarks:t,showCreate:n,showDelete:o}=s;return a.jsxs(xt,{children:[a.jsx(Ee,{isDisabled:t.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:a.jsx(ps,{}),onClick:o,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),a.jsx(Ee,{onClick:n,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function ii(s){const{intl:e,onCancel:t,onClear:n}=s;return a.jsxs(xt,{children:[a.jsx(Ee,{variant:"outline",onClick:t,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),a.jsx(Ee,{onClick:n,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function ri(s){const{intl:e,onCancel:t,onSave:n,isInvalid:o}=s;return a.jsxs(xt,{children:[a.jsx(Ee,{variant:"outline",onClick:()=>t(),children:e.formatMessage({id:"bookmark.button.cancel"})}),a.jsx(Ee,{isDisabled:o,onClick:()=>n(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function xt(s){return a.jsx(Pe,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:s.children})}function Ee(s){return a.jsx(et,{width:"100%",...s})}function ai(s,e){const[t,n]=u.useState();return u.useEffect(()=>{let o;return s?o=new Jo(s,e):o=void 0,n(o),()=>o?.destroy()},[s,e]),t}const Ts="@open-pioneer/printing",Gt=De.bind(void 0,Ts),ci=te.bind(void 0,Ts),li="map";class ui{olMap;title="";fileFormat="pdf";i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,n){this.olMap=e,this.printingService=t,this.i18n=n}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}setViewPadding(e){this.viewPadding=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Nn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",t=this.title||li;return{title:e,fileName:t}}async exportMapInPNG(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height+50,t.style.backgroundColor="#fff";const n=t.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:o,fileName:i}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,t.width,t.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const r=t.width/2;n.fillText(o,r,20),n.drawImage(e,0,50);const c=document.createElement("a");c.setAttribute("download",i+".png");const l=jn(t);if(!l)throw new Error("Failed to get image data URL");c.href=l,c.click()}async exportMapInPDF(e){const{jsPDF:t}=await Bn(()=>import("./7-g9C1bxAnkj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),n=new t({orientation:"landscape",unit:"mm",format:"a4"}),o=n.internal.pageSize.getWidth(),i=n.internal.pageSize.getHeight(),r=15,c=20,l=i-c;n.setFontSize(20);const{title:f,fileName:g}=this.getTitleAndFileName();n.text(f,o/2,r,{align:"center"});const w=e.width/e.height;let x=l,S=x*w;S>=o&&(S=o,x=S/w);const M=(o-S)/2,P=c+(l-x)/2;n.addImage(e,"",M,P,S,x),n.save(g+".pdf")}}const di=fe("printing"),Ur=s=>{const e=ci(),{mapId:t,viewPadding:n="auto"}=s,{containerProps:o}=z("printing",s),[i,r]=u.useState("pdf"),[c,l]=u.useState(""),[f,g]=u.useState(!1),w=Gt("printing.PrintingService"),x=Gt("notifier.NotificationService"),{map:S}=W(t),M=hi(S,e,w,n);u.useEffect(()=>{M?.setFileFormat(i)},[M,i]),u.useEffect(()=>{M?.setTitle(c)},[M,c]);function P(_){(_==="png"||_==="pdf")&&r(_)}function R(){f||!M||(g(!0),M.handleMapExport().catch(_=>{const O=e.formatMessage({id:"printingFailed"});x.notify({level:"error",message:O}),di.error("Failed to print the map",_)}).finally(()=>{g(!1)}))}return a.jsxs($,{...o,children:[a.jsxs(Ue,{mb:4,alignItems:"center",children:[a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),a.jsx(tt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:c,onChange:_=>{l(_.target.value)},autoFocus:!0})]}),a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),a.jsxs(bt,{value:i,onChange:_=>P(_.target.value),className:"printing-select",children:[a.jsx("option",{value:"png",children:"PNG"}),a.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),a.jsx(et,{isLoading:f,loadingText:e.formatMessage({id:"printingMap"}),disabled:f,padding:2,className:"printing-export-button",onClick:R,width:"100%",children:e.formatMessage({id:"export"})})]})};function hi(s,e,t,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!s)return;const r=new ui(s.olMap,t,{overlayText:e.formatMessage({id:"printingMap"})});return i(r),()=>{r.destroy(),i(void 0)}},[s,e,t]),u.useEffect(()=>{o?.setViewPadding(n)},[o,n]),o}const fi="@open-pioneer/legend",Ls=te.bind(void 0,fi),zr=s=>{const{mapId:e,showBaseLayers:t=!1}=s,{containerProps:n}=z("legend",s),{map:o}=W(e);return a.jsx($,{...n,children:o?a.jsx(gi,{map:o,showBaseLayers:t}):null})};function gi(s){const{map:e,showBaseLayers:t}=s,o=vi(e).map(i=>a.jsx(Os,{layer:i,showBaseLayers:t},i.id));return a.jsx(gs,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:o})}function Os(s){const{layer:e,showBaseLayers:t}=s,{isVisible:n}=yi(e),o=bi(e);if(!n||!t&&!("parentLayer"in e)&&e.isBaseLayer)return;const i=[];return o?.length&&o.forEach(r=>{i.push(a.jsx(Os,{layer:r,showBaseLayers:t},r.id))}),a.jsxs(a.Fragment,{children:[a.jsx(pi,{layer:e,showBaseLayers:t}),i]})}function pi(s){const e=Ls(),{layer:t,showBaseLayers:n}=s,o=wi(t),i=mi(t);let r;o?.Component?r=a.jsx(o.Component,{layer:t}):o?.imageUrl?r=a.jsx($t,{layer:t,imageUrl:o.imageUrl}):i&&(r=a.jsx($t,{layer:t,imageUrl:i}));const c=!("parentLayer"in t)&&t.isBaseLayer;return r?a.jsxs($,{as:"li",className:Be("legend-item",`layer-${Si(t.id)}`),children:[n&&c?a.jsx(ce,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,r]}):void 0}function $t(s){const e=Ls(),{layer:t,imageUrl:n}=s;return a.jsxs($,{children:[a.jsx(ce,{children:t.title}),a.jsx(Rn,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:a.jsx($,{children:a.jsxs(ce,{children:[a.jsx(_s,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function mi(s){const e=u.useCallback(()=>s.legend,[s]),t=u.useCallback(n=>{const o=s.on("changed:legend",n);return()=>o.destroy()},[s]);return u.useSyncExternalStore(t,e)}function vi(s){const e=u.useCallback(n=>{const o=s.layers.on("changed",n);return()=>o.destroy()},[s]),t=u.useCallback(()=>{let n=s.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[s]);return Ns(e,t)}function bi(s){const e=u.useCallback(n=>{const o=s.sublayers?.on("changed",n);return()=>o?.destroy()},[s]),t=u.useCallback(()=>{if(!s.sublayers)return;let o=s.sublayers?.getSublayers({sortByDisplayOrder:!0});return o=o.reverse(),o},[s]);return Ns(e,t)}function Ns(s,e){const t=u.useRef(),n=u.useCallback(i=>{const r=s(()=>{t.current=void 0,i()});return()=>{t.current=void 0,r()}},[s]),o=u.useCallback(()=>{if(t.current)return t.current.value;const i=e();return t.current={value:i},i},[e]);return u.useSyncExternalStore(n,o)}function yi(s){const e=u.useCallback(()=>s.visible,[s]),t=u.useCallback(o=>{const i=s.on("changed:visible",o);return()=>i.destroy()},[s]);return{isVisible:u.useSyncExternalStore(t,e)}}function wi(s){const[e,t]=u.useState(void 0);return u.useEffect(()=>{t(s.attributes.legend);const n=s.on("changed:attributes",()=>{t(s.attributes.legend)});return()=>n.destroy()},[s]),e}function Si(s){return s.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const js="@open-pioneer/geolocation",xi=De.bind(void 0,js),Ei=te.bind(void 0,js);function Ci(s){return $n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(s)}const Ht=fe("geolocation:GeolocationController"),Ut=17;class ki extends ts{olMap;positionHighlightLayer;geolocation;maxZoom=Ut;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,t){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Tt,this.accuracyFeature.setStyle(Wt()),this.positionFeature=new Tt,this.positionFeature.setStyle(zt()),this.positionHighlightLayer=new ns({source:new os({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(is);const n=t||_i();this.geolocation=new Jn({tracking:!1,trackingOptions:n,projection:e.getView()?.getProjection()}),this.trackingOptions=n,this.geolocation.on("error",o=>this.handleGeolocationError(o))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(n=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const o=this.geolocation.on("change:accuracyGeometry",()=>{const l=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(l),this.accuracyFeature?.getGeometry()!==void 0&&n(),this.isInitialZoom){const f=this?.accuracyFeature?.getGeometry()?.getExtent();if(f){const g=uo(f);if(!g)return;e.getView().fit(g,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),i=this.geolocation.on("change:position",()=>{const l=this.geolocation.getPosition();l&&(l[0]||l[1])!==void 0&&(this.positionFeature?.setGeometry(new ht(l)),this.setMapToPosition&&e.getView().setCenter(l),this.positionFeature?.getGeometry()!==void 0&&n())}),r=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),c=e.on("pointermove",l=>{l.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(o,i,r,c),e.addLayer(this.positionHighlightLayer)}).catch(n=>{Ht.error("Failed to determine location",n)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{ae(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??zt())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??Wt())}setMaxZoom(e){this.maxZoom=e??Ut}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){Ht.error("Error from geolocation API:",e.message);const t=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",t)}}const zt=()=>new Se({image:new rs({radius:6,fill:new Ae({color:"#3399CC"}),stroke:new de({color:"#fff",width:2})})}),Wt=()=>new Se({stroke:new de({color:"#3399CC",width:3}),fill:new Ae({color:"rgba(0, 0, 255, 0.05)"})}),_i=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),Wr=u.forwardRef(function(e,t){const{mapId:n,maxZoom:o,positionFeatureStyle:i,accuracyFeatureStyle:r,trackingOptions:c}=e,{containerProps:l}=z("geolocation",e),f=!!navigator.geolocation,[g,w]=u.useState(!1),[x,S]=u.useState(!1),{map:M}=W(n),P=Ei(),R=xi("notifier.NotificationService"),_=Mi(M,o,c,i,r),O=f?g?P.formatMessage({id:"locateMeEnd"}):P.formatMessage({id:"locateMeStart"}):P.formatMessage({id:"locateNotSupported"});u.useEffect(()=>{if(_===void 0)return;const B=_.on("error",function(H){const G=P.formatMessage({id:"error"}),U=(()=>{switch(H){case"permission-denied":return P.formatMessage({id:"permissionDenied"});case"position-unavailable":return P.formatMessage({id:"positionUnavailable"});case"timeout":return P.formatMessage({id:"timeout"});case"unknown":return P.formatMessage({id:"unknownError"})}})();S(!1),w(!1),R.notify({level:"error",title:G,message:U})});return()=>{B.destroy()}},[_,P,R]),u.useEffect(()=>{if(!_){S(!1);return}return g&&(S(!0),_.startGeolocation().then(()=>{S(!1)})),()=>{_?.stopGeolocation(),S(!1)}},[_,g]);const j=()=>{M&&w(!g)};return a.jsx(Gn,{ref:t,label:O,icon:a.jsx(Ci,{}),onClick:()=>j(),isActive:g,isLoading:x,isDisabled:!f,...l})});function Mi(s,e,t,n,o){const[i,r]=u.useState();return u.useEffect(()=>{if(!s)return;const c=new ki(s.olMap,t);return r(c),()=>{c.destroy(),r(void 0)}},[s,t]),u.useEffect(()=>{i?.setPositionFeatureStyle(n)},[i,n]),u.useEffect(()=>{i?.setAccuracyFeatureStyle(o)},[i,o]),u.useEffect(()=>{i?.setMaxZoom(e)},[i,e]),i}const Pi="@open-pioneer/measurement",Ai=te.bind(void 0,Pi);class Ii{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,t){this.olMap=e,this.messages=t;const n=this.source=new os;this.layer=new ns({source:n}),this.layer.setZIndex(is),e.addLayer(this.layer);const o=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){ae(o)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const t=wn(e);this.activeFeatureStyle=(n,...o)=>{const i=n?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return t(n,...o)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",n=this.draw=new Fn({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let o,i;n.on("drawstart",r=>{o=this.measureTooltip=this.createMeasureTooltip();const c=this.sketch=r.feature;if(!c)return;let l;i=c.getGeometry()?.on("change",f=>{const g=f.target,w=this.olMap.getView().getProjection();let x="";g instanceof as?(x=Li(g,w,this.messages),l=g.getInteriorPoint().getCoordinates()||null):g instanceof bs&&(x=Oi(g,w,this.messages),l=g.getLastCoordinate()||null),o&&(o.element.innerHTML=x,l&&o?.overlay.setPosition(l))})}),n.on("drawend",()=>{if(o){const r=o.element.classList;r.remove("measurement-active-tooltip"),r.remove("printing-hide"),r.add("measurement-finished-tooltip"),o.overlay.setOffset([0,-7]),this.overlayTooltips.push(o),this.measureTooltip=o=void 0}this.sketch=void 0,i&&ae(i)}),n.on("drawabort",()=>{o&&(o.destroy(),this.measureTooltip=o=void 0),this.sketch=void 0,i&&ae(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=new ze({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n=this.olMap;return n.addOverlay(t),{overlay:t,element:e,destroy(){n.removeOverlay(t)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const t=new ze({element:e,offset:[15,0],positioning:"center-left"}),n=this.olMap;return n.addOverlay(t),{overlay:t,element:e,destroy(){n.removeOverlay(t)}}}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,n=Ti(this.messages,this.sketch);t.element.textContent=n,t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}}function Ti(s,e){if(e){const t=e.getGeometry();if(t instanceof as||t instanceof bs)return s.getContinueMessage()}return s.getHelpMessage()}function Li(s,e,t){const n=Sn(s,{projection:e});let o;return n>=1e6?o=`${t.formatNumber(n/1e6)} km<sup>2</sup>`:o=`${t.formatNumber(n)} m<sup>2</sup>`,o}function Oi(s,e,t){const n=xn(s,{projection:e});let o;return n>=1e3?o=`${t.formatNumber(n/1e3)} km`:o=`${t.formatNumber(n)} m`,o}const Kr=s=>{const e=Ai(),{mapId:t,activeFeatureStyle:n,finishedFeatureStyle:o}=s,{containerProps:i}=z("measurement",s),[r,c]=u.useState("distance"),l=S=>e.formatMessage({id:S}),f=W(t),g=Ni(f.map,e);u.useEffect(()=>{g?.setActiveFeatureStyle(n??ji())},[g,n]),u.useEffect(()=>{g?.setFinishedFeatureStyle(o??Ri())},[g,o]),u.useEffect(()=>{if(g)return g.startMeasurement(r),()=>{g.stopMeasurement()}},[g,r]);function w(S){if(S==="distance"||S==="area")c(S);else throw new Error(`Unexpected measurement type: '${S}'.`)}function x(){g?.clearMeasurements()}return a.jsxs($,{...i,children:[a.jsx(ce,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),a.jsx(Ue,{mb:4,alignItems:"center",children:a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{mb:1,children:l("measurementLabel")}),a.jsxs(bt,{value:r,onChange:S=>w(S.target.value),className:"measurement-select",children:[a.jsx("option",{value:"distance",children:l("distance")}),a.jsx("option",{value:"area",children:l("area")})]})]})}),a.jsx(et,{padding:2,className:"measurement-delete-button",onClick:x,width:"100%",children:l("deleteMeasurementLabel")})]})};function Ni(s,e){const[t,n]=u.useState(void 0);return u.useEffect(()=>{if(!s)return;const o=new Ii(s.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(i){return e.formatNumber(i,{maximumFractionDigits:2})}});return n(o),()=>{o.destroy(),n(void 0)}},[s,e]),t}function ji(){return[new Se({stroke:new de({color:"#fff",lineDash:[10,10],width:5})}),new Se({fill:new Ae({color:"rgba(0,0,0,0.15)"}),stroke:new de({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new rs({radius:5,stroke:new de({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new Ae({color:"rgba(255, 255, 255, 0.2)"})})})]}function Ri(){return[new Se({stroke:new de({color:"#fff",width:5})}),new Se({stroke:new de({color:"#0b96fc",width:3}),fill:new Ae({color:"rgba(11,150,252,0.15)"})})]}const Fi="200px",Vi="300px",Yr=s=>{const{mapId:e,olLayer:t,height:n=Fi,width:o=Vi}=s,{containerProps:i}=z("overview-map",s),r=u.useRef(null),{map:c}=W(e);return u.useEffect(()=>{if(r.current&&c&&t){const l=c.olMap,f=new go({className:"ol-overviewmap",layers:[t],collapsible:!1,collapsed:!1,target:r.current});return l.addControl(f),()=>{l.removeControl(f)}}},[c,t]),a.jsx($,{height:n,width:o,ref:r,...i})},Di="@open-pioneer/search",st=te.bind(void 0,Di);function Bi(s){const e=s.selectProps.inputValue.length>0,t={...s,className:Be(s.className,{"search-invisible":!e})};return a.jsx(se.Menu,{...t,children:s.children})}function Gi(s){const t=st().formatMessage({id:"noOptionsText"});return a.jsx(se.NoOptionsMessage,{...s,children:a.jsx(K.span,{className:"search-no-match",children:t})})}function $i(s){const t=st().formatMessage({id:"loadingText"});return a.jsx(se.LoadingMessage,{...s,children:a.jsx(K.span,{className:"search-loading-text",children:t})})}function Hi({children:s,...e}){const t={...e,className:Be(e.className,"search-value-container")};return a.jsxs(se.ValueContainer,{...t,children:[!!s&&a.jsx(To,{style:{position:"absolute",left:8}}),s]})}function Ui(s){const e={...s,isHidden:!1};return a.jsx(se.Input,{...e})}function zi(s){return null}function Wi(s){return a.jsxs(se.IndicatorsContainer,{...s,children:[s.children,!s.selectProps.isLoading&&s.selectProps.inputValue&&a.jsx(Ki,{selectProps:s.selectProps,clearValue:s.clearValue})]})}function Ki(s){const t=st().formatMessage({id:"ariaLabel.clearButton"}),n=o=>{o.preventDefault(),o.stopPropagation(),s.clearValue()};return a.jsx(In,{role:"button",size:"md",mr:1,"aria-label":t,onClick:n,onTouchEnd:n,onMouseDown:o=>o.preventDefault()})}function Yi(s){return null}function Zi(s){const e=s.selectProps.inputValue,t=s.data.label,n={...s,className:Be(s.className,"search-option")};return a.jsx(se.Option,{...n,children:a.jsx(K.div,{className:"search-option-label",children:e.trim().length>0?Xi(t,e):t})})}function Xi(s,e){const t=s.toLowerCase().indexOf(e.toLowerCase());return t>=0?a.jsxs(a.Fragment,{children:[s.substring(0,t),a.jsx(K.span,{className:"search-highlighted-match",children:s.substring(t,t+e.length)},"highlighted"),s.substring(t+e.length)]}):s}const Kt=fe("search:SearchController"),Yt=200,Zt=5;var je,be,ye,we,J,Je,Rs;class Ji{constructor(e,t){A(this,Je);A(this,je,void 0);A(this,be,[]);A(this,ye,Zt);A(this,we,Yt);A(this,J,void 0);I(this,je,e),I(this,be,t)}destroy(){C(this,J)?.abort(),I(this,J,void 0)}async search(e){if(C(this,J)?.abort(),I(this,J,void 0),!e)return[];const t=I(this,J,new AbortController);try{return await qi(t.signal,C(this,we)),t.signal.aborted&&(Kt.debug(`search canceled with ${e}`),Tn()),(await Promise.all(C(this,be).map(o=>V(this,Je,Rs).call(this,o,e,t.signal)))).filter(o=>o!=null)}finally{C(this,J)===t&&I(this,J,void 0)}}get searchTypingDelay(){return C(this,we)}set searchTypingDelay(e){I(this,we,e??Yt)}get maxResultsPerSource(){return C(this,ye)}set maxResultsPerSource(e){I(this,ye,e??Zt)}get sources(){return C(this,be)}}je=new WeakMap,be=new WeakMap,ye=new WeakMap,we=new WeakMap,J=new WeakMap,Je=new WeakSet,Rs=async function(e,t,n){const o=e.label,i=C(this,je).olMap.getView().getProjection();try{const r=C(this,ye);let c=await e.search(t,{maxResults:r,signal:n,mapProjection:i});return c.length>r&&(c=c.slice(0,r)),{label:o,source:e,results:c}}catch(r){hs(r)||Kt.error(`search for source ${o} failed`,r);return}};async function qi(s,e){s.aborted||await new Promise(t=>{const n=()=>{s.removeEventListener("abort",n),clearTimeout(o),t()};s.addEventListener("abort",n);const o=setTimeout(n,e)})}const Ke=fe("search:Search"),Zr=s=>{const{mapId:e,sources:t,searchTypingDelay:n,maxResultsPerGroup:o,onSelect:i,onClear:r}=s,{containerProps:c}=z("search",s),{map:l}=W(e),f=st(),g=sr(t,n,o,l),{input:w,search:x,selectedOption:S,onInputChanged:M,onResultConfirmed:P}=nr(g),R=tr(),_=Qi(f),O=er(),j=ee((G,U)=>{U.action==="input-change"&&M(G)}),B=ee((G,U)=>{switch(U.action){case"select-option":G&&(P(G),i?.({source:G.source,result:G.result}));break;case"clear":M(""),H.current?.blur(),H.current?.focus(),r?.();break;default:Ke.debug(`Unhandled action type '${U.action}'.`);break}}),H=u.useRef(null);return a.jsx($,{...c,children:a.jsx(pt,{className:"search-component",classNamePrefix:"react-select",ref:H,inputValue:w,onInputChange:j,"aria-label":f.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:_,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:R,isClearable:!0,placeholder:f.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:x.kind==="loading",options:x.kind==="ready"?x.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:O,onChange:B,value:S,menuPosition:"fixed"})})};function Qi(s){return u.useMemo(()=>({onFocus:({focused:i})=>`${i.label} ${s.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:i,label:r})=>{let c="";switch(i){case"select-option":c=`${r} ${s.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":c=`${r} ${s.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return c},guidance:()=>`${s.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[s])}function er(){return u.useMemo(()=>({Menu:Bi,Input:Ui,SingleValue:zi,Option:Zi,NoOptionsMessage:Gi,LoadingMessage:$i,ValueContainer:Hi,IndicatorsContainer:Wi,ClearIndicator:Yi}),[])}function tr(){const[s,e]=fs("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return u.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:s,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[s,e])}function sr(s,e,t,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!n)return;const r=new Ji(n,s);return i(r),()=>{r.destroy(),i(void 0)}},[n,s]),u.useEffect(()=>{o&&(o.searchTypingDelay=e)},[o,e]),u.useEffect(()=>{o&&(o.maxResultsPerSource=t)},[o,t]),o}function nr(s){const[e,t]=u.useReducer((c,l)=>{switch(l.kind){case"input":return{...c,query:l.query,selectedOption:null};case"select-option":return{...c,selectedOption:l.option,query:l.option.label};case"load-results":return{...c,search:{kind:"loading"}};case"accept-results":return{...c,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=u.useRef(),o=ee(c=>{if(!s){n.current=void 0,t({kind:"accept-results",results:[]});return}Ke.isDebug()&&Ke.debug(`Starting new search for query ${JSON.stringify(c)}.`),t({kind:"load-results"});const l=n.current=or(s,c).then(f=>{n.current===l&&t({kind:"accept-results",results:f})})}),i=u.useCallback(c=>{t({kind:"select-option",option:c})},[]),r=u.useCallback(c=>{t({kind:"input",query:c}),o(c)},[o]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:i,onInputChanged:r}}async function or(s,e){let t;try{t=await s.search(e)}catch(n){hs(n)||Ke.error("Search failed",n),t=[]}return ir(t)}function ir(s){return s.map((t,n)=>({label:t.label,options:t.results.map(o=>({value:`${n}-${o.id}`,label:o.label,source:t.source,result:o}))}))}const Fs="@open-pioneer/selection",rr=De.bind(void 0,Fs),Et=te.bind(void 0,Fs),_e="selection-active",He="selection-inactive";class ar{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,n,o,i){let r;switch(t){case Ct.extent:default:r=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,i,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=o}initViewport(e){const t=e.getViewport();return t.classList.add(_e),t.oncontextmenu=n=>(n.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipMessage,t.classList.remove(He),t.classList.add(_e),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,t.classList.remove(_e),t.classList.add(He),this.isActive=!1)}createDragBox(e,t,n,o){const i=new Lt({className:"selection-drag-box",condition:En});return e.addInteraction(i),i.on("boxend",function(){t(i.getGeometry())}),{interaction:i,destroy(){e.removeInteraction(i),o.splice(o.indexOf(this)),i.dispose(),n.classList.remove(_e),n.classList.remove(He),n.oncontextmenu=null}}}createDrag(e,t,n){const o=function(c){return c.originalEvent.button==2},i=new Ot({condition:o});return e.addInteraction(i),{interaction:i,destroy(){e.removeInteraction(i),n.splice(n.indexOf(this)),i.dispose(),t.classList.remove(_e),t.classList.remove(He),t.oncontextmenu=null}}}createHelpTooltip(e,t){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.textContent=t;const o=new ze({element:n,offset:[15,0],positioning:"center-left"}),i=e.on("pointermove",r=>{o.setPosition(r.coordinate)});return e.addOverlay(o),{overlay:o,element:n,destroy(){e.removeOverlay(o),o.dispose(),ae(i)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Lt)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Ot)}}const dt=fe("selection:SelectionController"),cr=1e4;var Re,Fe,Ve,qe,Vs;class lr{constructor(e){A(this,qe);A(this,Re,void 0);A(this,Fe,void 0);A(this,Ve,void 0);const{mapModel:t,onError:n,maxResults:o=cr}=e;I(this,Re,t),I(this,Fe,o),I(this,Ve,n)}destroy(){}async select(e,t){if(t)return await V(this,qe,Vs).call(this,e,t)}}Re=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,qe=new WeakSet,Vs=async function(e,t){const n=C(this,Re).olMap.getView().getProjection();try{dt.debug(`Starting selection on source '${e.label}'`);const o=C(this,Fe);let i=await e.select({type:"extent",extent:t},{maxResults:o,mapProjection:n,signal:new AbortController().signal});return i.length>o&&(i=i.slice(0,o)),dt.debug(`Found ${i.length} results on source '${e.label}'`),{source:e,results:i}}catch(o){dt.error(`selection from source ${e.label} failed`,o),C(this,Ve).call(this);return}};var Ct=(s=>(s.extent="EXTENT",s.polygon="POLYGON",s.free="FREEPOLYGON",s.circle="CIRCLE",s))(Ct||{});const Xt={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},Xr=s=>{const e=Et(),{mapId:t,sources:n,onSelectionComplete:o,onSelectionSourceChanged:i}=s,{containerProps:r}=z("selection",s),[c,l]=u.useState(()=>n.find(h=>(h.status??"available")==="available")),f=W(t),{onExtentSelected:g}=hr(f.map,n,c,o),w=pr(),[x,S]=u.useState(!1),P=u.useCallback(h=>{const y=[];if(h||(h=["EXTENT"]),h.forEach(m=>{Object.values(Ct).includes(m)&&y.push({label:e.formatMessage({id:m}),value:m})}),y.length===0)throw new Error("methods does not contain valid values");return y},[e])(void 0),[R,_]=u.useState(P[0]),O=ee(h=>{_(h)}),[j,B]=u.useState(!0);gr(f.map,R,e,g,j);const H=u.useMemo(()=>n.map(h=>({label:h.label,value:h})),[n]),G=u.useMemo(()=>H.find(h=>h.value===c),[H,c]),U=ee(h=>{l(h?.value),i&&i({source:h?.value})});u.useEffect(()=>{if(!c){B(!1);return}const h=e.formatMessage({id:"sourceNotAvailable"}),y=()=>c&&vt(c,h).kind==="available";B(y());const m=c.on("changed:status",()=>{B(y())});return()=>m.destroy()},[c,B,e]);const d=ee(h=>{!x&&h.key==="Enter"&&S(!0)});return a.jsxs(ft,{...r,spacing:2,children:[P.length>1&&a.jsxs(Ue,{children:[a.jsx(Ie,{children:e.formatMessage({id:"selectMethod"})}),a.jsx(pt,{className:"selection-method react-select",...Xt,options:P,onChange:O,value:R,chakraStyles:w})]}),a.jsxs(Ue,{children:[a.jsx(Ie,{children:e.formatMessage({id:"selectSource"})}),a.jsx(pt,{className:"selection-source react-select",...Xt,options:H,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:G,onChange:U,components:{Option:ur,SingleValue:dr},isOptionDisabled:h=>h.value===void 0||h.value.status==="unavailable",getOptionLabel:h=>h.label+(h.value===void 0||h.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:w,onKeyDown:d,menuIsOpen:x,onMenuOpen:()=>S(!0),onMenuClose:()=>S(!1)})]})]})};function ur(s){const{value:e}=s.data,{isAvailable:t,content:n}=Ds(e,!1);return a.jsx(se.Option,{...s,isDisabled:!t,className:"selection-source-option",children:n})}function dr(s){const{value:e}=s.data,{isAvailable:t,content:n}=Ds(e,!0),o=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return a.jsx(se.SingleValue,{...s,isDisabled:!t,className:o,children:n})}function Ds(s,e){const t=s?.label,n=fr(s);return{isAvailable:n.kind==="available",content:a.jsxs(Pe,{direction:"row",alignItems:"center",grow:1,children:[!e&&a.jsx(Pe,{grow:1,children:t}),n.kind==="unavailable"&&a.jsx($,{ml:2,children:a.jsx(ds,{label:n.reason,placement:"right",openDelay:500,children:a.jsx(K.span,{children:a.jsx(Ln,{as:Hn,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&t]})}}function hr(s,e,t,n){const o=rr("notifier.NotificationService"),i=Et(),[r,c]=u.useState(void 0);u.useEffect(()=>{if(!s)return;const f=new lr({mapModel:s,onError(){o.notify({level:"error",message:i.formatMessage({id:"selectionFailed"})})}});return c(f),()=>{f.destroy()}},[s,o,e,i]);const l=ee(async f=>{if(!r||!t)return;const g=await r.select(t,f.getExtent());g&&n?.(g)});return{controller:r,onExtentSelected:l}}function vt(s,e){const t=s.status??"available",n=typeof t=="string"?{kind:t}:t;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function fr(s){const e=Et(),[t,n]=u.useState(()=>({kind:"available"}));return u.useEffect(()=>{if(!s){n({kind:"available"});return}const o=e.formatMessage({id:"sourceNotAvailable"});n(vt(s,o));const i=s.on?.("changed:status",()=>{n(vt(s,o))});return()=>i?.destroy()},[s,e]),t}function gr(s,e,t,n,o){u.useEffect(()=>{if(!s)return;const i=new ar(s.olMap,e.value,t.formatMessage({id:"tooltip"}),t.formatMessage({id:"disabledTooltip"}),n);return i.setActive(o),()=>{i?.destroy()}},[s,e,t,n,o])}function pr(){const[s,e]=fs("colors",["background_body","border"],["#ffffff","#ffffff"]);return u.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:s})}),[s,e])}export{jr as C,Wr as G,Vr as L,Kr as M,Br as N,ze as O,Ur as P,Hr as S,Fr as V,Nr as W,zr as a,Yr as b,Zr as c,Xr as d,Dr as e,Gr as f,$r as g,bt as h};
