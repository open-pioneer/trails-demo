const __vite__fileDeps=["./BUJ0jVyJVw_W.js","./Dch09mLNbtBx.js","./B5-Mc2PbXXMs.js","./DTCJ8zUXYCFK.js","./1mybnJ7phGO6.js","./CV2vCj2hnT-X.js","./DqjceUz0qOuV.js","./BIA8ntS0DxTH.js","./DNr9U4lV2nYc.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Gs=Object.defineProperty;var $s=(t,e,s)=>e in t?Gs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var kt=(t,e,s)=>($s(t,typeof e!="symbol"?e+"":e,s),s),nt=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var C=(t,e,s)=>(nt(t,e,"read from private field"),s?s.call(t):e.get(t)),T=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},L=(t,e,s,n)=>(nt(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s);var D=(t,e,s)=>(nt(t,e,"access private method"),s);import{b8 as qt,b9 as Hs,ap as Us,ao as _t,ba as zs,bb as Ws,B as Ks,bc as Ys,bd as Zs,be as Xs,bf as Js,bg as Qt,bh as es,bi as qs,bj as Qs,ay as ts,bk as en,bl as tn,L as re,bm as sn,bn as nn,Z as $,bo as on,E as rn,aY as an,f as Mt,bp as cn,bq as ln,br as Pt,bs as un,bt as ot,V as dn,bu as At,av as hn,aA as fn,bv as gn,bw as pn,bx as mn,by as vn,bz as It,l as ht,N as ss,bA as ns,Y as ee,bB as U,a2 as z,bC as bn,X as De,bD as yn,bE as wn,a0 as Pe,bF as Be,k as Tt,b as os,a as is,Q as rs,c as we,C as as,F as Ae,b1 as ue,a1 as Sn,bG as xn,aU as cs,bH as En,bI as Cn,bJ as Lt,bK as kn,bL as Nt}from"./1mybnJ7phGO6.js";import{u as _n,e as Mn,r as u,f as Pn,h as Qe,i as ls,o as us,k as ds,j as a,l as W,m as An,n as In,c as he,E as q,R as Tn,A as it,p as rt,F as hs,B as et,C as Ln,t as Nn,q as fs,s as gs,I as On}from"./DTCJ8zUXYCFK.js";import{T as ae,V as ft,L as ps}from"./BIA8ntS0DxTH.js";import{S as jn,c as Rn,a as Fn,I as Vn,D as Dn}from"./DI52NiDWeDV1.js";import{j as Bn,k as ms}from"./BL3K0z8HbpPZ.js";import{S as Gn}from"./CKUc2QYdJAHT.js";import{_ as $n}from"./Dch09mLNbtBx.js";import{u as vs,F as Ue}from"./DqjceUz0qOuV.js";import{F as Ie}from"./vPrb6pfZCATP.js";import{H as gt}from"./CCVYFdIzwr5R.js";import{c as bs}from"./CAA67vYgO4r4.js";import{G as Hn,F as Un}from"./CV2vCj2hnT-X.js";import{L as ys}from"./Bc1T6cboqrZG.js";import{u as Se}from"./BMCyePFs3u3x.js";import{c as te,S as pt}from"./B5-Mc2PbXXMs.js";function zn(t){const{theme:e}=_n(),s=Mn();return u.useMemo(()=>Pn(e.direction,{...s,...t}),[t,e.direction,s])}var tt=Qe(function(e,s){const{htmlSize:n,...o}=e,i=ls("Input",o),r=us(o),c=vs(r),l=ds("chakra-input",e.className);return a.jsx(W.input,{size:n,...c,__css:i.field,ref:s,className:l})});tt.displayName="Input";tt.id="Input";var ws=W("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});ws.displayName="Center";var Wn={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Qe(function(e,s){const{axis:n="both",...o}=e;return a.jsx(W.div,{ref:s,__css:Wn[n],...o,position:"absolute"})});var Ss=Qe(function(e,s){const{children:n,placeholder:o,className:i,...r}=e;return a.jsxs(W.select,{...r,ref:s,className:ds("chakra-select",i),children:[o&&a.jsx("option",{value:"",children:o}),n]})});Ss.displayName="SelectField";function Kn(t,e){const s={},n={};for(const[o,i]of Object.entries(t))e.includes(o)?s[o]=i:n[o]=i;return[s,n]}var bt=Qe((t,e)=>{var s;const n=ls("Select",t),{rootProps:o,placeholder:i,icon:r,color:c,height:l,h,minH:f,minHeight:y,iconColor:E,iconSize:w,...M}=us(t),[A,F]=Kn(M,In),P=vs(F),I={width:"100%",height:"fit-content",position:"relative",color:c},R={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(s=n.field)==null?void 0:s._focus}};return a.jsxs(W.div,{className:"chakra-select__wrapper",__css:I,...A,...o,children:[a.jsx(Ss,{ref:e,height:h??l,minH:f??y,placeholder:i,...P,__css:R,children:t.children}),a.jsx(xs,{"data-disabled":An(P.disabled),...(E||c)&&{color:E||c},__css:n.icon,...w&&{fontSize:w},children:r})]})});bt.displayName="Select";var Yn=t=>a.jsx("svg",{viewBox:"0 0 24 24",...t,children:a.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Zn=W("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),xs=t=>{const{children:e=a.jsx(Yn,{}),...s}=t,n=u.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return a.jsx(Zn,{...s,className:"chakra-select__icon-wrapper",children:u.isValidElement(e)?n:null})};xs.displayName="SelectIcon";const j={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Xn={ERROR:"error"};class Jn extends Ks{constructor(e){super(Xn.ERROR),this.code=e.code,this.message=e.message}}let qn=class extends qt{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Hs,this.watchId_=void 0,this.addChangeListener(j.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(j.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Us(_t("EPSG:4326"),e),this.position_&&this.set(j.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const s=e.coords;this.set(j.ACCURACY,s.accuracy),this.set(j.ALTITUDE,s.altitude===null?void 0:s.altitude),this.set(j.ALTITUDE_ACCURACY,s.altitudeAccuracy===null?void 0:s.altitudeAccuracy),this.set(j.HEADING,s.heading===null?void 0:zs(s.heading)),this.position_?(this.position_[0]=s.longitude,this.position_[1]=s.latitude):this.position_=[s.longitude,s.latitude];const n=this.transform_(this.position_);this.set(j.POSITION,n.slice()),this.set(j.SPEED,s.speed===null?void 0:s.speed);const o=Ws(this.position_,s.accuracy);o.applyTransform(this.transform_),this.set(j.ACCURACY_GEOMETRY,o),this.changed()}positionError_(e){this.dispatchEvent(new Jn(e))}getAccuracy(){return this.get(j.ACCURACY)}getAccuracyGeometry(){return this.get(j.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(j.ALTITUDE)}getAltitudeAccuracy(){return this.get(j.ALTITUDE_ACCURACY)}getHeading(){return this.get(j.HEADING)}getPosition(){return this.get(j.POSITION)}getProjection(){return this.get(j.PROJECTION)}getSpeed(){return this.get(j.SPEED)}getTracking(){return this.get(j.TRACKING)}getTrackingOptions(){return this.get(j.TRACKING_OPTIONS)}setProjection(e){this.set(j.PROJECTION,_t(e))}setTracking(e){this.set(j.TRACKING,e)}setTrackingOptions(e){this.set(j.TRACKING_OPTIONS,e)}};const G={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class ze extends qt{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Ys,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(G.ELEMENT,this.handleElementChanged),this.addChangeListener(G.MAP,this.handleMapChanged),this.addChangeListener(G.OFFSET,this.handleOffsetChanged),this.addChangeListener(G.POSITION,this.handlePositionChanged),this.addChangeListener(G.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(G.ELEMENT)}getId(){return this.id}getMap(){return this.get(G.MAP)||null}getOffset(){return this.get(G.OFFSET)}getPosition(){return this.get(G.POSITION)}getPositioning(){return this.get(G.POSITIONING)}handleElementChanged(){Zs(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Xs(this.element),Js(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Qt(e,es.POSTRENDER,this.render,this),this.updatePixelPosition();const s=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(G.ELEMENT,e)}setMap(e){this.set(G.MAP,e)}setOffset(e){this.set(G.OFFSET,e)}setPosition(e){this.set(G.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const s=this.getMap();if(!s||!s.getTargetElement()||!this.get(G.POSITION))return;const n=this.getRect(s.getTargetElement(),s.getSize()),o=this.getElement(),i=this.getRect(o,[qs(o),Qs(o)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!ts(n,i)){const c=i[0]-n[0],l=n[2]-i[2],h=i[1]-n[1],f=n[3]-i[3],y=[0,0];if(c<0?y[0]=c-r:l<0&&(y[0]=Math.abs(l)+r),h<0?y[1]=h-r:f<0&&(y[1]=Math.abs(f)+r),y[0]!==0||y[1]!==0){const E=s.getView().getCenterInternal(),w=s.getPixelFromCoordinateInternal(E);if(!w)return;const M=[w[0]+y[0],w[1]+y[1]],A=e.animation||{};s.getView().animateInternal({center:s.getCoordinateFromPixelInternal(M),duration:A.duration,easing:A.easing})}}}getRect(e,s){const n=e.getBoundingClientRect(),o=n.left+window.pageXOffset,i=n.top+window.pageYOffset;return[o,i,o+s[0],i+s[1]]}setPositioning(e){this.set(G.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),s=this.getPosition();if(!e||!e.isRendered()||!s){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(s),o=e.getSize();this.updateRenderedPosition(n,o)}updateRenderedPosition(e,s){const n=this.element.style,o=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const r=Math.round(e[0]+o[0])+"px",c=Math.round(e[1]+o[1])+"px";let l="0%",h="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?l="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(l="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?h="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(h="-50%");const f=`translate(${l}, ${h}) translate(${r}, ${c})`;this.rendered.transform_!=f&&(this.rendered.transform_=f,n.transform=f)}getOptions(){return this.options}}const Or=en,Qn=25.4/.28,eo=39.37;function yt(t){return wt(t,to,so)}function to(t){return t.getView()}function so(t,e){return t.on("change:view",e)}function Es(t){return yt(t)?.getProjection()}function no(t){const e=yt(t);return wt(e,oo,io)}function oo(t){return t.getResolution()}function io(t,e){return t.on("change:resolution",e)}function ro(t){const e=yt(t);return wt(e,ao,co)}function ao(t){return t.getCenter()}function co(t,e){return t.on("change:center",e)}function lo(t){const e=ro(t),s=no(t),n=Es(t);return u.useMemo(()=>{if(n==null||s==null||e==null)return;const i=tn(n,s,e);return Math.round(i*eo*Qn)},[n,s,e])}function wt(t,e,s){const n=u.useCallback(()=>t?e(t):void 0,[t,e]),o=u.useCallback(i=>{if(!t)return()=>{};const r=s(t,i);return()=>re(r)},[t,s]);return u.useSyncExternalStore(o,n)}const uo=1.2;function ho(t,e=uo){fo(t);const s=sn(t),n=nn(t),o=s*e,i=n*e;return[t[0]-(o-s)/2,t[1]-(i-n)/2,t[2]+(o-s)/2,t[3]+(i-n)/2]}function fo(t){if(t.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${t.length}).`)}const go={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function jr(t){return a.jsxs($,{children:[a.jsx(ae,{children:t.layer.title}),a.jsx($,{style:go})]})}const at=.75,Ge=.1;let po=class extends on{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const s=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",o=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const i=e.label!==void 0?e.label:"›";typeof i=="string"?(this.label_=document.createElement("span"),this.label_.textContent=i):this.label_=i;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,c=document.createElement("button");c.setAttribute("type","button"),c.title=n,c.appendChild(r),c.addEventListener(rn.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new an({view:e.view,controls:new Mt,interactions:new Mt});this.ovmap_=l,e.layers&&e.layers.forEach(function(I){l.addLayer(I)});const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new ze({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const f=s+" "+cn+" "+ln+(this.collapsed_&&this.collapsible_?" "+Pt:"")+(this.collapsible_?"":" ol-uncollapsible"),y=this.element;y.className=f,y.appendChild(this.ovmapDiv_),y.appendChild(c);const E=this,w=this.boxOverlay_,M=this.boxOverlay_.getElement(),A=function(I){return{clientX:I.clientX,clientY:I.clientY}},F=function(I){const R=A(I),H=l.getEventCoordinateInternal(R);w.setPosition(H)},P=function(I){const R=l.getEventCoordinateInternal(I);E.getMap().getView().setCenterInternal(R),window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",P)};M.addEventListener("mousedown",function(){window.addEventListener("mousemove",F),window.addEventListener("mouseup",P)})}setMap(e){const s=this.getMap();if(e!==s){if(s){const n=s.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(Qt(e,un.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===ot.VIEW){const s=e.oldValue;s&&this.unbindView_(s);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===ot.TARGET||e.key===ot.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const s=new dn({projection:e.getProjection()});this.ovmap_.setView(s)}e.addChangeListener(At.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(At.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),s=this.ovmap_;if(!e.isRendered()||!s.isRendered())return;const n=e.getSize(),i=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&hn(i,this.viewExtent_))return;this.viewExtent_=i;const r=s.getSize(),l=s.getView().calculateExtentInternal(r),h=s.getPixelFromCoordinateInternal(fn(i)),f=s.getPixelFromCoordinateInternal(gn(i)),y=Math.abs(h[0]-f[0]),E=Math.abs(h[1]-f[1]),w=r[0],M=r[1];y<w*Ge||E<M*Ge||y>w*at||E>M*at?this.resetExtent_():ts(l,i)||this.recenter_()}resetExtent_(){const e=this.getMap(),s=this.ovmap_,n=e.getSize(),i=e.getView().calculateExtentInternal(n),r=s.getView(),c=Math.log(at/Ge)/Math.LN2,l=1/(Math.pow(2,c/2)*Ge);pn(i,l),r.fitInternal(mn(i))}recenter_(){const e=this.getMap(),s=this.ovmap_,n=e.getView();s.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),s=this.ovmap_;if(!e.isRendered()||!s.isRendered())return;const n=e.getSize(),o=e.getView(),i=s.getView(),r=this.rotateWithView_?0:-o.getRotation(),c=this.boxOverlay_,l=this.boxOverlay_.getElement(),h=o.getCenterInternal(),f=o.getResolution(),y=i.getResolution(),E=n[0]*f/y,w=n[1]*f/y;if(c.setPosition(h),l){l.style.width=E+"px",l.style.height=w+"px";const M="rotate("+r+"rad)";l.style.transform=M}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=vn(this.ovmap_,es.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Pt),this.collapsed_?It(this.collapseLabel_,this.label_):It(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};new ht([407354,5754673]),new ht([404740,5757893]);var ce,ne,Te,Le,Ne,mt;class mo extends ss{constructor(s,n,o){super();T(this,Ne);kt(this,"label");T(this,ce,{kind:"available"});T(this,ne,void 0);T(this,Te,void 0);T(this,Le,void 0);this.label=n,L(this,ne,s),L(this,Le,o),D(this,Ne,mt).call(this),L(this,Te,C(this,ne).on("change:visible",()=>{D(this,Ne,mt).call(this)}))}destroy(){re(C(this,Te))}get status(){return C(this,ce)}async select(s,n){if(s.type!=="extent")throw new Error(`Unsupported selection kind: ${s.type}`);if(C(this,ce).kind!=="available"||C(this,ne).getSource()===null)return[];const o=[];C(this,ne).getSource().forEachFeatureIntersectingExtent(s.extent,c=>{if(!c.getGeometry())return;const l={...c.getProperties()};delete l.geometries;const h={id:c.getId()?.toString()||ns(),geometry:c.getGeometry(),properties:l};o.push(h)});const i=o.filter(c=>c!=null);return i.length>n.maxResults?i.slice(0,n.maxResults):i}}ce=new WeakMap,ne=new WeakMap,Te=new WeakMap,Le=new WeakMap,Ne=new WeakSet,mt=function(){const n=C(this,ne).getVisible()?{kind:"available"}:{kind:"unavailable",reason:C(this,Le)};n.kind!==C(this,ce).kind&&(L(this,ce,n),this.emit("changed:status"))};var Oe;class Fr{constructor({intl:e}){T(this,Oe,void 0);L(this,Oe,e)}createSelectionSource(e){return new mo(e.vectorLayer,e.label,C(this,Oe).formatMessage({id:"layerNotVisibleReason"}))}}Oe=new WeakMap;const de=he("local-storage"),vo=0,Q={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var pe,Z,oe,me,X,Ye,Cs,Ze,ks,le,Me,ie,ge,Xe,_s;class Vr{constructor(e){T(this,Ye);T(this,Ze);T(this,le);T(this,ie);T(this,Xe);T(this,pe,void 0);T(this,Z,{});T(this,oe,void 0);T(this,me,void 0);T(this,X,void 0);L(this,pe,So(e.properties)),L(this,oe,xo()),C(this,oe)&&(D(this,Ze,ks).call(this),L(this,me,D(this,Xe,_s).call(this)))}destroy(){C(this,X)&&(clearTimeout(C(this,X)),L(this,X,void 0)),C(this,oe)&&D(this,le,Me).call(this)}get isSupported(){return!!C(this,me)}get(e){return D(this,ie,ge).call(this).get(e)}set(e,s){return D(this,ie,ge).call(this).set(e,s)}remove(e){return D(this,ie,ge).call(this).remove(e)}removeAll(){return D(this,ie,ge).call(this).removeAll()}getNamespace(e){return D(this,ie,ge).call(this).getNamespace(e)}}pe=new WeakMap,Z=new WeakMap,oe=new WeakMap,me=new WeakMap,X=new WeakMap,Ye=new WeakSet,Cs=function(){C(this,X)&&clearTimeout(C(this,X)),L(this,X,setTimeout(()=>{L(this,X,void 0),D(this,le,Me).call(this)},vo))},Ze=new WeakSet,ks=function(){try{const e=C(this,oe);if(!e)throw new q(Q.INTERNAL,"Local storage is not available.");const s=e.getItem(C(this,pe));if(s==null){L(this,Z,{}),D(this,le,Me).call(this);return}try{const n=JSON.parse(s);if(!xe(n))throw new q(Q.CORRUPTED_DATA,"Persisted value should be an object.");L(this,Z,n)}catch(n){de.warn("Invalid persisted data, reverting to default.",n),L(this,Z,{}),D(this,le,Me).call(this)}}catch(e){de.error("Failed to load from local storage",e)}},le=new WeakSet,Me=function(){try{const e=C(this,oe);if(!e)throw new q(Q.INTERNAL,"Local storage is not available.");const s=JSON.stringify(C(this,Z));e.setItem(C(this,pe),s)}catch(e){de.error("Failed to save to local storage",e)}},ie=new WeakSet,ge=function(){const e=C(this,me);if(!e)throw new q(Q.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},Xe=new WeakSet,_s=function(){const e={getByPath:s=>jt(bo(C(this,Z),s)),setByPath:(s,n)=>{if(!wo(n))throw new q(Q.INVALID_VALUE,"The value is not supported by local storage.");if(n=jt(n),s.length===0){if(!xe(n))throw new q(Q.INVALID_VALUE,"The root value must be a plain object.");L(this,Z,n)}else yo(C(this,Z),s,n);D(this,Ye,Cs).call(this)}};return new St([],e)};class St{path;access;constructor(e,s){this.path=e,this.access=s}get(e){return this.access.getByPath([...this.path,e])}set(e,s){this.access.setByPath([...this.path,e],s)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const s=this.get(e);if(s===void 0)this.set(e,{});else if(!xe(s))throw new q(Q.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new St(this.path.concat([e]),this.access)}}const Ot="trails-state";function bo(t,e){let s=t;for(const n of e){if(!xe(s))throw new q(Q.INVALID_PATH,`Cannot get nested property '${n}' because the parent is no object.`);s=s[n]}return s}function yo(t,e,s){if(!e.length)throw new q(Q.INTERNAL,"Path must not be empty.");let n=t;for(let i=0,r=e.length-1;i<r;++i){const c=e[i],l=n[c];if(!xe(l))throw new q(Q.INVALID_PATH,`Cannot set property on '${c}' because it is no object.`);n=l}const o=e[e.length-1];n[o]=s}function xe(t){return!!(t&&typeof t=="object"&&!Array.isArray(t))}function wo(t){const e=typeof t;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||t===null||Array.isArray(t)||xe(t)}function So(t){const e=t.storageId;return!e||typeof e!="string"?(de.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${Ot}'.`),Ot):e}function xo(){if(typeof Storage>"u"){de.warn("Local storage is not supported by this browser.");return}try{const t=globalThis.localStorage;if(!t){de.warn("Local storage is not supported by this browser.");return}return t}catch(t){de.warn("Local storage is not supported by this browser.",t);return}}function jt(t){return t!=null&&(t=JSON.parse(JSON.stringify(t))),t}const Eo="@open-pioneer/coordinate-viewer",Co=ee.bind(void 0,Eo),ko=4,Dr=t=>{const{mapId:e,precision:s,displayProjectionCode:n}=t,{containerProps:o}=U("coordinate-viewer",t),{map:i}=z(e),r=i?.olMap,c=Es(r)?.getCode()??"";let{coordinates:l}=Mo(r);l=l&&n?Ao(l,c,n):l;const h=_o(l,s),f=n||c,y=h?h+" "+f:"";return a.jsx($,{...o,children:a.jsx(ae,{className:"coordinate-viewer-text",children:y})})};function _o(t,e){const s=Co();return t?Po(t,e,s):""}function Mo(t){const[e,s]=u.useState();return u.useEffect(()=>{if(!t)return;const n=t.on("pointermove",o=>{s(o.coordinate)});return()=>re(n)},[t]),{coordinates:e}}function Po(t,e,s){if(t[0]==null||t[1]==null)return"";const n=e??ko,[o,i]=t,r=s.formatNumber(o,{maximumFractionDigits:n,minimumFractionDigits:n}),c=s.formatNumber(i,{maximumFractionDigits:n,minimumFractionDigits:n});return r+" "+c}function Ao(t,e,s){return bn(t,e,s)}function Rt(t){const e=u.useRef(null);return u.useLayoutEffect(()=>{e.current=t}),u.useCallback((...n)=>{const o=e.current;return o(...n)},[])}const Io="@open-pioneer/notifier",To=De.bind(void 0,Io);var Ms=bs({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Lo=bs({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const No=!1;function Br(t){const{position:e="top-right"}=t,s=zn(),n=To("notifier.NotificationService"),[o,i]=u.useState(!No),r=Rt(l=>{const h=l.level==="error"?a.jsx(Ms,{h:"100%",w:"100%"}):void 0;s({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:h})}),c=Rt(()=>{s.closeAll()});return u.useEffect(()=>{const l=n.registerHandler({showNotification:r,closeAll:c});return()=>l.destroy()},[o,n,r,c]),a.jsx(a.Fragment,{})}const Gr=t=>{const{mapId:e,displayMode:s="line"}=t,{containerProps:n}=U("scale-bar",t),{map:o}=z(e),i=u.useRef(null);return u.useEffect(()=>{if(i.current&&o){const r=o.olMap,c=new jn({units:"metric",target:i.current,bar:s==="bar"});return r.addControl(c),()=>{r.removeControl(c)}}},[s,o]),a.jsx($,{...n,ref:i})},Oo="@open-pioneer/scale-viewer",jo=ee.bind(void 0,Oo),$r=t=>{const{mapId:e}=t,{containerProps:s}=U("scale-viewer",t),{map:n}=z(e),o=jo(),i=lo(n?.olMap),r=i?o.formatNumber(i):void 0;return a.jsx($,{...s,children:r&&a.jsxs(ae,{children:["1:",r]})})};var V={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let Ro=0;function Fo(t,e){const s=`atom${++Ro}`,n={toString:()=>s};return typeof t=="function"?n.read=t:(n.init=t,n.read=Vo,n.write=Do),n}function Vo(t){return t(this)}function Do(t,e,s){return e(this,typeof s=="function"?s(t(this)):s)}const ct=(t,e)=>t.unstable_is?t.unstable_is(e):e===t,lt=t=>"init"in t,ut=t=>!!t.write,We=new WeakMap,Bo=(t,e)=>{We.set(t,e),t.catch(()=>{}).finally(()=>We.delete(t))},Ft=(t,e)=>{const s=We.get(t);s&&(We.delete(t),s(e))},Vt=(t,e)=>{t.status="fulfilled",t.value=e},Dt=(t,e)=>{t.status="rejected",t.reason=e},Go=t=>typeof t?.then=="function",Ce=(t,e)=>!!t&&"v"in t&&"v"in e&&Object.is(t.v,e.v),Bt=(t,e)=>!!t&&"e"in t&&"e"in e&&Object.is(t.e,e.e),fe=t=>!!t&&"v"in t&&t.v instanceof Promise,$o=(t,e)=>"v"in t&&"v"in e&&t.v.orig&&t.v.orig===e.v.orig,$e=t=>{if("e"in t)throw t.e;return t.v},Ps=()=>{const t=new WeakMap,e=new WeakMap,s=[],n=new WeakMap;let o,i;(V?"production":void 0)!=="production"&&(o=new Set,i=new Set);const r=d=>t.get(d),c=(d,v)=>{v.d.forEach((S,b)=>{var m;if(!n.has(b)){const g=r(b);(m=s[s.length-1])==null||m.add(b),n.set(b,[g,new Set]),g&&c(b,g)}n.get(b)[1].add(d)})},l=(d,v)=>{var S;(V?"production":void 0)!=="production"&&Object.freeze(v);const b=r(d);if(t.set(d,v),n.has(d)||((S=s[s.length-1])==null||S.add(d),n.set(d,[b,new Set]),c(d,v)),fe(b)){const m="v"in v?v.v instanceof Promise?v.v:Promise.resolve(v.v):Promise.reject(v.e);b.v!==m&&Ft(b.v,m)}},h=(d,v,S,b)=>{const m=new Map(b?v.d:null);let g=!1;S.forEach((p,x)=>{!p&&ct(d,x)&&(p=v),p?(m.set(x,p),v.d.get(x)!==p&&(g=!0)):(V?"production":void 0)!=="production"&&console.warn("[Bug] atom state not found")}),(g||v.d.size!==m.size)&&(v.d=m)},f=(d,v,S,b)=>{const m=r(d),g={d:m?.d||new Map,v};if(S&&h(d,g,S,b),Ce(m,g)&&m.d===g.d)return m;if(fe(m)&&fe(g)&&$o(m,g)){if(m.d===g.d)return m;g.v=m.v}return l(d,g),g},y=(d,v,S,b)=>{if(Go(v)){let m;const g=()=>{const x=r(d);if(!fe(x)||x.v!==p)return;const N=f(d,p,S);e.has(d)&&x.d!==N.d&&K(d,N,x.d)},p=new Promise((x,N)=>{let _=!1;v.then(O=>{_||(_=!0,Vt(p,O),x(O),g())},O=>{_||(_=!0,Dt(p,O),N(O),g())}),m=O=>{_||(_=!0,O.then(Y=>Vt(p,Y),Y=>Dt(p,Y)),x(O))}});return p.orig=v,p.status="pending",Bo(p,x=>{x&&m(x),b?.()}),f(d,p,S,!0)}return f(d,v,S)},E=(d,v,S)=>{const b=r(d),m={d:b?.d||new Map,e:v};return S&&h(d,m,S),Bt(b,m)&&b.d===m.d?b:(l(d,m),m)},w=(d,v)=>{const S=r(d);if(!v&&S&&(e.has(d)||Array.from(S.d).every(([_,O])=>{if(_===d)return!0;const Y=w(_);return Y===O||Ce(Y,O)})))return S;const b=new Map;let m=!0;const g=_=>{if(ct(d,_)){const Y=r(_);if(Y)return b.set(_,Y),$e(Y);if(lt(_))return b.set(_,void 0),_.init;throw new Error("no atom init")}const O=w(_);return b.set(_,O),$e(O)};let p,x;const N={get signal(){return p||(p=new AbortController),p.signal},get setSelf(){return(V?"production":void 0)!=="production"&&!ut(d)&&console.warn("setSelf function cannot be used with read-only atom"),!x&&ut(d)&&(x=(..._)=>{if((V?"production":void 0)!=="production"&&m&&console.warn("setSelf function cannot be called in sync"),!m)return P(d,..._)}),x}};try{const _=d.read(g,N);return y(d,_,b,()=>p?.abort())}catch(_){return E(d,_,b)}finally{m=!1}},M=d=>$e(w(d)),A=d=>{const v=p=>{var x,N;const _=new Set((x=e.get(p))==null?void 0:x.t);return(N=n.get(p))==null||N[1].forEach(O=>{_.add(O)}),_},S=new Array,b=new Set,m=p=>{if(!b.has(p)){b.add(p);for(const x of v(p))p!==x&&m(x);S.push(p)}};m(d);const g=new Set([d]);for(let p=S.length-1;p>=0;--p){const x=S[p],N=r(x);if(!N)continue;let _=!1;for(const O of N.d.keys())if(O!==x&&g.has(O)){_=!0;break}if(_){const O=w(x,!0);Ce(N,O)||g.add(x)}}},F=(d,...v)=>{const S=g=>$e(w(g)),b=(g,...p)=>{const x=s.length>0;x||s.push(new Set([g]));let N;if(ct(d,g)){if(!lt(g))throw new Error("atom not writable");const _=r(g),O=y(g,p[0]);Ce(_,O)||A(g)}else N=F(g,...p);if(!x){const _=k(s.pop());(V?"production":void 0)!=="production"&&o.forEach(O=>O({type:"async-write",flushed:_}))}return N};return d.write(S,b,...v)},P=(d,...v)=>{s.push(new Set([d]));const S=F(d,...v),b=k(s.pop());return(V?"production":void 0)!=="production"&&o.forEach(m=>m({type:"write",flushed:b})),S},I=(d,v,S)=>{var b;const m=e.get(d);if(m)return v&&m.t.add(v),m;const g=S||[];(b=r(d))==null||b.d.forEach((x,N)=>{N!==d&&I(N,d,g)}),w(d);const p={t:new Set(v&&[v]),l:new Set};if(e.set(d,p),(V?"production":void 0)!=="production"&&i.add(d),ut(d)&&d.onMount){const{onMount:x}=d;g.push(()=>{const N=x((..._)=>P(d,..._));N&&(p.u=N)})}return S||g.forEach(x=>x()),p},R=(d,v)=>!v.l.size&&(!v.t.size||v.t.size===1&&v.t.has(d)),H=(d,v)=>{if(!R(d,v))return;const S=v.u;S&&S(),e.delete(d),(V?"production":void 0)!=="production"&&i.delete(d);const b=r(d);b?(fe(b)&&Ft(b.v),b.d.forEach((m,g)=>{if(g!==d){const p=e.get(g);p&&(p.t.delete(d),H(g,p))}})):(V?"production":void 0)!=="production"&&console.warn("[Bug] could not find atom state to unmount",d)},K=(d,v,S)=>{const b=new Set(v.d.keys()),m=new Set;S?.forEach((g,p)=>{if(b.has(p)){b.delete(p);return}m.add(p);const x=e.get(p);x&&x.t.delete(d)}),b.forEach(g=>{I(g,d)}),m.forEach(g=>{const p=e.get(g);p&&H(g,p)})},k=d=>{let v;(V?"production":void 0)!=="production"&&(v=new Set);const S=[],b=m=>{var g;if(!n.has(m))return;const[p,x]=n.get(m);n.delete(m),S.push([m,p]),x.forEach(b),(g=r(m))==null||g.d.forEach((N,_)=>b(_))};if(d.forEach(b),S.forEach(([m,g])=>{const p=r(m);if(!p){(V?"production":void 0)!=="production"&&console.warn("[Bug] no atom state to flush");return}if(p!==g){const x=e.get(m);x&&p.d!==g?.d&&K(m,p,g?.d),x&&!(!fe(g)&&(Ce(g,p)||Bt(g,p)))&&(x.l.forEach(N=>N()),(V?"production":void 0)!=="production"&&v.add(m))}}),(V?"production":void 0)!=="production")return v},B=(d,v)=>{const S=I(d),b=k([d]),m=S.l;return m.add(v),(V?"production":void 0)!=="production"&&o.forEach(g=>g({type:"sub",flushed:b})),()=>{m.delete(v),H(d,S),(V?"production":void 0)!=="production"&&o.forEach(g=>g({type:"unsub"}))}};return(V?"production":void 0)!=="production"?{get:M,set:P,sub:B,dev_subscribe_store:d=>(o.add(d),()=>{o.delete(d)}),dev_get_mounted_atoms:()=>i.values(),dev_get_atom_state:d=>t.get(d),dev_get_mounted:d=>e.get(d),dev_restore_atoms:d=>{s.push(new Set);for(const[S,b]of d)lt(S)&&(y(S,b),A(S));const v=k(s.pop());o.forEach(S=>S({type:"restore",flushed:v}))}}:{get:M,set:P,sub:B}};let ke;const Ho=()=>(ke||(ke=Ps(),(V?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=ke),globalThis.__JOTAI_DEFAULT_STORE__!==ke&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),ke),As=Ps,Uo=Ho,Is=u.createContext(void 0),zo=t=>u.useContext(Is)||Uo(),Wo=({children:t,store:e})=>{const s=u.useRef();return!e&&!s.current&&(s.current=As()),u.createElement(Is.Provider,{value:e||s.current},t)},Ko=t=>typeof t?.then=="function",Yo=Tn.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)});function Zo(t,e){const s=zo(),[[n,o,i],r]=u.useReducer(h=>{const f=s.get(t);return Object.is(h[0],f)&&h[1]===s&&h[2]===t?h:[f,s,t]},void 0,()=>[s.get(t),s,t]);let c=n;return(o!==s||i!==t)&&(r(),c=s.get(t)),u.useEffect(()=>{const h=s.sub(t,()=>{r()});return r(),h},[s,t,void 0]),u.useDebugValue(c),Ko(c)?Yo(c):c}const Ts="@open-pioneer/spatial-bookmarks",Xo=De.bind(void 0,Ts),Jo=ee.bind(void 0,Ts),se=he("spatial-bookmark:SpatialBookmarkViewModel");class qo{map;packageNamespace;writableBookmarks=Fo([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,s){this.map=e,this.packageNamespace=s.getNamespace("spatial-bookmarks"),this.store=As(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const s=this.map.olMap,n=s.getView().calculateExtent(),o=s.getView().getProjection().getCode(),i={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},r={id:ns(),title:e,extent:i,projection:o};se.debug("Created a new bookmark",r);const c=this.writableBookmarks;this.store.set(c,[...this.store.get(c),r])}activateBookmark(e){se.debug("Activating bookmark",e);const s=this.getBookmarkExtent(e);se.debug("Attempting to apply extent",s),this.applyExtent(s)}deleteBookmark(e){se.debug("Deleting bookmark",e);const s=this.writableBookmarks;this.store.set(s,[...this.store.get(s).filter(n=>n.id!==e)])}deleteAllBookmarks(){se.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){se.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{Qo(e),this.store.set(this.writableBookmarks,e)}catch(s){se.error("Bookmarks data in local storage is invalid, resetting to default value.",s),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){se.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const n=this.map.olMap.getView(),o=e.extent,i=[o.minX,o.minY,o.maxX,o.maxY],r=n.getProjection(),c=e.projection;return yn(i,c,r)}applyExtent(e){const n=this.map.olMap.getView(),o=wn(e),i=n.getResolutionForExtent(e);n.setCenter(o),n.setResolution(i)}}function Qo(t){if(!Array.isArray(t))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of t)ei(e)}function ei(t){if(!t||typeof t!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=t;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(ti(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function ti(t){if(!t||typeof t!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=t;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const Hr=t=>{const{map:e}=z(t.mapId),s=Xo("local-storage.LocalStorageService"),n=ci(e,s);return n&&a.jsx(Wo,{store:n.store,children:a.jsx(si,{...t,viewModel:n})})};function si(t){const{viewModel:e}=t,s=Jo(),n=u.useRef([]),[o,i]=u.useState(!1),r=Zo(e.bookmarks),[c,l]=u.useState(""),h=c.trim().length>0,{containerProps:f}=U("spatial-bookmarks",t),[y,E]=u.useState("list"),w=()=>{e.deleteAllBookmarks(),E("list")},M=()=>{h&&(e.createBookmark(c),E("list"),l(""),i(!0))};u.useEffect(()=>{if(o){const R=n.current;R&&R[r.length-1]?.scrollIntoView?.(),i(!1)}},[r,o]);const A=()=>a.jsxs(ft,{children:[a.jsxs(it,{rounded:"md",status:"warning",children:[a.jsx(rt,{}),s.formatMessage({id:"bookmark.alert.delete"})]}),a.jsx(ri,{intl:s,onClear:w,onCancel:()=>E("list")})]}),F=()=>a.jsxs(ft,{children:[a.jsxs(it,{rounded:"md",status:"info",children:[a.jsx(rt,{}),s.formatMessage({id:"bookmark.alert.create"})]}),a.jsx(tt,{"aria-label":s.formatMessage({id:"bookmark.input.label"}),placeholder:s.formatMessage({id:"bookmark.input.placeholder"}),value:c,onChange:R=>{l(R.target.value)},onKeyDown:R=>{R.key==="Enter"&&M()},isRequired:!0,isInvalid:!h,autoFocus:!0}),a.jsx(ai,{intl:s,isInvalid:!h,onCancel:()=>{l(""),E("list")},onSave:M})]}),P=()=>a.jsxs(a.Fragment,{children:[r.length?ni(r,e,s,n):a.jsxs(it,{rounded:"md",status:"info",children:[a.jsx(rt,{}),s.formatMessage({id:"bookmark.alert.noSaved"})]}),a.jsx(ii,{intl:s,bookmarks:r,showCreate:()=>E("create"),showDelete:()=>E("delete")})]}),I=a.jsxs(a.Fragment,{children:[y==="list"&&P(),y==="create"&&F(),y==="delete"&&A()]});return a.jsx(Pe,{flexDirection:"column",...f,children:I})}function ni(t,e,s,n){const o=s.formatMessage({id:"bookmark.button.deleteOne"}),i=t.map((r,c)=>a.jsx(oi,{index:c,listItemNodes:n,bookmark:r,onActivate:()=>e.activateBookmark(r),onDelete:()=>e.deleteBookmark(r.id),deleteBtnLabel:o},r.id));return a.jsx(ps,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":s.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:i})}const Gt={ArrowDown:1,ArrowUp:-1};function oi(t){const{index:e,listItemNodes:s,bookmark:n,onDelete:o,onActivate:i,deleteBtnLabel:r}=t,c=n.title,l=h=>{const f=h.key;if(f==="Enter"){h.target===h.currentTarget&&i();return}if(Gt[f]!=null){const y=s.current?.length;if(!y)return;let E=(e+Gt[f])%y;E<0&&(E=y-1),s.current[E]?.focus()}};return a.jsx($,{as:"li",p:1,ref:h=>{if(!h){s.current.splice(e,1);return}s.current[e]=h},className:Be("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:l,onClick:i,children:a.jsxs(Pe,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[a.jsx(ws,{children:a.jsx(Bn,{})}),a.jsx(ae,{ps:2,noOfLines:1,children:c}),a.jsx(Gn,{}),a.jsx(hs,{hasArrow:!0,label:r,placement:"right",children:a.jsx(et,{className:"spatial-bookmarks-item-delete","aria-label":r,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:a.jsx(ms,{}),onClick:h=>{o(),h.stopPropagation()}})},e)]})})}function ii(t){const{intl:e,bookmarks:s,showCreate:n,showDelete:o}=t;return a.jsxs(xt,{children:[a.jsx(Ee,{isDisabled:s.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:a.jsx(ms,{}),onClick:o,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),a.jsx(Ee,{onClick:n,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function ri(t){const{intl:e,onCancel:s,onClear:n}=t;return a.jsxs(xt,{children:[a.jsx(Ee,{variant:"outline",onClick:s,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),a.jsx(Ee,{onClick:n,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function ai(t){const{intl:e,onCancel:s,onSave:n,isInvalid:o}=t;return a.jsxs(xt,{children:[a.jsx(Ee,{variant:"outline",onClick:()=>s(),children:e.formatMessage({id:"bookmark.button.cancel"})}),a.jsx(Ee,{isDisabled:o,onClick:()=>n(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function xt(t){return a.jsx(Pe,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:t.children})}function Ee(t){return a.jsx(et,{width:"100%",...t})}function ci(t,e){const[s,n]=u.useState();return u.useEffect(()=>{let o;return t?o=new qo(t,e):o=void 0,n(o),()=>o?.destroy()},[t,e]),s}const Ls="@open-pioneer/printing",$t=De.bind(void 0,Ls),li=ee.bind(void 0,Ls),ui="map";class di{olMap;title="";fileFormat="pdf";i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,s,n){this.olMap=e,this.printingService=s,this.i18n=n}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}setViewPadding(e){this.viewPadding=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Rn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",s=this.title||ui;return{title:e,fileName:s}}async exportMapInPNG(e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height+50,s.style.backgroundColor="#fff";const n=s.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:o,fileName:i}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,s.width,s.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const r=s.width/2;n.fillText(o,r,20),n.drawImage(e,0,50);const c=document.createElement("a");c.setAttribute("download",i+".png");const l=Fn(s);if(!l)throw new Error("Failed to get image data URL");c.href=l,c.click()}async exportMapInPDF(e){const{jsPDF:s}=await $n(()=>import("./BUJ0jVyJVw_W.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),n=new s({orientation:"landscape",unit:"mm",format:"a4"}),o=n.internal.pageSize.getWidth(),i=n.internal.pageSize.getHeight(),r=15,c=20,l=i-c;n.setFontSize(20);const{title:h,fileName:f}=this.getTitleAndFileName();n.text(h,o/2,r,{align:"center"});const y=e.width/e.height;let E=l,w=E*y;w>=o&&(w=o,E=w/y);const M=(o-w)/2,A=c+(l-E)/2;n.addImage(e,"",M,A,w,E),n.save(f+".pdf")}}const hi=he("printing"),Ur=t=>{const e=li(),{mapId:s,viewPadding:n="auto"}=t,{containerProps:o}=U("printing",t),[i,r]=u.useState("pdf"),[c,l]=u.useState(""),[h,f]=u.useState(!1),y=$t("printing.PrintingService"),E=$t("notifier.NotificationService"),{map:w}=z(s),M=fi(w,e,y,n);u.useEffect(()=>{M?.setFileFormat(i)},[M,i]),u.useEffect(()=>{M?.setTitle(c)},[M,c]);function A(P){(P==="png"||P==="pdf")&&r(P)}function F(){h||!M||(f(!0),M.handleMapExport().catch(P=>{const I=e.formatMessage({id:"printingFailed"});E.notify({level:"error",message:I}),hi.error("Failed to print the map",P)}).finally(()=>{f(!1)}))}return a.jsxs($,{...o,children:[a.jsxs(Ue,{mb:4,alignItems:"center",children:[a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),a.jsx(tt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:c,onChange:P=>{l(P.target.value)},autoFocus:!0})]}),a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),a.jsxs(bt,{value:i,onChange:P=>A(P.target.value),className:"printing-select",children:[a.jsx("option",{value:"png",children:"PNG"}),a.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),a.jsx(et,{isLoading:h,loadingText:e.formatMessage({id:"printingMap"}),disabled:h,padding:2,className:"printing-export-button",onClick:F,width:"100%",children:e.formatMessage({id:"export"})})]})};function fi(t,e,s,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!t)return;const r=new di(t.olMap,s,{overlayText:e.formatMessage({id:"printingMap"})});return i(r),()=>{r.destroy(),i(void 0)}},[t,e,s]),u.useEffect(()=>{o?.setViewPadding(n)},[o,n]),o}const gi="@open-pioneer/legend",Ns=ee.bind(void 0,gi),zr=t=>{const{mapId:e,showBaseLayers:s=!1}=t,{containerProps:n}=U("legend",t),{map:o}=z(e);return a.jsx($,{...n,children:o?a.jsx(pi,{map:o,showBaseLayers:s}):null})};function pi(t){const{map:e,showBaseLayers:s}=t,o=bi(e).map(i=>a.jsx(Os,{layer:i,showBaseLayers:s},i.id));return a.jsx(ps,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:o})}function Os(t){const{layer:e,showBaseLayers:s}=t,{isVisible:n}=wi(e),o=yi(e);if(!n||!s&&!("parentLayer"in e)&&e.isBaseLayer)return;const i=[];return o?.length&&o.forEach(r=>{i.push(a.jsx(Os,{layer:r,showBaseLayers:s},r.id))}),a.jsxs(a.Fragment,{children:[a.jsx(mi,{layer:e,showBaseLayers:s}),i]})}function mi(t){const e=Ns(),{layer:s,showBaseLayers:n}=t,o=Si(s),i=vi(s);let r;o?.Component?r=a.jsx(o.Component,{layer:s}):o?.imageUrl?r=a.jsx(Ht,{layer:s,imageUrl:o.imageUrl}):i&&(r=a.jsx(Ht,{layer:s,imageUrl:i}));const c=!("parentLayer"in s)&&s.isBaseLayer;return r?a.jsxs($,{as:"li",className:Be("legend-item",`layer-${xi(s.id)}`),children:[n&&c?a.jsx(ae,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,r]}):void 0}function Ht(t){const e=Ns(),{layer:s,imageUrl:n}=t;return a.jsxs($,{children:[a.jsx(ae,{children:s.title}),a.jsx(Vn,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:s.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:a.jsx($,{children:a.jsxs(ae,{children:[a.jsx(Ms,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function vi(t){const e=u.useCallback(()=>t.legend,[t]),s=u.useCallback(n=>{const o=t.on("changed:legend",n);return()=>o.destroy()},[t]);return u.useSyncExternalStore(s,e)}function bi(t){const e=u.useCallback(n=>{const o=t.layers.on("changed",n);return()=>o.destroy()},[t]),s=u.useCallback(()=>{let n=t.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[t]);return js(e,s)}function yi(t){const e=u.useCallback(n=>{const o=t.sublayers?.on("changed",n);return()=>o?.destroy()},[t]),s=u.useCallback(()=>{if(!t.sublayers)return;let o=t.sublayers?.getSublayers({sortByDisplayOrder:!0});return o=o.reverse(),o},[t]);return js(e,s)}function js(t,e){const s=u.useRef(),n=u.useCallback(i=>{const r=t(()=>{s.current=void 0,i()});return()=>{s.current=void 0,r()}},[t]),o=u.useCallback(()=>{if(s.current)return s.current.value;const i=e();return s.current={value:i},i},[e]);return u.useSyncExternalStore(n,o)}function wi(t){const e=u.useCallback(()=>t.visible,[t]),s=u.useCallback(o=>{const i=t.on("changed:visible",o);return()=>i.destroy()},[t]);return{isVisible:u.useSyncExternalStore(s,e)}}function Si(t){const[e,s]=u.useState(void 0);return u.useEffect(()=>{s(t.attributes.legend);const n=t.on("changed:attributes",()=>{s(t.attributes.legend)});return()=>n.destroy()},[t]),e}function xi(t){return t.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const Rs="@open-pioneer/geolocation",Ei=De.bind(void 0,Rs),Ci=ee.bind(void 0,Rs);function ki(t){return Hn({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(t)}const Ut=he("geolocation:GeolocationController"),zt=17;class _i extends ss{olMap;positionHighlightLayer;geolocation;maxZoom=zt;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,s){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Tt,this.accuracyFeature.setStyle(Kt()),this.positionFeature=new Tt,this.positionFeature.setStyle(Wt()),this.positionHighlightLayer=new os({source:new is({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(rs);const n=s||Mi();this.geolocation=new qn({tracking:!1,trackingOptions:n,projection:e.getView()?.getProjection()}),this.trackingOptions=n,this.geolocation.on("error",o=>this.handleGeolocationError(o))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(n=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const o=this.geolocation.on("change:accuracyGeometry",()=>{const l=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(l),this.accuracyFeature?.getGeometry()!==void 0&&n(),this.isInitialZoom){const h=this?.accuracyFeature?.getGeometry()?.getExtent();if(h){const f=ho(h);if(!f)return;e.getView().fit(f,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),i=this.geolocation.on("change:position",()=>{const l=this.geolocation.getPosition();l&&(l[0]||l[1])!==void 0&&(this.positionFeature?.setGeometry(new ht(l)),this.setMapToPosition&&e.getView().setCenter(l),this.positionFeature?.getGeometry()!==void 0&&n())}),r=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),c=e.on("pointermove",l=>{l.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(o,i,r,c),e.addLayer(this.positionHighlightLayer)}).catch(n=>{Ut.error("Failed to determine location",n)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{re(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??Wt())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??Kt())}setMaxZoom(e){this.maxZoom=e??zt}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){Ut.error("Error from geolocation API:",e.message);const s=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",s)}}const Wt=()=>new we({image:new as({radius:6,fill:new Ae({color:"#3399CC"}),stroke:new ue({color:"#fff",width:2})})}),Kt=()=>new we({stroke:new ue({color:"#3399CC",width:3}),fill:new Ae({color:"rgba(0, 0, 255, 0.05)"})}),Mi=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),Wr=u.forwardRef(function(e,s){const{mapId:n,maxZoom:o,positionFeatureStyle:i,accuracyFeatureStyle:r,trackingOptions:c}=e,{containerProps:l}=U("geolocation",e),h=!!navigator.geolocation,[f,y]=u.useState(!1),[E,w]=u.useState(!1),{map:M}=z(n),A=Ci(),F=Ei("notifier.NotificationService"),P=Pi(M,o,c,i,r),I=h?f?A.formatMessage({id:"locateMeEnd"}):A.formatMessage({id:"locateMeStart"}):A.formatMessage({id:"locateNotSupported"});u.useEffect(()=>{if(P===void 0)return;const H=P.on("error",function(K){const k=A.formatMessage({id:"error"}),B=(()=>{switch(K){case"permission-denied":return A.formatMessage({id:"permissionDenied"});case"position-unavailable":return A.formatMessage({id:"positionUnavailable"});case"timeout":return A.formatMessage({id:"timeout"});case"unknown":return A.formatMessage({id:"unknownError"})}})();w(!1),y(!1),F.notify({level:"error",title:k,message:B})});return()=>{H.destroy()}},[P,A,F]),u.useEffect(()=>{if(!P){w(!1);return}return f&&(w(!0),P.startGeolocation().then(()=>{w(!1)})),()=>{P?.stopGeolocation(),w(!1)}},[P,f]);const R=()=>{M&&y(!f)};return a.jsx(Sn,{ref:s,label:I,icon:a.jsx(ki,{}),onClick:()=>R(),isActive:f,isLoading:E,isDisabled:!h,...l})});function Pi(t,e,s,n,o){const[i,r]=u.useState();return u.useEffect(()=>{if(!t)return;const c=new _i(t.olMap,s);return r(c),()=>{c.destroy(),r(void 0)}},[t,s]),u.useEffect(()=>{i?.setPositionFeatureStyle(n)},[i,n]),u.useEffect(()=>{i?.setAccuracyFeatureStyle(o)},[i,o]),u.useEffect(()=>{i?.setMaxZoom(e)},[i,e]),i}const Ai="@open-pioneer/measurement",Ii=ee.bind(void 0,Ai);class Ti{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,s){this.olMap=e,this.messages=s;const n=this.source=new is;this.layer=new os({source:n}),this.layer.setZIndex(rs),e.addLayer(this.layer);const o=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){re(o)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const s=xn(e);this.activeFeatureStyle=(n,...o)=>{const i=n?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return s(n,...o)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const s=e==="area"?"Polygon":"LineString",n=this.draw=new Dn({source:this.source,type:s,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let o,i;n.on("drawstart",r=>{o=this.measureTooltip=this.createMeasureTooltip();const c=this.sketch=r.feature;if(!c)return;let l;i=c.getGeometry()?.on("change",h=>{const f=h.target,y=this.olMap.getView().getProjection();let E="";f instanceof cs?(E=Ni(f,y,this.messages),l=f.getInteriorPoint().getCoordinates()||null):f instanceof ys&&(E=Oi(f,y,this.messages),l=f.getLastCoordinate()||null),o&&(o.element.innerHTML=E,l&&o?.overlay.setPosition(l))})}),n.on("drawend",()=>{if(o){const r=o.element.classList;r.remove("measurement-active-tooltip"),r.remove("printing-hide"),r.add("measurement-finished-tooltip"),o.overlay.setOffset([0,-7]),this.overlayTooltips.push(o),this.measureTooltip=o=void 0}this.sketch=void 0,i&&re(i)}),n.on("drawabort",()=>{o&&(o.destroy(),this.measureTooltip=o=void 0),this.sketch=void 0,i&&re(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const s=new ze({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n=this.olMap;return n.addOverlay(s),{overlay:s,element:e,destroy(){n.removeOverlay(s)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const s=new ze({element:e,offset:[15,0],positioning:"center-left"}),n=this.olMap;return n.addOverlay(s),{overlay:s,element:e,destroy(){n.removeOverlay(s)}}}handlePointerMove(e){if(e.dragging)return;const s=this.helpTooltip,n=Li(this.messages,this.sketch);s.element.textContent=n,s.overlay.setPosition(e.coordinate),s.element.classList.remove("hidden")}}function Li(t,e){if(e){const s=e.getGeometry();if(s instanceof cs||s instanceof ys)return t.getContinueMessage()}return t.getHelpMessage()}function Ni(t,e,s){const n=En(t,{projection:e});let o;return n>=1e6?o=`${s.formatNumber(n/1e6)} km<sup>2</sup>`:o=`${s.formatNumber(n)} m<sup>2</sup>`,o}function Oi(t,e,s){const n=Cn(t,{projection:e});let o;return n>=1e3?o=`${s.formatNumber(n/1e3)} km`:o=`${s.formatNumber(n)} m`,o}const Kr=t=>{const e=Ii(),{mapId:s,activeFeatureStyle:n,finishedFeatureStyle:o}=t,{containerProps:i}=U("measurement",t),[r,c]=u.useState("distance"),l=w=>e.formatMessage({id:w}),h=z(s),f=ji(h.map,e);u.useEffect(()=>{f?.setActiveFeatureStyle(n??Ri())},[f,n]),u.useEffect(()=>{f?.setFinishedFeatureStyle(o??Fi())},[f,o]),u.useEffect(()=>{if(f)return f.startMeasurement(r),()=>{f.stopMeasurement()}},[f,r]);function y(w){if(w==="distance"||w==="area")c(w);else throw new Error(`Unexpected measurement type: '${w}'.`)}function E(){f?.clearMeasurements()}return a.jsxs($,{...i,children:[a.jsx(ae,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),a.jsx(Ue,{mb:4,alignItems:"center",children:a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{mb:1,children:l("measurementLabel")}),a.jsxs(bt,{value:r,onChange:w=>y(w.target.value),className:"measurement-select",children:[a.jsx("option",{value:"distance",children:l("distance")}),a.jsx("option",{value:"area",children:l("area")})]})]})}),a.jsx(et,{padding:2,className:"measurement-delete-button",onClick:E,width:"100%",children:l("deleteMeasurementLabel")})]})};function ji(t,e){const[s,n]=u.useState(void 0);return u.useEffect(()=>{if(!t)return;const o=new Ti(t.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(i){return e.formatNumber(i,{maximumFractionDigits:2})}});return n(o),()=>{o.destroy(),n(void 0)}},[t,e]),s}function Ri(){return[new we({stroke:new ue({color:"#fff",lineDash:[10,10],width:5})}),new we({fill:new Ae({color:"rgba(0,0,0,0.15)"}),stroke:new ue({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new as({radius:5,stroke:new ue({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new Ae({color:"rgba(255, 255, 255, 0.2)"})})})]}function Fi(){return[new we({stroke:new ue({color:"#fff",width:5})}),new we({stroke:new ue({color:"#0b96fc",width:3}),fill:new Ae({color:"rgba(11,150,252,0.15)"})})]}const Vi="200px",Di="300px",Yr=t=>{const{mapId:e,olLayer:s,height:n=Vi,width:o=Di}=t,{containerProps:i}=U("overview-map",t),r=u.useRef(null),{map:c}=z(e);return u.useEffect(()=>{if(r.current&&c&&s){const l=c.olMap,h=new po({className:"ol-overviewmap",layers:[s],collapsible:!1,collapsed:!1,target:r.current});return l.addControl(h),()=>{l.removeControl(h)}}},[c,s]),a.jsx($,{height:n,width:o,ref:r,...i})},Bi="@open-pioneer/search",st=ee.bind(void 0,Bi);function Gi(t){const e=t.selectProps.inputValue.length>0,s={...t,className:Be(t.className,{"search-invisible":!e})};return a.jsx(te.Menu,{...s,children:t.children})}function $i(t){const s=st().formatMessage({id:"noOptionsText"});return a.jsx(te.NoOptionsMessage,{...t,children:a.jsx(W.span,{className:"search-no-match",children:s})})}function Hi(t){const s=st().formatMessage({id:"loadingText"});return a.jsx(te.LoadingMessage,{...t,children:a.jsx(W.span,{className:"search-loading-text",children:s})})}function Ui({children:t,...e}){const s={...e,className:Be(e.className,"search-value-container")};return a.jsxs(te.ValueContainer,{...s,children:[!!t&&a.jsx(Lo,{style:{position:"absolute",left:8}}),t]})}function zi(t){const e={...t,isHidden:!1};return a.jsx(te.Input,{...e})}function Wi(t){return null}function Ki(t){return a.jsxs(te.IndicatorsContainer,{...t,children:[t.children,!t.selectProps.isLoading&&t.selectProps.inputValue&&a.jsx(Yi,{selectProps:t.selectProps,clearValue:t.clearValue})]})}function Yi(t){const s=st().formatMessage({id:"ariaLabel.clearButton"}),n=o=>{o.preventDefault(),o.stopPropagation(),t.clearValue()};return a.jsx(Ln,{role:"button",size:"md",mr:1,"aria-label":s,onClick:n,onTouchEnd:n,onMouseDown:o=>o.preventDefault()})}function Zi(t){return null}function Xi(t){const e=t.selectProps.inputValue,s=t.data.label,n={...t,className:Be(t.className,"search-option")};return a.jsx(te.Option,{...n,children:a.jsx(W.div,{className:"search-option-label",children:e.trim().length>0?Ji(s,e):s})})}function Ji(t,e){const s=t.toLowerCase().indexOf(e.toLowerCase());return s>=0?a.jsxs(a.Fragment,{children:[t.substring(0,s),a.jsx(W.span,{className:"search-highlighted-match",children:t.substring(s,s+e.length)},"highlighted"),t.substring(s+e.length)]}):t}const Yt=he("search:SearchController"),Zt=200,Xt=5;var je,ve,be,ye,J,Je,Fs;class qi{constructor(e,s){T(this,Je);T(this,je,void 0);T(this,ve,[]);T(this,be,Xt);T(this,ye,Zt);T(this,J,void 0);L(this,je,e),L(this,ve,s)}destroy(){C(this,J)?.abort(),L(this,J,void 0)}async search(e){if(C(this,J)?.abort(),L(this,J,void 0),!e)return[];const s=L(this,J,new AbortController);try{return await Qi(s.signal,C(this,ye)),s.signal.aborted&&(Yt.debug(`search canceled with ${e}`),Nn()),(await Promise.all(C(this,ve).map(o=>D(this,Je,Fs).call(this,o,e,s.signal)))).filter(o=>o!=null)}finally{C(this,J)===s&&L(this,J,void 0)}}get searchTypingDelay(){return C(this,ye)}set searchTypingDelay(e){L(this,ye,e??Zt)}get maxResultsPerSource(){return C(this,be)}set maxResultsPerSource(e){L(this,be,e??Xt)}get sources(){return C(this,ve)}}je=new WeakMap,ve=new WeakMap,be=new WeakMap,ye=new WeakMap,J=new WeakMap,Je=new WeakSet,Fs=async function(e,s,n){const o=e.label,i=C(this,je).olMap.getView().getProjection();try{const r=C(this,be);let c=await e.search(s,{maxResults:r,signal:n,mapProjection:i});return c.length>r&&(c=c.slice(0,r)),{label:o,source:e,results:c}}catch(r){fs(r)||Yt.error(`search for source ${o} failed`,r);return}};async function Qi(t,e){t.aborted||await new Promise(s=>{const n=()=>{t.removeEventListener("abort",n),clearTimeout(o),s()};t.addEventListener("abort",n);const o=setTimeout(n,e)})}const Ke=he("search:Search"),Zr=t=>{const{mapId:e,sources:s,searchTypingDelay:n,maxResultsPerGroup:o,onSelect:i,onClear:r}=t,{containerProps:c}=U("search",t),{map:l}=z(e),h=st(),f=nr(s,n,o,l),{input:y,search:E,selectedOption:w,onInputChanged:M,onResultConfirmed:A}=or(f),F=sr(),P=er(h),I=tr(),R=Se((k,B)=>{B.action==="input-change"&&M(k)}),H=Se((k,B)=>{switch(B.action){case"select-option":k&&(A(k),i?.({source:k.source,result:k.result}));break;case"clear":M(""),K.current?.blur(),K.current?.focus(),r?.();break;default:Ke.debug(`Unhandled action type '${B.action}'.`);break}}),K=u.useRef(null);return a.jsx($,{...c,children:a.jsx(pt,{className:"search-component",classNamePrefix:"react-select",ref:K,inputValue:y,onInputChange:R,"aria-label":h.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:P,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:F,isClearable:!0,placeholder:h.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:E.kind==="loading",options:E.kind==="ready"?E.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:I,onChange:H,value:w,menuPosition:"fixed"})})};function er(t){return u.useMemo(()=>({onFocus:({focused:i})=>`${i.label} ${t.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:i,label:r})=>{let c="";switch(i){case"select-option":c=`${r} ${t.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":c=`${r} ${t.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return c},guidance:()=>`${t.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[t])}function tr(){return u.useMemo(()=>({Menu:Gi,Input:zi,SingleValue:Wi,Option:Xi,NoOptionsMessage:$i,LoadingMessage:Hi,ValueContainer:Ui,IndicatorsContainer:Ki,ClearIndicator:Zi}),[])}function sr(){const[t,e]=gs("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return u.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:t,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[t,e])}function nr(t,e,s,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!n)return;const r=new qi(n,t);return i(r),()=>{r.destroy(),i(void 0)}},[n,t]),u.useEffect(()=>{o&&(o.searchTypingDelay=e)},[o,e]),u.useEffect(()=>{o&&(o.maxResultsPerSource=s)},[o,s]),o}function or(t){const[e,s]=u.useReducer((c,l)=>{switch(l.kind){case"input":return{...c,query:l.query,selectedOption:null};case"select-option":return{...c,selectedOption:l.option,query:l.option.label};case"load-results":return{...c,search:{kind:"loading"}};case"accept-results":return{...c,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=u.useRef(),o=Se(c=>{if(!t){n.current=void 0,s({kind:"accept-results",results:[]});return}Ke.isDebug()&&Ke.debug(`Starting new search for query ${JSON.stringify(c)}.`),s({kind:"load-results"});const l=n.current=ir(t,c).then(h=>{n.current===l&&s({kind:"accept-results",results:h})})}),i=u.useCallback(c=>{s({kind:"select-option",option:c})},[]),r=u.useCallback(c=>{s({kind:"input",query:c}),o(c)},[o]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:i,onInputChanged:r}}async function ir(t,e){let s;try{s=await t.search(e)}catch(n){fs(n)||Ke.error("Search failed",n),s=[]}return rr(s)}function rr(t){return t.map((s,n)=>({label:s.label,options:s.results.map(o=>({value:`${n}-${o.id}`,label:o.label,source:s.source,result:o}))}))}const Vs="@open-pioneer/selection",ar=De.bind(void 0,Vs),Et=ee.bind(void 0,Vs),_e="selection-active",He="selection-inactive";class cr{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,s,n,o,i){let r;switch(s){case Ct.extent:default:r=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,i,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=o}initViewport(e){const s=e.getViewport();return s.classList.add(_e),s.oncontextmenu=n=>(n.preventDefault(),!1),s}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const s=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipMessage,s.classList.remove(He),s.classList.add(_e),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,s.classList.remove(_e),s.classList.add(He),this.isActive=!1)}createDragBox(e,s,n,o){const i=new Lt({className:"selection-drag-box",condition:kn});return e.addInteraction(i),i.on("boxend",function(){s(i.getGeometry())}),{interaction:i,destroy(){e.removeInteraction(i),o.splice(o.indexOf(this)),i.dispose(),n.classList.remove(_e),n.classList.remove(He),n.oncontextmenu=null}}}createDrag(e,s,n){const o=function(c){return c.originalEvent.button==2},i=new Nt({condition:o});return e.addInteraction(i),{interaction:i,destroy(){e.removeInteraction(i),n.splice(n.indexOf(this)),i.dispose(),s.classList.remove(_e),s.classList.remove(He),s.oncontextmenu=null}}}createHelpTooltip(e,s){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.textContent=s;const o=new ze({element:n,offset:[15,0],positioning:"center-left"}),i=e.on("pointermove",r=>{o.setPosition(r.coordinate)});return e.addOverlay(o),{overlay:o,element:n,destroy(){e.removeOverlay(o),o.dispose(),re(i)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Lt)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Nt)}}const dt=he("selection:SelectionController"),lr=1e4;var Re,Fe,Ve,qe,Ds;class ur{constructor(e){T(this,qe);T(this,Re,void 0);T(this,Fe,void 0);T(this,Ve,void 0);const{mapModel:s,onError:n,maxResults:o=lr}=e;L(this,Re,s),L(this,Fe,o),L(this,Ve,n)}destroy(){}async select(e,s){if(s)return await D(this,qe,Ds).call(this,e,s)}}Re=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,qe=new WeakSet,Ds=async function(e,s){const n=C(this,Re).olMap.getView().getProjection();try{dt.debug(`Starting selection on source '${e.label}'`);const o=C(this,Fe);let i=await e.select({type:"extent",extent:s},{maxResults:o,mapProjection:n,signal:new AbortController().signal});return i.length>o&&(i=i.slice(0,o)),dt.debug(`Found ${i.length} results on source '${e.label}'`),{source:e,results:i}}catch(o){dt.error(`selection from source ${e.label} failed`,o),C(this,Ve).call(this);return}};var Ct=(t=>(t.extent="EXTENT",t.polygon="POLYGON",t.free="FREEPOLYGON",t.circle="CIRCLE",t))(Ct||{});const Jt={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},Xr=t=>{const e=Et(),{mapId:s,sources:n,onSelectionComplete:o,onSelectionSourceChanged:i}=t,{containerProps:r}=U("selection",t),[c,l]=u.useState(()=>n.find(k=>(k.status??"available")==="available")),h=z(s),{onExtentSelected:f}=fr(h.map,n,c,o),y=mr(),w=u.useCallback(k=>{const B=[];if(k||(k=["EXTENT"]),k.forEach(d=>{Object.values(Ct).includes(d)&&B.push({label:e.formatMessage({id:d}),value:d})}),B.length===0)throw new Error("methods does not contain valid values");return B},[e])(void 0),[M,A]=u.useState(w[0]),F=Se(k=>{A(k)}),[P,I]=u.useState(!0);pr(h.map,M,e,f,P);const R=u.useMemo(()=>n.map(k=>({label:k.label,value:k})),[n]),H=u.useMemo(()=>R.find(k=>k.value===c),[R,c]),K=Se(k=>{l(k?.value),i&&i({source:k?.value})});return u.useEffect(()=>{if(!c){I(!1);return}const k=e.formatMessage({id:"sourceNotAvailable"}),B=()=>c&&vt(c,k).kind==="available";I(B());const d=c.on("changed:status",()=>{I(B())});return()=>d.destroy()},[c,I,e]),a.jsxs(ft,{...r,spacing:2,children:[w.length>1&&a.jsxs(Ue,{children:[a.jsx(Ie,{children:e.formatMessage({id:"selectMethod"})}),a.jsx(pt,{className:"selection-method react-select",...Jt,options:w,onChange:F,value:M,chakraStyles:y})]}),a.jsxs(Ue,{children:[a.jsx(Ie,{children:e.formatMessage({id:"selectSource"})}),a.jsx(pt,{className:"selection-source react-select",...Jt,options:R,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:H,onChange:K,components:{Option:dr,SingleValue:hr},isOptionDisabled:k=>k.value===void 0||k.value.status==="unavailable",getOptionLabel:k=>k.label+(k.value===void 0||k.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:y})]})]})};function dr(t){const{value:e}=t.data,{isAvailable:s,content:n}=Bs(e,!1);return a.jsx(te.Option,{...t,isDisabled:!s,className:"selection-source-option",children:n})}function hr(t){const{value:e}=t.data,{isAvailable:s,content:n}=Bs(e,!0),o=s?"selection-source-value":"selection-source-value selection-source-value--disabled";return a.jsx(te.SingleValue,{...t,isDisabled:!s,className:o,children:n})}function Bs(t,e){const s=t?.label,n=gr(t);return{isAvailable:n.kind==="available",content:a.jsxs(Pe,{direction:"row",alignItems:"center",grow:1,children:[!e&&a.jsx(Pe,{grow:1,children:s}),n.kind==="unavailable"&&a.jsx($,{ml:2,children:a.jsx(hs,{label:n.reason,placement:"right",openDelay:500,children:a.jsx(W.span,{children:a.jsx(On,{as:Un,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&s]})}}function fr(t,e,s,n){const o=ar("notifier.NotificationService"),i=Et(),[r,c]=u.useState(void 0);u.useEffect(()=>{if(!t)return;const h=new ur({mapModel:t,onError(){o.notify({level:"error",message:i.formatMessage({id:"selectionFailed"})})}});return c(h),()=>{h.destroy()}},[t,o,e,i]);const l=Se(async h=>{if(!r||!s)return;const f=await r.select(s,h.getExtent());f&&n?.(f)});return{controller:r,onExtentSelected:l}}function vt(t,e){const s=t.status??"available",n=typeof s=="string"?{kind:s}:s;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function gr(t){const e=Et(),[s,n]=u.useState(()=>({kind:"available"}));return u.useEffect(()=>{if(!t){n({kind:"available"});return}const o=e.formatMessage({id:"sourceNotAvailable"});n(vt(t,o));const i=t.on?.("changed:status",()=>{n(vt(t,o))});return()=>i?.destroy()},[t,e]),s}function pr(t,e,s,n,o){u.useEffect(()=>{if(!t)return;const i=new cr(t.olMap,e.value,s.formatMessage({id:"tooltip"}),s.formatMessage({id:"disabledTooltip"}),n);return i.setActive(o),()=>{i?.destroy()}},[t,e,s,n,o])}function mr(){const[t,e]=gs("colors",["background_body","border"],["#ffffff","#ffffff"]);return u.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:t})}),[t,e])}export{jr as C,Wr as G,Vr as L,Kr as M,Br as N,ze as O,Ur as P,Hr as S,Fr as V,Or as W,zr as a,Yr as b,Zr as c,Xr as d,Dr as e,Gr as f,$r as g,bt as h};
