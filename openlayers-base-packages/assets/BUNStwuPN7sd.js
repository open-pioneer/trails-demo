const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CCUPmKUZ3nLZ.js","./Dch09mLNbtBx.js","./Ce-AVgIhzRso.js","./BvAHHuMXFj46.js","./CmtdBmeX-HMU.js","./BLhFkVDrmwIT.js","./CMdsQMOq4OHS.js","./Dl7YmDbj-Q1S.js","./B08mBq1aakqC.js","./B-tq_vZfe4eI.js"])))=>i.map(i=>d[i]);
var Gn=Object.defineProperty;var Et=n=>{throw TypeError(n)};var Vn=(n,e,t)=>e in n?Gn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var _=(n,e,t)=>Vn(n,typeof e!="symbol"?e+"":e,t),tt=(n,e,t)=>e.has(n)||Et("Cannot "+t);var g=(n,e,t)=>(tt(n,e,"read from private field"),t?t.call(n):e.get(n)),C=(n,e,t)=>e.has(n)?Et("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),M=(n,e,t,s)=>(tt(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),v=(n,e,t)=>(tt(n,e,"access private method"),t);import{aE as Hn,b5 as Bn,b6 as Un,b7 as $n,b8 as qn,aP as Wn,aX as zn,b9 as Kn,ba as Jn,a0 as Yn,bb as Xn,b0 as Zn,h as B,bc as Qn,bd as es,be as ts,bf as qt,bg as ns,bh as ss,a as me,b as Xe,aL as He,bi as Mt,bj as ae,E as Pt,_ as q,bk as nt,a_ as Ce,an as Be,bl as je,bm as Lt,bn as H,m as N,bo as Q,bp as ot,bq as is,br as rs,x as os,bs as at,bt as as,bu as ls,bv as Wt,ao as zt,bw as cs,bx as us,by as It,bz as hs,bA as Ft,bB as ds,bC as Tt,bD as ft,a$ as gt,b1 as fs,d as pt,u as re,aZ as X,g as Z,B as j,bE as gs,b4 as Ze,bF as ps,am as Kt,bG as ms,bH as ys,c as Ue,ax as Se,F as lt,C as vs,bI as kt,bJ as _s,bK as Ot,i as At}from"./CmtdBmeX-HMU.js";import{u as Ss,m as xs,r as p,n as ws,h as mt,o as Jt,p as Yt,q as Xt,j as h,f as z,s as bs,t as Cs,c as Oe,b as Zt,B as Qt,C as Es,v as Ms,i as en,w as tn,l as Ps,I as Ls}from"./BvAHHuMXFj46.js";import{G as nn}from"./BFiWkJAEfH7M.js";import{a as Is}from"./C4rkSsuKOJw_.js";import{D as sn,S as Fs,I as Ts,c as ks,a as Os}from"./DbcU0-7QSx3L.js";import{u as Y}from"./BLhFkVDrmwIT.js";import{T as pe,L as As,V as Ns}from"./Dl7YmDbj-Q1S.js";import{c as rn}from"./CvnU78HXdo_G.js";import{L as on}from"./CmOg7nFw2haV.js";import{u as an,F as $e}from"./CMdsQMOq4OHS.js";import{F as qe}from"./JZHasUOow1wD.js";import{H as ct}from"./CZajoN890Ov3.js";import{F as U,r as ln}from"./Ce-AVgIhzRso.js";import{F as js}from"./B-tq_vZfe4eI.js";import{_ as Rs}from"./Dch09mLNbtBx.js";function Ds(n){const{theme:e}=Ss(),t=xs();return p.useMemo(()=>ws(e.direction,{...t,...n}),[n,e.direction,t])}var yt=mt(function(e,t){const{htmlSize:s,...i}=e,r=Jt("Input",i),o=Yt(i),l=an(o),a=Xt("chakra-input",e.className);return h.jsx(z.input,{size:s,...l,__css:r.field,ref:t,className:a})});yt.displayName="Input";yt.id="Input";var cn=mt(function(e,t){const{children:s,placeholder:i,className:r,...o}=e;return h.jsxs(z.select,{...o,ref:t,className:Xt("chakra-select",r),children:[i&&h.jsx("option",{value:"",children:i}),s]})});cn.displayName="SelectField";function Gs(n,e){const t={},s={};for(const[i,r]of Object.entries(n))e.includes(i)?t[i]=r:s[i]=r;return[t,s]}var vt=mt((n,e)=>{var t;const s=Jt("Select",n),{rootProps:i,placeholder:r,icon:o,color:l,height:a,h:c,minH:u,minHeight:d,iconColor:m,iconSize:f,...y}=Yt(n),[w,b]=Gs(y,Cs),O=an(b),$={width:"100%",height:"fit-content",position:"relative",color:l},D={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(t=s.field)==null?void 0:t._focus}};return h.jsxs(z.div,{className:"chakra-select__wrapper",__css:$,...w,...i,children:[h.jsx(cn,{ref:e,height:c??a,minH:u??d,placeholder:r,...O,__css:D,children:n.children}),h.jsx(un,{"data-disabled":bs(O.disabled),...(m||l)&&{color:m||l},__css:s.icon,...f&&{fontSize:f},children:o})]})});vt.displayName="Select";var Vs=n=>h.jsx("svg",{viewBox:"0 0 24 24",...n,children:h.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Hs=z("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),un=n=>{const{children:e=h.jsx(Vs,{}),...t}=n,s=p.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return h.jsx(Hs,{...t,className:"chakra-select__icon-wrapper",children:p.isValidElement(e)?s:null})};un.displayName="SelectIcon";const I={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class We extends Hn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Bn,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(I.ELEMENT,this.handleElementChanged),this.addChangeListener(I.MAP,this.handleMapChanged),this.addChangeListener(I.OFFSET,this.handleOffsetChanged),this.addChangeListener(I.POSITION,this.handlePositionChanged),this.addChangeListener(I.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(I.ELEMENT)}getId(){return this.id}getMap(){return this.get(I.MAP)||null}getOffset(){return this.get(I.OFFSET)}getPosition(){return this.get(I.POSITION)}getPositioning(){return this.get(I.POSITIONING)}handleElementChanged(){Un(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&($n(this.element),qn(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Wn(e,zn.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(I.ELEMENT,e)}setMap(e){this.set(I.MAP,e)}setOffset(e){this.set(I.OFFSET,e)}setPosition(e){this.set(I.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(I.POSITION))return;const s=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[Kn(i),Jn(i)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!Yn(s,r)){const l=r[0]-s[0],a=s[2]-r[2],c=r[1]-s[1],u=s[3]-r[3],d=[0,0];if(l<0?d[0]=l-o:a<0&&(d[0]=Math.abs(a)+o),c<0?d[1]=c-o:u<0&&(d[1]=Math.abs(u)+o),d[0]!==0||d[1]!==0){const m=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(m);if(!f)return;const y=[f[0]+d[0],f[1]+d[1]],w=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(y),duration:w.duration,easing:w.easing})}}}getRect(e,t){const s=e.getBoundingClientRect(),i=s.left+window.pageXOffset,r=s.top+window.pageYOffset;return[i,r,i+t[0],r+t[1]]}setPositioning(e){this.set(I.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const s=e.getPixelFromCoordinate(t),i=e.getSize();this.updateRenderedPosition(s,i)}updateRenderedPosition(e,t){const s=this.element.style,i=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+i[0])+"px",l=Math.round(e[1]+i[1])+"px";let a="0%",c="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?a="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(a="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?c="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(c="-50%");const u=`translate(${a}, ${c}) translate(${o}, ${l})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,s.transform=u)}getOptions(){return this.options}}const po=Xn,Bs=25.4/.28,Us=39.37;function _t(n){return St(n,$s,qs)}function $s(n){return n.getView()}function qs(n,e){return n.on("change:view",e)}function hn(n){return _t(n)?.getProjection()}function Ws(n){const e=_t(n);return St(e,zs,Ks)}function zs(n){return n.getResolution()}function Ks(n,e){return n.on("change:resolution",e)}function Js(n){const e=_t(n);return St(e,Ys,Xs)}function Ys(n){return n.getCenter()}function Xs(n,e){return n.on("change:center",e)}function Zs(n){const e=Js(n),t=Ws(n),s=hn(n);return p.useMemo(()=>{if(s==null||t==null||e==null)return;const r=Zn(s,t,e);return Math.round(r*Us*Bs)},[s,t,e])}function St(n,e,t){const s=p.useCallback(()=>n?e(n):void 0,[n,e]),i=p.useCallback(r=>{if(!n)return()=>{};const o=t(n,r);return()=>B(o)},[n,t]);return p.useSyncExternalStore(i,s)}var Qs=Symbol.for("preact-signals");function Qe(){if(J>1)J--;else{for(var n,e=!1;xe!==void 0;){var t=xe;for(xe=void 0,ut++;t!==void 0;){var s=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&fn(t))try{t.c()}catch(i){e||(n=i,e=!0)}t=s}}if(ut=0,J--,e)throw n}}function ei(n){if(J>0)return n();J++;try{return n()}finally{Qe()}}var x=void 0;function xt(n){var e=x;x=void 0;try{return n()}finally{x=e}}var xe=void 0,J=0,ut=0,ze=0;function dn(n){if(x!==void 0){var e=n.n;if(e===void 0||e.t!==x)return e={i:0,S:n,p:x.s,n:void 0,t:x,e:void 0,x:void 0,r:e},x.s!==void 0&&(x.s.n=e),x.s=e,n.n=e,32&x.f&&n.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=x.s,e.n=void 0,x.s.n=e,x.s=e),e}}function T(n){this.v=n,this.i=0,this.n=void 0,this.t=void 0}T.prototype.brand=Qs;T.prototype.h=function(){return!0};T.prototype.S=function(n){this.t!==n&&n.e===void 0&&(n.x=this.t,this.t!==void 0&&(this.t.e=n),this.t=n)};T.prototype.U=function(n){if(this.t!==void 0){var e=n.e,t=n.x;e!==void 0&&(e.x=t,n.e=void 0),t!==void 0&&(t.e=e,n.x=void 0),n===this.t&&(this.t=t)}};T.prototype.subscribe=function(n){var e=this;return vn(function(){var t=e.value,s=x;x=void 0;try{n(t)}finally{x=s}})};T.prototype.valueOf=function(){return this.value};T.prototype.toString=function(){return this.value+""};T.prototype.toJSON=function(){return this.value};T.prototype.peek=function(){var n=x;x=void 0;try{return this.value}finally{x=n}};Object.defineProperty(T.prototype,"value",{get:function(){var n=dn(this);return n!==void 0&&(n.i=this.i),this.v},set:function(n){if(n!==this.v){if(ut>100)throw new Error("Cycle detected");this.v=n,this.i++,ze++,J++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Qe()}}}});function ti(n){return new T(n)}function fn(n){for(var e=n.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function gn(n){for(var e=n.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){n.s=e;break}}}function pn(n){for(var e=n.s,t=void 0;e!==void 0;){var s=e.p;e.i===-1?(e.S.U(e),s!==void 0&&(s.n=e.n),e.n!==void 0&&(e.n.p=s)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=s}n.s=t}function ye(n){T.call(this,void 0),this.x=n,this.s=void 0,this.g=ze-1,this.f=4}(ye.prototype=new T).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===ze))return!0;if(this.g=ze,this.f|=1,this.i>0&&!fn(this))return this.f&=-2,!0;var n=x;try{gn(this),x=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return x=n,pn(this),this.f&=-2,!0};ye.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}T.prototype.S.call(this,n)};ye.prototype.U=function(n){if(this.t!==void 0&&(T.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};ye.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var n=this.t;n!==void 0;n=n.x)n.t.N()}};Object.defineProperty(ye.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var n=dn(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}});function mn(n){return new ye(n)}function yn(n){var e=n.u;if(n.u=void 0,typeof e=="function"){J++;var t=x;x=void 0;try{e()}catch(s){throw n.f&=-2,n.f|=8,wt(n),s}finally{x=t,Qe()}}}function wt(n){for(var e=n.s;e!==void 0;e=e.n)e.S.U(e);n.x=void 0,n.s=void 0,yn(n)}function ni(n){if(x!==this)throw new Error("Out-of-order effect");pn(this),x=n,this.f&=-2,8&this.f&&wt(this),Qe()}function Ae(n){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Ae.prototype.c=function(){var n=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{n()}};Ae.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,yn(this),gn(this),J++;var n=x;return x=this,ni.bind(this,n)};Ae.prototype.N=function(){2&this.f||(this.f|=2,this.o=xe,xe=this)};Ae.prototype.d=function(){this.f|=8,1&this.f||wt(this)};function vn(n){var e=new Ae(n);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}function se(n,e){return new ri(n,e?.equal)}function si(n,e){return new ii(n,e?.equal)}function mo(n){return ei(n)}function bt(n){return xt(n)}var oe=Symbol("signal"),we=Symbol("equals"),_n=class{[oe];constructor(n){this[oe]=n}get value(){return this[oe].value}set value(n){throw new Error("Cannot update a readonly reactive object.")}trigger(){throw new Error("Cannot trigger this reactive object.")}peek(){return this[oe].peek()}toJSON(){return this.value}toString(){return`Reactive[value=${ai(this[oe].value)}]`}},ii=class extends _n{[we];constructor(n,e){const t=mn(e?oi(n,e):n);super(t),this[we]=e}},ri=class extends _n{[we];constructor(n,e){super(ti(n)),this[we]=e}get value(){return super.value}set value(n){xt(()=>this[we]?.(this.value,n))||(this[oe].value=n)}};function oi(n,e){let t=!0,s;return function(){const r=n();return xt(()=>((t||!e(s,r))&&(s=r,t=!1),s))}}function ai(n){return typeof n=="string"?JSON.stringify(n):String(n)}function li(n,e){return n===e?!0:n.length===e.length&&n.every((t,s)=>t===e[s])}function ci(n,e,t,s){const i=mn(e),r=s?.immediate??!1;let o,l;function a(){const d=l;l=void 0;try{d?.()}catch(m){throw u.destroy(),m}}const c=n(()=>{const d=i.value;bt(()=>{const m=!o&&r||o&&!li(o,d);o=d,m&&(a(),l=t(d))})}),u={destroy(){try{a()}finally{c.destroy()}}};return u}function ui(n){return{destroy:vn(n)}}function hi(n,e){let t=0,s=!0,i;return i=ui(()=>{const r=t++;if(r===0)return n();r===1&&bt(()=>{try{e()}finally{s?Promise.resolve().then(()=>i?.destroy()):i?.destroy()}})}),s=!1,i}function Sn(n){Promise.reject(new Error("Error in effect or watch callback",{cause:n}))}var di=class{queue=[];channel=new MessageChannel;constructor(){this.channel.port2.start()}enqueue(n){const e={fn:n,destroyed:!1};return this.queue.push(e),this.queue.length===1&&this.scheduleIteration(),{destroy(){e.destroyed||(e.destroyed=!0)}}}messageHandler=()=>this.runIteration();scheduleIteration(){const n=this.channel;n.port2.addEventListener("message",this.messageHandler),n.port1.postMessage("")}runIteration(){this.channel.port2.removeEventListener("message",this.messageHandler);const n=this.queue;this.queue=[];for(const e of n)if(!e.destroyed)try{e.fn()}catch(t){Sn(t)}}};function fi(n){const e=new gi(n);return{destroy:e.destroy.bind(e)}}var gi=class{callback;cleanup;effectHandle;scheduledExecution;isDestroyed=!1;initialExecution=!0;isExecuting=!1;constructor(n){this.callback=n,this.execute(),this.initialExecution=!1}destroy(){if(!this.isDestroyed){this.isDestroyed=!0;try{this.triggerCleanup()}finally{this.effectHandle?.destroy(),this.effectHandle=void 0,this.scheduledExecution?.destroy(),this.scheduledExecution=void 0}}}execute(){this.isExecuting=!0;try{const n=hi(()=>{if(this.initialExecution)this.triggerCallback();else try{this.triggerCallback()}catch(e){Sn(e)}},()=>this.scheduleExecution());this.isDestroyed?n.destroy():this.effectHandle=n}finally{this.isExecuting=!1}}triggerCallback(){this.triggerCleanup(),this.isDestroyed||(this.cleanup=this.callback())}triggerCleanup(){const n=this.cleanup;this.cleanup=void 0;try{n&&bt(n)}catch(e){throw this.destroy(),e}}scheduleExecution(){if(!this.isDestroyed){if(this.effectHandle?.destroy(),this.effectHandle=void 0,this.isExecuting)throw new Error("Cycle detected");this.scheduledExecution||(this.scheduledExecution=yi(()=>{try{this.execute()}finally{this.scheduledExecution=void 0}}))}}};function pi(n,e,t){return ci(fi,n,e,t)}var mi=new di;function yi(n){return mi.enqueue(n)}function yo(n){return new vi(n)}var F,ce,L,ee,Ge,xn,wn,$t,vi=($t=class{constructor(n){C(this,L);C(this,F,new Map);C(this,ce,se(!1));if(n)for(const[e,t]of n)g(this,F).set(e,se(t))}get size(){return v(this,L,ee).call(this),g(this,F).size}entries(){return v(this,L,ee).call(this),v(this,L,xn).call(this)}keys(){return v(this,L,ee).call(this),g(this,F).keys()}values(){return v(this,L,ee).call(this),v(this,L,wn).call(this)}[Symbol.iterator](){return this.entries()}clear(){const n=!!g(this,F).size;g(this,F).clear(),n&&v(this,L,Ge).call(this)}delete(n){const e=g(this,F).delete(n);return e&&v(this,L,Ge).call(this),e}get(n){return v(this,L,ee).call(this),g(this,F).get(n)?.value}has(n){return v(this,L,ee).call(this),g(this,F).has(n)}set(n,e){const t=g(this,F).get(n);return t?t.value=e:(g(this,F).set(n,se(e)),v(this,L,Ge).call(this)),this}},F=new WeakMap,ce=new WeakMap,L=new WeakSet,ee=function(){g(this,ce).value},Ge=function(){g(this,ce).value=!g(this,ce).peek()},xn=function*(){const n=g(this,F).entries();for(const[e,t]of n)yield[e,t.value]},wn=function*(){const n=g(this,F).values();for(const e of n)yield e.value},$t);function ve(n){return new _i(n)}var E,ue,S,te,Ve,bn,Cn,R,ne,he,_i=(he=class{constructor(e){C(this,S);C(this,E);C(this,ue,se(!1));M(this,E,e?Array.from(e).map(t=>se(t)):[])}get length(){return v(this,S,R).call(this),g(this,E).length}push(...e){g(this,E).push(...e.map(t=>se(t))),v(this,S,ne).call(this)}pop(){if(g(this,E).length===0)return;const e=g(this,E).pop();return v(this,S,ne).call(this),e.value}unshift(...e){g(this,E).unshift(...e.map(t=>se(t))),v(this,S,ne).call(this)}shift(){if(g(this,E).length===0)return;const e=g(this,E).shift();return v(this,S,ne).call(this),e.value}splice(...e){const t=e[2],s=g(this,E).splice(...e);return(t!=null&&t.length!==0||s.length!==0)&&v(this,S,ne).call(this),s.map(i=>i.value)}sort(e){g(this,E).sort((t,s)=>e(t.value,s.value)),v(this,S,ne).call(this)}getItems(){return v(this,S,R).call(this),g(this,E).map(e=>e.value)}at(e){return v(this,S,R).call(this),g(this,E).at(e)?.value}get(e){return v(this,S,R).call(this),g(this,E)[e]?.value}set(e,t){if(e<0||e>=g(this,E).length)throw new Error("index out of bounds");const s=g(this,E)[e];s.value=t}slice(...e){v(this,S,R).call(this);const t=g(this,E).slice(...e).map(s=>s.value);return ve(t)}concat(...e){const t=this.getItems().concat(...e.map(s=>s instanceof he?s.getItems():s));return ve(t)}includes(e,t){return v(this,S,te).call(this,s=>s===e,t)!==-1}indexOf(e,t){return v(this,S,te).call(this,s=>s===e,t)}lastIndexOf(e){return v(this,S,Ve).call(this,t=>t===e)}find(e){const t=v(this,S,te).call(this,e);return this.get(t)}findLast(e){const t=v(this,S,Ve).call(this,e);return this.get(t)}findIndex(e){return v(this,S,te).call(this,e)}findLastIndex(e){return v(this,S,Ve).call(this,e)}some(e){return v(this,S,te).call(this,e)!==-1}every(e){return v(this,S,te).call(this,(t,s)=>!e(t,s))===-1}forEach(e){for(const[t,s]of this.entries())e(s,t)}filter(e){return ve(this.getItems().filter((t,s)=>e(t,s)))}map(e){return ve(this.getItems().map((t,s)=>e(t,s)))}flatMap(e){return ve(this.getItems().flatMap((t,s)=>e(t,s)))}reduce(e,...t){return v(this,S,R).call(this),g(this,E).reduce((s,i,r)=>e(s,i.value,r),...t)}reduceRight(e,...t){return v(this,S,R).call(this),g(this,E).reduceRight((s,i,r)=>e(s,i.value,r),...t)}keys(){return v(this,S,R).call(this),g(this,E).keys()}values(){return v(this,S,R).call(this),v(this,S,bn).call(this)}entries(){return v(this,S,R).call(this),v(this,S,Cn).call(this)}[Symbol.iterator](){return this.values()}},E=new WeakMap,ue=new WeakMap,S=new WeakSet,te=function(e,t){for(let s=t??0,i=this.length;s<i;++s){const r=this.get(s);if(e(r,s))return s}return-1},Ve=function(e){for(let t=this.length;t-- >0;){const s=this.get(t);if(e(s,t))return t}return-1},bn=function*(){for(const e of g(this,E))yield e.value},Cn=function*(){for(const[e,t]of g(this,E).entries())yield[e,t.value]},R=function(){g(this,ue).value},ne=function(){g(this,ue).value=!g(this,ue).peek()},he);const Nt=0,be=1,jt=[0,0,0,0],le=[],st={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class it extends zt{constructor(e,t,s){super(e),this.features=t,this.mapBrowserEvent=s}}class Si extends Qn{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:es,this.defaultDeleteCondition_=function(s){return ts(s)&&qt(s)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ns,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ss,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new me({source:new Xe({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:wi(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new He(this.source_.getFeatures()),this.source_.addEventListener(Mt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Mt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ae.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ae.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const i=this.SEGMENT_WRITERS_[t.getType()];i&&i(e,t)}const s=this.getMap();s&&s.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,s),e.addEventListener(Pt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new He;const s=this.featuresBeingModified_.getArray();for(let i=0,r=t.length;i<r;++i){const o=t[i];for(let l=0,a=o.length;l<a;++l){const c=o[l].feature;c&&!s.includes(c)&&this.featuresBeingModified_.push(c)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new it(st.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Pt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,s=[];t.forEach(function(i){e===i.feature&&s.push(i)});for(let i=s.length-1;i>=0;--i){const r=s[i];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const s=t.getCoordinates(),i={feature:e,geometry:t,segment:[s,s]};this.rBush_.insert(t.getExtent(),i)}writeMultiPointGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i],l={feature:e,geometry:t,depth:[i],index:i,segment:[o,o]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length-1;i<r;++i){const o=s.slice(i,i+2),l={feature:e,geometry:t,index:i,segment:o};this.rBush_.insert(q(o),l)}}writeMultiLineStringGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i];for(let l=0,a=o.length-1;l<a;++l){const c=o.slice(l,l+2),u={feature:e,geometry:t,depth:[i],index:l,segment:c};this.rBush_.insert(q(c),u)}}}writePolygonGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i];for(let l=0,a=o.length-1;l<a;++l){const c=o.slice(l,l+2),u={feature:e,geometry:t,depth:[i],index:l,segment:c};this.rBush_.insert(q(c),u)}}}writeMultiPolygonGeometry_(e,t){const s=t.getCoordinates();for(let i=0,r=s.length;i<r;++i){const o=s[i];for(let l=0,a=o.length;l<a;++l){const c=o[l];for(let u=0,d=c.length-1;u<d;++u){const m=c.slice(u,u+2),f={feature:e,geometry:t,depth:[l,i],index:u,segment:m};this.rBush_.insert(q(m),f)}}}}writeCircleGeometry_(e,t){const s=t.getCenter(),i={feature:e,geometry:t,index:Nt,segment:[s,s]},r={feature:e,geometry:t,index:be,segment:[s,s]},o=[i,r];i.featureSegments=o,r.featureSegments=o,this.rBush_.insert(nt(s),i);let l=t;this.rBush_.insert(l.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const s=t.getGeometriesArray();for(let i=0;i<s.length;++i){const r=s[i],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,s){let i=this.vertexFeature_;return i?i.getGeometry().setCoordinates(e):(i=new Ce(new Be(e)),this.vertexFeature_=i,this.overlay_.getSource().addFeature(i)),i.set("features",t),i.set("geometries",s),i}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==je.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=je.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==je.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],s=[],i=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const l=this.dragSegments_[r],a=l[0],c=a.feature;s.includes(c)||s.push(c);const u=a.geometry;i.includes(u)||i.push(u);const d=a.depth;let m;const f=a.segment,y=l[1];for(;t.length<u.getStride();)t.push(f[y][t.length]);switch(u.getType()){case"Point":m=t,f[0]=t,f[1]=t;break;case"MultiPoint":m=u.getCoordinates(),m[a.index]=t,f[0]=t,f[1]=t;break;case"LineString":m=u.getCoordinates(),m[a.index+y]=t,f[y]=t;break;case"MultiLineString":m=u.getCoordinates(),m[d[0]][a.index+y]=t,f[y]=t;break;case"Polygon":m=u.getCoordinates(),m[d[0]][a.index+y]=t,f[y]=t;break;case"MultiPolygon":m=u.getCoordinates(),m[d[1]][d[0]][a.index+y]=t,f[y]=t;break;case"Circle":if(f[0]=t,f[1]=t,a.index===Nt)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let w=Lt(H(u.getCenter()),H(t));u.setRadius(w),this.changingFeature_=!1}break}m&&this.setGeometryCoordinates_(u,m)}this.createOrUpdateVertexFeature_(t,s,i)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const s=this.vertexFeature_;if(s){e.map.getView().getProjection();const i=[],r=s.getGeometry().getCoordinates(),o=q([r]),l=this.rBush_.getInExtent(o),a={};l.sort(xi);for(let c=0,u=l.length;c<u;++c){const d=l[c],m=d.segment;let f=N(d.geometry);const y=d.depth;if(y&&(f+="-"+y.join("-")),a[f]||(a[f]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===be){const w=Dt(t,d);Q(w,r)&&!a[f][0]&&(this.dragSegments_.push([d,0]),a[f][0]=d);continue}if(Q(m[0],r)&&!a[f][0]){this.dragSegments_.push([d,0]),a[f][0]=d;continue}if(Q(m[1],r)&&!a[f][1]){if(a[f][0]&&a[f][0].index===0){let w=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":w=w[y[1]];case"Polygon":if(d.index!==w[y[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),a[f][1]=d;continue}N(m)in this.vertexSegments_&&!a[f][0]&&!a[f][1]&&this.insertVertexCondition_(e)&&i.push(d)}i.length&&this.willModifyFeatures_(e,[i]);for(let c=i.length-1;c>=0;--c)this.insertVertex_(i[c],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const s=this.dragSegments_[t][0],i=s.geometry;if(i.getType()==="Circle"){const r=i.getCenter(),o=s.featureSegments[0],l=s.featureSegments[1];o.segment[0]=r,o.segment[1]=r,l.segment[0]=r,l.segment[1]=r,this.rBush_.update(nt(r),o);let a=i;this.rBush_.update(a.getExtent(),l)}else this.rBush_.update(q(s.segment),s)}return this.featuresBeingModified_&&(this.dispatchEvent(new it(st.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,s){const i=s||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(a,c){return Rt(i,a)-Rt(i,c)};let o,l;if(this.hitDetection_){const a=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(c,u,d)=>{d&&d.getType()==="Point"&&(d=new Be(ot(d.getCoordinates())));const m=d||c.getGeometry();if(c instanceof Ce&&this.features_.getArray().includes(c)){l=m;const f=c.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:c,geometry:l,segment:[f,f]}]}return!0},{layerFilter:a})}if(!o){const a=is(nt(i,jt)),c=t.getView().getResolution()*this.pixelTolerance_,u=rs(os(a,c,jt));o=this.rBush_.getInExtent(u)}if(o&&o.length>0){const a=o.sort(r)[0],c=a.segment;let u=Dt(i,a);const d=t.getPixelFromCoordinate(u);let m=Lt(e,d);if(l||m<=this.pixelTolerance_){const f={};if(f[N(c)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-i[0],this.delta_[1]=u[1]-i[1]),a.geometry.getType()==="Circle"&&a.index===be)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[a.feature],[a.geometry]);else{const y=t.getPixelFromCoordinate(c[0]),w=t.getPixelFromCoordinate(c[1]),b=at(d,y),O=at(d,w);m=Math.sqrt(Math.min(b,O)),this.snappedToVertex_=m<=this.pixelTolerance_,this.snappedToVertex_&&(u=b>O?c[1]:c[0]),this.createOrUpdateVertexFeature_(u,[a.feature],[a.geometry]);const $={};$[N(a.geometry)]=!0;for(let D=1,P=o.length;D<P;++D){const k=o[D].segment;if(Q(c[0],k[0])&&Q(c[1],k[1])||Q(c[0],k[1])&&Q(c[1],k[0])){const A=N(o[D].geometry);A in $||($[A]=!0,f[N(k)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const s=e.segment,i=e.feature,r=e.geometry,o=e.depth,l=e.index;let a;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":a=r.getCoordinates(),a[o[0]].splice(l+1,0,t);break;case"Polygon":a=r.getCoordinates(),a[o[0]].splice(l+1,0,t);break;case"MultiPolygon":a=r.getCoordinates(),a[o[1]][o[0]].splice(l+1,0,t);break;case"LineString":a=r.getCoordinates(),a.splice(l+1,0,t);break;default:return}this.setGeometryCoordinates_(r,a);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(r,l,o,1);const u={segment:[s[0],t],feature:i,geometry:r,depth:o,index:l};c.insert(q(u.segment),u),this.dragSegments_.push([u,1]);const d={segment:[t,s[1]],feature:i,geometry:r,depth:o,index:l+1};c.insert(q(d.segment),d),this.dragSegments_.push([d,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=je.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new it(st.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let s=!1,i,r,o,l,a,c,u,d,m,f,y;for(a=e.length-1;a>=0;--a)o=e[a],f=o[0],y=N(f.feature),f.depth&&(y+="-"+f.depth.join("-")),y in t||(t[y]={}),o[1]===0?(t[y].right=f,t[y].index=f.index):o[1]==1&&(t[y].left=f,t[y].index=f.index+1);for(y in t){switch(m=t[y].right,u=t[y].left,c=t[y].index,d=c-1,u!==void 0?f=u:f=m,d<0&&(d=0),l=f.geometry,r=l.getCoordinates(),i=r,s=!1,l.getType()){case"MultiLineString":r[f.depth[0]].length>2&&(r[f.depth[0]].splice(c,1),s=!0);break;case"LineString":r.length>2&&(r.splice(c,1),s=!0);break;case"MultiPolygon":i=i[f.depth[1]];case"Polygon":i=i[f.depth[0]],i.length>4&&(c==i.length-1&&(c=0),i.splice(c,1),s=!0,c===0&&(i.pop(),i.push(i[0]),d=i.length-1));break}if(s){this.setGeometryCoordinates_(l,r);const w=[];if(u!==void 0&&(this.rBush_.remove(u),w.push(u.segment[0])),m!==void 0&&(this.rBush_.remove(m),w.push(m.segment[1])),u!==void 0&&m!==void 0){const b={depth:f.depth,feature:f.feature,geometry:f.geometry,index:d,segment:w};this.rBush_.insert(q(b.segment),b)}this.updateSegmentIndices_(l,c,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return s}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,s,i){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(s===void 0||r.depth===void 0||as(r.depth,s))&&r.index>t&&(r.index+=i)})}}function xi(n,e){return n.index-e.index}function Rt(n,e,t){const s=e.geometry;if(s.getType()==="Circle"){let r=s;if(e.index===be){const o=at(r.getCenter(),H(n)),l=Math.sqrt(o)-r.getRadius();return l*l}}const i=H(n);return le[0]=H(e.segment[0]),le[1]=H(e.segment[1]),cs(i,le)}function Dt(n,e,t){const s=e.geometry;if(s.getType()==="Circle"&&e.index===be)return ot(s.getClosestPoint(H(n)));const i=H(n);return le[0]=H(e.segment[0]),le[1]=H(e.segment[1]),ot(ls(i,le))}function wi(){const n=Wt();return function(e,t){return n.Point}}const bi={SELECT:"select"};class Ci extends zt{constructor(e,t,s,i){super(e),this.selected=t,this.deselected=s,this.mapBrowserEvent=i}}const Re={};class En extends us{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:qt,this.addCondition_=e.addCondition?e.addCondition:It,this.removeCondition_=e.removeCondition?e.removeCondition:It,this.toggleCondition_=e.toggleCondition?e.toggleCondition:hs,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:Ft,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:Ei(),this.features_=e.features||new He;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const s=e.layers;t=function(i){return s.includes(i)}}else t=Ft;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[N(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[N(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(ae.ADD,this.boundAddFeature_),this.features_.addEventListener(ae.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(ae.ADD,this.boundAddFeature_),this.features_.removeEventListener(ae.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const s=this.getMap().getAllLayers().find(function(i){if(i instanceof me&&i.getSource()&&i.getSource().hasFeature(t))return i});s&&this.addFeatureLayerAssociation_(t,s)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=N(e);t in Re||(Re[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let i=t.length-1;i>=0;--i){const r=t[i];if(r!==this&&r instanceof En&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const s=N(e);e.setStyle(Re[s]),delete Re[s]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[N(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),s=this.removeCondition_(e),i=this.toggleCondition_(e),r=!t&&!s&&!i,o=e.map,l=this.getFeatures(),a=[],c=[];if(r){ds(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(u,d)=>{if(!(!(u instanceof Ce)||!this.filter_(u,d)))return this.addFeatureLayerAssociation_(u,d),c.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=l.getLength()-1;u>=0;--u){const d=l.item(u),m=c.indexOf(d);m>-1?c.splice(m,1):(l.remove(d),a.push(d))}c.length!==0&&l.extend(c)}else{o.forEachFeatureAtPixel(e.pixel,(u,d)=>{if(!(!(u instanceof Ce)||!this.filter_(u,d)))return(t||i)&&!l.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,d),c.push(u)):(s||i)&&l.getArray().includes(u)&&(a.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=a.length-1;u>=0;--u)l.remove(a[u]);l.extend(c)}return(c.length>0||a.length>0)&&this.dispatchEvent(new Ci(bi.SELECT,c,a,e)),!0}}function Ei(){const n=Wt();return Tt(n.Polygon,n.LineString),Tt(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}async function Mi(n,e,t,s){const r=s.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),o=await n.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${r}>`}});if(!o||!o.ok||o.status!==201)throw new Error("Request failed: "+o.status);const l=o.headers.get("location");if(!l)throw new Error("Request failed: no Location response header");const a=l.substring(l.lastIndexOf("/")+1);return Promise.resolve(a)}async function Pi(n,e,t,s,i){const o=i.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),l=new URL(`${e.toString()}/${t}`),a=await n.fetch(l,{method:"PATCH",body:JSON.stringify({type:"Feature",properties:{},geometry:s}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${o}>`}});if(!a||!a.ok||a.status!==204)throw new Error("Request failed: "+a.status);return Promise.resolve(t)}function Mn(n,e){const t=document.createElement("div");t.className="editing-tooltip editing-tooltip-hidden",t.role="tooltip";const s=document.createElement("span");s.textContent=e,t.appendChild(s);const i=new We({element:t,offset:[15,0],positioning:"center-left"}),r=n.on("pointermove",o=>{o.dragging||i.setPosition(o.coordinate)});return n.addOverlay(i),{destroy(){B(r),n.removeOverlay(i)},setVisible(o){t.classList.toggle("editing-tooltip-hidden",!o)},setText(o){s.textContent=o}}}function Pn(n){let e=Gt(n.polygon);Array.isArray(e)&&(e=e[0]);let t=Gt(n.vertex);Array.isArray(t)&&(t=t[0]);const s=[];return e&&s.push(e),t&&(t.setGeometry(Li),s.push(t)),s}const Li=n=>{if(n){const e=n.getGeometry();if(e&&e.getType()==="Polygon"){const t=e.getCoordinates()[0];if(t)return new Is(t)}}},Gt=n=>{const e=new Ce,s=new me({style:n}).getStyleFunction();if(!s)throw new Error("can't retrieve style function");const i=s(e,1);if(!i)throw new Error("can't retrieve styles from feature style function");return Array.isArray(i)&&i.length?i.length>1?i:i[0]:i},Ii=Oe("editing:EditingCreateWorkflowImpl");var W;class Fi extends ft{constructor(t){super();C(this,W);_(this,"_httpService");_(this,"_intl");_(this,"_map");_(this,"_polygonStyle");_(this,"_vertexStyle");_(this,"_state");_(this,"_editLayerURL");_(this,"_featureId");_(this,"_editingSource");_(this,"_editingLayer");_(this,"_drawInteraction");_(this,"_olMap");_(this,"_mapContainer");_(this,"_tooltip");_(this,"_enterHandler");_(this,"_escapeHandler");_(this,"_error");_(this,"_interactionListener");_(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._editingSource=new Xe,this._editingLayer=new me({source:this._editingSource,zIndex:gt,properties:{name:"editing-layer"}}),this._drawInteraction=new sn({source:this._editingSource,type:"Polygon",style:Pn({polygon:this._polygonStyle,vertex:this._vertexStyle})}),this._tooltip=Mn(this._olMap,this._intl.formatMessage({id:"create.tooltip.begin"})),this._enterHandler=s=>{if((s.code==="Enter"||s.code==="NumpadEnter")&&s.target===this._olMap.getTargetElement()){const i=this._drawInteraction.getOverlay().getSource()?.getFeatures()??[];i[0]&&i[0].getGeometry().getCoordinates()[0].length>4&&this.triggerSave()}},this._escapeHandler=s=>{s.code==="Escape"&&s.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const s=this._editLayerURL,i=t.getGeometry();if(!i){this._destroy(),this._error=new Error("no geometry available"),g(this,W)?.reject(this._error);return}const r=this._olMap.getView().getProjection(),l=new nn({dataProjection:r}).writeGeometryObject(i,{rightHanded:!0,decimals:10});Mi(this._httpService,s,l,r).then(a=>{this._featureId=a,this._destroy(),g(this,W)?.resolve({featureId:this._featureId})}).catch(a=>{Ii.error(a),this._destroy(),this._error=new Error("Failed to save feature",{cause:a}),g(this,W)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.continue"}))}),s=this._drawInteraction.on("drawend",r=>{const o=r.feature;if(!o){this._destroy(),this._error=new Error("no feature available"),g(this,W)?.reject(this._error);return}this._save(o)}),i=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(t,s),this._mapListener.push(i)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.begin"})),this._setState("active:initialized")}stop(){this._destroy(),g(this,W)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{B(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){this._drawInteraction.finishDrawing()}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(g(this,W)??M(this,W,Zt())).promise}}W=new WeakMap;var G;class Ti extends ft{constructor(t){super();C(this,G);_(this,"_httpService");_(this,"_intl");_(this,"_map");_(this,"_polygonStyle");_(this,"_vertexStyle");_(this,"_state");_(this,"_editLayerURL");_(this,"_featureId");_(this,"_initialFeature");_(this,"_editFeature");_(this,"_editingSource");_(this,"_editingLayer");_(this,"_modifyInteraction");_(this,"_olMap");_(this,"_mapContainer");_(this,"_tooltip");_(this,"_enterHandler");_(this,"_escapeHandler");_(this,"_error");_(this,"_interactionListener");_(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._initialFeature=t.feature.clone(),this._initialFeature.setId(t.feature.getId()),this._editFeature=t.feature.clone(),this._editFeature.setId(t.feature.getId()),this._editFeature.setStyle(Pn({polygon:this._polygonStyle,vertex:this._vertexStyle})),this._editingSource=new Xe({features:new He([this._editFeature])}),this._editingLayer=new me({source:this._editingSource,zIndex:gt,properties:{name:"editing-layer"}}),this._modifyInteraction=new Si({source:this._editingSource}),this._tooltip=Mn(this._olMap,this._intl.formatMessage({id:"create.tooltip.deselect"})),this._enterHandler=s=>{if((s.code==="Enter"||s.code==="NumpadEnter")&&s.target===this._olMap.getTargetElement()){const i=this._editingSource.getFeatures()[0];if(!i)throw Error("no updated feature found");this._save(i)}},this._escapeHandler=s=>{s.code==="Escape"&&s.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getModifyInteraction(){return this._modifyInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const s=this._editLayerURL;if(this._featureId=t.getId()?.toString(),!this._featureId){this._destroy(),this._error=new Error("no feature id available"),g(this,G)?.reject(this._error);return}const i=t?.getGeometry();if(!i){this._destroy(),this._error=new Error("no geometry available"),g(this,G)?.reject(this._error);return}const r=this._olMap.getView().getProjection(),l=new nn({dataProjection:r}).writeGeometryObject(i,{rightHanded:!0,decimals:10});Pi(this._httpService,s,this._featureId,l,r).then(a=>{this._destroy(),g(this,G)?.resolve({featureId:a})}).catch(a=>{this._destroy(),this._error=new Error("Failed to save feature",{cause:a}),g(this,G)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._modifyInteraction);const t=this._editingSource.getFeatures()[0];if(t&&!t.getId()?.toString()){this._destroy(),this._error=new Error("no feature id available"),g(this,G)?.reject(this._error);return}this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const s=this._map.olMap.on("click",o=>{const l=o.coordinate,a=o.originalEvent.altKey,c=this._editingSource.getFeaturesAtCoordinate(l);a||c.length===0&&this.triggerSave()}),i=this._modifyInteraction.on("modifystart",()=>{this._setState("active:drawing")}),r=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(s,i),this._mapListener.push(r)}reset(){const t=this._initialFeature.getGeometry()?.clone(),s=this._editingSource.getFeatures()[0];if(!s)throw Error("no updated feature found");s.setGeometry(t),this._setState("active:initialized")}stop(){this._destroy(),g(this,G)?.resolve(void 0)}_destroy(){this._editingSource.clear(),this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{B(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){const t=this._editingSource.getFeatures()[0];if(!t)throw Error("no updated feature found");this._save(t)}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(g(this,G)??M(this,G,Zt())).promise}}G=new WeakMap;class vo{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}createFeature(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const s=e.id;let i=this._workflows.get(s);if(i)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return i=new Fi({map:e,ogcApiFeatureLayerUrl:t,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(s,i),this._connectToWorkflowDestroyEvent(i,s),i}updateFeature(e,t,s){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const i=e.id;let r=this._workflows.get(i);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new Ti({map:e,ogcApiFeatureLayerUrl:t,feature:s,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(i,r),this._connectToWorkflowDestroyEvent(r,i),r}stop(e){const t=this._workflows.get(e);t&&t.stop()}reset(e){const t=this._workflows.get(e);if(t)t.reset();else throw new Error("No workflow found for mapId: "+e)}_connectToWorkflowDestroyEvent(e,t){e.on("destroyed",()=>{this._workflows.get(t)===e&&this._workflows.delete(t)})}}new Be([407354,5754673]),new Be([404740,5757893]);var ie,K,Ee,Me,Pe,ht;class ki extends ft{constructor(t,s,i){super();C(this,Pe);_(this,"label");C(this,ie,{kind:"available"});C(this,K);C(this,Ee);C(this,Me);this.label=s,M(this,K,t),M(this,Me,i),v(this,Pe,ht).call(this),M(this,Ee,g(this,K).on("change:visible",()=>{v(this,Pe,ht).call(this)}))}destroy(){B(g(this,Ee))}get status(){return g(this,ie)}async select(t,s){if(t.type!=="extent")throw new Error(`Unsupported selection kind: ${t.type}`);if(g(this,ie).kind!=="available"||g(this,K).getSource()===null)return[];const i=[];g(this,K).getSource().forEachFeatureIntersectingExtent(t.extent,l=>{if(!l.getGeometry())return;const a={...l.getProperties()};delete a.geometries;const c={id:l.getId()?.toString()||fs(),geometry:l.getGeometry(),properties:a};i.push(c)});const r=i.filter(l=>l!=null);return r.length>s.maxResults?r.slice(0,s.maxResults):r}}ie=new WeakMap,K=new WeakMap,Ee=new WeakMap,Me=new WeakMap,Pe=new WeakSet,ht=function(){const s=g(this,K).getVisible()?{kind:"available"}:{kind:"unavailable",reason:g(this,Me)};s.kind!==g(this,ie).kind&&(M(this,ie,s),this.emit("changed:status"))};var Le;class _o{constructor({intl:e}){C(this,Le);M(this,Le,e)}createSelectionSource(e){return new ki(e.vectorLayer,e.label,g(this,Le).formatMessage({id:"layerNotVisibleReason"}))}}Le=new WeakMap;const Oi="@open-pioneer/notifier",Ai=pt.bind(void 0,Oi);var Ln=rn({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Ni=rn({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const ji=!1;function So(n){const{position:e="top-right"}=n,t=Ds(),s=Ai("notifier.NotificationService"),[i,r]=p.useState(!ji),o=Y(a=>{const c=a.level==="error"?h.jsx(Ln,{h:"100%",w:"100%"}):void 0;t({position:e,title:a.title,description:a.message||null,status:a.level,isClosable:!0,duration:a.displayDuration??null,icon:c})}),l=Y(()=>{t.closeAll()});return p.useEffect(()=>{const a=s.registerHandler({showNotification:o,closeAll:l});return()=>a.destroy()},[i,s,o,l]),h.jsx(h.Fragment,{})}function Ri(n,e){const t=p.useRef(n);t.current=n;const s=Gi(e);return p.useMemo(()=>si(()=>t.current()),[s])}function Di(n){const e=p.useCallback(()=>n.peek(),[n]),t=p.useCallback(i=>{const r=pi(()=>[n.value],i);return()=>r.destroy()},[n]),s=p.useSyncExternalStore(t,e);return p.useDebugValue(s),s}function xo(n,e){const t=Ri(n,e),s=Di(t);return p.useDebugValue(s),s}function Gi(n){const e=p.useRef();return(e.current==null||!Vi(e.current,n))&&(e.current=n??[]),e.current}function Vi(n,e){return n===e?!0:n.length===(e?.length??0)&&n.every((t,s)=>t===e[s])}const Hi="@open-pioneer/coordinate-viewer",Bi=re.bind(void 0,Hi),Ui=4,wo=n=>{const{mapId:e,precision:t,displayProjectionCode:s}=n,{containerProps:i}=X("coordinate-viewer",n),{map:r}=Z(e),o=r?.olMap,l=hn(o)?.getCode()??"";let{coordinates:a}=qi(o);a=a&&s?zi(a,l,s):a;const c=$i(a,t),u=s||l,d=c?c+" "+u:"";return h.jsx(j,{...i,children:h.jsx(pe,{className:"coordinate-viewer-text",children:d})})};function $i(n,e){const t=Bi();return n?Wi(n,e,t):""}function qi(n){const[e,t]=p.useState();return p.useEffect(()=>{if(!n)return;const s=n.on("pointermove",i=>{t(i.coordinate)});return()=>B(s)},[n]),{coordinates:e}}function Wi(n,e,t){if(n[0]==null||n[1]==null)return"";const s=e??Ui,[i,r]=n,o=t.formatNumber(i,{maximumFractionDigits:s,minimumFractionDigits:s}),l=t.formatNumber(r,{maximumFractionDigits:s,minimumFractionDigits:s});return o+" "+l}function zi(n,e,t){return gs(n,e,t)}const bo=n=>{const{mapId:e,displayMode:t="line"}=n,{containerProps:s}=X("scale-bar",n),{map:i}=Z(e),r=p.useRef(null);return p.useEffect(()=>{if(r.current&&i){const o=i.olMap,l=new Fs({units:"metric",target:r.current,bar:t==="bar"});return o.addControl(l),()=>{o.removeControl(l)}}},[t,i]),h.jsx(j,{...s,ref:r})},Ki="@open-pioneer/scale-viewer",Ji=re.bind(void 0,Ki),Co=n=>{const{mapId:e}=n,{containerProps:t}=X("scale-viewer",n),{map:s}=Z(e),i=Ji(),r=Zs(s?.olMap),o=r?i.formatNumber(r):void 0;return h.jsx(j,{...t,children:o&&h.jsxs(pe,{children:["1:",o]})})},Yi="@open-pioneer/legend",In=re.bind(void 0,Yi),Eo=n=>{const{mapId:e,showBaseLayers:t=!1}=n,{containerProps:s}=X("legend",n),{map:i}=Z(e);return h.jsx(j,{...s,children:i?h.jsx(Xi,{map:i,showBaseLayers:t}):null})};function Xi(n){const{map:e,showBaseLayers:t}=n,i=er(e).map(r=>h.jsx(Fn,{layer:r,showBaseLayers:t},r.id));return h.jsx(As,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:i})}function Fn(n){const{layer:e,showBaseLayers:t}=n,{isVisible:s}=nr(e),i=tr(e);if(!s||!t&&!("parentLayer"in e)&&e.isBaseLayer)return;const r=[];return i?.length&&i.forEach(o=>{r.push(h.jsx(Fn,{layer:o,showBaseLayers:t},o.id))}),h.jsxs(h.Fragment,{children:[h.jsx(Zi,{layer:e,showBaseLayers:t}),r]})}function Zi(n){const e=In(),{layer:t,showBaseLayers:s}=n,i=sr(t),r=Qi(t);let o;i?.Component?o=h.jsx(i.Component,{layer:t}):i?.imageUrl?o=h.jsx(Vt,{layer:t,imageUrl:i.imageUrl}):r&&(o=h.jsx(Vt,{layer:t,imageUrl:r}));const l=!("parentLayer"in t)&&t.isBaseLayer;return o?h.jsxs(j,{as:"li",className:Ze("legend-item",`layer-${ir(t.id)}`),children:[s&&l?h.jsx(pe,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,o]}):void 0}function Vt(n){const e=In(),{layer:t,imageUrl:s}=n;return h.jsxs(j,{children:[h.jsx(pe,{children:t.title}),h.jsx(Ts,{maxW:"none",maxH:"none",src:s,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:h.jsx(j,{children:h.jsxs(pe,{children:[h.jsx(Ln,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function Qi(n){const e=p.useCallback(()=>n.legend,[n]),t=p.useCallback(s=>{const i=n.on("changed:legend",s);return()=>i.destroy()},[n]);return p.useSyncExternalStore(t,e)}function er(n){const e=p.useCallback(s=>{const i=n.layers.on("changed",s);return()=>i.destroy()},[n]),t=p.useCallback(()=>{let s=n.layers.getAllLayers({sortByDisplayOrder:!0})??[];return s=s.reverse(),s},[n]);return Tn(e,t)}function tr(n){const e=p.useCallback(s=>{const i=n.sublayers?.on("changed",s);return()=>i?.destroy()},[n]),t=p.useCallback(()=>{if(!n.sublayers)return;let i=n.sublayers?.getSublayers({sortByDisplayOrder:!0});return i=i.reverse(),i},[n]);return Tn(e,t)}function Tn(n,e){const t=p.useRef(),s=p.useCallback(r=>{const o=n(()=>{t.current=void 0,r()});return()=>{t.current=void 0,o()}},[n]),i=p.useCallback(()=>{if(t.current)return t.current.value;const r=e();return t.current={value:r},r},[e]);return p.useSyncExternalStore(s,i)}function nr(n){const e=p.useCallback(()=>n.visible,[n]),t=p.useCallback(i=>{const r=n.on("changed:visible",i);return()=>r.destroy()},[n]);return{isVisible:p.useSyncExternalStore(t,e)}}function sr(n){const[e,t]=p.useState(void 0);return p.useEffect(()=>{t(n.attributes.legend);const s=n.on("changed:attributes",()=>{t(n.attributes.legend)});return()=>s.destroy()},[n]),e}function ir(n){return n.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const rr="@open-pioneer/measurement",or=re.bind(void 0,rr);class ar{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,t){this.olMap=e,this.messages=t;const s=this.source=new Xe;this.layer=new me({source:s}),this.layer.setZIndex(gt),e.addLayer(this.layer);const i=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){B(i)}});const r=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",r),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",r)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const t=ps(e);this.activeFeatureStyle=(s,...i)=>{const r=s?.getGeometry()?.getType();if(r==="Polygon"||r==="LineString"||r==="Point")return t(s,...i)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",s=this.draw=new sn({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(s);let i,r;s.on("drawstart",o=>{i=this.measureTooltip=this.createMeasureTooltip();const l=this.sketch=o.feature;if(!l)return;let a;r=l.getGeometry()?.on("change",c=>{const u=c.target,d=this.olMap.getView().getProjection();let m="";u instanceof Kt?(m=cr(u,d,this.messages),a=u.getInteriorPoint().getCoordinates()||null):u instanceof on&&(m=ur(u,d,this.messages),a=u.getLastCoordinate()||null),i&&(i.setHtml(m),a&&i?.overlay.setPosition(a))})}),s.on("drawend",()=>{if(i){const o=i.element.classList;o.remove("measurement-active-tooltip"),o.remove("printing-hide"),o.add("measurement-finished-tooltip"),i.overlay.setOffset([0,-7]),this.overlayTooltips.push(i),this.measureTooltip=i=void 0}this.sketch=void 0,r&&B(r)}),s.on("drawabort",()=>{i&&(i.destroy(),this.measureTooltip=i=void 0),this.sketch=void 0,r&&B(r)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const s=new We({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),i=this.olMap;return i.addOverlay(s),{overlay:s,element:e,destroy(){i.removeOverlay(s)},setText(r){t.textContent=r},setHtml(r){t.innerHTML=r}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const s=new We({element:e,offset:[15,0],positioning:"center-left"}),i=this.olMap;return i.addOverlay(s),{overlay:s,element:e,destroy(){i.removeOverlay(s)},setText(r){t.textContent=r},setHtml(r){t.innerHTML=r}}}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,s=lr(this.messages,this.sketch);t.setText(s),t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}}function lr(n,e){if(e){const t=e.getGeometry();if(t instanceof Kt||t instanceof on)return n.getContinueMessage()}return n.getHelpMessage()}function cr(n,e,t){const s=ms(n,{projection:e});let i;return s>=1e6?i=`${t.formatNumber(s/1e6)} km<sup>2</sup>`:i=`${t.formatNumber(s)} m<sup>2</sup>`,i}function ur(n,e,t){const s=ys(n,{projection:e});let i;return s>=1e3?i=`${t.formatNumber(s/1e3)} km`:i=`${t.formatNumber(s)} m`,i}const Mo=n=>{const e=or(),{mapId:t,activeFeatureStyle:s,finishedFeatureStyle:i}=n,{containerProps:r}=X("measurement",n),[o,l]=p.useState("distance"),a=f=>e.formatMessage({id:f}),c=Z(t),u=hr(c.map,e);p.useEffect(()=>{u?.setActiveFeatureStyle(s??dr())},[u,s]),p.useEffect(()=>{u?.setFinishedFeatureStyle(i??fr())},[u,i]),p.useEffect(()=>{if(u)return u.startMeasurement(o),()=>{u.stopMeasurement()}},[u,o]);function d(f){if(f==="distance"||f==="area")l(f);else throw new Error(`Unexpected measurement type: '${f}'.`)}function m(){u?.clearMeasurements()}return h.jsxs(j,{...r,children:[h.jsx(pe,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),h.jsx($e,{mb:4,alignItems:"center",children:h.jsxs(ct,{mb:2,children:[h.jsx(qe,{mb:1,children:a("measurementLabel")}),h.jsxs(vt,{value:o,onChange:f=>d(f.target.value),className:"measurement-select",children:[h.jsx("option",{value:"distance",children:a("distance")}),h.jsx("option",{value:"area",children:a("area")})]})]})}),h.jsx(Qt,{padding:2,className:"measurement-delete-button",onClick:m,width:"100%",children:a("deleteMeasurementLabel")})]})};function hr(n,e){const[t,s]=p.useState(void 0);return p.useEffect(()=>{if(!n)return;const i=new ar(n.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(r){return e.formatNumber(r,{maximumFractionDigits:2})}});return s(i),()=>{i.destroy(),s(void 0)}},[n,e]),t}function dr(){return[new Ue({stroke:new Se({color:"#fff",lineDash:[10,10],width:5})}),new Ue({fill:new lt({color:"rgba(0,0,0,0.15)"}),stroke:new Se({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new vs({radius:5,stroke:new Se({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new lt({color:"rgba(255, 255, 255, 0.2)"})})})]}function fr(){return[new Ue({stroke:new Se({color:"#fff",width:5})}),new Ue({stroke:new Se({color:"#0b96fc",width:3}),fill:new lt({color:"rgba(11,150,252,0.15)"})})]}const gr="@open-pioneer/search",et=re.bind(void 0,gr);function pr(n){const e=n.selectProps.inputValue.length>0,t={...n,className:Ze(n.className,{"search-invisible":!e})};return h.jsx(U.Menu,{...t,children:n.children})}function mr(n){const e=n.data.label,t={...n.innerProps,"aria-label":e,role:"group"};return h.jsx(U.Group,{...n,innerProps:t})}function yr(n){const t=et().formatMessage({id:"noOptionsText"});return h.jsx(U.NoOptionsMessage,{...n,children:h.jsx(z.span,{className:"search-no-match",children:t})})}function vr(n){const t=et().formatMessage({id:"loadingText"});return h.jsx(U.LoadingMessage,{...n,children:h.jsx(z.span,{className:"search-loading-text",children:t})})}function _r({children:n,...e}){const t={...e,className:Ze(e.className,"search-value-container")};return h.jsxs(U.ValueContainer,{...t,children:[!!n&&h.jsx(Ni,{style:{position:"absolute",left:8}}),n]})}function Sr(n){const e={...n,isHidden:!1};return h.jsx(U.Input,{...e})}function xr(n){return null}function wr(n){return h.jsxs(U.IndicatorsContainer,{...n,children:[n.children,!n.selectProps.isLoading&&n.selectProps.inputValue&&h.jsx(br,{selectProps:n.selectProps,clearValue:n.clearValue})]})}function br(n){const t=et().formatMessage({id:"ariaLabel.clearButton"}),s=i=>{i.preventDefault(),i.stopPropagation(),n.clearValue()};return h.jsx(Es,{role:"button",size:"md",mr:1,"aria-label":t,onClick:s,onTouchEnd:s,onMouseDown:i=>i.preventDefault()})}function Cr(n){return null}function Er(n){const e=n.selectProps.inputValue,t=n.data.label,s={...n,className:Ze(n.className,"search-option")};return h.jsx(U.Option,{...s,children:h.jsx(z.div,{className:"search-option-label",children:e.trim().length>0?Mr(t,e):t})})}function Mr(n,e){const t=n.toLowerCase().indexOf(e.toLowerCase());return t>=0?h.jsxs(h.Fragment,{children:[n.substring(0,t),h.jsx(z.span,{className:"search-highlighted-match",children:n.substring(t,t+e.length)},"highlighted"),n.substring(t+e.length)]}):n}const Ht=Oe("search:SearchController"),Bt=200,Ut=5;var Ie,de,fe,ge,V,Je,kn;class Pr{constructor(e,t){C(this,Je);C(this,Ie);C(this,de,[]);C(this,fe,Ut);C(this,ge,Bt);C(this,V);M(this,Ie,e),M(this,de,t)}destroy(){g(this,V)?.abort(),M(this,V,void 0)}async search(e){if(g(this,V)?.abort(),M(this,V,void 0),!e)return[];const t=M(this,V,new AbortController);try{return await Lr(t.signal,g(this,ge)),t.signal.aborted&&(Ht.debug(`search canceled with ${e}`),Ms()),(await Promise.all(g(this,de).map(i=>v(this,Je,kn).call(this,i,e,t.signal)))).filter(i=>i!=null)}finally{g(this,V)===t&&M(this,V,void 0)}}get searchTypingDelay(){return g(this,ge)}set searchTypingDelay(e){M(this,ge,e??Bt)}get maxResultsPerSource(){return g(this,fe)}set maxResultsPerSource(e){M(this,fe,e??Ut)}get sources(){return g(this,de)}}Ie=new WeakMap,de=new WeakMap,fe=new WeakMap,ge=new WeakMap,V=new WeakMap,Je=new WeakSet,kn=async function(e,t,s){const i=e.label,r=g(this,Ie).olMap.getView().getProjection();try{const o=g(this,fe);let l=await e.search(t,{maxResults:o,signal:s,mapProjection:r});return l.length>o&&(l=l.slice(0,o)),{label:i,source:e,results:l}}catch(o){en(o)||Ht.error(`search for source ${i} failed`,o);return}};async function Lr(n,e){n.aborted||await new Promise(t=>{const s=()=>{n.removeEventListener("abort",s),clearTimeout(i),t()};n.addEventListener("abort",s);const i=setTimeout(s,e)})}const Ke=Oe("search:Search"),Po=n=>{const{mapId:e,sources:t,searchTypingDelay:s,maxResultsPerGroup:i,onSelect:r,onClear:o}=n,{containerProps:l}=X("search",n),{map:a}=Z(e),c=et(),u=kr(t,s,i,a),{input:d,search:m,selectedOption:f,onInputChanged:y,onResultConfirmed:w}=Or(u),b=Tr(),O=Ir(c),$=Fr(),D=Y((A,Ne)=>{Ne.action==="input-change"&&y(A)}),P=Y((A,Ne)=>{switch(Ne.action){case"select-option":A&&(w(A),r?.({source:A.source,result:A.result}));break;case"clear":y(""),k.current?.blur(),k.current?.focus(),o?.();break;default:Ke.debug(`Unhandled action type '${Ne.action}'.`);break}}),k=p.useRef(null);return h.jsx(j,{...l,children:h.jsx(ln,{className:"search-component",classNamePrefix:"react-select",ref:k,inputValue:d,onInputChange:D,"aria-label":c.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:O,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:b,isClearable:!0,placeholder:c.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:m.kind==="loading",options:m.kind==="ready"?m.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:$,onChange:P,value:f,menuPosition:"fixed"})})};function Ir(n){return p.useMemo(()=>({onFocus:()=>"",onChange:()=>"",guidance:()=>`${n.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[n])}function Fr(){return p.useMemo(()=>({Menu:pr,Input:Sr,SingleValue:xr,Option:Er,NoOptionsMessage:yr,LoadingMessage:vr,ValueContainer:_r,IndicatorsContainer:wr,ClearIndicator:Cr,Group:mr}),[])}function Tr(){const[n,e]=tn("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return p.useMemo(()=>({groupHeading:s=>({...s,backgroundColor:n,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:s=>({...s,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:s=>({...s,display:"none"})}),[n,e])}function kr(n,e,t,s){const[i,r]=p.useState(void 0);return p.useEffect(()=>{if(!s)return;const o=new Pr(s,n);return r(o),()=>{o.destroy(),r(void 0)}},[s,n]),p.useEffect(()=>{i&&(i.searchTypingDelay=e)},[i,e]),p.useEffect(()=>{i&&(i.maxResultsPerSource=t)},[i,t]),i}function Or(n){const[e,t]=p.useReducer((l,a)=>{switch(a.kind){case"input":return{...l,query:a.query,selectedOption:null};case"select-option":return{...l,selectedOption:a.option,query:a.option.label};case"load-results":return{...l,search:{kind:"loading"}};case"accept-results":return{...l,search:{kind:"ready",results:a.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),s=p.useRef(),i=Y(l=>{if(!n){s.current=void 0,t({kind:"accept-results",results:[]});return}Ke.isDebug()&&Ke.debug(`Starting new search for query ${JSON.stringify(l)}.`),t({kind:"load-results"});const a=s.current=Ar(n,l).then(c=>{s.current===a&&t({kind:"accept-results",results:c})})}),r=p.useCallback(l=>{t({kind:"select-option",option:l})},[]),o=p.useCallback(l=>{t({kind:"input",query:l}),i(l)},[i]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:r,onInputChanged:o}}async function Ar(n,e){let t;try{t=await n.search(e)}catch(s){en(s)||Ke.error("Search failed",s),t=[]}return Nr(t)}function Nr(n){return n.map((t,s)=>({label:t.label,options:t.results.map(i=>({value:`${s}-${i.id}`,label:i.label,source:t.source,result:i}))}))}const On="@open-pioneer/selection",jr=pt.bind(void 0,On),Ct=re.bind(void 0,On),_e="selection-active",De="selection-inactive";class Rr{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,s,i){const r=this.initViewport(e);this.interactionResources.push(this.createDragBox(e,i,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources)),this.tooltip=this.createHelpTooltip(e,t),this.olMap=e,this.tooltipMessage=t,this.tooltipDisabledMessage=s}initViewport(e){const t=e.getViewport();return t.classList.add(_e),t.oncontextmenu=s=>(s.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(s=>this.olMap.addInteraction(s.interaction)),this.tooltip.setText(this.tooltipMessage),t.classList.remove(De),t.classList.add(_e),this.isActive=!0):(this.interactionResources.forEach(s=>this.olMap.removeInteraction(s.interaction)),this.tooltip.setText(this.tooltipDisabledMessage),t.classList.remove(_e),t.classList.add(De),this.isActive=!1)}createDragBox(e,t,s,i){const r=new kt({className:"selection-drag-box",condition:_s});return e.addInteraction(r),r.on("boxend",function(){t(r.getGeometry())}),{interaction:r,destroy(){e.removeInteraction(r),i.splice(i.indexOf(this)),r.dispose(),s.classList.remove(_e),s.classList.remove(De),s.oncontextmenu=null}}}createDrag(e,t,s){const i=function(l){return l.originalEvent.button==2},r=new Ot({condition:i});return e.addInteraction(r),{interaction:r,destroy(){e.removeInteraction(r),s.splice(s.indexOf(this)),r.dispose(),t.classList.remove(_e),t.classList.remove(De),t.oncontextmenu=null}}}createHelpTooltip(e,t){const s=document.createElement("div");s.className="selection-tooltip printing-hide",s.role="tooltip";const i=document.createElement("span");i.textContent=t,s.appendChild(i);const r=new We({element:s,offset:[15,0],positioning:"center-left"}),o=e.on("pointermove",l=>{r.setPosition(l.coordinate)});return e.addOverlay(r),{overlay:r,element:s,destroy(){e.removeOverlay(r),r.dispose(),B(o)},setText(l){i.textContent=l}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof kt)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Ot)}}const rt=Oe("selection:SelectionController"),Dr=1e4;var Fe,Te,ke,Ye,An;class Gr{constructor(e){C(this,Ye);C(this,Fe);C(this,Te);C(this,ke);const{mapModel:t,onError:s,maxResults:i=Dr}=e;M(this,Fe,t),M(this,Te,i),M(this,ke,s)}destroy(){}async select(e,t){if(t)return await v(this,Ye,An).call(this,e,t)}}Fe=new WeakMap,Te=new WeakMap,ke=new WeakMap,Ye=new WeakSet,An=async function(e,t){const s=g(this,Fe).olMap.getView().getProjection();try{rt.debug(`Starting selection on source '${e.label}'`);const i=g(this,Te);let r=await e.select({type:"extent",extent:t},{maxResults:i,mapProjection:s,signal:new AbortController().signal});return r.length>i&&(r=r.slice(0,i)),rt.debug(`Found ${r.length} results on source '${e.label}'`),{source:e,results:r}}catch(i){rt.error(`selection from source ${e.label} failed`,i),g(this,ke).call(this);return}};const Vr={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},Lo=n=>{const e=Ct(),{mapId:t,sources:s,onSelectionComplete:i,onSelectionSourceChanged:r}=n,{containerProps:o}=X("selection",n),l=e.formatMessage({id:"sourceNotAvailable"}),[a,c]=Ur(s,r),u=jn(a,l),d=Z(t),{onExtentSelected:m}=$r(d.map,s,a,i),f=Wr(),[y,w]=p.useState(!1);qr(d.map,e,m,u.kind==="available",!!a);const b=p.useMemo(()=>s.map(P=>({label:P.label,value:P})),[s]),O=p.useMemo(()=>b.find(k=>k.value===a)||null,[b,a]),$=Y(P=>{c(P?.value)}),D=Y(P=>{!y&&P.key==="Enter"&&w(!0)});return h.jsx(Ns,{...o,spacing:2,children:h.jsxs($e,{children:[h.jsx(qe,{children:e.formatMessage({id:"selectSource"})}),h.jsx(ln,{className:"selection-source react-select",...Vr,options:b,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:O,onChange:$,components:{Option:Hr,SingleValue:Br},isOptionDisabled:()=>!1,getOptionLabel:P=>{const k=P.label,A=dt(P.value,l);return A.kind=="available"?k:k+" "+A.reason},ariaLiveMessages:{guidance:()=>"",onChange:P=>P.action=="select-option"||P.action=="initial-input-focus"?P.label+" "+e.formatMessage({id:"selected"}):"",onFilter:()=>"",onFocus:()=>""},chakraStyles:f,onKeyDown:D,menuIsOpen:y,onMenuOpen:()=>w(!0),onMenuClose:()=>w(!1)})]})})};function Hr(n){const{value:e}=n.data,{isAvailable:t,content:s}=Nn(e,!1);return h.jsx(U.Option,{...n,isDisabled:!t,className:"selection-source-option",children:s})}function Br(n){const{value:e}=n.data,{isAvailable:t,content:s}=Nn(e,!0),i=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return h.jsx(U.SingleValue,{...n,isDisabled:!t,className:i,children:s})}function Ur(n,e){const[t,s]=p.useState(()=>n[0]);p.useEffect(()=>{t&&!n.includes(t)&&s(void 0)},[n,t]);const i=p.useRef(void 0);return p.useEffect(()=>{t!==i.current&&(i.current=t,e?.({source:t}))},[t,e]),[t,s]}function Nn(n,e){const t=Ct(),s=n?.label,i=t.formatMessage({id:"sourceNotAvailable"}),r=jn(n,i);return{isAvailable:r.kind==="available",content:h.jsxs(At,{direction:"row",alignItems:"center",grow:1,children:[!e&&h.jsx(At,{grow:1,children:s}),r.kind==="unavailable"&&h.jsx(j,{ml:2,children:h.jsx(Ps,{label:r.reason,placement:"right",openDelay:500,children:h.jsx(z.span,{children:h.jsx(Ls,{as:js,color:"red",className:"warning-icon","aria-label":r.reason})})})}),e&&s]})}}function $r(n,e,t,s){const i=jr("notifier.NotificationService"),r=Ct(),[o,l]=p.useState(void 0);p.useEffect(()=>{if(!n)return;const c=new Gr({mapModel:n,onError(){i.notify({level:"error",message:r.formatMessage({id:"selectionFailed"})})}});return l(c),()=>{c.destroy()}},[n,i,e,r]);const a=Y(async c=>{if(!o||!t)return;const u=await o.select(t,c.getExtent());u&&s?.(u)});return{controller:o,onExtentSelected:a}}function dt(n,e){const t=n.status??"available",s=typeof t=="string"?{kind:t}:t;return s.kind==="available"?s:{kind:"unavailable",reason:s.reason??e}}function jn(n,e){const[t,s]=p.useState(()=>({kind:"unavailable",reason:e}));return p.useEffect(()=>{if(!n){s({kind:"unavailable",reason:e});return}s(dt(n,e));const i=n.on?.("changed:status",()=>{s(dt(n,e))});return()=>i?.destroy()},[n,e]),t}function qr(n,e,t,s,i){p.useEffect(()=>{if(!n)return;const r=i?e.formatMessage({id:"disabledTooltip"}):e.formatMessage({id:"noSourceTooltip"}),o=new Rr(n.olMap,e.formatMessage({id:"tooltip"}),r,t);return o.setActive(s),()=>{o?.destroy()}},[n,e,t,s,i])}function Wr(){const[n,e]=tn("colors",["background_body","border"],["#ffffff","#ffffff"]);return p.useMemo(()=>({control:s=>({...s,cursor:"pointer"}),indicatorSeparator:s=>({...s,borderColor:e}),dropdownIndicator:s=>({...s,backgroundColor:n})}),[n,e])}const Rn="@open-pioneer/printing",Dn=pt.bind(void 0,Rn),zr=re.bind(void 0,Rn),Kr="map";class Jr{olMap;i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,s){this.olMap=e,this.printingService=t,this.i18n=s}destroy(){this.reset()}setViewPadding(e){this.viewPadding=e}async handleMapExport(e){if(this.olMap)try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const t=this.printMap.getCanvas();if(t)e.fileFormat=="png"?await this.exportMapInPNG(t,e):await this.exportMapInPDF(t,e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=ks(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(e){const t=e.title||"",s=e.title||Kr;return{title:t,fileName:s}}async exportMapInPNG(e,t){const s=document.createElement("canvas");s.width=e.width,s.height=e.height+50,s.style.backgroundColor="#fff";const i=s.getContext("2d");if(!i)throw new Error("2d canvas rendering context not available");const{title:r,fileName:o}=this.getTitleAndFileName(t);i.fillStyle="#fff",i.fillRect(0,0,s.width,s.height),i.font="20px bold sans-serif",i.textAlign="center",i.fillStyle="#000";const l=s.width/2;i.fillText(r,l,20),i.drawImage(e,0,50);const a=document.createElement("a");a.setAttribute("download",o+".png");const c=Os(s);if(!c)throw new Error("Failed to get image data URL");a.href=c,a.click()}async exportMapInPDF(e,t){const{jsPDF:s}=await Rs(async()=>{const{jsPDF:O}=await import("./CCUPmKUZ3nLZ.js");return{jsPDF:O}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),i=new s({orientation:"landscape",unit:"mm",format:"a4"}),r=i.internal.pageSize.getWidth(),o=i.internal.pageSize.getHeight(),l=15,a=20,c=o-a;i.setFontSize(20);const{title:u,fileName:d}=this.getTitleAndFileName(t);i.text(u,r/2,l,{align:"center"});const m=e.width/e.height;let f=c,y=f*m;y>=r&&(y=r,f=y/m);const w=(r-y)/2,b=a+(c-f)/2;i.addImage(e,"",w,b,y,f),i.save(d+".pdf")}}const Yr=Oe("printing"),Io=n=>{const e=zr(),{mapId:t,viewPadding:s="auto"}=n,{containerProps:i}=X("printing",n),[r,o]=p.useState("pdf"),[l,a]=p.useState(""),[c,u]=p.useState(!1),d=Dn("notifier.NotificationService"),{map:m}=Z(t),f=Xr(m,e,s);function y(b){(b==="png"||b==="pdf")&&o(b)}function w(){c||!f||(u(!0),f.handleMapExport({title:l,fileFormat:r}).catch(b=>{const O=e.formatMessage({id:"printingFailed"});d.notify({level:"error",message:O}),Yr.error("Failed to print the map",b)}).finally(()=>{u(!1)}))}return h.jsx(j,{...i,children:h.jsxs(j,{as:"form",m:2,alignItems:"center",onSubmit:b=>{b.preventDefault(),w()},children:[h.jsxs($e,{as:ct,mb:2,children:[h.jsx(qe,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),h.jsx(yt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:l,onChange:b=>{a(b.target.value)},autoFocus:!0})]}),h.jsxs($e,{as:ct,mb:2,children:[h.jsx(qe,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),h.jsxs(vt,{value:r,onChange:b=>y(b.target.value),className:"printing-select",children:[h.jsx("option",{value:"png",children:"PNG"}),h.jsx("option",{value:"pdf",children:"PDF"})]})]}),h.jsx(Qt,{isLoading:c,loadingText:e.formatMessage({id:"printingMap"}),disabled:c,mt:2,p:2,className:"printing-export-button",type:"submit",width:"100%",children:e.formatMessage({id:"export"})})]})})};function Xr(n,e,t){const s=Dn("printing.PrintingService"),[i,r]=p.useState(void 0);return p.useEffect(()=>{if(!n)return;const o=new Jr(n.olMap,s,{overlayText:e.formatMessage({id:"printingMap"})});return r(o),()=>{o.destroy(),r(void 0)}},[n,e,s]),p.useEffect(()=>{i?.setViewPadding(t)},[i,t]),i}export{wo as C,vo as E,yt as I,Eo as L,Mo as M,So as N,We as O,Io as P,En as S,_o as V,po as W,ve as a,yo as b,bo as c,Co as d,Po as e,Lo as f,Zs as g,si as h,mo as i,vt as j,se as r,xo as u,pi as w};
