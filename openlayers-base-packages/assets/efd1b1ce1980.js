var te=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var u=(s,e,t)=>(te(s,e,"read from private field"),t?t.call(s):e.get(s)),g=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},d=(s,e,t,r)=>(te(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t);var P=(s,e,t)=>(te(s,e,"access private method"),t);import{a as He}from"./0fe2929bec87.js";import{be as Ce,bp as Ge,aF as ye,bq as le,aE as he,br as Ie,bs as m,aK as Ne,bt as Ue,bu as D,bv as F,bw as ue,bx as Ve,by as We,i as Be,Z as re,bz as pe,au as be,bA as Ee,bB as Ze,bC as ke,U as $e,E as Re,R as Ye,bD as qe,bg as Ke,bE as Xe,bj as ge,ak as ze,bF as Y,bG as Se,B as Qe,H as X,bH as Le,bI as de,bJ as me,bK as Je,bL as et,bM as tt}from"./ef479b9a18df.js";import{b as ve}from"./e2ca5e44f10d.js";import{E as st}from"./960f2965a833.js";import{G as U}from"./ffd4e0f65f16.js";function we(s,e){const t=(""+s).split("."),r=(""+e).split(".");for(let i=0;i<Math.max(t.length,r.length);i++){const a=parseInt(t[i]||"0",10),n=parseInt(r[i]||"0",10);if(a>n)return 1;if(n>a)return-1}return 0}class rt extends Ce{constructor(e){e=e||{},super(e)}}const it=rt;class at extends Ge{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,i=e.viewState,a=i.resolution,n=this.getLayer().getSource(),o=e.viewHints;let c=e.extent;if(t.extent!==void 0&&(c=ye(c,le(t.extent,i.projection))),!o[he.ANIMATING]&&!o[he.INTERACTING]&&!Ie(c))if(n){const h=i.projection,l=n.getImage(c,a,r,h);l&&(this.loadImage(l)?this.image_=l:l.getState()===m.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=Ne(t.pixelToCoordinateTransform,e.slice()),a=r.getExtent();if(a&&!Ue(a,i))return null;const n=this.image_.getExtent(),o=this.image_.getImage(),c=D(n),h=Math.floor(o.width*((i[0]-n[0])/c));if(h<0||h>=o.width)return null;const l=F(n),_=Math.floor(o.height*((n[3]-i[1])/l));return _<0||_>=o.height?null:this.getImageData(o,h,_)}renderFrame(e,t){const r=this.image_,i=r.getExtent(),a=r.getResolution(),[n,o]=Array.isArray(a)?a:[a,a],c=r.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],l=e.pixelRatio,_=e.viewState,x=_.center,V=_.resolution,W=l*n/(V*c),B=l*o/(V*c),b=e.extent,Z=_.resolution,k=_.rotation,O=Math.round(D(b)/Z*l),M=Math.round(F(b)/Z*l);ue(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/l,1/l,k,-O/2,-M/2),Ve(this.inversePixelTransform,this.pixelTransform);const z=We(this.pixelTransform);this.useContainer(t,z,this.getBackground(e));const f=this.context,R=f.canvas;R.width!=O||R.height!=M?(R.width=O,R.height=M):this.containerReused||f.clearRect(0,0,O,M);let Q=!1,J=!0;if(h.extent){const j=le(h.extent,_.projection);J=Be(j,e.extent),Q=J&&!re(j,e.extent),Q&&this.clipUnrotated(f,e,j)}const T=r.getImage(),$=ue(this.tempTransform,O/2,M/2,W,B,0,c*(i[0]-x[0])/n,c*(x[1]-i[3])/o);this.renderedResolution=o*l/c;const ne=T.width*$[0],oe=T.height*$[3];if(this.getLayer().getSource().getInterpolate()||(f.imageSmoothingEnabled=!1),this.preRender(f,e),J&&ne>=.5&&oe>=.5){const j=$[4],Fe=$[5],ee=h.opacity;let ce;ee!==1&&(ce=f.globalAlpha,f.globalAlpha=ee),f.drawImage(T,0,0,+T.width,+T.height,j,Fe,ne,oe),ee!==1&&(f.globalAlpha=ce)}return this.postRender(f,e),Q&&f.restore(),f.imageSmoothingEnabled=!0,z!==R.style.transform&&(R.style.transform=z),this.container}}const nt=at;class ot extends it{constructor(e){super(e)}createRenderer(){return new nt(this)}getData(e){return super.getData(e)}}const ct=ot;function ie(s){return Array.isArray(s)?Math.min(...s):s}class lt extends pe{constructor(e,t,r,i,a,n,o){let c=e.getExtent();c&&e.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const l=h?ye(r,h):r,_=be(l),x=Ee(e,t,_,i),V=qe,W=new Ze(e,t,l,c,x*V,i),B=W.calculateSourceExtent(),b=Ie(B)?null:n(B,x,a),Z=b?m.IDLE:m.EMPTY,k=b?b.getPixelRatio():1;super(r,i,k,Z),this.targetProj_=t,this.maxSourceExtent_=c,this.triangulation_=W,this.targetResolution_=i,this.targetExtent_=r,this.sourceImage_=b,this.sourcePixelRatio_=k,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==m.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==m.LOADED){const t=D(this.targetExtent_)/this.targetResolution_,r=F(this.targetExtent_)/this.targetResolution_;this.canvas_=ke(t,r,this.sourcePixelRatio_,ie(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==m.IDLE){this.state=m.LOADING,this.changed();const e=this.sourceImage_.getState();e==m.LOADED||e==m.ERROR?this.reproject_():(this.sourceListenerKey_=$e(this.sourceImage_,Re.CHANGE,function(t){const r=this.sourceImage_.getState();(r==m.LOADED||r==m.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){Ye(this.sourceListenerKey_),this.sourceListenerKey_=null}}const ht=lt,p=4,se={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class ut extends Qe{constructor(e,t){super(e),this.image=t}}class gt extends Ke{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const r=Xe(t,e,0);e=t[r]}return e}getImage(e,t,r,i){const a=this.getProjection();if(!a||!i||ge(a,i))return a&&(i=a),this.getImageInternal(e,t,r,i);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ge(this.reprojectedImage_.getProjection(),i)&&this.reprojectedImage_.getResolution()==t&&ze(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new ht(a,i,e,t,r,(n,o,c)=>this.getImageInternal(n,o,c,a),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,r,i){if(this.loader){const a=Ae(e,t,r,1),n=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&re(this.wantedExtent_,a)||re(this.image.getExtent(),a))&&(this.wantedResolution_&&ie(this.wantedResolution_)===n||ie(this.image.getResolution())===n)))return this.image;this.wantedProjection_=i,this.wantedExtent_=a,this.wantedResolution_=n,this.image=new pe(a,n,r,this.loader),this.image.addEventListener(Re.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let r;switch(t.getState()){case m.LOADING:this.loading=!0,r=se.IMAGELOADSTART;break;case m.LOADED:this.loading=!1,r=se.IMAGELOADEND;break;case m.ERROR:this.loading=!1,r=se.IMAGELOADERROR;break;default:return}this.hasListener(r)&&this.dispatchEvent(new ut(r,t))}}function dt(s,e){s.getImage().src=e}function Ae(s,e,t,r){const i=e/t,a=be(s),n=Y(D(s)/i,p),o=Y(F(s)/i,p),c=Y((r-1)*n/2,p),h=n+2*c,l=Y((r-1)*o/2,p),_=o+2*l;return Se(a,i,0,[h,_])}const mt=gt,xe="1.3.0",_e=[101,101];function Oe(s,e,t,r,i){i.WIDTH=t[0],i.HEIGHT=t[1];const a=r.getAxisOrientation();let n;const o=we(i.VERSION,"1.3")>=0;return i[o?"CRS":"SRS"]=r.getCode(),o&&a.substr(0,2)=="ne"?n=[e[1],e[0],e[3],e[2]]:n=e,i.BBOX=n.join(","),ve(s,i)}function _t(s,e,t,r,i,a,n){a=Object.assign({REQUEST:"GetMap"},a);const o=e/t,c=[me(D(s)/o,p),me(F(s)/o,p)];if(t!=1)switch(n){case"geoserver":const l=90*t+.5|0;"FORMAT_OPTIONS"in a?a.FORMAT_OPTIONS+=";dpi:"+l:a.FORMAT_OPTIONS="dpi:"+l;break;case"mapserver":a.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":a.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return Oe(i,s,c,r,a)}function Me(s,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:xe,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},s)}function ft(s){const e=s.hidpi===void 0?!0:s.hidpi,t=X(s.projection||"EPSG:3857"),r=s.ratio||1.5,i=s.load||Le;return(a,n,o)=>{a=Ae(a,n,o,r),o!=1&&(!e||s.serverType===void 0)&&(o=1);const c=_t(a,n,o,t,s.url,Me(s.params,"GetMap"),s.serverType),h=new Image;return s.crossOrigin!==null&&(h.crossOrigin=s.crossOrigin),i(h,c).then(l=>({image:l,extent:a,pixelRatio:o}))}}function yt(s,e,t){if(s.url===void 0)return;const r=X(s.projection||"EPSG:3857"),i=Se(e,t,0,_e),a={QUERY_LAYERS:s.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(a,Me(s.params,"GetFeatureInfo"),s.params);const n=de((e[0]-i[0])/t,p),o=de((i[3]-e[1])/t,p),c=we(a.VERSION,"1.3")>=0;return a[c?"I":"X"]=n,a[c?"J":"Y"]=o,Oe(s.url,i,_e,r,a)}function It(s,e){if(s.url===void 0)return;const t={SERVICE:"WMS",VERSION:xe,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(s.params===void 0||s.params.LAYER===void 0){const r=s.params.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;t.LAYER=r}if(e!==void 0){const r=X(s.projection||"EPSG:3857").getMetersPerUnit()||1,i=28e-5;t.SCALE=e*r/i}return Object.assign(t,s.params),ve(s.url,t)}class pt extends mt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:dt,this.params_=e.params,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,r,i){const a=X(r),n=this.getProjection();n&&n!==a&&(t=Ee(n,a,e,t),e=Je(e,a,n));const o={url:this.url_,params:{...this.params_,...i},projection:n||a};return yt(o,e,t)}getLegendUrl(e,t){return It({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=ft({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(a,n)=>(this.image.setImage(a),this.imageLoadFunction_(this.image,n),Le(a))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const bt=pt;function Et(s){let e=!1,t=setTimeout(()=>{e=!0,t=void 0,s()});return{reschedule(){return!e},cancel(){t&&clearTimeout(t)}}}var y;class Te extends st{constructor(t){super();g(this,y,void 0);d(this,y,t)}destroy(){for(const t of u(this,y))t.destroy();d(this,y,[])}getSublayers(t){return u(this,y).slice()}__getRawSublayers(){return u(this,y)}}y=new WeakMap;const fe=He("map:WMSLayer");var H,S,L,v,w,C,ae,q,je,K,Pe;class Rt extends et{constructor(t){const r=new ct;super({...t,olLayer:r});g(this,C);g(this,q);g(this,K);g(this,H,void 0);g(this,S,void 0);g(this,L,void 0);g(this,v,void 0);g(this,w,void 0);const i=new bt({...t.sourceOptions,url:t.url,params:{...t.sourceOptions?.params},imageLoadFunction:(a,n)=>P(this,K,Pe).call(this,a,n).catch(o=>{fe.error(`Failed to load tile at '${n}'`,o)})});d(this,H,t.url),d(this,w,i),d(this,v,r),d(this,S,new Te(De(t.sublayers))),P(this,C,ae).call(this)}get url(){return u(this,H)}get sublayers(){return u(this,S)}__attach(t){super.__attach(t);for(const r of u(this,S).getSublayers())r.__attach(t,this,this)}__updateSublayerVisibility(){u(this,L)?.reschedule()||d(this,L,Et(()=>{try{P(this,C,ae).call(this),d(this,L,void 0)}catch(t){fe.error(`Failed to update sublayer visibility on WMS layer '${this.id}'.`,t)}}))}}H=new WeakMap,S=new WeakMap,L=new WeakMap,v=new WeakMap,w=new WeakMap,C=new WeakSet,ae=function(){const t=P(this,q,je).call(this);u(this,w).updateParams({LAYERS:t});const r=t.length===0?null:u(this,w);u(this,v).getSource()!==r&&u(this,v).setSource(r)},q=new WeakSet,je=function(){const t=[],r=i=>{if(!i.visible)return;const a=i.sublayers.__getRawSublayers();if(a.length)for(const n of a)r(n);else t.push(i.name)};for(const i of this.sublayers.__getRawSublayers())r(i);return t},K=new WeakSet,Pe=async function(t,r){const a=await this.map.__sharedDependencies.httpService.fetch(r);if(!a.ok)throw new Error(`Request failed with status ${a.status}.`);const n=await a.blob(),o=URL.createObjectURL(n),c=t.getImage();c.src=o,c.onload=()=>{URL.revokeObjectURL(o)}};var E,I,G,N,A;class St extends tt{constructor(t){super(t);g(this,E,void 0);g(this,I,void 0);g(this,G,void 0);g(this,N,void 0);g(this,A,void 0);d(this,G,t.name),d(this,A,t.visible??!0),d(this,N,new Te(De(t.sublayers)))}get name(){return u(this,G)}get sublayers(){return u(this,N)}get parent(){const t=u(this,E);if(!t)throw new Error(`WMS sublayer ${this.id} has not been attached to its parent yet.`);return t}get parentLayer(){const t=u(this,I);if(!t)throw new Error(`WMS sublayer ${this.id} has not been attached to its parent yet.`);return t}__attach(t,r,i){if(super.__attachToMap(t),u(this,E))throw new Error(`WMS sublayer '${this.id}' has already been attached to parent '${u(this,E).id}'`);if(d(this,E,i),u(this,I))throw new Error(`WMS sublayer '${this.id}' has already been attached to parent layer '${u(this,I).id}'`);d(this,I,r);for(const a of this.sublayers.__getRawSublayers())a.__attach(t,r,this)}get visible(){return u(this,A)}setVisible(t){this.visible!==t&&(d(this,A,t),u(this,I)?.__updateSublayerVisibility(),this.__emitChangeEvent("changed:visible"))}}E=new WeakMap,I=new WeakMap,G=new WeakMap,N=new WeakMap,A=new WeakMap;function De(s=[]){const e=[];try{for(const t of s)e.push(new St(t));return e}catch(t){for(;e.length;)e.pop()?.destroy();throw new Error("Failed to construct sublayers.",{cause:t})}}const Mt=Rt;function Tt(s){return U({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,56H60A20,20,0,0,0,40,76V228a12,12,0,0,0,19,9.76l49-35,49,35A12,12,0,0,0,176,228V76A20,20,0,0,0,156,56Zm-4,148.68-37-26.45a12,12,0,0,0-14,0L64,204.68V80h88ZM216,36V188a12,12,0,0,1-24,0V40H92a12,12,0,0,1,0-24H196A20,20,0,0,1,216,36Z"}}]})(s)}function jt(s){return U({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222,128a6,6,0,0,1-6,6H40a6,6,0,0,1,0-12H216A6,6,0,0,1,222,128ZM40,70H216a6,6,0,0,0,0-12H40a6,6,0,0,0,0,12ZM216,186H40a6,6,0,0,0,0,12H216a6,6,0,0,0,0-12Z"}}]})(s)}function Pt(s){return U({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M233.91,74.79,181.22,22.1a14,14,0,0,0-19.8,0L22.09,161.41a14,14,0,0,0,0,19.8L74.78,233.9a14,14,0,0,0,19.8,0L233.91,94.59A14,14,0,0,0,233.91,74.79ZM225.42,86.1,86.1,225.41h0a2,2,0,0,1-2.83,0L30.58,172.73a2,2,0,0,1,0-2.83L64,136.48l27.76,27.76a6,6,0,1,0,8.48-8.48L72.48,128,96,104.48l27.76,27.76a6,6,0,0,0,8.48-8.48L104.48,96,128,72.49l27.76,27.75a6,6,0,0,0,8.48-8.48L136.49,64,169.9,30.59a2,2,0,0,1,2.83,0l52.69,52.68A2,2,0,0,1,225.42,86.1Z"}}]})(s)}function Dt(s){return U({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,50H40a6,6,0,0,0,0,12H50V208a14,14,0,0,0,14,14H192a14,14,0,0,0,14-14V62h10a6,6,0,0,0,0-12ZM194,208a2,2,0,0,1-2,2H64a2,2,0,0,1-2-2V62H194ZM82,24a6,6,0,0,1,6-6h80a6,6,0,0,1,0,12H88A6,6,0,0,1,82,24Z"}}]})(s)}function Ft(s){return U({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228.92,49.69a8,8,0,0,0-6.86-1.45L160.93,63.52,99.58,32.84a8,8,0,0,0-5.52-.6l-64,16A8,8,0,0,0,24,56V200a8,8,0,0,0,9.94,7.76l61.13-15.28,61.35,30.68A8.15,8.15,0,0,0,160,224a8,8,0,0,0,1.94-.24l64-16A8,8,0,0,0,232,200V56A8,8,0,0,0,228.92,49.69ZM104,52.94l48,24V203.06l-48-24ZM40,62.25l48-12v127.5l-48,12Zm176,131.5-48,12V78.25l48-12Z"}}]})(s)}export{Ft as P,Mt as W,Dt as a,Tt as b,jt as c,Pt as d};
