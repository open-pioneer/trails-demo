var Zt=Object.defineProperty;var yt=e=>{throw TypeError(e)};var Bt=(e,t,r)=>t in e?Zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var M=(e,t,r)=>Bt(e,typeof t!="symbol"?t+"":t,r),at=(e,t,r)=>t.has(e)||yt("Cannot "+r);var n=(e,t,r)=>(at(e,t,"read from private field"),r?r.call(e):t.get(e)),x=(e,t,r)=>t.has(e)?yt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),P=(e,t,r,s)=>(at(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),a=(e,t,r)=>(at(e,t,"access private method"),r);import{c as Gt,i as bt,r as y,j as I}from"./Bh0CuZ3gy5tC.js";import{G as xt,T as ht}from"./DFF1h5Auub9k.js";import{b as Jt,aA as Wt,b2 as Kt,u as Qt,a_ as ft,g as dt,b5 as St,h as Xt,V as Yt}from"./Bg6CwrFcg8E3.js";import{a as te,b as ee,c as re,d as se,e as ie}from"./CL_VRsbiqLzM.js";var ne=Symbol.for("preact-signals");function nt(){if(V>1)V--;else{for(var e,t=!1;G!==void 0;){var r=G;for(G=void 0,ut++;r!==void 0;){var s=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Rt(r))try{r.c()}catch(i){t||(e=i,t=!0)}r=s}}if(ut=0,V--,t)throw e}}function oe(e){if(V>0)return e();V++;try{return e()}finally{nt()}}var h=void 0;function vt(e){var t=h;h=void 0;try{return e()}finally{h=t}}var G=void 0,V=0,ut=0,it=0;function Et(e){if(h!==void 0){var t=e.n;if(t===void 0||t.t!==h)return t={i:0,S:e,p:h.s,n:void 0,t:h,e:void 0,x:void 0,r:t},h.s!==void 0&&(h.s.n=t),h.s=t,e.n=t,32&h.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=h.s,t.n=void 0,h.s.n=t,h.s=t),t}}function E(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}E.prototype.brand=ne;E.prototype.h=function(){return!0};E.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};E.prototype.U=function(e){if(this.t!==void 0){var t=e.e,r=e.x;t!==void 0&&(t.x=r,e.e=void 0),r!==void 0&&(r.e=t,e.x=void 0),e===this.t&&(this.t=r)}};E.prototype.subscribe=function(e){var t=this;return Ft(function(){var r=t.value,s=h;h=void 0;try{e(r)}finally{h=s}})};E.prototype.valueOf=function(){return this.value};E.prototype.toString=function(){return this.value+""};E.prototype.toJSON=function(){return this.value};E.prototype.peek=function(){var e=h;h=void 0;try{return this.value}finally{h=e}};Object.defineProperty(E.prototype,"value",{get:function(){var e=Et(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(ut>100)throw new Error("Cycle detected");this.v=e,this.i++,it++,V++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{nt()}}}});function ae(e){return new E(e)}function Rt(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function It(e){for(var t=e.s;t!==void 0;t=t.n){var r=t.S.n;if(r!==void 0&&(t.r=r),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Ct(e){for(var t=e.s,r=void 0;t!==void 0;){var s=t.p;t.i===-1?(t.S.U(t),s!==void 0&&(s.n=t.n),t.n!==void 0&&(t.n.p=s)):r=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=s}e.s=r}function Z(e){E.call(this,void 0),this.x=e,this.s=void 0,this.g=it-1,this.f=4}(Z.prototype=new E).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===it))return!0;if(this.g=it,this.f|=1,this.i>0&&!Rt(this))return this.f&=-2,!0;var e=h;try{It(this),h=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return h=e,Ct(this),this.f&=-2,!0};Z.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}E.prototype.S.call(this,e)};Z.prototype.U=function(e){if(this.t!==void 0&&(E.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};Z.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(Z.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=Et(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function Lt(e){return new Z(e)}function kt(e){var t=e.u;if(e.u=void 0,typeof t=="function"){V++;var r=h;h=void 0;try{t()}catch(s){throw e.f&=-2,e.f|=8,pt(e),s}finally{h=r,nt()}}}function pt(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,kt(e)}function ce(e){if(h!==this)throw new Error("Out-of-order effect");Ct(this),h=e,this.f&=-2,8&this.f&&pt(this),nt()}function tt(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}tt.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}};tt.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,kt(this),It(this),V++;var e=h;return h=this,ce.bind(this,e)};tt.prototype.N=function(){2&this.f||(this.f|=2,this.o=G,G=this)};tt.prototype.d=function(){this.f|=8,1&this.f||pt(this)};function Ft(e){var t=new tt(e);try{t.c()}catch(r){throw t.d(),r}return t.d.bind(t)}function U(e,t){return new he(e,t?.equal)}function ue(e,t){return new le(e,t?.equal)}function ir(e){return oe(e)}function mt(e){return vt(e)}var D=Symbol("signal"),J=Symbol("equals"),Ut=class{[D];constructor(e){this[D]=e}get value(){return this[D].value}set value(e){throw new Error("Cannot update a readonly reactive object.")}trigger(){throw new Error("Cannot trigger this reactive object.")}peek(){return this[D].peek()}toJSON(){return this.value}toString(){return`Reactive[value=${de(this[D].value)}]`}},le=class extends Ut{[J];constructor(e,t){const r=Lt(t?fe(e,t):e);super(r),this[J]=t}},he=class extends Ut{[J];constructor(e,t){super(ae(e)),this[J]=t}get value(){return super.value}set value(e){vt(()=>this[J]?.(this.value,e))||(this[D].value=e)}};function fe(e,t){let r=!0,s;return function(){const o=e();return vt(()=>((r||!t(s,o))&&(s=o,r=!1),s))}}function de(e){return typeof e=="string"?JSON.stringify(e):String(e)}function ve(e,t){return e===t?!0:e.length===t.length&&e.every((r,s)=>r===t[s])}function pe(e,t,r,s){const i=Lt(t),o=s?.immediate??!1,c=s?.equal??me;let l=!0,f,v;function m(){const b=v;v=void 0;try{b?.()}catch(g){throw R.destroy(),g}}const p=e(()=>{const b=i.value;mt(()=>{const g=f,k=l&&o||!l&&!c(g,b);(k||l)&&(f=b,l=!1),k&&(m(),v=r(b,g))})}),R={destroy(){try{m()}finally{p.destroy()}}};return R}function me(e,t){return e===t}function ge(e){return{destroy:Ft(e)}}function ye(e,t){let r=0,s=!0,i;return i=ge(()=>{const o=r++;if(o===0)return e();o===1&&mt(()=>{try{t()}finally{s?Promise.resolve().then(()=>i?.destroy()):i?.destroy()}})}),s=!1,i}function Mt(e){Promise.reject(new Error("Error in effect or watch callback",{cause:e}))}var we=class{queue=[];channel=new MessageChannel;constructor(){this.channel.port2.start()}enqueue(e){const t={fn:e,destroyed:!1};return this.queue.push(t),this.queue.length===1&&this.scheduleIteration(),{destroy(){t.destroyed||(t.destroyed=!0)}}}messageHandler=()=>this.runIteration();scheduleIteration(){const e=this.channel;e.port2.addEventListener("message",this.messageHandler),e.port1.postMessage("")}runIteration(){this.channel.port2.removeEventListener("message",this.messageHandler);const e=this.queue;this.queue=[];for(const t of e)if(!t.destroyed)try{t.fn()}catch(r){Mt(r)}}};function be(e){const t=new xe(e);return{destroy:t.destroy.bind(t)}}var xe=class{callback;cleanup;effectHandle;scheduledExecution;isDestroyed=!1;initialExecution=!0;isExecuting=!1;constructor(e){this.callback=e,this.execute(),this.initialExecution=!1}destroy(){if(!this.isDestroyed){this.isDestroyed=!0;try{this.triggerCleanup()}finally{this.effectHandle?.destroy(),this.effectHandle=void 0,this.scheduledExecution?.destroy(),this.scheduledExecution=void 0}}}execute(){this.isExecuting=!0;try{const e=ye(()=>{if(this.initialExecution)this.triggerCallback();else try{this.triggerCallback()}catch(t){Mt(t)}},()=>this.scheduleExecution());this.isDestroyed?e.destroy():this.effectHandle=e}finally{this.isExecuting=!1}}triggerCallback(){this.triggerCleanup(),this.isDestroyed||(this.cleanup=this.callback())}triggerCleanup(){const e=this.cleanup;this.cleanup=void 0;try{e&&mt(e)}catch(t){throw this.destroy(),t}}scheduleExecution(){if(!this.isDestroyed){if(this.effectHandle?.destroy(),this.effectHandle=void 0,this.isExecuting)throw new Error("Cycle detected");this.scheduledExecution||(this.scheduledExecution=Re(()=>{try{this.execute()}finally{this.scheduledExecution=void 0}}))}}};function Se(e,t,r){return pe(be,e,t,{equal:ve,...r})}var Ee=new we;function Re(e){return Ee.enqueue(e)}function Ie(e){return new Ce(e)}var S,H,w,q,et,Pt,Vt,wt,Ce=(wt=class{constructor(e){x(this,w);x(this,S,new Map);x(this,H,U(!1));if(e)for(const[t,r]of e)n(this,S).set(t,U(r))}get size(){return a(this,w,q).call(this),n(this,S).size}entries(){return a(this,w,q).call(this),a(this,w,Pt).call(this)}keys(){return a(this,w,q).call(this),n(this,S).keys()}values(){return a(this,w,q).call(this),a(this,w,Vt).call(this)}[Symbol.iterator](){return this.entries()}clear(){const e=!!n(this,S).size;n(this,S).clear(),e&&a(this,w,et).call(this)}delete(e){const t=n(this,S).delete(e);return t&&a(this,w,et).call(this),t}get(e){return a(this,w,q).call(this),n(this,S).get(e)?.value}has(e){return a(this,w,q).call(this),n(this,S).has(e)}set(e,t){const r=n(this,S).get(e);return r?r.value=t:(n(this,S).set(e,U(t)),a(this,w,et).call(this)),this}},S=new WeakMap,H=new WeakMap,w=new WeakSet,q=function(){n(this,H).value},et=function(){n(this,H).value=!n(this,H).peek()},Pt=function*(){const e=n(this,S).entries();for(const[t,r]of e)yield[t,r.value]},Vt=function*(){const e=n(this,S).values();for(const t of e)yield t.value},wt);function B(e){return new Le(e)}var d,T,u,O,rt,jt,qt,C,A,z,Le=(z=class{constructor(t){x(this,u);x(this,d);x(this,T,U(!1));P(this,d,t?Array.from(t).map(r=>U(r)):[])}get length(){return a(this,u,C).call(this),n(this,d).length}push(...t){n(this,d).push(...t.map(r=>U(r))),a(this,u,A).call(this)}pop(){if(n(this,d).length===0)return;const t=n(this,d).pop();return a(this,u,A).call(this),t.value}unshift(...t){n(this,d).unshift(...t.map(r=>U(r))),a(this,u,A).call(this)}shift(){if(n(this,d).length===0)return;const t=n(this,d).shift();return a(this,u,A).call(this),t.value}splice(t,r,...s){const i=n(this,d).splice(t,r??n(this,d).length,...s.map(o=>U(o)));return(s!=null&&s.length!==0||i.length!==0)&&a(this,u,A).call(this),i.map(o=>o.value)}sort(t){n(this,d).sort((r,s)=>t(r.value,s.value)),a(this,u,A).call(this)}getItems(){return a(this,u,C).call(this),n(this,d).map(t=>t.value)}at(t){return a(this,u,C).call(this),n(this,d).at(t)?.value}get(t){return a(this,u,C).call(this),n(this,d)[t]?.value}set(t,r){if(t<0||t>=n(this,d).length)throw new Error("index out of bounds");const s=n(this,d)[t];s.value=r}slice(...t){a(this,u,C).call(this);const r=n(this,d).slice(...t).map(s=>s.value);return B(r)}concat(...t){const r=this.getItems().concat(...t.map(s=>s instanceof z?s.getItems():s));return B(r)}includes(t,r){return a(this,u,O).call(this,s=>s===t,r)!==-1}indexOf(t,r){return a(this,u,O).call(this,s=>s===t,r)}lastIndexOf(t){return a(this,u,rt).call(this,r=>r===t)}find(t){const r=a(this,u,O).call(this,t);return this.get(r)}findLast(t){const r=a(this,u,rt).call(this,t);return this.get(r)}findIndex(t){return a(this,u,O).call(this,t)}findLastIndex(t){return a(this,u,rt).call(this,t)}some(t){return a(this,u,O).call(this,t)!==-1}every(t){return a(this,u,O).call(this,(r,s)=>!t(r,s))===-1}forEach(t){for(const[r,s]of this.entries())t(s,r)}filter(t){return B(this.getItems().filter((r,s)=>t(r,s)))}map(t){return B(this.getItems().map((r,s)=>t(r,s)))}flatMap(t){return B(this.getItems().flatMap((r,s)=>t(r,s)))}reduce(t,...r){return a(this,u,C).call(this),n(this,d).reduce((s,i,o)=>t(s,i.value,o),...r)}reduceRight(t,...r){return a(this,u,C).call(this),n(this,d).reduceRight((s,i,o)=>t(s,i.value,o),...r)}keys(){return a(this,u,C).call(this),n(this,d).keys()}values(){return a(this,u,C).call(this),a(this,u,jt).call(this)}entries(){return a(this,u,C).call(this),a(this,u,qt).call(this)}[Symbol.iterator](){return this.values()}},d=new WeakMap,T=new WeakMap,u=new WeakSet,O=function(t,r){for(let s=r??0,i=this.length;s<i;++s){const o=this.get(s);if(t(o,s))return s}return-1},rt=function(t){for(let r=this.length;r-- >0;){const s=this.get(r);if(t(s,r))return r}return-1},jt=function*(){for(const t of n(this,d))yield t.value},qt=function*(){for(const[t,r]of n(this,d).entries())yield[t,r.value]},C=function(){n(this,T).value},A=function(){n(this,T).value=!n(this,T).peek()},z);const ke="next";function Fe(e,t,r,s){const i=new URL(e),o=i.searchParams;return o.set("bbox",t.join(",")),o.set("bbox-crs",r),o.set("crs",r),o.set("f","json"),s?.(new URL(i))??i}function Ue(e,t,r){const s=new URL(e),i=s.searchParams;return i.set("offset",t.toString()),i.set("limit",r.toString()),s.toString()}function Ot(e){if(!Array.isArray(e))return;const r=e.filter(s=>s.rel===ke);if(r.length===1)return r[0]?.href}async function At(e,t,r,s){let i=[];const o={headers:{Accept:"application/geo+json"},signal:s},c=await r.fetch(e,o);if(c.status!==200)throw new Error(`Failed to query features from service (status code ${c.status})`);const l=await c.json();t&&(i=t.readFeatures(l));const f=Ot(l.links);return{features:i,numberMatched:l.numberMatched,nextURL:f}}async function Me(e,t){const r={supportsOffsetStrategy:!1},s=new URL(e);s.searchParams.set("limit","1"),s.searchParams.set("f","json");const i=await t.fetch(s.toString(),{headers:{Accept:"application/geo+json"}});if(i.status!==200)throw new Error(`Failed to probe collection information (status code ${i.status})`);const o=await i.json(),c=Ot(o.links);if(!c)return r;const f=new URL(c).searchParams.has("offset");return r.supportsOffsetStrategy=f,r}async function Pe(e){const{fullURL:t,featureFormat:r,signal:s,addFeatures:i,queryFeatures:o}=e,c=e.limit,l=e.maxConcurrentRequests;let f=0,v=t;const m=[];let p;for(;v;){let R;p==null?R=l:R=Math.ceil((p-f)/c),R=Math.max(1,Math.min(R,l));const b=[];for(let k=0;k<R;++k)b.push(Ue(t,f,c)),f+=c;const g=await Nt(b,r,e.httpService,s,i,o);m.push(...g.features),v=g.nextURL,g.numberMatched!=null&&(p=g.numberMatched)}return m}const _=Gt("ogc-features:OgcFeatureSourceFactory"),Ve=5e3,je=6;function qe(e,t){return Oe(e,{httpService:t})}function Oe(e,t){const r=t.httpService,s=`${e.baseUrl}/collections/${e.collectionId}/items?`,i=new Jt({format:new xt,strategy:Wt,attributions:e.attributions,...e.additionalOptions}),o=t.queryFeaturesParam??At,c=t.getCollectionInfosParam??Me,l=t.addFeaturesParam||function(p){_.debug(`Adding ${p.length} features`),i.addFeatures(p)};let f,v;const m=async(p,R,b,g,k)=>{v??=c(s,r);let N;try{N=await v}catch(j){_.error("Failed to retrieve collection information",j),k?.(),v=void 0;return}f?.abort("Extent changed"),f=new AbortController;const $t=Fe(s,p,e.crs,e.rewriteUrl);let ot=e?.strategy||(N?.supportsOffsetStrategy?"offset":"next");ot==="offset"&&!N?.supportsOffsetStrategy&&(ot="next");try{const j=await Ae(ot,{fullURL:$t.toString(),httpService:r,featureFormat:i.getFormat(),queryFeatures:o,addFeatures:l,limit:e.limit??Ve,maxConcurrentRequests:e.maxConcurrentRequests??je,signal:f.signal,collectionInfos:N});g?.(j),_.debug("Finished loading features for extent:",p)}catch(j){bt(j)?(_.debug("Query-Feature-Request aborted",j),i.removeLoadedExtent(p),k?.()):_.error("Failed to load features",j)}};return i.setLoader(m),i}function Ae(e,t){switch(e){case"next":return Ne(t);case"offset":return Pe(t)}}async function Ne(e){const t=e.limit;let r=new URL(e.fullURL);r.searchParams.set("limit",t.toString());let s=[];do{const i=await Nt([r.toString()],e.featureFormat,e.httpService,e.signal,e.addFeatures,e.queryFeatures);if(s=s.concat(i.features),!i.nextURL)break;r=new URL(i.nextURL)}while(!0);return s}async function Nt(e,t,r,s,i,o=At){const c={nextURL:void 0,numberMatched:void 0,features:[]},l=e.map(async(f,v)=>{const m=v===e.length-1,p=await o(f,t,r,s);i(p.features),_.debug(`NextURL for index = ${v} (isLast = ${m}): ${p.nextURL||"No Next URL"}`),c.features.push(...p.features),m&&(c.numberMatched=p.numberMatched,c.nextURL=p.nextURL)});return await Promise.all(l),c}var F,W,K,Q,$,Dt,_t;class De{constructor(t,r){x(this,$);M(this,"label");x(this,F);x(this,W);x(this,K);x(this,Q);this.label=t.label,P(this,F,t),P(this,W,r);const{baseUrl:s,params:i}=He(t.baseUrl);P(this,K,s),P(this,Q,i)}async search(t,{mapProjection:r,maxResults:s,signal:i}){const o=a(this,$,_t).call(this,t,s),c=new xt({dataProjection:"EPSG:4326",featureProjection:r});return(await _e(n(this,W),o,i)).features.map(f=>a(this,$,Dt).call(this,f,c))}}F=new WeakMap,W=new WeakMap,K=new WeakMap,Q=new WeakMap,$=new WeakSet,Dt=function(t,r){const s=n(this,F).renderLabel?.(t),i=t.properties[n(this,F).labelProperty],o=t.properties[n(this,F).searchProperty],c=s||(i!==void 0?String(i):o!==void 0?String(o):"");return{id:t.id??Kt(),label:c,geometry:r.readGeometry(t.geometry),properties:t.properties}},_t=function(t,r){const s=new URL(`${n(this,K)}/collections/${n(this,F).collectionId}/items`);for(const[i,o]of n(this,Q))s.searchParams.append(i,o);return s.searchParams.set(n(this,F).searchProperty,`*${t}*`),s.searchParams.set("limit",String(r)),s.searchParams.set("f","json"),n(this,F).rewriteUrl?.(new URL(s))??s};async function _e(e,t,r){try{const s=await e.fetch(t,{signal:r,headers:{Accept:"application/json"}});if(!s.ok)throw new Error("Request failed with status "+s.status);return await s.json()}catch(s){throw bt(s)?s:new Error("Failed to search on OGC API Features service",{cause:s})}}function He(e){const t=new URL(e),r=new URLSearchParams(t.searchParams);return t.search="",{baseUrl:t.href.replace(/\/+$/,""),params:r}}var X;class nr{constructor({references:t}){x(this,X);P(this,X,t.httpService)}createVectorSource(t){return qe(t,n(this,X))}}X=new WeakMap;var Y;class or{constructor({references:t}){x(this,Y);P(this,Y,t.httpService)}createSearchSource(t){return new De(t,n(this,Y))}}Y=new WeakMap;function Te(e,t){const r=y.useRef(e);r.current=e;const s=Ze(t);return y.useMemo(()=>ue(()=>r.current()),[s])}function ze(e){const t=y.useCallback(()=>e.peek(),[e]),r=y.useCallback(i=>{const o=Se(()=>[e.value],i);return()=>o.destroy()},[e]),s=y.useSyncExternalStore(r,t);return y.useDebugValue(s),s}function $e(e,t){const r=Te(e,t),s=ze(r);return y.useDebugValue(s),s}function Ze(e){const t=y.useRef();return(t.current==null||!Be(t.current,e))&&(t.current=e??[]),t.current}function Be(e,t){return e===t?!0:e.length===(t?.length??0)&&e.every((r,s)=>r===t[s])}const Ge="@open-pioneer/map-navigation",gt=Qt.bind(void 0,Ge),ar=y.forwardRef(function(t,r){const{containerProps:s}=ft("initial-extent",t),{map:i}=dt(t),o=gt();function c(){const l=i?.initialExtent,f=i?.olMap;if(l&&f){const v=[l.xMin,l.yMin,l.xMax,l.yMax];f.getView().fit(v,{duration:200})}}return I.jsx(ht,{ref:r,label:o.formatMessage({id:"initial-extent.title"}),icon:I.jsx(te,{}),onClick:c,...s})}),cr=y.forwardRef(function(t,r){return I.jsx(Ht,{zoomDirection:"in",ref:r,...t})}),ur=y.forwardRef(function(t,r){return I.jsx(Ht,{zoomDirection:"out",ref:r,...t})}),Ht=y.forwardRef(function(t,r){const{zoomDirection:s}=t,{map:i}=dt(t),o=gt(),[c,l]=y.useState(!1),{defaultClassName:f,buttonLabel:v,buttonIcon:m}=Je(o,s),{containerProps:p}=ft(St("zoom",f),t);function R(){if(c)return;l(!0);const b=i?.olMap.getView();let g=b?.getZoom();const k=b?.getMaxZoom()||Number.MAX_SAFE_INTEGER,N=b?.getMinZoom()||0;b&&g!==void 0&&(s==="in"&&g<k?++g:s==="out"&&g>N&&--g,b.animate({zoom:g,duration:200},()=>l(!1)))}return I.jsx(ht,{ref:r,label:v,icon:m,onClick:R,...p})});function Je(e,t){switch(t){case"in":return{defaultClassName:"zoom-in",buttonLabel:e.formatMessage({id:"zoom-in.title"}),buttonIcon:I.jsx(re,{})};case"out":return{defaultClassName:"zoom-out",buttonLabel:e.formatMessage({id:"zoom-out.title"}),buttonIcon:I.jsx(ee,{})}}}const We=200;var L,lt,st,Tt;class Ke{constructor(t){x(this,L);M(this,"olMap");M(this,"handle");M(this,"_mapViews",Ie());M(this,"_activeViewId",U(0));M(this,"backward",()=>{if(this.canBackward)a(this,L,st).call(this,this.activeViewId-1),a(this,L,lt).call(this,this.activeViewId);else throw new Error("Backward is not possible at the moment")});M(this,"forward",()=>{if(this.canForward)a(this,L,st).call(this,this.activeViewId+1),a(this,L,lt).call(this,this.activeViewId);else throw new Error("Forward is not possible at the moment")});this.olMap=t.olMap,this.handle=a(this,L,Tt).call(this)}destroy(){this.handle&&Xt(this.handle),this.handle=void 0}get activeViewId(){return this._activeViewId.value}get mapViews(){return this._mapViews}get canBackward(){return this.mapViews.get(this.activeViewId-1)!=null}get canForward(){return this.mapViews.get(this.activeViewId+1)!=null}}L=new WeakSet,lt=function(t){const r=this.olMap.getView();this.olMap.setView(new Yt({center:this.mapViews.get(t).center,resolution:this.mapViews.get(t).resolution,projection:r.getProjection()}))},st=function(t){this._activeViewId.value=t},Tt=function(){const t=this.olMap.on("moveend",()=>{r()}),r=()=>{const s=this.olMap,i=this.mapViews,o=s.getView(),c=o.getResolution(),l=o.getCenter();if(c!=null&&l!=null&&(l!==i.get(this.activeViewId)?.center||c!==i.get(this.activeViewId)?.resolution)){const f={resolution:c,center:l},v=this.activeViewId+1;for(const m of i.keys())m>v&&i.delete(m);for(const m of i.keys()){if(i.size<We)break;i.delete(m)}a(this,L,st).call(this,v),i.set(v,f)}};return t};const ct=new WeakMap;function Qe(e){const[t,r]=y.useState();return y.useEffect(()=>{if(!e)return;let s=ct.get(e);return s==null?(s={vm:new Ke(e),useCount:1},ct.set(e,s)):s.useCount++,r(s.vm),()=>{r(void 0),s.useCount--,s.useCount===0&&(s.vm.destroy(),ct.delete(e))}},[e]),t}const lr=y.forwardRef(function(t,r){return I.jsx(zt,{viewDirection:"forward",ref:r,...t})}),hr=y.forwardRef(function(t,r){return I.jsx(zt,{viewDirection:"backward",ref:r,...t})}),zt=y.forwardRef(function(t,r){const s=gt(),{viewDirection:i}=t,{map:o}=dt(t),c=Qe(o),{defaultClassName:l,buttonLabel:f,buttonIcon:v}=Xe(s,i),{containerProps:m}=ft(St("view",l),t),p=$e(()=>c?i==="forward"?c.canForward:c.canBackward:!1,[c,i]),R=()=>{c&&(i==="forward"?c.forward():c.backward())};return c&&I.jsx(ht,{ref:r,...m,label:f,icon:v,onClick:R,isDisabled:!p})});function Xe(e,t){switch(t){case"forward":return{defaultClassName:"view-forward",buttonLabel:e.formatMessage({id:"view-forward.title"}),buttonIcon:I.jsx(ie,{})};case"backward":return{defaultClassName:"view-backward",buttonLabel:e.formatMessage({id:"view-backward.title"}),buttonIcon:I.jsx(se,{})}}}export{hr as H,ar as I,or as S,nr as V,cr as Z,B as a,Ie as b,ur as c,lr as d,ue as e,ir as f,U as r,$e as u,Se as w};
