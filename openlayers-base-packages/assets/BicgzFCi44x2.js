var Zt=Object.defineProperty;var gt=e=>{throw TypeError(e)};var Bt=(e,t,r)=>t in e?Zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var M=(e,t,r)=>Bt(e,typeof t!="symbol"?t+"":t,r),at=(e,t,r)=>t.has(e)||gt("Cannot "+r);var n=(e,t,r)=>(at(e,t,"read from private field"),r?r.call(e):t.get(e)),S=(e,t,r)=>t.has(e)?gt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),P=(e,t,r,s)=>(at(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),o=(e,t,r)=>(at(e,t,"access private method"),r);import{c as Gt,i as yt,r as y,j as I}from"./Bh0CuZ3gy5tC.js";import{G as bt,T as ht}from"./Cc9xaV05uMzL.js";import{b as Wt,aA as Jt,b2 as Kt,u as Qt,a_ as ft,g as dt,b5 as xt,h as Xt,V as Yt}from"./BBd4RzEkte6S.js";import{a as te,b as ee,c as re,d as se,e as ie}from"./CL_VRsbiqLzM.js";var ne=Symbol.for("preact-signals");function nt(){if(j>1)j--;else{for(var e,t=!1;G!==void 0;){var r=G;for(G=void 0,ut++;r!==void 0;){var s=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Et(r))try{r.c()}catch(i){t||(e=i,t=!0)}r=s}}if(ut=0,j--,t)throw e}}function oe(e){if(j>0)return e();j++;try{return e()}finally{nt()}}var h=void 0;function vt(e){var t=h;h=void 0;try{return e()}finally{h=t}}var G=void 0,j=0,ut=0,it=0;function St(e){if(h!==void 0){var t=e.n;if(t===void 0||t.t!==h)return t={i:0,S:e,p:h.s,n:void 0,t:h,e:void 0,x:void 0,r:t},h.s!==void 0&&(h.s.n=t),h.s=t,e.n=t,32&h.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=h.s,t.n=void 0,h.s.n=t,h.s=t),t}}function E(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}E.prototype.brand=ne;E.prototype.h=function(){return!0};E.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};E.prototype.U=function(e){if(this.t!==void 0){var t=e.e,r=e.x;t!==void 0&&(t.x=r,e.e=void 0),r!==void 0&&(r.e=t,e.x=void 0),e===this.t&&(this.t=r)}};E.prototype.subscribe=function(e){var t=this;return kt(function(){var r=t.value,s=h;h=void 0;try{e(r)}finally{h=s}})};E.prototype.valueOf=function(){return this.value};E.prototype.toString=function(){return this.value+""};E.prototype.toJSON=function(){return this.value};E.prototype.peek=function(){var e=h;h=void 0;try{return this.value}finally{h=e}};Object.defineProperty(E.prototype,"value",{get:function(){var e=St(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(ut>100)throw new Error("Cycle detected");this.v=e,this.i++,it++,j++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{nt()}}}});function ae(e){return new E(e)}function Et(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Rt(e){for(var t=e.s;t!==void 0;t=t.n){var r=t.S.n;if(r!==void 0&&(t.r=r),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function It(e){for(var t=e.s,r=void 0;t!==void 0;){var s=t.p;t.i===-1?(t.S.U(t),s!==void 0&&(s.n=t.n),t.n!==void 0&&(t.n.p=s)):r=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=s}e.s=r}function Z(e){E.call(this,void 0),this.x=e,this.s=void 0,this.g=it-1,this.f=4}(Z.prototype=new E).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===it))return!0;if(this.g=it,this.f|=1,this.i>0&&!Et(this))return this.f&=-2,!0;var e=h;try{Rt(this),h=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return h=e,It(this),this.f&=-2,!0};Z.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}E.prototype.S.call(this,e)};Z.prototype.U=function(e){if(this.t!==void 0&&(E.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};Z.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(Z.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=St(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function Ct(e){return new Z(e)}function Lt(e){var t=e.u;if(e.u=void 0,typeof t=="function"){j++;var r=h;h=void 0;try{t()}catch(s){throw e.f&=-2,e.f|=8,pt(e),s}finally{h=r,nt()}}}function pt(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,Lt(e)}function ce(e){if(h!==this)throw new Error("Out-of-order effect");It(this),h=e,this.f&=-2,8&this.f&&pt(this),nt()}function tt(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}tt.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}};tt.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Lt(this),Rt(this),j++;var e=h;return h=this,ce.bind(this,e)};tt.prototype.N=function(){2&this.f||(this.f|=2,this.o=G,G=this)};tt.prototype.d=function(){this.f|=8,1&this.f||pt(this)};function kt(e){var t=new tt(e);try{t.c()}catch(r){throw t.d(),r}return t.d.bind(t)}function ue(e){let t;return{destroy:kt(function(){this[le]=e.bind(void 0),t=this[he].bind(this)}),start:t}}var le="N",he="S";function U(e,t){return new ve(e,t?.equal)}function fe(e,t){return new de(e,t?.equal)}function nr(e){return oe(e)}function Ft(e){return vt(e)}var _=Symbol("signal"),W=Symbol("equals"),Ut=class{[_];constructor(e){this[_]=e}get value(){return this[_].value}set value(e){throw new Error("Cannot update a readonly reactive object.")}trigger(){throw new Error("Cannot trigger this reactive object.")}peek(){return this[_].peek()}toJSON(){return this.value}toString(){return`Reactive[value=${me(this[_].value)}]`}},de=class extends Ut{[W];constructor(e,t){const r=Ct(t?pe(e,t):e);super(r),this[W]=t}},ve=class extends Ut{[W];constructor(e,t){super(ae(e)),this[W]=t}get value(){return super.value}set value(e){vt(()=>this[W]?.(this.value,e))||(this[_].value=e)}};function pe(e,t){let r=!0,s;return function(){const a=e();return vt(()=>((r||!t(s,a))&&(s=a,r=!1),s))}}function me(e){return typeof e=="string"?JSON.stringify(e):String(e)}function ge(e,t){return e===t?!0:e.length===t.length&&e.every((r,s)=>r===t[s])}function we(e,t,r,s){const i=Ct(t),a=s?.immediate??!1,c=s?.equal??ye;let l=!0,f,v;function m(){const x=v;v=void 0;try{x?.()}catch(g){throw R.destroy(),g}}const p=e(()=>{const x=i.value;Ft(()=>{const g=f,k=l&&a||!l&&!c(g,x);(k||l)&&(f=x,l=!1),k&&(m(),v=r(x,g))})}),R={destroy(){try{m()}finally{p.destroy()}}};return R}function ye(e,t){return e===t}function Mt(e){Promise.reject(new Error("Error in effect or watch callback",{cause:e}))}var be=class{queue=[];channel=new MessageChannel;constructor(){this.channel.port2.start()}enqueue(e){const t={fn:e,destroyed:!1};return this.queue.push(t),this.queue.length===1&&this.scheduleIteration(),{destroy(){t.destroyed||(t.destroyed=!0)}}}messageHandler=()=>this.runIteration();scheduleIteration(){const e=this.channel;e.port2.addEventListener("message",this.messageHandler),e.port1.postMessage("")}runIteration(){this.channel.port2.removeEventListener("message",this.messageHandler);const e=this.queue;this.queue=[];for(const t of e)if(!t.destroyed)try{t.fn()}catch(r){Mt(r)}}};function xe(e){const t=new Se(e);return{destroy:t.destroy.bind(t)}}var Se=class{callback;cleanup;watcher;scheduledExecution;isDestroyed=!1;initialExecution=!0;isExecuting=!1;constructor(e){this.callback=e,this.watcher=ue(this.scheduleExecution),this.execute(),this.initialExecution=!1}destroy(){if(!this.isDestroyed){this.isDestroyed=!0;try{this.triggerCleanup()}finally{this.watcher?.destroy(),this.watcher=void 0,this.scheduledExecution?.destroy(),this.scheduledExecution=void 0}}}execute(){const e=this.watcher;if(!e)return;this.isExecuting=!0;const t=e.start();try{if(this.initialExecution)try{this.triggerCallback()}catch(r){throw this.destroy(),r}else try{this.triggerCallback()}catch(r){Mt(r)}}finally{t(),this.isExecuting=!1}this.isDestroyed&&this.triggerCleanup()}triggerCallback(){if(!this.isDestroyed){this.triggerCleanup();const e=this.callback();typeof e=="function"&&(this.cleanup=e)}}triggerCleanup(){const e=this.cleanup;this.cleanup=void 0;try{e&&Ft(e)}catch(t){throw this.destroy(),t}}scheduleExecution=()=>{if(!this.isDestroyed){if(this.isExecuting)throw new Error("Cycle detected");this.scheduledExecution||(this.scheduledExecution=Ie(()=>{try{this.execute()}finally{this.scheduledExecution=void 0}}))}}};function Ee(e,t,r){return we(xe,e,t,{equal:ge,...r})}var Re=new be;function Ie(e){return Re.enqueue(e)}function Ce(e){return new Le(e)}var b,T,w,V,et,Pt,Vt,wt,Le=(wt=class{constructor(e){S(this,w);S(this,b,new Map);S(this,T,U(!1));if(e)for(const[t,r]of e)n(this,b).set(t,U(r))}get size(){return o(this,w,V).call(this),n(this,b).size}forEach(e){o(this,w,V).call(this);const t=n(this,b).entries();for(const[r,s]of t)e(s.value,r)}entries(){return o(this,w,V).call(this),o(this,w,Pt).call(this)}keys(){return o(this,w,V).call(this),n(this,b).keys()}values(){return o(this,w,V).call(this),o(this,w,Vt).call(this)}[Symbol.iterator](){return this.entries()}clear(){const e=!!n(this,b).size;n(this,b).clear(),e&&o(this,w,et).call(this)}delete(e){const t=n(this,b).delete(e);return t&&o(this,w,et).call(this),t}get(e){return o(this,w,V).call(this),n(this,b).get(e)?.value}has(e){return o(this,w,V).call(this),n(this,b).has(e)}set(e,t){const r=n(this,b).get(e);return r?r.value=t:(n(this,b).set(e,U(t)),o(this,w,et).call(this)),this}},b=new WeakMap,T=new WeakMap,w=new WeakSet,V=function(){n(this,T).value},et=function(){n(this,T).value=!n(this,T).peek()},Pt=function*(){const e=n(this,b).entries();for(const[t,r]of e)yield[t,r.value]},Vt=function*(){const e=n(this,b).values();for(const t of e)yield t.value},wt);function B(e){return new ke(e)}var d,z,u,A,rt,jt,qt,C,N,$,ke=($=class{constructor(t){S(this,u);S(this,d);S(this,z,U(!1));P(this,d,t?Array.from(t).map(r=>U(r)):[])}get length(){return o(this,u,C).call(this),n(this,d).length}push(...t){n(this,d).push(...t.map(r=>U(r))),o(this,u,N).call(this)}pop(){if(n(this,d).length===0)return;const t=n(this,d).pop();return o(this,u,N).call(this),t.value}unshift(...t){n(this,d).unshift(...t.map(r=>U(r))),o(this,u,N).call(this)}shift(){if(n(this,d).length===0)return;const t=n(this,d).shift();return o(this,u,N).call(this),t.value}splice(t,r,...s){const i=n(this,d).splice(t,r??n(this,d).length,...s.map(a=>U(a)));return(s!=null&&s.length!==0||i.length!==0)&&o(this,u,N).call(this),i.map(a=>a.value)}sort(t){n(this,d).sort((r,s)=>t(r.value,s.value)),o(this,u,N).call(this)}getItems(){return o(this,u,C).call(this),n(this,d).map(t=>t.value)}at(t){return o(this,u,C).call(this),n(this,d).at(t)?.value}get(t){return o(this,u,C).call(this),n(this,d)[t]?.value}set(t,r){if(t<0||t>=n(this,d).length)throw new Error("index out of bounds");const s=n(this,d)[t];s.value=r}slice(...t){o(this,u,C).call(this);const r=n(this,d).slice(...t).map(s=>s.value);return B(r)}concat(...t){const r=this.getItems().concat(...t.map(s=>s instanceof $?s.getItems():s));return B(r)}includes(t,r){return o(this,u,A).call(this,s=>s===t,r)!==-1}indexOf(t,r){return o(this,u,A).call(this,s=>s===t,r)}lastIndexOf(t){return o(this,u,rt).call(this,r=>r===t)}find(t){const r=o(this,u,A).call(this,t);return this.get(r)}findLast(t){const r=o(this,u,rt).call(this,t);return this.get(r)}findIndex(t){return o(this,u,A).call(this,t)}findLastIndex(t){return o(this,u,rt).call(this,t)}some(t){return o(this,u,A).call(this,t)!==-1}every(t){return o(this,u,A).call(this,(r,s)=>!t(r,s))===-1}forEach(t){for(const[r,s]of this.entries())t(s,r)}filter(t){return B(this.getItems().filter((r,s)=>t(r,s)))}map(t){return B(this.getItems().map((r,s)=>t(r,s)))}flatMap(t){return B(this.getItems().flatMap((r,s)=>t(r,s)))}reduce(t,...r){return o(this,u,C).call(this),n(this,d).reduce((s,i,a)=>t(s,i.value,a),...r)}reduceRight(t,...r){return o(this,u,C).call(this),n(this,d).reduceRight((s,i,a)=>t(s,i.value,a),...r)}keys(){return o(this,u,C).call(this),n(this,d).keys()}values(){return o(this,u,C).call(this),o(this,u,jt).call(this)}entries(){return o(this,u,C).call(this),o(this,u,qt).call(this)}[Symbol.iterator](){return this.values()}},d=new WeakMap,z=new WeakMap,u=new WeakSet,A=function(t,r){for(let s=r??0,i=this.length;s<i;++s){const a=this.get(s);if(t(a,s))return s}return-1},rt=function(t){for(let r=this.length;r-- >0;){const s=this.get(r);if(t(s,r))return r}return-1},jt=function*(){for(const t of n(this,d))yield t.value},qt=function*(){for(const[t,r]of n(this,d).entries())yield[t,r.value]},C=function(){n(this,z).value},N=function(){n(this,z).value=!n(this,z).peek()},$);const Fe="next";function Ue(e,t,r,s){const i=new URL(e),a=i.searchParams;return a.set("bbox",t.join(",")),a.set("bbox-crs",r),a.set("crs",r),a.set("f","json"),s?.(new URL(i))??i}function Me(e,t,r){const s=new URL(e),i=s.searchParams;return i.set("offset",t.toString()),i.set("limit",r.toString()),s.toString()}function At(e){if(!Array.isArray(e))return;const r=e.filter(s=>s.rel===Fe);if(r.length===1)return r[0]?.href}async function Nt(e,t,r,s){let i=[];const a={headers:{Accept:"application/geo+json"},signal:s},c=await r.fetch(e,a);if(c.status!==200)throw new Error(`Failed to query features from service (status code ${c.status})`);const l=await c.json();t&&(i=t.readFeatures(l));const f=At(l.links);return{features:i,numberMatched:l.numberMatched,nextURL:f}}async function Pe(e,t){const r={supportsOffsetStrategy:!1},s=new URL(e);s.searchParams.set("limit","1"),s.searchParams.set("f","json");const i=await t.fetch(s.toString(),{headers:{Accept:"application/geo+json"}});if(i.status!==200)throw new Error(`Failed to probe collection information (status code ${i.status})`);const a=await i.json(),c=At(a.links);if(!c)return r;const f=new URL(c).searchParams.has("offset");return r.supportsOffsetStrategy=f,r}async function Ve(e){const{fullURL:t,featureFormat:r,signal:s,addFeatures:i,queryFeatures:a}=e,c=e.limit,l=e.maxConcurrentRequests;let f=0,v=t;const m=[];let p;for(;v;){let R;p==null?R=l:R=Math.ceil((p-f)/c),R=Math.max(1,Math.min(R,l));const x=[];for(let k=0;k<R;++k)x.push(Me(t,f,c)),f+=c;const g=await Ot(x,r,e.httpService,s,i,a);m.push(...g.features),v=g.nextURL,g.numberMatched!=null&&(p=g.numberMatched)}return m}const D=Gt("ogc-features:OgcFeatureSourceFactory"),je=5e3,qe=6;function Ae(e,t){return Ne(e,{httpService:t})}function Ne(e,t){const r=t.httpService,s=`${e.baseUrl}/collections/${e.collectionId}/items?`,i=new Wt({format:new bt,strategy:Jt,attributions:e.attributions,...e.additionalOptions}),a=t.queryFeaturesParam??Nt,c=t.getCollectionInfosParam??Pe,l=t.addFeaturesParam||function(p){D.debug(`Adding ${p.length} features`),i.addFeatures(p)};let f,v;const m=async(p,R,x,g,k)=>{v??=c(s,r);let O;try{O=await v}catch(q){D.error("Failed to retrieve collection information",q),k?.(),v=void 0;return}f?.abort("Extent changed"),f=new AbortController;const Ht=Ue(s,p,e.crs,e.rewriteUrl);let ot=e?.strategy||(O?.supportsOffsetStrategy?"offset":"next");ot==="offset"&&!O?.supportsOffsetStrategy&&(ot="next");try{const q=await Oe(ot,{fullURL:Ht.toString(),httpService:r,featureFormat:i.getFormat(),queryFeatures:a,addFeatures:l,limit:e.limit??je,maxConcurrentRequests:e.maxConcurrentRequests??qe,signal:f.signal,collectionInfos:O});g?.(q),D.debug("Finished loading features for extent:",p)}catch(q){yt(q)?(D.debug("Query-Feature-Request aborted",q),i.removeLoadedExtent(p),k?.()):D.error("Failed to load features",q)}};return i.setLoader(m),i}function Oe(e,t){switch(e){case"next":return _e(t);case"offset":return Ve(t)}}async function _e(e){const t=e.limit;let r=new URL(e.fullURL);r.searchParams.set("limit",t.toString());let s=[];do{const i=await Ot([r.toString()],e.featureFormat,e.httpService,e.signal,e.addFeatures,e.queryFeatures);if(s=s.concat(i.features),!i.nextURL)break;r=new URL(i.nextURL)}while(!0);return s}async function Ot(e,t,r,s,i,a=Nt){const c={nextURL:void 0,numberMatched:void 0,features:[]},l=e.map(async(f,v)=>{const m=v===e.length-1,p=await a(f,t,r,s);i(p.features),D.debug(`NextURL for index = ${v} (isLast = ${m}): ${p.nextURL||"No Next URL"}`),c.features.push(...p.features),m&&(c.numberMatched=p.numberMatched,c.nextURL=p.nextURL)});return await Promise.all(l),c}var F,J,K,Q,H,_t,Dt;class De{constructor(t,r){S(this,H);M(this,"label");S(this,F);S(this,J);S(this,K);S(this,Q);this.label=t.label,P(this,F,t),P(this,J,r);const{baseUrl:s,params:i}=ze(t.baseUrl);P(this,K,s),P(this,Q,i)}async search(t,{mapProjection:r,maxResults:s,signal:i}){const a=o(this,H,Dt).call(this,t,s),c=new bt({dataProjection:"EPSG:4326",featureProjection:r});return(await Te(n(this,J),a,i)).features.map(f=>o(this,H,_t).call(this,f,c))}}F=new WeakMap,J=new WeakMap,K=new WeakMap,Q=new WeakMap,H=new WeakSet,_t=function(t,r){const s=n(this,F).renderLabel?.(t),i=t.properties[n(this,F).labelProperty],a=t.properties[n(this,F).searchProperty],c=s||(i!==void 0?String(i):a!==void 0?String(a):"");return{id:t.id??Kt(),label:c,geometry:r.readGeometry(t.geometry),properties:t.properties}},Dt=function(t,r){const s=new URL(`${n(this,K)}/collections/${n(this,F).collectionId}/items`);for(const[i,a]of n(this,Q))s.searchParams.append(i,a);return s.searchParams.set(n(this,F).searchProperty,`*${t}*`),s.searchParams.set("limit",String(r)),s.searchParams.set("f","json"),n(this,F).rewriteUrl?.(new URL(s))??s};async function Te(e,t,r){try{const s=await e.fetch(t,{signal:r,headers:{Accept:"application/json"}});if(!s.ok)throw new Error("Request failed with status "+s.status);return await s.json()}catch(s){throw yt(s)?s:new Error("Failed to search on OGC API Features service",{cause:s})}}function ze(e){const t=new URL(e),r=new URLSearchParams(t.searchParams);return t.search="",{baseUrl:t.href.replace(/\/+$/,""),params:r}}var X;class or{constructor({references:t}){S(this,X);P(this,X,t.httpService)}createVectorSource(t){return Ae(t,n(this,X))}}X=new WeakMap;var Y;class ar{constructor({references:t}){S(this,Y);P(this,Y,t.httpService)}createSearchSource(t){return new De(t,n(this,Y))}}Y=new WeakMap;function $e(e,t){const r=y.useRef(e);r.current=e;const s=Be(t);return y.useMemo(()=>fe(()=>r.current()),[s])}function He(e){const t=y.useCallback(()=>e.peek(),[e]),r=y.useCallback(i=>{const a=Ee(()=>[e.value],i);return()=>a.destroy()},[e]),s=y.useSyncExternalStore(r,t);return y.useDebugValue(s),s}function Ze(e,t){const r=$e(e,t),s=He(r);return y.useDebugValue(s),s}function Be(e){const t=y.useRef();return(t.current==null||!Ge(t.current,e))&&(t.current=e??[]),t.current}function Ge(e,t){return e===t?!0:e.length===(t?.length??0)&&e.every((r,s)=>r===t[s])}const We="@open-pioneer/map-navigation",mt=Qt.bind(void 0,We),cr=y.forwardRef(function(t,r){const{containerProps:s}=ft("initial-extent",t),{map:i}=dt(t),a=mt();function c(){const l=i?.initialExtent,f=i?.olMap;if(l&&f){const v=[l.xMin,l.yMin,l.xMax,l.yMax];f.getView().fit(v,{duration:200})}}return I.jsx(ht,{ref:r,label:a.formatMessage({id:"initial-extent.title"}),icon:I.jsx(te,{}),onClick:c,...s})}),ur=y.forwardRef(function(t,r){return I.jsx(Tt,{zoomDirection:"in",ref:r,...t})}),lr=y.forwardRef(function(t,r){return I.jsx(Tt,{zoomDirection:"out",ref:r,...t})}),Tt=y.forwardRef(function(t,r){const{zoomDirection:s}=t,{map:i}=dt(t),a=mt(),[c,l]=y.useState(!1),{defaultClassName:f,buttonLabel:v,buttonIcon:m}=Je(a,s),{containerProps:p}=ft(xt("zoom",f),t);function R(){if(c)return;l(!0);const x=i?.olMap.getView();let g=x?.getZoom();const k=x?.getMaxZoom()||Number.MAX_SAFE_INTEGER,O=x?.getMinZoom()||0;x&&g!==void 0&&(s==="in"&&g<k?++g:s==="out"&&g>O&&--g,x.animate({zoom:g,duration:200},()=>l(!1)))}return I.jsx(ht,{ref:r,label:v,icon:m,onClick:R,...p})});function Je(e,t){switch(t){case"in":return{defaultClassName:"zoom-in",buttonLabel:e.formatMessage({id:"zoom-in.title"}),buttonIcon:I.jsx(re,{})};case"out":return{defaultClassName:"zoom-out",buttonLabel:e.formatMessage({id:"zoom-out.title"}),buttonIcon:I.jsx(ee,{})}}}const Ke=200;var L,lt,st,zt;class Qe{constructor(t){S(this,L);M(this,"olMap");M(this,"handle");M(this,"_mapViews",Ce());M(this,"_activeViewId",U(0));M(this,"backward",()=>{if(this.canBackward)o(this,L,st).call(this,this.activeViewId-1),o(this,L,lt).call(this,this.activeViewId);else throw new Error("Backward is not possible at the moment")});M(this,"forward",()=>{if(this.canForward)o(this,L,st).call(this,this.activeViewId+1),o(this,L,lt).call(this,this.activeViewId);else throw new Error("Forward is not possible at the moment")});this.olMap=t.olMap,this.handle=o(this,L,zt).call(this)}destroy(){this.handle&&Xt(this.handle),this.handle=void 0}get activeViewId(){return this._activeViewId.value}get mapViews(){return this._mapViews}get canBackward(){return this.mapViews.get(this.activeViewId-1)!=null}get canForward(){return this.mapViews.get(this.activeViewId+1)!=null}}L=new WeakSet,lt=function(t){const r=this.olMap.getView();this.olMap.setView(new Yt({center:this.mapViews.get(t).center,resolution:this.mapViews.get(t).resolution,projection:r.getProjection()}))},st=function(t){this._activeViewId.value=t},zt=function(){const t=this.olMap.on("moveend",()=>{r()}),r=()=>{const s=this.olMap,i=this.mapViews,a=s.getView(),c=a.getResolution(),l=a.getCenter();if(c!=null&&l!=null&&(l!==i.get(this.activeViewId)?.center||c!==i.get(this.activeViewId)?.resolution)){const f={resolution:c,center:l},v=this.activeViewId+1;for(const m of i.keys())m>v&&i.delete(m);for(const m of i.keys()){if(i.size<Ke)break;i.delete(m)}o(this,L,st).call(this,v),i.set(v,f)}};return t};const ct=new WeakMap;function Xe(e){const[t,r]=y.useState();return y.useEffect(()=>{if(!e)return;let s=ct.get(e);return s==null?(s={vm:new Qe(e),useCount:1},ct.set(e,s)):s.useCount++,r(s.vm),()=>{r(void 0),s.useCount--,s.useCount===0&&(s.vm.destroy(),ct.delete(e))}},[e]),t}const hr=y.forwardRef(function(t,r){return I.jsx($t,{viewDirection:"forward",ref:r,...t})}),fr=y.forwardRef(function(t,r){return I.jsx($t,{viewDirection:"backward",ref:r,...t})}),$t=y.forwardRef(function(t,r){const s=mt(),{viewDirection:i}=t,{map:a}=dt(t),c=Xe(a),{defaultClassName:l,buttonLabel:f,buttonIcon:v}=Ye(s,i),{containerProps:m}=ft(xt("view",l),t),p=Ze(()=>c?i==="forward"?c.canForward:c.canBackward:!1,[c,i]),R=()=>{c&&(i==="forward"?c.forward():c.backward())};return c&&I.jsx(ht,{ref:r,...m,label:f,icon:v,onClick:R,isDisabled:!p})});function Ye(e,t){switch(t){case"forward":return{defaultClassName:"view-forward",buttonLabel:e.formatMessage({id:"view-forward.title"}),buttonIcon:I.jsx(ie,{})};case"backward":return{defaultClassName:"view-backward",buttonLabel:e.formatMessage({id:"view-backward.title"}),buttonIcon:I.jsx(se,{})}}}export{fr as H,cr as I,ar as S,or as V,ur as Z,B as a,Ce as b,lr as c,hr as d,fe as e,nr as f,U as r,Ze as u,Ee as w};
