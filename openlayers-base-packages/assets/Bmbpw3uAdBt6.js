const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BOu-kg1heWko.js","./Dch09mLNbtBx.js","./CboLGRN6EGsf.js","./CfsOZItWJxSO.js","./CKJVqe80oimG.js","./CyHSoWdO5dIm.js","./BXT_Zj7rRNC1.js","./CZKMksgG1gB0.js","./Ou_tk4DdlQr6.js","./ByEtrROIq9PZ.js"])))=>i.map(i=>d[i]);
var $s=Object.defineProperty;var It=s=>{throw TypeError(s)};var Us=(s,e,t)=>e in s?$s(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var _=(s,e,t)=>Us(s,typeof e!="symbol"?e+"":e,t),it=(s,e,t)=>e.has(s)||It("Cannot "+t);var m=(s,e,t)=>(it(s,e,"read from private field"),t?t.call(s):e.get(s)),E=(s,e,t)=>e.has(s)?It("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),M=(s,e,t,n)=>(it(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),v=(s,e,t)=>(it(s,e,"access private method"),t);import{aE as qs,b5 as Ws,b6 as zs,b7 as Ks,b8 as Ys,aP as Js,aX as Xs,b9 as Zs,ba as Qs,a0 as en,bb as tn,bc as sn,h as $,bd as nn,be as rn,bf as on,bg as Zt,bh as an,bi as ln,a as _e,b as et,aL as qe,bj as Tt,bk as ue,E as kt,_ as U,bl as rt,a$ as Le,an as We,bm as Ve,bn as Ot,bo as B,m as A,bp as ee,bq as ct,br as cn,bs as un,x as hn,bt as ut,bu as dn,bv as fn,bw as Qt,ao as es,bx as gn,by as mn,bz as At,bA as pn,bB as Nt,bC as yn,bD as jt,a_ as yt,b0 as vt,b1 as vn,d as _t,u as oe,aZ as Z,g as Q,B as D,bE as _n,b4 as tt,bF as Sn,am as ts,bG as xn,bH as bn,c as ze,ax as Ee,F as ht,C as wn,bI as Rt,bJ as En,bK as Dt,i as Gt}from"./CKJVqe80oimG.js";import{u as Cn,m as Mn,r as g,n as Pn,h as St,o as ss,p as ns,q as is,j as h,f as z,s as Ln,t as Fn,c as De,b as rs,B as os,C as In,v as Tn,i as as,w as ls,l as kn,I as On}from"./CfsOZItWJxSO.js";import{G as cs}from"./Bpa3DNnYJJ3o.js";import{a as An}from"./DW3N9beJZBqr.js";import{D as us,S as Nn,I as jn,c as Rn,a as Dn}from"./BygLxmlAsq2F.js";import{u as W}from"./CyHSoWdO5dIm.js";import{T as ve,L as Gn,V as Vn}from"./CZKMksgG1gB0.js";import{c as hs}from"./Cggywb9cp24J.js";import{L as ds}from"./Cg2kYByUc4RN.js";import{u as fs,F as Ke}from"./BXT_Zj7rRNC1.js";import{F as Fe}from"./CFQDb4nmS4iS.js";import{H as dt}from"./C0eybGlw1vsF.js";import{F as K,r as ft}from"./CboLGRN6EGsf.js";import{F as Hn}from"./ByEtrROIq9PZ.js";import{_ as Bn}from"./Dch09mLNbtBx.js";function $n(s){const{theme:e}=Cn(),t=Mn();return g.useMemo(()=>Pn(e.direction,{...t,...s}),[s,e.direction,t])}var xt=St(function(e,t){const{htmlSize:n,...i}=e,r=ss("Input",i),o=ns(i),a=fs(o),l=is("chakra-input",e.className);return h.jsx(z.input,{size:n,...a,__css:r.field,ref:t,className:l})});xt.displayName="Input";xt.id="Input";var gs=St(function(e,t){const{children:n,placeholder:i,className:r,...o}=e;return h.jsxs(z.select,{...o,ref:t,className:is("chakra-select",r),children:[i&&h.jsx("option",{value:"",children:i}),n]})});gs.displayName="SelectField";function Un(s,e){const t={},n={};for(const[i,r]of Object.entries(s))e.includes(i)?t[i]=r:n[i]=r;return[t,n]}var bt=St((s,e)=>{var t;const n=ss("Select",s),{rootProps:i,placeholder:r,icon:o,color:a,height:l,h:c,minH:u,minHeight:d,iconColor:p,iconSize:f,...y}=ns(s),[b,F]=Un(y,Fn),P=fs(F),N={width:"100%",height:"fit-content",position:"relative",color:a},G={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(t=n.field)==null?void 0:t._focus}};return h.jsxs(z.div,{className:"chakra-select__wrapper",__css:N,...b,...i,children:[h.jsx(gs,{ref:e,height:c??l,minH:u??d,placeholder:r,...P,__css:G,children:s.children}),h.jsx(ms,{"data-disabled":Ln(P.disabled),...(p||a)&&{color:p||a},__css:n.icon,...f&&{fontSize:f},children:o})]})});bt.displayName="Select";var qn=s=>h.jsx("svg",{viewBox:"0 0 24 24",...s,children:h.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Wn=z("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),ms=s=>{const{children:e=h.jsx(qn,{}),...t}=s,n=g.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return h.jsx(Wn,{...t,className:"chakra-select__icon-wrapper",children:g.isValidElement(e)?n:null})};ms.displayName="SelectIcon";const I={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Ye extends qs{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Ws,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(I.ELEMENT,this.handleElementChanged),this.addChangeListener(I.MAP,this.handleMapChanged),this.addChangeListener(I.OFFSET,this.handleOffsetChanged),this.addChangeListener(I.POSITION,this.handlePositionChanged),this.addChangeListener(I.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(I.ELEMENT)}getId(){return this.id}getMap(){return this.get(I.MAP)||null}getOffset(){return this.get(I.OFFSET)}getPosition(){return this.get(I.POSITION)}getPositioning(){return this.get(I.POSITIONING)}handleElementChanged(){zs(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Ks(this.element),Ys(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Js(e,Xs.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(I.ELEMENT,e)}setMap(e){this.set(I.MAP,e)}setOffset(e){this.set(I.OFFSET,e)}setPosition(e){this.set(I.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(I.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[Zs(i),Qs(i)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!en(n,r)){const a=r[0]-n[0],l=n[2]-r[2],c=r[1]-n[1],u=n[3]-r[3],d=[0,0];if(a<0?d[0]=a-o:l<0&&(d[0]=Math.abs(l)+o),c<0?d[1]=c-o:u<0&&(d[1]=Math.abs(u)+o),d[0]!==0||d[1]!==0){const p=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(p);if(!f)return;const y=[f[0]+d[0],f[1]+d[1]],b=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(y),duration:b.duration,easing:b.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),i=n.left+window.pageXOffset,r=n.top+window.pageYOffset;return[i,r,i+t[0],r+t[1]]}setPositioning(e){this.set(I.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),i=e.getSize();this.updateRenderedPosition(n,i)}updateRenderedPosition(e,t){const n=this.element.style,i=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+i[0])+"px",a=Math.round(e[1]+i[1])+"px";let l="0%",c="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?c="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(c="-50%");const u=`translate(${l}, ${c}) translate(${o}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,n.transform=u)}getOptions(){return this.options}}const vo=tn,zn=25.4/.28,Kn=39.37;function wt(s){return Et(s,Yn,Jn)}function Yn(s){return s.getView()}function Jn(s,e){return s.on("change:view",e)}function ps(s){return wt(s)?.getProjection()}function Xn(s){const e=wt(s);return Et(e,Zn,Qn)}function Zn(s){return s.getResolution()}function Qn(s,e){return s.on("change:resolution",e)}function ei(s){const e=wt(s);return Et(e,ti,si)}function ti(s){return s.getCenter()}function si(s,e){return s.on("change:center",e)}function ni(s){const e=ei(s),t=Xn(s),n=ps(s);return g.useMemo(()=>{if(n==null||t==null||e==null)return;const r=sn(n,t,e);return Math.round(r*Kn*zn)},[n,t,e])}function Et(s,e,t){const n=g.useCallback(()=>s?e(s):void 0,[s,e]),i=g.useCallback(r=>{if(!s)return()=>{};const o=t(s,r);return()=>$(o)},[s,t]);return g.useSyncExternalStore(i,n)}var ii=Symbol.for("preact-signals");function st(){if(X>1)X--;else{for(var s,e=!1;Ce!==void 0;){var t=Ce;for(Ce=void 0,gt++;t!==void 0;){var n=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&vs(t))try{t.c()}catch(i){e||(s=i,e=!0)}t=n}}if(gt=0,X--,e)throw s}}function ri(s){if(X>0)return s();X++;try{return s()}finally{st()}}var x=void 0;function Ct(s){var e=x;x=void 0;try{return s()}finally{x=e}}var Ce=void 0,X=0,gt=0,Je=0;function ys(s){if(x!==void 0){var e=s.n;if(e===void 0||e.t!==x)return e={i:0,S:s,p:x.s,n:void 0,t:x,e:void 0,x:void 0,r:e},x.s!==void 0&&(x.s.n=e),x.s=e,s.n=e,32&x.f&&s.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=x.s,e.n=void 0,x.s.n=e,x.s=e),e}}function k(s){this.v=s,this.i=0,this.n=void 0,this.t=void 0}k.prototype.brand=ii;k.prototype.h=function(){return!0};k.prototype.S=function(s){this.t!==s&&s.e===void 0&&(s.x=this.t,this.t!==void 0&&(this.t.e=s),this.t=s)};k.prototype.U=function(s){if(this.t!==void 0){var e=s.e,t=s.x;e!==void 0&&(e.x=t,s.e=void 0),t!==void 0&&(t.e=e,s.x=void 0),s===this.t&&(this.t=t)}};k.prototype.subscribe=function(s){var e=this;return ws(function(){var t=e.value,n=x;x=void 0;try{s(t)}finally{x=n}})};k.prototype.valueOf=function(){return this.value};k.prototype.toString=function(){return this.value+""};k.prototype.toJSON=function(){return this.value};k.prototype.peek=function(){var s=x;x=void 0;try{return this.value}finally{x=s}};Object.defineProperty(k.prototype,"value",{get:function(){var s=ys(this);return s!==void 0&&(s.i=this.i),this.v},set:function(s){if(s!==this.v){if(gt>100)throw new Error("Cycle detected");this.v=s,this.i++,Je++,X++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{st()}}}});function oi(s){return new k(s)}function vs(s){for(var e=s.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function _s(s){for(var e=s.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){s.s=e;break}}}function Ss(s){for(var e=s.s,t=void 0;e!==void 0;){var n=e.p;e.i===-1?(e.S.U(e),n!==void 0&&(n.n=e.n),e.n!==void 0&&(e.n.p=n)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=n}s.s=t}function Se(s){k.call(this,void 0),this.x=s,this.s=void 0,this.g=Je-1,this.f=4}(Se.prototype=new k).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Je))return!0;if(this.g=Je,this.f|=1,this.i>0&&!vs(this))return this.f&=-2,!0;var s=x;try{_s(this),x=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return x=s,Ss(this),this.f&=-2,!0};Se.prototype.S=function(s){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}k.prototype.S.call(this,s)};Se.prototype.U=function(s){if(this.t!==void 0&&(k.prototype.U.call(this,s),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};Se.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var s=this.t;s!==void 0;s=s.x)s.t.N()}};Object.defineProperty(Se.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var s=ys(this);if(this.h(),s!==void 0&&(s.i=this.i),16&this.f)throw this.v;return this.v}});function xs(s){return new Se(s)}function bs(s){var e=s.u;if(s.u=void 0,typeof e=="function"){X++;var t=x;x=void 0;try{e()}catch(n){throw s.f&=-2,s.f|=8,Mt(s),n}finally{x=t,st()}}}function Mt(s){for(var e=s.s;e!==void 0;e=e.n)e.S.U(e);s.x=void 0,s.s=void 0,bs(s)}function ai(s){if(x!==this)throw new Error("Out-of-order effect");Ss(this),x=s,this.f&=-2,8&this.f&&Mt(this),st()}function Ge(s){this.x=s,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Ge.prototype.c=function(){var s=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{s()}};Ge.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,bs(this),_s(this),X++;var s=x;return x=this,ai.bind(this,s)};Ge.prototype.N=function(){2&this.f||(this.f|=2,this.o=Ce,Ce=this)};Ge.prototype.d=function(){this.f|=8,1&this.f||Mt(this)};function ws(s){var e=new Ge(s);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}function ie(s,e){return new ui(s,e?.equal)}function li(s,e){return new ci(s,e?.equal)}function _o(s){return ri(s)}function Pt(s){return Ct(s)}var ce=Symbol("signal"),Me=Symbol("equals"),Es=class{[ce];constructor(s){this[ce]=s}get value(){return this[ce].value}set value(s){throw new Error("Cannot update a readonly reactive object.")}trigger(){throw new Error("Cannot trigger this reactive object.")}peek(){return this[ce].peek()}toJSON(){return this.value}toString(){return`Reactive[value=${di(this[ce].value)}]`}},ci=class extends Es{[Me];constructor(s,e){const t=xs(e?hi(s,e):s);super(t),this[Me]=e}},ui=class extends Es{[Me];constructor(s,e){super(oi(s)),this[Me]=e}get value(){return super.value}set value(s){Ct(()=>this[Me]?.(this.value,s))||(this[ce].value=s)}};function hi(s,e){let t=!0,n;return function(){const r=s();return Ct(()=>((t||!e(n,r))&&(n=r,t=!1),n))}}function di(s){return typeof s=="string"?JSON.stringify(s):String(s)}function fi(s,e){return s===e?!0:s.length===e.length&&s.every((t,n)=>t===e[n])}function gi(s,e,t,n){const i=xs(e),r=n?.immediate??!1;let o,a;function l(){const d=a;a=void 0;try{d?.()}catch(p){throw u.destroy(),p}}const c=s(()=>{const d=i.value;Pt(()=>{const p=!o&&r||o&&!fi(o,d);o=d,p&&(l(),a=t(d))})}),u={destroy(){try{l()}finally{c.destroy()}}};return u}function mi(s){return{destroy:ws(s)}}function pi(s,e){let t=0,n=!0,i;return i=mi(()=>{const r=t++;if(r===0)return s();r===1&&Pt(()=>{try{e()}finally{n?Promise.resolve().then(()=>i?.destroy()):i?.destroy()}})}),n=!1,i}function Cs(s){Promise.reject(new Error("Error in effect or watch callback",{cause:s}))}var yi=class{queue=[];channel=new MessageChannel;constructor(){this.channel.port2.start()}enqueue(s){const e={fn:s,destroyed:!1};return this.queue.push(e),this.queue.length===1&&this.scheduleIteration(),{destroy(){e.destroyed||(e.destroyed=!0)}}}messageHandler=()=>this.runIteration();scheduleIteration(){const s=this.channel;s.port2.addEventListener("message",this.messageHandler),s.port1.postMessage("")}runIteration(){this.channel.port2.removeEventListener("message",this.messageHandler);const s=this.queue;this.queue=[];for(const e of s)if(!e.destroyed)try{e.fn()}catch(t){Cs(t)}}};function vi(s){const e=new _i(s);return{destroy:e.destroy.bind(e)}}var _i=class{callback;cleanup;effectHandle;scheduledExecution;isDestroyed=!1;initialExecution=!0;isExecuting=!1;constructor(s){this.callback=s,this.execute(),this.initialExecution=!1}destroy(){if(!this.isDestroyed){this.isDestroyed=!0;try{this.triggerCleanup()}finally{this.effectHandle?.destroy(),this.effectHandle=void 0,this.scheduledExecution?.destroy(),this.scheduledExecution=void 0}}}execute(){this.isExecuting=!0;try{const s=pi(()=>{if(this.initialExecution)this.triggerCallback();else try{this.triggerCallback()}catch(e){Cs(e)}},()=>this.scheduleExecution());this.isDestroyed?s.destroy():this.effectHandle=s}finally{this.isExecuting=!1}}triggerCallback(){this.triggerCleanup(),this.isDestroyed||(this.cleanup=this.callback())}triggerCleanup(){const s=this.cleanup;this.cleanup=void 0;try{s&&Pt(s)}catch(e){throw this.destroy(),e}}scheduleExecution(){if(!this.isDestroyed){if(this.effectHandle?.destroy(),this.effectHandle=void 0,this.isExecuting)throw new Error("Cycle detected");this.scheduledExecution||(this.scheduledExecution=bi(()=>{try{this.execute()}finally{this.scheduledExecution=void 0}}))}}};function Si(s,e,t){return gi(vi,s,e,t)}var xi=new yi;function bi(s){return xi.enqueue(s)}function So(s){return new wi(s)}var T,de,L,te,$e,Ms,Ps,Xt,wi=(Xt=class{constructor(s){E(this,L);E(this,T,new Map);E(this,de,ie(!1));if(s)for(const[e,t]of s)m(this,T).set(e,ie(t))}get size(){return v(this,L,te).call(this),m(this,T).size}entries(){return v(this,L,te).call(this),v(this,L,Ms).call(this)}keys(){return v(this,L,te).call(this),m(this,T).keys()}values(){return v(this,L,te).call(this),v(this,L,Ps).call(this)}[Symbol.iterator](){return this.entries()}clear(){const s=!!m(this,T).size;m(this,T).clear(),s&&v(this,L,$e).call(this)}delete(s){const e=m(this,T).delete(s);return e&&v(this,L,$e).call(this),e}get(s){return v(this,L,te).call(this),m(this,T).get(s)?.value}has(s){return v(this,L,te).call(this),m(this,T).has(s)}set(s,e){const t=m(this,T).get(s);return t?t.value=e:(m(this,T).set(s,ie(e)),v(this,L,$e).call(this)),this}},T=new WeakMap,de=new WeakMap,L=new WeakSet,te=function(){m(this,de).value},$e=function(){m(this,de).value=!m(this,de).peek()},Ms=function*(){const s=m(this,T).entries();for(const[e,t]of s)yield[e,t.value]},Ps=function*(){const s=m(this,T).values();for(const e of s)yield e.value},Xt);function be(s){return new Ei(s)}var C,fe,S,se,Ue,Ls,Fs,R,ne,ge,Ei=(ge=class{constructor(e){E(this,S);E(this,C);E(this,fe,ie(!1));M(this,C,e?Array.from(e).map(t=>ie(t)):[])}get length(){return v(this,S,R).call(this),m(this,C).length}push(...e){m(this,C).push(...e.map(t=>ie(t))),v(this,S,ne).call(this)}pop(){if(m(this,C).length===0)return;const e=m(this,C).pop();return v(this,S,ne).call(this),e.value}unshift(...e){m(this,C).unshift(...e.map(t=>ie(t))),v(this,S,ne).call(this)}shift(){if(m(this,C).length===0)return;const e=m(this,C).shift();return v(this,S,ne).call(this),e.value}splice(...e){const t=e[2],n=m(this,C).splice(...e);return(t!=null&&t.length!==0||n.length!==0)&&v(this,S,ne).call(this),n.map(i=>i.value)}sort(e){m(this,C).sort((t,n)=>e(t.value,n.value)),v(this,S,ne).call(this)}getItems(){return v(this,S,R).call(this),m(this,C).map(e=>e.value)}at(e){return v(this,S,R).call(this),m(this,C).at(e)?.value}get(e){return v(this,S,R).call(this),m(this,C)[e]?.value}set(e,t){if(e<0||e>=m(this,C).length)throw new Error("index out of bounds");const n=m(this,C)[e];n.value=t}slice(...e){v(this,S,R).call(this);const t=m(this,C).slice(...e).map(n=>n.value);return be(t)}concat(...e){const t=this.getItems().concat(...e.map(n=>n instanceof ge?n.getItems():n));return be(t)}includes(e,t){return v(this,S,se).call(this,n=>n===e,t)!==-1}indexOf(e,t){return v(this,S,se).call(this,n=>n===e,t)}lastIndexOf(e){return v(this,S,Ue).call(this,t=>t===e)}find(e){const t=v(this,S,se).call(this,e);return this.get(t)}findLast(e){const t=v(this,S,Ue).call(this,e);return this.get(t)}findIndex(e){return v(this,S,se).call(this,e)}findLastIndex(e){return v(this,S,Ue).call(this,e)}some(e){return v(this,S,se).call(this,e)!==-1}every(e){return v(this,S,se).call(this,(t,n)=>!e(t,n))===-1}forEach(e){for(const[t,n]of this.entries())e(n,t)}filter(e){return be(this.getItems().filter((t,n)=>e(t,n)))}map(e){return be(this.getItems().map((t,n)=>e(t,n)))}flatMap(e){return be(this.getItems().flatMap((t,n)=>e(t,n)))}reduce(e,...t){return v(this,S,R).call(this),m(this,C).reduce((n,i,r)=>e(n,i.value,r),...t)}reduceRight(e,...t){return v(this,S,R).call(this),m(this,C).reduceRight((n,i,r)=>e(n,i.value,r),...t)}keys(){return v(this,S,R).call(this),m(this,C).keys()}values(){return v(this,S,R).call(this),v(this,S,Ls).call(this)}entries(){return v(this,S,R).call(this),v(this,S,Fs).call(this)}[Symbol.iterator](){return this.values()}},C=new WeakMap,fe=new WeakMap,S=new WeakSet,se=function(e,t){for(let n=t??0,i=this.length;n<i;++n){const r=this.get(n);if(e(r,n))return n}return-1},Ue=function(e){for(let t=this.length;t-- >0;){const n=this.get(t);if(e(n,t))return t}return-1},Ls=function*(){for(const e of m(this,C))yield e.value},Fs=function*(){for(const[e,t]of m(this,C).entries())yield[e,t.value]},R=function(){m(this,fe).value},ne=function(){m(this,fe).value=!m(this,fe).peek()},ge);const Vt=0,Pe=1,Ht=[0,0,0,0],he=[],ot={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class at extends es{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class Ci extends nn{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:rn,this.defaultDeleteCondition_=function(n){return on(n)&&Zt(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:an,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ln,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new _e({source:new et({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Pi(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new qe(this.source_.getFeatures()),this.source_.addEventListener(Tt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Tt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ue.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ue.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const i=this.SEGMENT_WRITERS_[t.getType()];i&&i(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(kt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new qe;const n=this.featuresBeingModified_.getArray();for(let i=0,r=t.length;i<r;++i){const o=t[i];for(let a=0,l=o.length;a<l;++a){const c=o[a].feature;c&&!n.includes(c)&&this.featuresBeingModified_.push(c)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new at(ot.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(kt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(i){e===i.feature&&n.push(i)});for(let i=n.length-1;i>=0;--i){const r=n[i];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),i={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),i)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){const o=n[i],a={feature:e,geometry:t,depth:[i],index:i,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let i=0,r=n.length-1;i<r;++i){const o=n.slice(i,i+2),a={feature:e,geometry:t,index:i,segment:o};this.rBush_.insert(U(o),a)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){const o=n[i];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),u={feature:e,geometry:t,depth:[i],index:a,segment:c};this.rBush_.insert(U(c),u)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){const o=n[i];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),u={feature:e,geometry:t,depth:[i],index:a,segment:c};this.rBush_.insert(U(c),u)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let i=0,r=n.length;i<r;++i){const o=n[i];for(let a=0,l=o.length;a<l;++a){const c=o[a];for(let u=0,d=c.length-1;u<d;++u){const p=c.slice(u,u+2),f={feature:e,geometry:t,depth:[a,i],index:u,segment:p};this.rBush_.insert(U(p),f)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),i={feature:e,geometry:t,index:Vt,segment:[n,n]},r={feature:e,geometry:t,index:Pe,segment:[n,n]},o=[i,r];i.featureSegments=o,r.featureSegments=o,this.rBush_.insert(rt(n),i);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let i=0;i<n.length;++i){const r=n[i],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,n){let i=this.vertexFeature_;return i?i.getGeometry().setCoordinates(e):(i=new Le(new We(e)),this.vertexFeature_=i,this.overlay_.getSource().addFeature(i)),i.set("features",t),i.set("geometries",n),i}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Ve.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Ve.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Ve.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],i=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],c=l.feature;n.includes(c)||n.push(c);const u=l.geometry;i.includes(u)||i.push(u);const d=l.depth;let p;const f=l.segment,y=a[1];for(;t.length<u.getStride();)t.push(f[y][t.length]);switch(u.getType()){case"Point":p=t,f[0]=t,f[1]=t;break;case"MultiPoint":p=u.getCoordinates(),p[l.index]=t,f[0]=t,f[1]=t;break;case"LineString":p=u.getCoordinates(),p[l.index+y]=t,f[y]=t;break;case"MultiLineString":p=u.getCoordinates(),p[d[0]][l.index+y]=t,f[y]=t;break;case"Polygon":p=u.getCoordinates(),p[d[0]][l.index+y]=t,f[y]=t;break;case"MultiPolygon":p=u.getCoordinates(),p[d[1]][d[0]][l.index+y]=t,f[y]=t;break;case"Circle":if(f[0]=t,f[1]=t,l.index===Vt)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let b=Ot(B(u.getCenter()),B(t));u.setRadius(b),this.changingFeature_=!1}break}p&&this.setGeometryCoordinates_(u,p)}this.createOrUpdateVertexFeature_(t,n,i)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(n){e.map.getView().getProjection();const i=[],r=n.getGeometry().getCoordinates(),o=U([r]),a=this.rBush_.getInExtent(o),l={};a.sort(Mi);for(let c=0,u=a.length;c<u;++c){const d=a[c],p=d.segment;let f=A(d.geometry);const y=d.depth;if(y&&(f+="-"+y.join("-")),l[f]||(l[f]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===Pe){const b=$t(t,d);ee(b,r)&&!l[f][0]&&(this.dragSegments_.push([d,0]),l[f][0]=d);continue}if(ee(p[0],r)&&!l[f][0]){this.dragSegments_.push([d,0]),l[f][0]=d;continue}if(ee(p[1],r)&&!l[f][1]){if(l[f][0]&&l[f][0].index===0){let b=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":b=b[y[1]];case"Polygon":if(d.index!==b[y[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),l[f][1]=d;continue}A(p)in this.vertexSegments_&&!l[f][0]&&!l[f][1]&&this.insertVertexCondition_(e)&&i.push(d)}i.length&&this.willModifyFeatures_(e,[i]);for(let c=i.length-1;c>=0;--c)this.insertVertex_(i[c],r)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],i=n.geometry;if(i.getType()==="Circle"){const r=i.getCenter(),o=n.featureSegments[0],a=n.featureSegments[1];o.segment[0]=r,o.segment[1]=r,a.segment[0]=r,a.segment[1]=r,this.rBush_.update(rt(r),o);let l=i;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(U(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new at(ot.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,n){const i=n||t.getCoordinateFromPixel(e);t.getView().getProjection();const r=function(l,c){return Bt(i,l)-Bt(i,c)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(c,u,d)=>{d&&d.getType()==="Point"&&(d=new We(ct(d.getCoordinates())));const p=d||c.getGeometry();if(c instanceof Le&&this.features_.getArray().includes(c)){a=p;const f=c.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:c,geometry:a,segment:[f,f]}]}return!0},{layerFilter:l})}if(!o){const l=cn(rt(i,Ht)),c=t.getView().getResolution()*this.pixelTolerance_,u=un(hn(l,c,Ht));o=this.rBush_.getInExtent(u)}if(o&&o.length>0){const l=o.sort(r)[0],c=l.segment;let u=$t(i,l);const d=t.getPixelFromCoordinate(u);let p=Ot(e,d);if(a||p<=this.pixelTolerance_){const f={};if(f[A(c)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-i[0],this.delta_[1]=u[1]-i[1]),l.geometry.getType()==="Circle"&&l.index===Pe)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);else{const y=t.getPixelFromCoordinate(c[0]),b=t.getPixelFromCoordinate(c[1]),F=ut(d,y),P=ut(d,b);p=Math.sqrt(Math.min(F,P)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(u=F>P?c[1]:c[0]),this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);const N={};N[A(l.geometry)]=!0;for(let G=1,Y=o.length;G<Y;++G){const O=o[G].segment;if(ee(c[0],O[0])&&ee(c[1],O[1])||ee(c[0],O[1])&&ee(c[1],O[0])){const j=A(o[G].geometry);j in N||(N[j]=!0,f[A(O)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,i=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(r,l);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(r,a,o,1);const u={segment:[n[0],t],feature:i,geometry:r,depth:o,index:a};c.insert(U(u.segment),u),this.dragSegments_.push([u,1]);const d={segment:[t,n[1]],feature:i,geometry:r,depth:o,index:a+1};c.insert(U(d.segment),d),this.dragSegments_.push([d,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Ve.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new at(ot.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,i,r,o,a,l,c,u,d,p,f,y;for(l=e.length-1;l>=0;--l)o=e[l],f=o[0],y=A(f.feature),f.depth&&(y+="-"+f.depth.join("-")),y in t||(t[y]={}),o[1]===0?(t[y].right=f,t[y].index=f.index):o[1]==1&&(t[y].left=f,t[y].index=f.index+1);for(y in t){switch(p=t[y].right,u=t[y].left,c=t[y].index,d=c-1,u!==void 0?f=u:f=p,d<0&&(d=0),a=f.geometry,r=a.getCoordinates(),i=r,n=!1,a.getType()){case"MultiLineString":r[f.depth[0]].length>2&&(r[f.depth[0]].splice(c,1),n=!0);break;case"LineString":r.length>2&&(r.splice(c,1),n=!0);break;case"MultiPolygon":i=i[f.depth[1]];case"Polygon":i=i[f.depth[0]],i.length>4&&(c==i.length-1&&(c=0),i.splice(c,1),n=!0,c===0&&(i.pop(),i.push(i[0]),d=i.length-1));break}if(n){this.setGeometryCoordinates_(a,r);const b=[];if(u!==void 0&&(this.rBush_.remove(u),b.push(u.segment[0])),p!==void 0&&(this.rBush_.remove(p),b.push(p.segment[1])),u!==void 0&&p!==void 0){const F={depth:f.depth,feature:f.feature,geometry:f.geometry,index:d,segment:b};this.rBush_.insert(U(F.segment),F)}this.updateSegmentIndices_(a,c,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,i){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(n===void 0||r.depth===void 0||dn(r.depth,n))&&r.index>t&&(r.index+=i)})}}function Mi(s,e){return s.index-e.index}function Bt(s,e,t){const n=e.geometry;if(n.getType()==="Circle"){let r=n;if(e.index===Pe){const o=ut(r.getCenter(),B(s)),a=Math.sqrt(o)-r.getRadius();return a*a}}const i=B(s);return he[0]=B(e.segment[0]),he[1]=B(e.segment[1]),gn(i,he)}function $t(s,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===Pe)return ct(n.getClosestPoint(B(s)));const i=B(s);return he[0]=B(e.segment[0]),he[1]=B(e.segment[1]),ct(fn(i,he))}function Pi(){const s=Qt();return function(e,t){return s.Point}}const Li={SELECT:"select"};class Fi extends es{constructor(e,t,n,i){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=i}}const He={};class Is extends mn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Zt,this.addCondition_=e.addCondition?e.addCondition:At,this.removeCondition_=e.removeCondition?e.removeCondition:At,this.toggleCondition_=e.toggleCondition?e.toggleCondition:pn,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:Nt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:Ii(),this.features_=e.features||new qe;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(i){return n.includes(i)}}else t=Nt;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[A(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[A(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(ue.ADD,this.boundAddFeature_),this.features_.addEventListener(ue.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(ue.ADD,this.boundAddFeature_),this.features_.removeEventListener(ue.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.getMap().getAllLayers().find(function(i){if(i instanceof _e&&i.getSource()&&i.getSource().hasFeature(t))return i});n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=A(e);t in He||(He[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let i=t.length-1;i>=0;--i){const r=t[i];if(r!==this&&r instanceof Is&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const n=A(e);e.setStyle(He[n]),delete He[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[A(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),i=this.toggleCondition_(e),r=!t&&!n&&!i,o=e.map,a=this.getFeatures(),l=[],c=[];if(r){yn(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(u,d)=>{if(!(!(u instanceof Le)||!this.filter_(u,d)))return this.addFeatureLayerAssociation_(u,d),c.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=a.getLength()-1;u>=0;--u){const d=a.item(u),p=c.indexOf(d);p>-1?c.splice(p,1):(a.remove(d),l.push(d))}c.length!==0&&a.extend(c)}else{o.forEachFeatureAtPixel(e.pixel,(u,d)=>{if(!(!(u instanceof Le)||!this.filter_(u,d)))return(t||i)&&!a.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,d),c.push(u)):(n||i)&&a.getArray().includes(u)&&(l.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=l.length-1;u>=0;--u)a.remove(l[u]);a.extend(c)}return(c.length>0||l.length>0)&&this.dispatchEvent(new Fi(Li.SELECT,c,l,e)),!0}}function Ii(){const s=Qt();return jt(s.Polygon,s.LineString),jt(s.GeometryCollection,s.LineString),function(e){return e.getGeometry()?s[e.getGeometry().getType()]:null}}async function Ti(s,e,t,n){const r=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),o=await s.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${r}>`}});if(!o||!o.ok||o.status!==201)throw new Error("Request failed: "+o.status);const a=o.headers.get("location");if(!a)throw new Error("Request failed: no Location response header");const l=a.substring(a.lastIndexOf("/")+1);return Promise.resolve(l)}async function ki(s,e,t,n,i){const o=i.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=new URL(`${e.toString()}/${t}`),l=await s.fetch(a,{method:"PATCH",body:JSON.stringify({type:"Feature",properties:{},geometry:n}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${o}>`}});if(!l||!l.ok||l.status!==204)throw new Error("Request failed: "+l.status);return Promise.resolve(t)}function Ts(s,e){const t=document.createElement("div");t.className="editing-tooltip editing-tooltip-hidden",t.role="tooltip";const n=document.createElement("span");n.textContent=e,t.appendChild(n);const i=new Ye({element:t,offset:[15,0],positioning:"center-left"}),r=s.on("pointermove",o=>{o.dragging||i.setPosition(o.coordinate)});return s.addOverlay(i),{destroy(){$(r),s.removeOverlay(i)},setVisible(o){t.classList.toggle("editing-tooltip-hidden",!o)},setText(o){n.textContent=o}}}function ks(s){let e=Ut(s.polygon);Array.isArray(e)&&(e=e[0]);let t=Ut(s.vertex);Array.isArray(t)&&(t=t[0]);const n=[];return e&&n.push(e),t&&(t.setGeometry(Oi),n.push(t)),n}const Oi=s=>{if(s){const e=s.getGeometry();if(e&&e.getType()==="Polygon"){const t=e.getCoordinates()[0];if(t)return new An(t)}}},Ut=s=>{const e=new Le,n=new _e({style:s}).getStyleFunction();if(!n)throw new Error("can't retrieve style function");const i=n(e,1);if(!i)throw new Error("can't retrieve styles from feature style function");return Array.isArray(i)&&i.length?i.length>1?i:i[0]:i},Ai=De("editing:EditingCreateWorkflowImpl");var q;class Ni extends yt{constructor(t){super();E(this,q);_(this,"_httpService");_(this,"_intl");_(this,"_map");_(this,"_polygonStyle");_(this,"_vertexStyle");_(this,"_state");_(this,"_editLayerURL");_(this,"_featureId");_(this,"_editingSource");_(this,"_editingLayer");_(this,"_drawInteraction");_(this,"_olMap");_(this,"_mapContainer");_(this,"_tooltip");_(this,"_enterHandler");_(this,"_escapeHandler");_(this,"_error");_(this,"_interactionListener");_(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._editingSource=new et,this._editingLayer=new _e({source:this._editingSource,zIndex:vt,properties:{name:"editing-layer"}}),this._drawInteraction=new us({source:this._editingSource,type:"Polygon",style:ks({polygon:this._polygonStyle,vertex:this._vertexStyle})}),this._tooltip=Ts(this._olMap,this._intl.formatMessage({id:"create.tooltip.begin"})),this._enterHandler=n=>{if((n.code==="Enter"||n.code==="NumpadEnter")&&n.target===this._olMap.getTargetElement()){const i=this._drawInteraction.getOverlay().getSource()?.getFeatures()??[];i[0]&&i[0].getGeometry().getCoordinates()[0].length>4&&this.triggerSave()}},this._escapeHandler=n=>{n.code==="Escape"&&n.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const n=this._editLayerURL,i=t.getGeometry();if(!i){this._destroy(),this._error=new Error("no geometry available"),m(this,q)?.reject(this._error);return}const r=this._olMap.getView().getProjection(),a=new cs({dataProjection:r}).writeGeometryObject(i,{rightHanded:!0,decimals:10});Ti(this._httpService,n,a,r).then(l=>{this._featureId=l,this._destroy(),m(this,q)?.resolve({featureId:this._featureId})}).catch(l=>{Ai.error(l),this._destroy(),this._error=new Error("Failed to save feature",{cause:l}),m(this,q)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.continue"}))}),n=this._drawInteraction.on("drawend",r=>{const o=r.feature;if(!o){this._destroy(),this._error=new Error("no feature available"),m(this,q)?.reject(this._error);return}this._save(o)}),i=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(t,n),this._mapListener.push(i)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.begin"})),this._setState("active:initialized")}stop(){this._destroy(),m(this,q)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{$(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){this._drawInteraction.finishDrawing()}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(m(this,q)??M(this,q,rs())).promise}}q=new WeakMap;var V;class ji extends yt{constructor(t){super();E(this,V);_(this,"_httpService");_(this,"_intl");_(this,"_map");_(this,"_polygonStyle");_(this,"_vertexStyle");_(this,"_state");_(this,"_editLayerURL");_(this,"_featureId");_(this,"_initialFeature");_(this,"_editFeature");_(this,"_editingSource");_(this,"_editingLayer");_(this,"_modifyInteraction");_(this,"_olMap");_(this,"_mapContainer");_(this,"_tooltip");_(this,"_enterHandler");_(this,"_escapeHandler");_(this,"_error");_(this,"_interactionListener");_(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._initialFeature=t.feature.clone(),this._initialFeature.setId(t.feature.getId()),this._editFeature=t.feature.clone(),this._editFeature.setId(t.feature.getId()),this._editFeature.setStyle(ks({polygon:this._polygonStyle,vertex:this._vertexStyle})),this._editingSource=new et({features:new qe([this._editFeature])}),this._editingLayer=new _e({source:this._editingSource,zIndex:vt,properties:{name:"editing-layer"}}),this._modifyInteraction=new Ci({source:this._editingSource}),this._tooltip=Ts(this._olMap,this._intl.formatMessage({id:"create.tooltip.deselect"})),this._enterHandler=n=>{if((n.code==="Enter"||n.code==="NumpadEnter")&&n.target===this._olMap.getTargetElement()){const i=this._editingSource.getFeatures()[0];if(!i)throw Error("no updated feature found");this._save(i)}},this._escapeHandler=n=>{n.code==="Escape"&&n.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getModifyInteraction(){return this._modifyInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const n=this._editLayerURL;if(this._featureId=t.getId()?.toString(),!this._featureId){this._destroy(),this._error=new Error("no feature id available"),m(this,V)?.reject(this._error);return}const i=t?.getGeometry();if(!i){this._destroy(),this._error=new Error("no geometry available"),m(this,V)?.reject(this._error);return}const r=this._olMap.getView().getProjection(),a=new cs({dataProjection:r}).writeGeometryObject(i,{rightHanded:!0,decimals:10});ki(this._httpService,n,this._featureId,a,r).then(l=>{this._destroy(),m(this,V)?.resolve({featureId:l})}).catch(l=>{this._destroy(),this._error=new Error("Failed to save feature",{cause:l}),m(this,V)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._modifyInteraction);const t=this._editingSource.getFeatures()[0];if(t&&!t.getId()?.toString()){this._destroy(),this._error=new Error("no feature id available"),m(this,V)?.reject(this._error);return}this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const n=this._map.olMap.on("click",o=>{const a=o.coordinate,l=o.originalEvent.altKey,c=this._editingSource.getFeaturesAtCoordinate(a);l||c.length===0&&this.triggerSave()}),i=this._modifyInteraction.on("modifystart",()=>{this._setState("active:drawing")}),r=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(n,i),this._mapListener.push(r)}reset(){const t=this._initialFeature.getGeometry()?.clone(),n=this._editingSource.getFeatures()[0];if(!n)throw Error("no updated feature found");n.setGeometry(t),this._setState("active:initialized")}stop(){this._destroy(),m(this,V)?.resolve(void 0)}_destroy(){this._editingSource.clear(),this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{$(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){const t=this._editingSource.getFeatures()[0];if(!t)throw Error("no updated feature found");this._save(t)}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(m(this,V)??M(this,V,rs())).promise}}V=new WeakMap;class xo{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}createFeature(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let i=this._workflows.get(n);if(i)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return i=new Ni({map:e,ogcApiFeatureLayerUrl:t,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,i),this._connectToWorkflowDestroyEvent(i,n),i}updateFeature(e,t,n){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const i=e.id;let r=this._workflows.get(i);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new ji({map:e,ogcApiFeatureLayerUrl:t,feature:n,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(i,r),this._connectToWorkflowDestroyEvent(r,i),r}stop(e){const t=this._workflows.get(e);t&&t.stop()}reset(e){const t=this._workflows.get(e);if(t)t.reset();else throw new Error("No workflow found for mapId: "+e)}_connectToWorkflowDestroyEvent(e,t){e.on("destroyed",()=>{this._workflows.get(t)===e&&this._workflows.delete(t)})}}new We([407354,5754673]),new We([404740,5757893]);var re,J,Ie,Te,ke,mt;class Ri extends yt{constructor(t,n,i){super();E(this,ke);_(this,"label");E(this,re,{kind:"available"});E(this,J);E(this,Ie);E(this,Te);this.label=n,M(this,J,t),M(this,Te,i),v(this,ke,mt).call(this),M(this,Ie,m(this,J).on("change:visible",()=>{v(this,ke,mt).call(this)}))}destroy(){$(m(this,Ie))}get status(){return m(this,re)}async select(t,n){if(t.type!=="extent")throw new Error(`Unsupported selection kind: ${t.type}`);if(m(this,re).kind!=="available"||m(this,J).getSource()===null)return[];const i=[];m(this,J).getSource().forEachFeatureIntersectingExtent(t.extent,a=>{if(!a.getGeometry())return;const l={...a.getProperties()};delete l.geometries;const c={id:a.getId()?.toString()||vn(),geometry:a.getGeometry(),properties:l};i.push(c)});const r=i.filter(a=>a!=null);return r.length>n.maxResults?r.slice(0,n.maxResults):r}}re=new WeakMap,J=new WeakMap,Ie=new WeakMap,Te=new WeakMap,ke=new WeakSet,mt=function(){const n=m(this,J).getVisible()?{kind:"available"}:{kind:"unavailable",reason:m(this,Te)};n.kind!==m(this,re).kind&&(M(this,re,n),this.emit("changed:status"))};var Oe;class bo{constructor({intl:e}){E(this,Oe);M(this,Oe,e)}createSelectionSource(e){return new Ri(e.vectorLayer,e.label,m(this,Oe).formatMessage({id:"layerNotVisibleReason"}))}}Oe=new WeakMap;const Di="@open-pioneer/notifier",Gi=_t.bind(void 0,Di);var Os=hs({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Vi=hs({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const Hi=!1;function wo(s){const{position:e="top-right"}=s,t=$n(),n=Gi("notifier.NotificationService"),[i,r]=g.useState(!Hi),o=W(l=>{const c=l.level==="error"?h.jsx(Os,{h:"100%",w:"100%"}):void 0;t({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:c})}),a=W(()=>{t.closeAll()});return g.useEffect(()=>{const l=n.registerHandler({showNotification:o,closeAll:a});return()=>l.destroy()},[i,n,o,a]),h.jsx(h.Fragment,{})}function Bi(s,e){const t=g.useRef(s);t.current=s;const n=Ui(e);return g.useMemo(()=>li(()=>t.current()),[n])}function $i(s){const e=g.useCallback(()=>s.peek(),[s]),t=g.useCallback(i=>{const r=Si(()=>[s.value],i);return()=>r.destroy()},[s]),n=g.useSyncExternalStore(t,e);return g.useDebugValue(n),n}function Eo(s,e){const t=Bi(s,e),n=$i(t);return g.useDebugValue(n),n}function Ui(s){const e=g.useRef();return(e.current==null||!qi(e.current,s))&&(e.current=s??[]),e.current}function qi(s,e){return s===e?!0:s.length===(e?.length??0)&&s.every((t,n)=>t===e[n])}const Wi="@open-pioneer/coordinate-viewer",zi=oe.bind(void 0,Wi),Ki=4,Co=s=>{const{mapId:e,precision:t,displayProjectionCode:n}=s,{containerProps:i}=Z("coordinate-viewer",s),{map:r}=Q(e),o=r?.olMap,a=ps(o)?.getCode()??"";let{coordinates:l}=Ji(o);l=l&&n?Zi(l,a,n):l;const c=Yi(l,t),u=n||a,d=c?c+" "+u:"";return h.jsx(D,{...i,children:h.jsx(ve,{className:"coordinate-viewer-text",children:d})})};function Yi(s,e){const t=zi();return s?Xi(s,e,t):""}function Ji(s){const[e,t]=g.useState();return g.useEffect(()=>{if(!s)return;const n=s.on("pointermove",i=>{t(i.coordinate)});return()=>$(n)},[s]),{coordinates:e}}function Xi(s,e,t){if(s[0]==null||s[1]==null)return"";const n=e??Ki,[i,r]=s,o=t.formatNumber(i,{maximumFractionDigits:n,minimumFractionDigits:n}),a=t.formatNumber(r,{maximumFractionDigits:n,minimumFractionDigits:n});return o+" "+a}function Zi(s,e,t){return _n(s,e,t)}const Mo=s=>{const{mapId:e,displayMode:t="line"}=s,{containerProps:n}=Z("scale-bar",s),{map:i}=Q(e),r=g.useRef(null);return g.useEffect(()=>{if(r.current&&i){const o=i.olMap,a=new Nn({units:"metric",target:r.current,bar:t==="bar"});return o.addControl(a),()=>{o.removeControl(a)}}},[t,i]),h.jsx(D,{...n,ref:r})},Qi="@open-pioneer/scale-viewer",er=oe.bind(void 0,Qi),Po=s=>{const{mapId:e}=s,{containerProps:t}=Z("scale-viewer",s),{map:n}=Q(e),i=er(),r=ni(n?.olMap),o=r?i.formatNumber(r):void 0;return h.jsx(D,{...t,children:o&&h.jsxs(ve,{children:["1:",o]})})},tr="@open-pioneer/legend",As=oe.bind(void 0,tr),Lo=s=>{const{mapId:e,showBaseLayers:t=!1}=s,{containerProps:n}=Z("legend",s),{map:i}=Q(e);return h.jsx(D,{...n,children:i?h.jsx(sr,{map:i,showBaseLayers:t}):null})};function sr(s){const{map:e,showBaseLayers:t}=s,i=rr(e).map(r=>h.jsx(Ns,{layer:r,showBaseLayers:t},r.id));return h.jsx(Gn,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:i})}function Ns(s){const{layer:e,showBaseLayers:t}=s,{isVisible:n}=ar(e),i=or(e);if(!n||!t&&!("parentLayer"in e)&&e.isBaseLayer)return;const r=[];return i?.length&&i.forEach(o=>{r.push(h.jsx(Ns,{layer:o,showBaseLayers:t},o.id))}),h.jsxs(h.Fragment,{children:[h.jsx(nr,{layer:e,showBaseLayers:t}),r]})}function nr(s){const e=As(),{layer:t,showBaseLayers:n}=s,i=lr(t),r=ir(t);let o;i?.Component?o=h.jsx(i.Component,{layer:t}):i?.imageUrl?o=h.jsx(qt,{layer:t,imageUrl:i.imageUrl}):r&&(o=h.jsx(qt,{layer:t,imageUrl:r}));const a=!("parentLayer"in t)&&t.isBaseLayer;return o?h.jsxs(D,{as:"li",className:tt("legend-item",`layer-${cr(t.id)}`),children:[n&&a?h.jsx(ve,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,o]}):void 0}function qt(s){const e=As(),{layer:t,imageUrl:n}=s;return h.jsxs(D,{children:[h.jsx(ve,{children:t.title}),h.jsx(jn,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:h.jsx(D,{children:h.jsxs(ve,{children:[h.jsx(Os,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function ir(s){const e=g.useCallback(()=>s.legend,[s]),t=g.useCallback(n=>{const i=s.on("changed:legend",n);return()=>i.destroy()},[s]);return g.useSyncExternalStore(t,e)}function rr(s){const e=g.useCallback(n=>{const i=s.layers.on("changed",n);return()=>i.destroy()},[s]),t=g.useCallback(()=>{let n=s.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[s]);return js(e,t)}function or(s){const e=g.useCallback(n=>{const i=s.sublayers?.on("changed",n);return()=>i?.destroy()},[s]),t=g.useCallback(()=>{if(!s.sublayers)return;let i=s.sublayers?.getSublayers({sortByDisplayOrder:!0});return i=i.reverse(),i},[s]);return js(e,t)}function js(s,e){const t=g.useRef(),n=g.useCallback(r=>{const o=s(()=>{t.current=void 0,r()});return()=>{t.current=void 0,o()}},[s]),i=g.useCallback(()=>{if(t.current)return t.current.value;const r=e();return t.current={value:r},r},[e]);return g.useSyncExternalStore(n,i)}function ar(s){const e=g.useCallback(()=>s.visible,[s]),t=g.useCallback(i=>{const r=s.on("changed:visible",i);return()=>r.destroy()},[s]);return{isVisible:g.useSyncExternalStore(t,e)}}function lr(s){const[e,t]=g.useState(void 0);return g.useEffect(()=>{t(s.attributes.legend);const n=s.on("changed:attributes",()=>{t(s.attributes.legend)});return()=>n.destroy()},[s]),e}function cr(s){return s.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const ur="@open-pioneer/measurement",hr=oe.bind(void 0,ur);class dr{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,t){this.olMap=e,this.messages=t;const n=this.source=new et;this.layer=new _e({source:n}),this.layer.setZIndex(vt),e.addLayer(this.layer);const i=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){$(i)}});const r=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",r),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",r)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const t=Sn(e);this.activeFeatureStyle=(n,...i)=>{const r=n?.getGeometry()?.getType();if(r==="Polygon"||r==="LineString"||r==="Point")return t(n,...i)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",n=this.draw=new us({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let i,r;n.on("drawstart",o=>{i=this.measureTooltip=this.createMeasureTooltip();const a=this.sketch=o.feature;if(!a)return;let l;r=a.getGeometry()?.on("change",c=>{const u=c.target,d=this.olMap.getView().getProjection();let p="";u instanceof ts?(p=gr(u,d,this.messages),l=u.getInteriorPoint().getCoordinates()||null):u instanceof ds&&(p=mr(u,d,this.messages),l=u.getLastCoordinate()||null),i&&(i.setHtml(p),l&&i?.overlay.setPosition(l))})}),n.on("drawend",()=>{if(i){const o=i.element.classList;o.remove("measurement-active-tooltip"),o.remove("printing-hide"),o.add("measurement-finished-tooltip"),i.overlay.setOffset([0,-7]),this.overlayTooltips.push(i),this.measureTooltip=i=void 0}this.sketch=void 0,r&&$(r)}),n.on("drawabort",()=>{i&&(i.destroy(),this.measureTooltip=i=void 0),this.sketch=void 0,r&&$(r)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const n=new Ye({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),i=this.olMap;return i.addOverlay(n),{overlay:n,element:e,destroy(){i.removeOverlay(n)},setText(r){t.textContent=r},setHtml(r){t.innerHTML=r}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden",e.role="tooltip";const t=document.createElement("span");e.appendChild(t);const n=new Ye({element:e,offset:[15,0],positioning:"center-left"}),i=this.olMap;return i.addOverlay(n),{overlay:n,element:e,destroy(){i.removeOverlay(n)},setText(r){t.textContent=r},setHtml(r){t.innerHTML=r}}}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,n=fr(this.messages,this.sketch);t.setText(n),t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}}function fr(s,e){if(e){const t=e.getGeometry();if(t instanceof ts||t instanceof ds)return s.getContinueMessage()}return s.getHelpMessage()}function gr(s,e,t){const n=xn(s,{projection:e});let i;return n>=1e6?i=`${t.formatNumber(n/1e6)} km<sup>2</sup>`:i=`${t.formatNumber(n)} m<sup>2</sup>`,i}function mr(s,e,t){const n=bn(s,{projection:e});let i;return n>=1e3?i=`${t.formatNumber(n/1e3)} km`:i=`${t.formatNumber(n)} m`,i}const Fo=s=>{const e=hr(),{mapId:t,activeFeatureStyle:n,finishedFeatureStyle:i}=s,{containerProps:r}=Z("measurement",s),[o,a]=g.useState("distance"),l=f=>e.formatMessage({id:f}),c=Q(t),u=pr(c.map,e);g.useEffect(()=>{u?.setActiveFeatureStyle(n??yr())},[u,n]),g.useEffect(()=>{u?.setFinishedFeatureStyle(i??vr())},[u,i]),g.useEffect(()=>{if(u)return u.startMeasurement(o),()=>{u.stopMeasurement()}},[u,o]);function d(f){if(f==="distance"||f==="area")a(f);else throw new Error(`Unexpected measurement type: '${f}'.`)}function p(){u?.clearMeasurements()}return h.jsxs(D,{...r,children:[h.jsx(ve,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),h.jsx(Ke,{mb:4,alignItems:"center",children:h.jsxs(dt,{mb:2,children:[h.jsx(Fe,{mb:1,children:l("measurementLabel")}),h.jsxs(bt,{value:o,onChange:f=>d(f.target.value),className:"measurement-select",children:[h.jsx("option",{value:"distance",children:l("distance")}),h.jsx("option",{value:"area",children:l("area")})]})]})}),h.jsx(os,{padding:2,className:"measurement-delete-button",onClick:p,width:"100%",children:l("deleteMeasurementLabel")})]})};function pr(s,e){const[t,n]=g.useState(void 0);return g.useEffect(()=>{if(!s)return;const i=new dr(s.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(r){return e.formatNumber(r,{maximumFractionDigits:2})}});return n(i),()=>{i.destroy(),n(void 0)}},[s,e]),t}function yr(){return[new ze({stroke:new Ee({color:"#fff",lineDash:[10,10],width:5})}),new ze({fill:new ht({color:"rgba(0,0,0,0.15)"}),stroke:new Ee({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new wn({radius:5,stroke:new Ee({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new ht({color:"rgba(255, 255, 255, 0.2)"})})})]}function vr(){return[new ze({stroke:new Ee({color:"#fff",width:5})}),new ze({stroke:new Ee({color:"#0b96fc",width:3}),fill:new ht({color:"rgba(11,150,252,0.15)"})})]}const _r="@open-pioneer/search",nt=oe.bind(void 0,_r);function Sr(s){const e=s.selectProps.inputValue.length>0,t={...s,className:tt(s.className,{"search-invisible":!e})};return h.jsx(K.Menu,{...t,children:s.children})}function xr(s){const t=nt().formatMessage({id:"noOptionsText"});return h.jsx(K.NoOptionsMessage,{...s,children:h.jsx(z.span,{className:"search-no-match",children:t})})}function br(s){const t=nt().formatMessage({id:"loadingText"});return h.jsx(K.LoadingMessage,{...s,children:h.jsx(z.span,{className:"search-loading-text",children:t})})}function wr({children:s,...e}){const t={...e,className:tt(e.className,"search-value-container")};return h.jsxs(K.ValueContainer,{...t,children:[!!s&&h.jsx(Vi,{style:{position:"absolute",left:8}}),s]})}function Er(s){const e={...s,isHidden:!1};return h.jsx(K.Input,{...e})}function Cr(s){return null}function Mr(s){return h.jsxs(K.IndicatorsContainer,{...s,children:[s.children,!s.selectProps.isLoading&&s.selectProps.inputValue&&h.jsx(Pr,{selectProps:s.selectProps,clearValue:s.clearValue})]})}function Pr(s){const t=nt().formatMessage({id:"ariaLabel.clearButton"}),n=i=>{i.preventDefault(),i.stopPropagation(),s.clearValue()};return h.jsx(In,{role:"button",size:"md",mr:1,"aria-label":t,onClick:n,onTouchEnd:n,onMouseDown:i=>i.preventDefault()})}function Lr(s){return null}function Fr(s){const e=s.selectProps.inputValue,t=s.data.label,n={...s,className:tt(s.className,"search-option")};return h.jsx(K.Option,{...n,children:h.jsx(z.div,{className:"search-option-label",children:e.trim().length>0?Ir(t,e):t})})}function Ir(s,e){const t=s.toLowerCase().indexOf(e.toLowerCase());return t>=0?h.jsxs(h.Fragment,{children:[s.substring(0,t),h.jsx(z.span,{className:"search-highlighted-match",children:s.substring(t,t+e.length)},"highlighted"),s.substring(t+e.length)]}):s}const Wt=De("search:SearchController"),zt=200,Kt=5;var Ae,me,pe,ye,H,Ze,Rs;class Tr{constructor(e,t){E(this,Ze);E(this,Ae);E(this,me,[]);E(this,pe,Kt);E(this,ye,zt);E(this,H);M(this,Ae,e),M(this,me,t)}destroy(){m(this,H)?.abort(),M(this,H,void 0)}async search(e){if(m(this,H)?.abort(),M(this,H,void 0),!e)return[];const t=M(this,H,new AbortController);try{return await kr(t.signal,m(this,ye)),t.signal.aborted&&(Wt.debug(`search canceled with ${e}`),Tn()),(await Promise.all(m(this,me).map(i=>v(this,Ze,Rs).call(this,i,e,t.signal)))).filter(i=>i!=null)}finally{m(this,H)===t&&M(this,H,void 0)}}get searchTypingDelay(){return m(this,ye)}set searchTypingDelay(e){M(this,ye,e??zt)}get maxResultsPerSource(){return m(this,pe)}set maxResultsPerSource(e){M(this,pe,e??Kt)}get sources(){return m(this,me)}}Ae=new WeakMap,me=new WeakMap,pe=new WeakMap,ye=new WeakMap,H=new WeakMap,Ze=new WeakSet,Rs=async function(e,t,n){const i=e.label,r=m(this,Ae).olMap.getView().getProjection();try{const o=m(this,pe);let a=await e.search(t,{maxResults:o,signal:n,mapProjection:r});return a.length>o&&(a=a.slice(0,o)),{label:i,source:e,results:a}}catch(o){as(o)||Wt.error(`search for source ${i} failed`,o);return}};async function kr(s,e){s.aborted||await new Promise(t=>{const n=()=>{s.removeEventListener("abort",n),clearTimeout(i),t()};s.addEventListener("abort",n);const i=setTimeout(n,e)})}const Xe=De("search:Search"),Io=s=>{const{mapId:e,sources:t,searchTypingDelay:n,maxResultsPerGroup:i,onSelect:r,onClear:o}=s,{containerProps:a}=Z("search",s),{map:l}=Q(e),c=nt(),u=jr(t,n,i,l),{input:d,search:p,selectedOption:f,onInputChanged:y,onResultConfirmed:b}=Rr(u),F=Nr(),P=Or(c),N=Ar(),G=W((j,ae)=>{ae.action==="input-change"&&y(j)}),Y=W((j,ae)=>{switch(ae.action){case"select-option":j&&(b(j),r?.({source:j.source,result:j.result}));break;case"clear":y(""),O.current?.blur(),O.current?.focus(),o?.();break;default:Xe.debug(`Unhandled action type '${ae.action}'.`);break}}),O=g.useRef(null);return h.jsx(D,{...a,children:h.jsx(ft,{className:"search-component",classNamePrefix:"react-select",ref:O,inputValue:d,onInputChange:G,"aria-label":c.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:P,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:F,isClearable:!0,placeholder:c.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:p.kind==="loading",options:p.kind==="ready"?p.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:N,onChange:Y,value:f,menuPosition:"fixed"})})};function Or(s){return g.useMemo(()=>({onFocus:({focused:r})=>`${r.label} ${s.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:r,label:o})=>{let a="";switch(r){case"select-option":a=`${o} ${s.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":a=`${o} ${s.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return a},guidance:()=>`${s.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[s])}function Ar(){return g.useMemo(()=>({Menu:Sr,Input:Er,SingleValue:Cr,Option:Fr,NoOptionsMessage:xr,LoadingMessage:br,ValueContainer:wr,IndicatorsContainer:Mr,ClearIndicator:Lr}),[])}function Nr(){const[s,e]=ls("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return g.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:s,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[s,e])}function jr(s,e,t,n){const[i,r]=g.useState(void 0);return g.useEffect(()=>{if(!n)return;const o=new Tr(n,s);return r(o),()=>{o.destroy(),r(void 0)}},[n,s]),g.useEffect(()=>{i&&(i.searchTypingDelay=e)},[i,e]),g.useEffect(()=>{i&&(i.maxResultsPerSource=t)},[i,t]),i}function Rr(s){const[e,t]=g.useReducer((a,l)=>{switch(l.kind){case"input":return{...a,query:l.query,selectedOption:null};case"select-option":return{...a,selectedOption:l.option,query:l.option.label};case"load-results":return{...a,search:{kind:"loading"}};case"accept-results":return{...a,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=g.useRef(),i=W(a=>{if(!s){n.current=void 0,t({kind:"accept-results",results:[]});return}Xe.isDebug()&&Xe.debug(`Starting new search for query ${JSON.stringify(a)}.`),t({kind:"load-results"});const l=n.current=Dr(s,a).then(c=>{n.current===l&&t({kind:"accept-results",results:c})})}),r=g.useCallback(a=>{t({kind:"select-option",option:a})},[]),o=g.useCallback(a=>{t({kind:"input",query:a}),i(a)},[i]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:r,onInputChanged:o}}async function Dr(s,e){let t;try{t=await s.search(e)}catch(n){as(n)||Xe.error("Search failed",n),t=[]}return Gr(t)}function Gr(s){return s.map((t,n)=>({label:t.label,options:t.results.map(i=>({value:`${n}-${i.id}`,label:i.label,source:t.source,result:i}))}))}const Ds="@open-pioneer/selection",Vr=_t.bind(void 0,Ds),Lt=oe.bind(void 0,Ds),we="selection-active",Be="selection-inactive";class Hr{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,n,i,r){let o;switch(t){case Ft.extent:default:o=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,r,o,this.interactionResources)),this.interactionResources.push(this.createDrag(e,o,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=i}initViewport(e){const t=e.getViewport();return t.classList.add(we),t.oncontextmenu=n=>(n.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.setText(this.tooltipMessage),t.classList.remove(Be),t.classList.add(we),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.setText(this.tooltipDisabledMessage),t.classList.remove(we),t.classList.add(Be),this.isActive=!1)}createDragBox(e,t,n,i){const r=new Rt({className:"selection-drag-box",condition:En});return e.addInteraction(r),r.on("boxend",function(){t(r.getGeometry())}),{interaction:r,destroy(){e.removeInteraction(r),i.splice(i.indexOf(this)),r.dispose(),n.classList.remove(we),n.classList.remove(Be),n.oncontextmenu=null}}}createDrag(e,t,n){const i=function(a){return a.originalEvent.button==2},r=new Dt({condition:i});return e.addInteraction(r),{interaction:r,destroy(){e.removeInteraction(r),n.splice(n.indexOf(this)),r.dispose(),t.classList.remove(we),t.classList.remove(Be),t.oncontextmenu=null}}}createHelpTooltip(e,t){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.role="tooltip";const i=document.createElement("span");i.textContent=t,n.appendChild(i);const r=new Ye({element:n,offset:[15,0],positioning:"center-left"}),o=e.on("pointermove",a=>{r.setPosition(a.coordinate)});return e.addOverlay(r),{overlay:r,element:n,destroy(){e.removeOverlay(r),r.dispose(),$(o)},setText(a){i.textContent=a}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Rt)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Dt)}}const lt=De("selection:SelectionController"),Br=1e4;var Ne,je,Re,Qe,Gs;class $r{constructor(e){E(this,Qe);E(this,Ne);E(this,je);E(this,Re);const{mapModel:t,onError:n,maxResults:i=Br}=e;M(this,Ne,t),M(this,je,i),M(this,Re,n)}destroy(){}async select(e,t){if(t)return await v(this,Qe,Gs).call(this,e,t)}}Ne=new WeakMap,je=new WeakMap,Re=new WeakMap,Qe=new WeakSet,Gs=async function(e,t){const n=m(this,Ne).olMap.getView().getProjection();try{lt.debug(`Starting selection on source '${e.label}'`);const i=m(this,je);let r=await e.select({type:"extent",extent:t},{maxResults:i,mapProjection:n,signal:new AbortController().signal});return r.length>i&&(r=r.slice(0,i)),lt.debug(`Found ${r.length} results on source '${e.label}'`),{source:e,results:r}}catch(i){lt.error(`selection from source ${e.label} failed`,i),m(this,Re).call(this);return}};var Ft=(s=>(s.extent="EXTENT",s.polygon="POLYGON",s.free="FREEPOLYGON",s.circle="CIRCLE",s))(Ft||{});const Yt={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},To=s=>{const e=Lt(),{mapId:t,sources:n,onSelectionComplete:i,onSelectionSourceChanged:r}=s,{containerProps:o}=Z("selection",s),[a,l]=g.useState(()=>n.find(w=>(w.status??"available")==="available")),c=Q(t),{onExtentSelected:u}=Wr(c.map,n,a,i),d=Yr(),[p,f]=g.useState(!1),b=g.useCallback(w=>{const le=[];if(w||(w=["EXTENT"]),w.forEach(xe=>{Object.values(Ft).includes(xe)&&le.push({label:e.formatMessage({id:xe}),value:xe})}),le.length===0)throw new Error("methods does not contain valid values");return le},[e])(void 0),[F,P]=g.useState(b[0]),N=W(w=>{P(w)}),[G,Y]=g.useState(!0);Kr(c.map,F,e,u,G);const O=g.useMemo(()=>n.map(w=>({label:w.label,value:w})),[n]),j=g.useMemo(()=>O.find(w=>w.value===a),[O,a]),ae=W(w=>{l(w?.value),r&&r({source:w?.value})});g.useEffect(()=>{if(!a){Y(!1);return}const w=e.formatMessage({id:"sourceNotAvailable"}),le=()=>a&&pt(a,w).kind==="available";Y(le());const xe=a.on("changed:status",()=>{Y(le())});return()=>xe.destroy()},[a,Y,e]);const Bs=W(w=>{!p&&w.key==="Enter"&&f(!0)});return h.jsxs(Vn,{...o,spacing:2,children:[b.length>1&&h.jsxs(Ke,{children:[h.jsx(Fe,{children:e.formatMessage({id:"selectMethod"})}),h.jsx(ft,{className:"selection-method react-select",...Yt,options:b,onChange:N,value:F,chakraStyles:d})]}),h.jsxs(Ke,{children:[h.jsx(Fe,{children:e.formatMessage({id:"selectSource"})}),h.jsx(ft,{className:"selection-source react-select",...Yt,options:O,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:j,onChange:ae,components:{Option:Ur,SingleValue:qr},isOptionDisabled:w=>w.value===void 0||w.value.status==="unavailable",getOptionLabel:w=>w.label+(w.value===void 0||w.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:d,onKeyDown:Bs,menuIsOpen:p,onMenuOpen:()=>f(!0),onMenuClose:()=>f(!1)})]})]})};function Ur(s){const{value:e}=s.data,{isAvailable:t,content:n}=Vs(e,!1);return h.jsx(K.Option,{...s,isDisabled:!t,className:"selection-source-option",children:n})}function qr(s){const{value:e}=s.data,{isAvailable:t,content:n}=Vs(e,!0),i=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return h.jsx(K.SingleValue,{...s,isDisabled:!t,className:i,children:n})}function Vs(s,e){const t=s?.label,n=zr(s);return{isAvailable:n.kind==="available",content:h.jsxs(Gt,{direction:"row",alignItems:"center",grow:1,children:[!e&&h.jsx(Gt,{grow:1,children:t}),n.kind==="unavailable"&&h.jsx(D,{ml:2,children:h.jsx(kn,{label:n.reason,placement:"right",openDelay:500,children:h.jsx(z.span,{children:h.jsx(On,{as:Hn,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&t]})}}function Wr(s,e,t,n){const i=Vr("notifier.NotificationService"),r=Lt(),[o,a]=g.useState(void 0);g.useEffect(()=>{if(!s)return;const c=new $r({mapModel:s,onError(){i.notify({level:"error",message:r.formatMessage({id:"selectionFailed"})})}});return a(c),()=>{c.destroy()}},[s,i,e,r]);const l=W(async c=>{if(!o||!t)return;const u=await o.select(t,c.getExtent());u&&n?.(u)});return{controller:o,onExtentSelected:l}}function pt(s,e){const t=s.status??"available",n=typeof t=="string"?{kind:t}:t;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function zr(s){const e=Lt(),[t,n]=g.useState(()=>({kind:"available"}));return g.useEffect(()=>{if(!s){n({kind:"available"});return}const i=e.formatMessage({id:"sourceNotAvailable"});n(pt(s,i));const r=s.on?.("changed:status",()=>{n(pt(s,i))});return()=>r?.destroy()},[s,e]),t}function Kr(s,e,t,n,i){g.useEffect(()=>{if(!s)return;const r=new Hr(s.olMap,e.value,t.formatMessage({id:"tooltip"}),t.formatMessage({id:"disabledTooltip"}),n);return r.setActive(i),()=>{r?.destroy()}},[s,e,t,n,i])}function Yr(){const[s,e]=ls("colors",["background_body","border"],["#ffffff","#ffffff"]);return g.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:s})}),[s,e])}const Hs="@open-pioneer/printing",Jt=_t.bind(void 0,Hs),Jr=oe.bind(void 0,Hs),Xr="map";class Zr{olMap;title="";fileFormat="pdf";i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,t,n){this.olMap=e,this.printingService=t,this.i18n=n}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}setViewPadding(e){this.viewPadding=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Rn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",t=this.title||Xr;return{title:e,fileName:t}}async exportMapInPNG(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height+50,t.style.backgroundColor="#fff";const n=t.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:i,fileName:r}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,t.width,t.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const o=t.width/2;n.fillText(i,o,20),n.drawImage(e,0,50);const a=document.createElement("a");a.setAttribute("download",r+".png");const l=Dn(t);if(!l)throw new Error("Failed to get image data URL");a.href=l,a.click()}async exportMapInPDF(e){const{jsPDF:t}=await Bn(async()=>{const{jsPDF:F}=await import("./BOu-kg1heWko.js");return{jsPDF:F}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),n=new t({orientation:"landscape",unit:"mm",format:"a4"}),i=n.internal.pageSize.getWidth(),r=n.internal.pageSize.getHeight(),o=15,a=20,l=r-a;n.setFontSize(20);const{title:c,fileName:u}=this.getTitleAndFileName();n.text(c,i/2,o,{align:"center"});const d=e.width/e.height;let p=l,f=p*d;f>=i&&(f=i,p=f/d);const y=(i-f)/2,b=a+(l-p)/2;n.addImage(e,"",y,b,f,p),n.save(u+".pdf")}}const Qr=De("printing"),ko=s=>{const e=Jr(),{mapId:t,viewPadding:n="auto"}=s,{containerProps:i}=Z("printing",s),[r,o]=g.useState("pdf"),[a,l]=g.useState(""),[c,u]=g.useState(!1),d=Jt("printing.PrintingService"),p=Jt("notifier.NotificationService"),{map:f}=Q(t),y=eo(f,e,d,n);g.useEffect(()=>{y?.setFileFormat(r)},[y,r]),g.useEffect(()=>{y?.setTitle(a)},[y,a]);function b(P){(P==="png"||P==="pdf")&&o(P)}function F(){c||!y||(u(!0),y.handleMapExport().catch(P=>{const N=e.formatMessage({id:"printingFailed"});p.notify({level:"error",message:N}),Qr.error("Failed to print the map",P)}).finally(()=>{u(!1)}))}return h.jsxs(D,{...i,children:[h.jsxs(Ke,{mb:4,alignItems:"center",children:[h.jsxs(dt,{mb:2,children:[h.jsx(Fe,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),h.jsx(xt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:a,onChange:P=>{l(P.target.value)},autoFocus:!0})]}),h.jsxs(dt,{mb:2,children:[h.jsx(Fe,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),h.jsxs(bt,{value:r,onChange:P=>b(P.target.value),className:"printing-select",children:[h.jsx("option",{value:"png",children:"PNG"}),h.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),h.jsx(os,{isLoading:c,loadingText:e.formatMessage({id:"printingMap"}),disabled:c,padding:2,className:"printing-export-button",onClick:F,width:"100%",children:e.formatMessage({id:"export"})})]})};function eo(s,e,t,n){const[i,r]=g.useState(void 0);return g.useEffect(()=>{if(!s)return;const o=new Zr(s.olMap,t,{overlayText:e.formatMessage({id:"printingMap"})});return r(o),()=>{o.destroy(),r(void 0)}},[s,e,t]),g.useEffect(()=>{i?.setViewPadding(n)},[i,n]),i}export{Co as C,xo as E,xt as I,Lo as L,Fo as M,wo as N,Ye as O,ko as P,Is as S,bo as V,vo as W,be as a,So as b,Mo as c,Po as d,Io as e,To as f,li as g,_o as h,bt as i,ie as r,Eo as u,Si as w};
