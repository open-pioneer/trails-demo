var ir=Object.defineProperty;var ar=(t,e,o)=>e in t?ir(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var $=(t,e,o)=>(ar(t,typeof e!="symbol"?e+"":e,o),o),Ut=(t,e,o)=>{if(!e.has(t))throw TypeError("Cannot "+o)};var _=(t,e,o)=>(Ut(t,e,"read from private field"),o?o.call(t):e.get(t)),L=(t,e,o)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,o)},I=(t,e,o,n)=>(Ut(t,e,"write to private field"),n?n.call(t,o):e.set(t,o),o);var W=(t,e,o)=>(Ut(t,e,"access private method"),o);import{u as lr,a as cr,r as d,c as ur,f as Ft,b as nn,o as rn,d as sn,j as i,e as te,g as dr,l as pr,i as Mt,h as he,k as hr,R as an,m as fr,E as ie,n as gr,A as Ht,p as Wt,F as ln,B as Vt,C as mr,t as vr,q as cn,I as br,s as wr}from"./a804c6ae25fd.js";import{t as Sr}from"./86b0ef7fa05f.js";import{b as un,B as dn,i as yr,g as xr,a as Eo,t as _r,c as Er,d as kr,C as Cr,r as Mr,e as Ar,u as Pr,l as pn,M as hn,o as Lr,f as Rr,h as fn,A as Ir,T as co,I as Tr,j as Or,k as jr,m as le,n as Dr,p as Nr,q as j,V as gn,S as rt,O as mn,s as Ze,v as _e,w as Le,x as uo,F as We,y as Fr,E as Vr,z as zr,D as ko,G as Br,H as Gr,J as Co,K as Ur,L as $t,N as Mo,P as Hr,Q as Wr,R as $r,U as qr,W as Kr,X as Yr,Y as Ao,Z as po,_ as ho,$ as Jt,a0 as vn,a1 as Zr,a2 as Xr,a3 as ce,a4 as oe,a5 as Y,a6 as Jr,a7 as Xe,a8 as Qr,a9 as es,aa as de,ab as yt,ac as Ie,ad as Te,ae as Po,af as Ae,ag as ee,ah as ts,ai as bn,aj as os,ak as ns,al as Lo,am as rs,an as Ro,ao as ss,ap as Qe}from"./37379e2f5af0.js";import{m as D,a as E,X as wn,p as z,r as T,b as J,c as fo,d as Qt,e as ye,f as is,g as as,W as xt,P as Sn,h as yn,i as ls,j as cs,k as us,l as ds,n as ps,o as hs,q as fs,s as gs,t as ms,u as vs}from"./d66f6bf32426.js";import{o as bs,W as ws}from"./8db37233a50a.js";import{G as zt,T as Ss}from"./60fc4ce39a26.js";import{T as pe,V as eo,L as xn}from"./81064a1e15a2.js";import{D as _n,N as ys,P as xs,S as _s,c as Es,a as ks,I as Cs}from"./31065bb915e6.js";import{V as Ms,S as As,I as Ps,Z as Ls,a as Rs}from"./4b5ea776e952.js";import{_ as to}from"./a419295615be.js";import{c as En}from"./14997e1cc74a.js";import{S as Is}from"./a80ff04620c9.js";import{u as kn,F as At}from"./f413d8ffea52.js";import{F as at}from"./b816276102a2.js";import{H as oo}from"./e8bf978be9d7.js";import{G as Ts,F as Os}from"./4533599bd8ef.js";import{u as Re,R as js}from"./5cb1f7ac6835.js";import{L as Cn}from"./c5aeeeb5eb6b.js";import{c as fe,S as no,D as Ds}from"./12d50d22e7a5.js";import{C as Ns}from"./88ffbff35e76.js";import"./459d96ccde3b.js";import"./3f67a442b387.js";import"./43de92519f96.js";import"./8feb64e69a5d.js";function Fs(t){const{theme:e}=lr(),o=cr();return d.useMemo(()=>ur(e.direction,{...o,...t}),[t,e.direction,o])}var Bt=Ft(function(e,o){const{htmlSize:n,...r}=e,s=nn("Input",r),a=rn(r),l=kn(a),u=sn("chakra-input",e.className);return i.jsx(te.input,{size:n,...l,__css:s.field,ref:o,className:u})});Bt.displayName="Input";Bt.id="Input";var Mn=te("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Mn.displayName="Center";var Vs={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Ft(function(e,o){const{axis:n="both",...r}=e;return i.jsx(te.div,{ref:o,__css:Vs[n],...r,position:"absolute"})});var An=Ft(function(e,o){const{children:n,placeholder:r,className:s,...a}=e;return i.jsxs(te.select,{...a,ref:o,className:sn("chakra-select",s),children:[r&&i.jsx("option",{value:"",children:r}),n]})});An.displayName="SelectField";function zs(t,e){const o={},n={};for(const[r,s]of Object.entries(t))e.includes(r)?o[r]=s:n[r]=s;return[o,n]}var go=Ft((t,e)=>{var o;const n=nn("Select",t),{rootProps:r,placeholder:s,icon:a,color:l,height:u,h:c,minH:p,minHeight:g,iconColor:b,iconSize:w,...y}=rn(t),[k,R]=zs(y,pr),A=kn(R),N={width:"100%",height:"fit-content",position:"relative",color:l},F={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(o=n.field)==null?void 0:o._focus}};return i.jsxs(te.div,{className:"chakra-select__wrapper",__css:N,...k,...r,children:[i.jsx(An,{ref:e,height:c??u,minH:p??g,placeholder:s,...A,__css:F,children:t.children}),i.jsx(Pn,{"data-disabled":dr(A.disabled),...(b||l)&&{color:b||l},__css:n.icon,...w&&{fontSize:w},children:a})]})});go.displayName="Select";var Bs=t=>i.jsx("svg",{viewBox:"0 0 24 24",...t,children:i.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Gs=te("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Pn=t=>{const{children:e=i.jsx(Bs,{}),...o}=t,n=d.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return i.jsx(Gs,{...o,className:"chakra-select__icon-wrapper",children:d.isValidElement(e)?n:null})};Pn.displayName="SelectIcon";const Q=[null,"http://www.opengis.net/ows/1.1"],Us=D(Q,{ServiceIdentification:E(fi),ServiceProvider:E(mi),OperationsMetadata:E(pi)});class Hs extends wn{constructor(){super()}readFromNode(e){const o=z({},Us,e,[]);return o||null}}const Ws=D(Q,{DeliveryPoint:E(T),City:E(T),AdministrativeArea:E(T),PostalCode:E(T),Country:E(T),ElectronicMailAddress:E(T)}),$s=D(Q,{Value:J(vi)}),qs=D(Q,{AllowedValues:E(si)}),Ks=D(Q,{Phone:E(hi),Address:E(ri)}),Ys=D(Q,{HTTP:E(ui)}),Zs=D(Q,{Get:J(ci),Post:void 0}),Xs=D(Q,{DCP:E(li)}),Js=D(Q,{Operation:di}),Qs=D(Q,{Voice:E(T),Facsimile:E(T)}),ei=D(Q,{Constraint:J(ii)}),ti=D(Q,{IndividualName:E(T),PositionName:E(T),ContactInfo:E(ai)}),oi=D(Q,{Abstract:E(T),AccessConstraints:E(T),Fees:E(T),Title:E(T),ServiceTypeVersion:E(T),ServiceType:E(T)}),ni=D(Q,{ProviderName:E(T),ProviderSite:E(fo),ServiceContact:E(gi)});function ri(t,e){return z({},Ws,t,e)}function si(t,e){return z({},$s,t,e)}function ii(t,e){const o=t.getAttribute("name");if(o)return z({name:o},qs,t,e)}function ai(t,e){return z({},Ks,t,e)}function li(t,e){return z({},Ys,t,e)}function ci(t,e){const o=fo(t);if(o)return z({href:o},ei,t,e)}function ui(t,e){return z({},Zs,t,e)}function di(t,e){const o=t.getAttribute("name"),n=z({},Xs,t,e);if(!n)return;const r=e[e.length-1];r[o]=n}function pi(t,e){return z({},Js,t,e)}function hi(t,e){return z({},Qs,t,e)}function fi(t,e){return z({},oi,t,e)}function gi(t,e){return z({},ti,t,e)}function mi(t,e){return z({},ni,t,e)}function vi(t,e){return T(t)}const bi=Hs,ue=[null,"http://www.opengis.net/wmts/1.0"],Je=[null,"http://www.opengis.net/ows/1.1"],wi=D(ue,{Contents:E(Li)});class Si extends wn{constructor(){super(),this.owsParser_=new bi}readFromNode(e){let o=e.getAttribute("version");o&&(o=o.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=o,n=z(n,wi,e,[]),n||null):null}}const yi=D(ue,{Layer:J(Ri),TileMatrixSet:J(Ii)}),xi=D(ue,{Style:J(Ti),Format:J(T),TileMatrixSetLink:J(Oi),Dimension:J(ji),ResourceURL:J(Di)},D(Je,{Title:E(T),Abstract:E(T),WGS84BoundingBox:E(Rn),BoundingBox:J(Ni),Identifier:E(T)})),_i=D(ue,{LegendURL:J(Fi)},D(Je,{Title:E(T),Identifier:E(T)})),Ei=D(ue,{TileMatrixSet:E(T),TileMatrixSetLimits:E(zi)}),ki=D(ue,{TileMatrixLimits:Qt(Bi)}),Ci=D(ue,{TileMatrix:E(T),MinTileRow:E(ye),MaxTileRow:E(ye),MinTileCol:E(ye),MaxTileCol:E(ye)}),Mi=D(ue,{Default:E(T),Value:J(T)},D(Je,{Identifier:E(T)})),Ln=D(Je,{LowerCorner:Qt(ro),UpperCorner:Qt(ro)}),Ai=D(ue,{WellKnownScaleSet:E(T),TileMatrix:J(Vi)},D(Je,{SupportedCRS:E(T),Identifier:E(T),BoundingBox:E(Rn)})),Pi=D(ue,{TopLeftCorner:E(ro),ScaleDenominator:E(is),TileWidth:E(ye),TileHeight:E(ye),MatrixWidth:E(ye),MatrixHeight:E(ye)},D(Je,{Identifier:E(T)}));function Li(t,e){return z({},yi,t,e)}function Ri(t,e){return z({},xi,t,e)}function Ii(t,e){return z({},Ai,t,e)}function Ti(t,e){const o=z({},_i,t,e);if(!o)return;const n=t.getAttribute("isDefault")==="true";return o.isDefault=n,o}function Oi(t,e){return z({},Ei,t,e)}function ji(t,e){return z({},Mi,t,e)}function Di(t,e){const o=t.getAttribute("format"),n=t.getAttribute("template"),r=t.getAttribute("resourceType"),s={};return o&&(s.format=o),n&&(s.template=n),r&&(s.resourceType=r),s}function Rn(t,e){const o=z([],Ln,t,e);if(o.length==2)return un(o)}function Ni(t,e){const o=t.getAttribute("crs"),n=z([],Ln,t,e);if(n.length==2)return{extent:un(n),crs:o}}function Fi(t,e){const o={};return o.format=t.getAttribute("format"),o.href=fo(t),o}function ro(t,e){const o=T(t).split(/\s+/);if(!o||o.length!=2)return;const n=+o[0],r=+o[1];if(!(isNaN(n)||isNaN(r)))return[n,r]}function Vi(t,e){return z({},Pi,t,e)}function zi(t,e){return z([],ki,t,e)}function Bi(t,e){return z({},Ci,t,e)}const Gi=Si,U={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Ui={ERROR:"error"};class Hi extends kr{constructor(e){super(Ui.ERROR),this.code=e.code,this.message=e.message}}let Wi=class extends dn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=yr,this.watchId_=void 0,this.addChangeListener(U.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(U.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=xr(Eo("EPSG:4326"),e),this.position_&&this.set(U.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const o=e.coords;this.set(U.ACCURACY,o.accuracy),this.set(U.ALTITUDE,o.altitude===null?void 0:o.altitude),this.set(U.ALTITUDE_ACCURACY,o.altitudeAccuracy===null?void 0:o.altitudeAccuracy),this.set(U.HEADING,o.heading===null?void 0:_r(o.heading)),this.position_?(this.position_[0]=o.longitude,this.position_[1]=o.latitude):this.position_=[o.longitude,o.latitude];const n=this.transform_(this.position_);this.set(U.POSITION,n.slice()),this.set(U.SPEED,o.speed===null?void 0:o.speed);const r=Er(this.position_,o.accuracy);r.applyTransform(this.transform_),this.set(U.ACCURACY_GEOMETRY,r),this.changed()}positionError_(e){this.dispatchEvent(new Hi(e))}getAccuracy(){return this.get(U.ACCURACY)}getAccuracyGeometry(){return this.get(U.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(U.ALTITUDE)}getAltitudeAccuracy(){return this.get(U.ALTITUDE_ACCURACY)}getHeading(){return this.get(U.HEADING)}getPosition(){return this.get(U.POSITION)}getProjection(){return this.get(U.PROJECTION)}getSpeed(){return this.get(U.SPEED)}getTracking(){return this.get(U.TRACKING)}getTrackingOptions(){return this.get(U.TRACKING_OPTIONS)}setProjection(e){this.set(U.PROJECTION,Eo(e))}setTracking(e){this.set(U.TRACKING,e)}setTrackingOptions(e){this.set(U.TRACKING_OPTIONS,e)}};const $i=Wi,K={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class qi extends dn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Cr,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(K.ELEMENT,this.handleElementChanged),this.addChangeListener(K.MAP,this.handleMapChanged),this.addChangeListener(K.OFFSET,this.handleOffsetChanged),this.addChangeListener(K.POSITION,this.handlePositionChanged),this.addChangeListener(K.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(K.ELEMENT)}getId(){return this.id}getMap(){return this.get(K.MAP)||null}getOffset(){return this.get(K.OFFSET)}getPosition(){return this.get(K.POSITION)}getPositioning(){return this.get(K.POSITIONING)}handleElementChanged(){Mr(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Ar(this.element),Pr(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=pn(e,hn.POSTRENDER,this.render,this),this.updatePixelPosition();const o=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?o.insertBefore(this.element,o.childNodes[0]||null):o.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(K.ELEMENT,e)}setMap(e){this.set(K.MAP,e)}setOffset(e){this.set(K.OFFSET,e)}setPosition(e){this.set(K.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const o=this.getMap();if(!o||!o.getTargetElement()||!this.get(K.POSITION))return;const n=this.getRect(o.getTargetElement(),o.getSize()),r=this.getElement(),s=this.getRect(r,[Lr(r),Rr(r)]);e=e||{};const a=e.margin===void 0?20:e.margin;if(!fn(n,s)){const l=s[0]-n[0],u=n[2]-s[2],c=s[1]-n[1],p=n[3]-s[3],g=[0,0];if(l<0?g[0]=l-a:u<0&&(g[0]=Math.abs(u)+a),c<0?g[1]=c-a:p<0&&(g[1]=Math.abs(p)+a),g[0]!==0||g[1]!==0){const b=o.getView().getCenterInternal(),w=o.getPixelFromCoordinateInternal(b);if(!w)return;const y=[w[0]+g[0],w[1]+g[1]],k=e.animation||{};o.getView().animateInternal({center:o.getCoordinateFromPixelInternal(y),duration:k.duration,easing:k.easing})}}}getRect(e,o){const n=e.getBoundingClientRect(),r=n.left+window.pageXOffset,s=n.top+window.pageYOffset;return[r,s,r+o[0],s+o[1]]}setPositioning(e){this.set(K.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),o=this.getPosition();if(!e||!e.isRendered()||!o){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(o),r=e.getSize();this.updateRenderedPosition(n,r)}updateRenderedPosition(e,o){const n=this.element.style,r=this.getOffset(),s=this.getPositioning();this.setVisible(!0);const a=Math.round(e[0]+r[0])+"px",l=Math.round(e[1]+r[1])+"px";let u="0%",c="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?u="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(u="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?c="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(c="-50%");const p=`translate(${u}, ${c}) translate(${a}, ${l})`;this.rendered.transform_!=p&&(this.rendered.transform_=p,n.transform=p)}getOptions(){return this.options}}const lt=qi,ke=he("map:WMTSLayer");var De,Ne,Fe,Ve,ct,ut,dt,pt,Rt,In,It,Tn;class Ki extends Ir{constructor(o){const n=new co;super({...o,olLayer:n});L(this,Rt);L(this,It);L(this,De,void 0);L(this,Ne,void 0);L(this,Fe,void 0);L(this,Ve,void 0);L(this,ct,void 0);L(this,ut,void 0);L(this,dt,void 0);L(this,pt,new AbortController);I(this,De,o.url),I(this,Ne,o.name),I(this,Ve,n),I(this,Fe,o.matrixSet),I(this,dt,o.sourceOptions)}destroy(){super.destroy(),_(this,pt).abort()}get legend(){return _(this,ut)}__attach(o){super.__attach(o),W(this,Rt,In).call(this).then(n=>{const s=new Gi().read(n),a=bs(s,{layer:_(this,Ne),matrixSet:_(this,Fe)});if(!a)throw new Error("Layer was not found in capabilities");const l=new ws({...a,..._(this,dt),tileLoadFunction:(p,g)=>{W(this,It,Tn).call(this,p,g)}});I(this,ct,l),_(this,Ve).setSource(_(this,ct));const u=l.getStyle(),c=Zi(s,this.name,u);I(this,ut,c),this.__emitChangeEvent("changed:legend")}).catch(n=>{if(Mt(n)){ke.error(`Layer ${this.name} has been destroyed before fetching the data`);return}ke.error(`Failed fetching WMTS capabilities for Layer ${this.name}`,n)})}get layer(){return _(this,Ve)}get url(){return _(this,De)}get name(){return _(this,Ne)}get matrixSet(){return _(this,Fe)}get sublayers(){}}De=new WeakMap,Ne=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,ct=new WeakMap,ut=new WeakMap,dt=new WeakMap,pt=new WeakMap,Rt=new WeakSet,In=async function(){const o=this.map.__sharedDependencies.httpService;return as(_(this,De),o,_(this,pt).signal)},It=new WeakSet,Tn=async function(o,n){const r=this.map.__sharedDependencies.httpService;try{if(!(o instanceof Tr))throw new Error("Only 'ImageTile' is supported for now.");const s=o.getImage();if(!Yi(s))throw new Error("Only <img> tags are supported as tiles for now.");const a=await r.fetch(n);if(!a.ok)throw new Error(`Tile request failed with status ${a.status}.`);const l=await a.blob(),u=URL.createObjectURL(l),c=()=>{URL.revokeObjectURL(u),s.removeEventListener("load",c),s.removeEventListener("error",c)};s.addEventListener("load",c),s.addEventListener("error",c),s.src=u}catch(s){o.setState(Or.ERROR),Mt(s)||ke.error("Failed to load tile",s)}};function Yi(t){return t.tagName==="IMG"}function Zi(t,e,o){const r=t?.Contents?.Layer;let s=r?.find(c=>c?.Identifier===e);if(!s&&(ke.debug("Failed to find the active layer in WMTS layer capabilities."),s=r?.[0],!s)){ke.debug("No layer in WMTS capabilities - giving up.");return}const a=s.Style;let l=a?.find(c=>c?.Identifier===o);if(!l&&(ke.debug("Failed to find active style in WMTS layer."),l=a?.[0],!l)){ke.debug("No style in WMTS layer capabilities - giving up.");return}return l.LegendURL?.[0]?.href}const Io=Ki,Xi=25.4/.28,Ji=39.37;function mo(t){return vo(t,Qi,ea)}function Qi(t){return t.getView()}function ea(t,e){return t.on("change:view",e)}function On(t){return mo(t)?.getProjection()}function ta(t){const e=mo(t);return vo(e,oa,na)}function oa(t){return t.getResolution()}function na(t,e){return t.on("change:resolution",e)}function ra(t){const e=mo(t);return vo(e,sa,ia)}function sa(t){return t.getCenter()}function ia(t,e){return t.on("change:center",e)}function aa(t){const e=ra(t),o=ta(t),n=On(t);return d.useMemo(()=>{if(n==null||o==null||e==null)return;const s=jr(n,o,e);return Math.round(s*Ji*Xi)},[n,o,e])}function vo(t,e,o){const n=d.useCallback(()=>t?e(t):void 0,[t,e]),r=d.useCallback(s=>{if(!t)return()=>{};const a=o(t,s);return()=>le(a)},[t,o]);return d.useSyncExternalStore(r,n)}const la=1.2;function ca(t,e=la){ua(t);const o=Dr(t),n=Nr(t),r=o*e,s=n*e;return[t[0]-(r-o)/2,t[1]-(s-n)/2,t[2]+(r-o)/2,t[3]+(s-n)/2]}function ua(t){if(t.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${t.length}).`)}const da={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function pa(t){return i.jsxs(j,{children:[i.jsx(pe,{children:t.layer.title}),i.jsx(j,{style:da})]})}const B="main";class ha{mapId=B;vectorSourceFactory;constructor(e){this.vectorSourceFactory=e.references.vectorSourceFactory}async getMapConfig(){const e={Component:pa};return{advanced:{view:new gn({center:[404747,5757920],zoom:13,constrainResolution:!0,projection:"EPSG:25832"})},layers:[new xt({title:"Linfos",visible:!0,url:"https://www.wms.nrw.de/umwelt/linfos",sublayers:[{name:"SonstigeSchutzgebiete",title:"SonstigeSchutzgebiete"},{name:"SCH_GSG",title:"SCH_GSG"}]}),new Io({isBaseLayer:!0,title:"Topplus grau",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_grau",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new Io({isBaseLayer:!0,title:"Topplus farbig",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_col",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new rt({title:"OSM",visible:!1,isBaseLayer:!0,olLayer:new co({source:new mn})}),new rt({title:"Haltestellen Stadt Rostock",visible:!0,description:"Haltestellen des öffentlichen Personenverkehrs in der Hanse- und Universitätsstadt Rostock.",olLayer:fa(),attributes:{legend:e}}),new rt({id:"ogc_kitas",title:"Kindertagesstätten",visible:!0,olLayer:ga(),attributes:{legend:e,resultListMetadata:[{id:"id",displayName:"ID",width:100,getPropertyValue(o){return o.id}},{propertyName:"pointOfContact.address.postCode",displayName:"PLZ",width:120},{propertyName:"name",displayName:"Name"},{propertyName:"inspireId",displayName:"inspireID"},{displayName:"Gefördert",width:160,getPropertyValue(o){switch(o.properties?.gefoerdert){case"ja":return!0;case"nein":return!1;default:return o.properties?.gefoerdert}}}]}}),new rt({id:"ogc_kataster",title:"Liegenschaftskatasterbezirke in NRW (viele Daten)",visible:!1,olLayer:ma(this.vectorSourceFactory),attributes:{resultListMetadata:[{propertyName:"id",displayName:"ID",width:600,getPropertyValue(o){return o.id}},{displayName:"Aktualit",width:600,getPropertyValue(o){const n=o.properties?.aktualit;return typeof n=="string"&&!isNaN(Date.parse(n))?new Date(n):n}}]}}),wa(this.vectorSourceFactory),Sa(),ya(),va(),ba()]}}}function fa(){const t=new Ze({url:"https://geo.sv.rostock.de/download/opendata/haltestellen/haltestellen.json",format:new zt,attributions:"Haltestellen Stadt Rostock, Creative Commons CC Zero License (cc-zero)"});return new _e({source:t})}function ga(){const t=new Ze({url:"https://ogc-api.nrw.de/inspire-us-kindergarten/v1/collections/governmentalservice/items?f=json&limit=10000",format:new zt,attributions:'&copy; <a href="http://www.bkg.bund.de" target="_blank">Bundesamt f&uuml;r Kartographie und Geod&auml;sie</a> 2017, <a href="http://sg.geodatenzentrum.de/web_public/Datenquellen_TopPlus_Open.pdf" target="_blank">Datenquellen</a>'});return new _e({source:t,style:new Le({image:new uo({fill:new We({color:"blue"}),radius:4})})})}function ma(t){const e=t.createVectorSource({baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"katasterbezirk",limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`});return new _e({source:e})}function va(){return new xt({title:"Verwaltungsgebiete",visible:!0,url:"https://www.wms.nrw.de/geobasis/wms_nw_dvg",sublayers:[{name:"nw_dvg_bld",title:"NRW"}]})}function ba(){return new xt({title:"Bodenkarte zur Landwirtschaftlichen Standorterkundung",visible:!0,url:"https://www.wms.nrw.de/gd/bk05l",sublayers:[{name:"Versickerung_und_Stofftransport",title:"Versickerung und Stofftransport",sublayers:[{name:"Sickerwasserrate",title:"Sickerwasserrate",sublayers:[{name:"Szenario_Wald",title:"Szenario Wald",sublayers:[{name:"Sickerwasserrate_Wald",title:"Sickerwasserrate Wald"},{name:"Direktabfluss_Wald",title:"Direktabfluss Wald"}]},{name:"Szenario_Gruenland",title:"Szenario Grünland",sublayers:[{name:"Sickerwasserrate_Gruenland",title:"Sickerwasserrate Grünland"},{name:"Direktabfluss_Gruenland",title:"Direktabfluss Grünland"}]}]}]},{name:"Wasserhaushalt",title:"Wasserhaushalt",sublayers:[{name:"Kapillaraufstieg_von_Grundwasser",title:"Kapillaraufstieg von Grundwasser",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/gd/bk05l?request=GetLegendGraphic%26version=1.3.0%26format=image/png%26layer=Kapillaraufstieg_von_Grundwasser"}}},{name:"Luftkapazitaet_We",title:"Luftkapazitaet (We)",attributes:{legend:{}}}]}]})}function wa(t){const e="https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1",o="governmentalservice",n=t.createVectorSource({baseUrl:e,collectionId:o,limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`}),r=new _e({source:n});return new rt({id:"krankenhaus",title:"Krankenhäuser",visible:!0,olLayer:r,attributes:{collectionURL:e+"/collections/"+o}})}function Sa(){return new xt({title:"Schulstandorte",description:"Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.",visible:!0,url:"https://www.wms.nrw.de/wms/wms_nw_inspire-schulen",sublayers:[{name:"US.education",title:"INSPIRE - WMS Schulstandorte NRW",attributes:{legend:{}}}],sourceOptions:{ratio:1}})}function ya(){return new xt({title:"Straßennetz Landesbetrieb Straßenbau NRW",url:"https://www.wms.nrw.de/wms/strassen_nrw_wms",visible:!0,sublayers:[{name:"1",title:"Verwaltungen",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/legends/wms/strassen_nrw_wms/1.png"}}},{name:"4",title:"Abschnitte und Äste"},{name:"6",title:"Unfälle"}]})}const xa=Symbol(),bo=Symbol(),et="a",Ct="w";let _a=(t,e)=>new Proxy(t,e);const so=Object.getPrototypeOf,io=new WeakMap,jn=t=>t&&(io.has(t)?io.get(t):so(t)===Object.prototype||so(t)===Array.prototype),To=t=>typeof t=="object"&&t!==null,Ea=t=>{if(Array.isArray(t))return Array.from(t);const e=Object.getOwnPropertyDescriptors(t);return Object.values(e).forEach(o=>{o.configurable=!0}),Object.create(so(t),e)},Dn=t=>t[bo]||t,Nn=(t,e,o,n)=>{if(!jn(t))return t;let r=n&&n.get(t);if(!r){const u=Dn(t);r=(c=>Object.values(Object.getOwnPropertyDescriptors(c)).some(p=>!p.configurable&&!p.writable))(u)?[u,Ea(u)]:[u],n?.set(t,r)}const[s,a]=r;let l=o&&o.get(s);return l&&l[1].f===!!a||(l=((u,c)=>{const p={f:c};let g=!1;const b=(y,k)=>{if(!g){let R=p[et].get(u);if(R||(R={},p[et].set(u,R)),y===Ct)R[Ct]=!0;else{let A=R[y];A||(A=new Set,R[y]=A),A.add(k)}}},w={get:(y,k)=>k===bo?u:(b("k",k),Nn(Reflect.get(y,k),p[et],p.c,p.t)),has:(y,k)=>k===xa?(g=!0,p[et].delete(u),!0):(b("h",k),Reflect.has(y,k)),getOwnPropertyDescriptor:(y,k)=>(b("o",k),Reflect.getOwnPropertyDescriptor(y,k)),ownKeys:y=>(b(Ct),Reflect.ownKeys(y))};return c&&(w.set=w.deleteProperty=()=>!1),[w,p]})(s,!!a),l[1].p=_a(a||s,l[0]),o&&o.set(s,l)),l[1][et]=e,l[1].c=o,l[1].t=n,l[1].p},Fn=(t,e,o,n)=>{if(Object.is(t,e))return!1;if(!To(t)||!To(e))return!0;const r=o.get(Dn(t));if(!r)return!0;if(n){const a=n.get(t);if(a&&a.n===e)return a.g;n.set(t,{n:e,g:!1})}let s=null;try{for(const a of r.h||[])if(s=Reflect.has(t,a)!==Reflect.has(e,a),s)return s;if(r[Ct]===!0){if(s=((a,l)=>{const u=Reflect.ownKeys(a),c=Reflect.ownKeys(l);return u.length!==c.length||u.some((p,g)=>p!==c[g])})(t,e),s)return s}else for(const a of r.o||[])if(s=!!Reflect.getOwnPropertyDescriptor(t,a)!=!!Reflect.getOwnPropertyDescriptor(e,a),s)return s;for(const a of r.k||[])if(s=Fn(t[a],e[a],o,n),s)return s;return s===null&&(s=!0),s}finally{n&&n.set(t,{n:e,g:s})}},ka=t=>jn(t)&&t[bo]||null,Oo=(t,e=!0)=>{io.set(t,e)};const qt=t=>typeof t=="object"&&t!==null,me=new WeakMap,st=new WeakSet,Ca=(t=Object.is,e=(c,p)=>new Proxy(c,p),o=c=>qt(c)&&!st.has(c)&&(Array.isArray(c)||!(Symbol.iterator in c))&&!(c instanceof WeakMap)&&!(c instanceof WeakSet)&&!(c instanceof Error)&&!(c instanceof Number)&&!(c instanceof Date)&&!(c instanceof String)&&!(c instanceof RegExp)&&!(c instanceof ArrayBuffer),n=c=>{switch(c.status){case"fulfilled":return c.value;case"rejected":throw c.reason;default:throw c}},r=new WeakMap,s=(c,p,g=n)=>{const b=r.get(c);if(b?.[0]===p)return b[1];const w=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c));return Oo(w,!0),r.set(c,[p,w]),Reflect.ownKeys(c).forEach(y=>{if(Object.getOwnPropertyDescriptor(w,y))return;const k=Reflect.get(c,y),{enumerable:R}=Reflect.getOwnPropertyDescriptor(c,y),A={value:k,enumerable:R,configurable:!0};if(st.has(k))Oo(k,!1);else if(k instanceof Promise)delete A.value,A.get=()=>g(k);else if(me.has(k)){const[N,F]=me.get(k);A.value=s(N,F(),g)}Object.defineProperty(w,y,A)}),Object.preventExtensions(w)},a=new WeakMap,l=[1,1],u=c=>{if(!qt(c))throw new Error("object required");const p=a.get(c);if(p)return p;let g=l[0];const b=new Set,w=(m,v=++l[0])=>{g!==v&&(g=v,b.forEach(h=>h(m,v)))};let y=l[1];const k=(m=++l[1])=>(y!==m&&!b.size&&(y=m,A.forEach(([v])=>{const h=v[1](m);h>g&&(g=h)})),g),R=m=>(v,h)=>{const S=[...v];S[1]=[m,...S[1]],w(S,h)},A=new Map,N=(m,v)=>{if(b.size){const h=v[3](R(m));A.set(m,[v,h])}else A.set(m,[v])},F=m=>{var v;const h=A.get(m);h&&(A.delete(m),(v=h[1])==null||v.call(h))},Z=m=>(b.add(m),b.size===1&&A.forEach(([h,S],M)=>{const x=h[3](R(M));A.set(M,[h,x])}),()=>{b.delete(m),b.size===0&&A.forEach(([h,S],M)=>{S&&(S(),A.set(M,[h]))})}),X=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c)),H=e(X,{deleteProperty(m,v){const h=Reflect.get(m,v);F(v);const S=Reflect.deleteProperty(m,v);return S&&w(["delete",[v],h]),S},set(m,v,h,S){const M=Reflect.has(m,v),x=Reflect.get(m,v,S);if(M&&(t(x,h)||a.has(h)&&t(x,a.get(h))))return!0;F(v),qt(h)&&(h=ka(h)||h);let C=h;if(h instanceof Promise)h.then(V=>{h.status="fulfilled",h.value=V,w(["resolve",[v],V])}).catch(V=>{h.status="rejected",h.reason=V,w(["reject",[v],V])});else{!me.has(h)&&o(h)&&(C=u(h));const V=!st.has(C)&&me.get(C);V&&N(v,V)}return Reflect.set(m,v,C,S),w(["set",[v],h,x]),!0}});a.set(c,H);const f=[X,k,s,Z];return me.set(H,f),Reflect.ownKeys(c).forEach(m=>{const v=Object.getOwnPropertyDescriptor(c,m);"value"in v&&(H[m]=c[m],delete v.value,delete v.writable),Object.defineProperty(X,m,v)}),H})=>[u,me,st,t,e,o,n,r,s,a,l],[Ma]=Ca();function Vn(t={}){return Ma(t)}function Aa(t,e,o){const n=me.get(t);let r;const s=[],a=n[3];let l=!1;const c=a(p=>{if(s.push(p),o){e(s.splice(0));return}r||(r=Promise.resolve().then(()=>{r=void 0,l&&e(s.splice(0))}))});return l=!0,()=>{l=!1,c()}}function jo(t,e){const o=me.get(t),[n,r,s]=o;return s(n,r(),e)}function tt(t){return st.add(t),t}var zn={exports:{}},Bn={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $e=d;function Pa(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var La=typeof Object.is=="function"?Object.is:Pa,Ra=$e.useState,Ia=$e.useEffect,Ta=$e.useLayoutEffect,Oa=$e.useDebugValue;function ja(t,e){var o=e(),n=Ra({inst:{value:o,getSnapshot:e}}),r=n[0].inst,s=n[1];return Ta(function(){r.value=o,r.getSnapshot=e,Kt(r)&&s({inst:r})},[t,o,e]),Ia(function(){return Kt(r)&&s({inst:r}),t(function(){Kt(r)&&s({inst:r})})},[t]),Oa(o),o}function Kt(t){var e=t.getSnapshot;t=t.value;try{var o=e();return!La(t,o)}catch{return!0}}function Da(t,e){return e()}var Na=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Da:ja;Bn.useSyncExternalStore=$e.useSyncExternalStore!==void 0?$e.useSyncExternalStore:Na;zn.exports=Bn;var Fa=zn.exports;const Va=hr(Fa),{use:Do}=an,{useSyncExternalStore:za}=Va;const Ba=new WeakMap;function qe(t,e){const o=e?.sync,n=d.useRef(),r=d.useRef();let s=!0;const a=za(d.useCallback(c=>{const p=Aa(t,c,o);return c(),p},[t,o]),()=>{const c=jo(t,Do);try{if(!s&&n.current&&r.current&&!Fn(n.current,c,r.current,new WeakMap))return n.current}catch{}return c},()=>jo(t,Do));s=!1;const l=new WeakMap;d.useEffect(()=>{n.current=a,r.current=l});const u=d.useMemo(()=>new WeakMap,[]);return Nn(a,l,u,Ba)}function Ga(t){const e=Vn({data:Array.from(t||[]),has(o){return this.data.some(n=>n[0]===o)},set(o,n){const r=this.data.find(s=>s[0]===o);return r?r[1]=n:this.data.push([o,n]),this},get(o){var n;return(n=this.data.find(r=>r[0]===o))==null?void 0:n[1]},delete(o){const n=this.data.findIndex(r=>r[0]===o);return n===-1?!1:(this.data.splice(n,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(o){this.data.forEach(n=>{o(n[1],n[0],this)})},keys(){return this.data.map(o=>o[0]).values()},values(){return this.data.map(o=>o[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}class Ua{label;filteredTypes;httpService;constructor(e,o,n){this.label=e,this.filteredTypes=o,this.httpService=n}async search(e,{mapProjection:o,signal:n}){const r=await this.request(e,100,n),s=new zt({dataProjection:"EPSG:4326",featureProjection:o});return r.features.filter(a=>this.filteredTypes.includes(a.properties.type)).map((a,l)=>{const u=s.readGeometry(a.geometry);return{id:a.properties.osm_id||l,label:this.createLabel(a),geometry:u,properties:a.properties}})}async request(e,o,n){const r=new URL("https://photon.komoot.io/api?");r.searchParams.set("q",e),r.searchParams.set("lang","de"),r.searchParams.set("lat","51.961563"),r.searchParams.set("lon","7.628202"),r.searchParams.set("limit",o.toString());const s=await this.httpService.fetch(r,{signal:n});if(!s.ok)throw new Error("Request failed: "+s.status);return await s.json()}createLabel(e){return`${e.properties.name} (${e.properties.osm_value?e.properties.osm_value+", ":""}${e.properties.postcode?e.properties.postcode+", ":""}${e.properties.city?e.properties.city+", ":""}${e.properties.country?e.properties.country+")":")"}`}}const Ha=he("ol-app:AppModel");class Wa{_intl;_mapRegistry;_ogcSearchSourceFactory;_vectorSelectionSourceFactory;_httpService;_state;_resources=[];constructor({references:e,intl:o}){this._mapRegistry=e.mapRegistry,this._intl=o,this._ogcSearchSourceFactory=e.ogcSearchSourceFactory,this._vectorSelectionSourceFactory=e.vectorSelectionSourceFactory,this._httpService=e.httpService,this._state=Vn({searchSources:[],selectionSources:[],sourceMetadata:Ga(),resultListState:{input:void 0,open:!1,key:0}}),this.initSearchSources(),this.initSelectionSources().catch(n=>{Ha.error("Failed to initialize selection sources",n)})}destroy(){this._resources.forEach(e=>e.destroy())}get state(){return this._state}setResultListInput(e){const o=this._state.resultListState.key;this._state.resultListState={open:!0,key:o+1,input:e}}setResultListVisibility(e){this._state.resultListState.open=e}initSearchSources(){const e=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.lika"}),baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"flurstueck",searchProperty:"flurstid",labelProperty:"objid"}),o=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.miningPermissions"}),baseUrl:"https://ogc-api.nrw.de/inspire-am-bergbauberechtigungen/v1",collectionId:"managementrestrictionorregulationzone",searchProperty:"thematicId",labelProperty:"name",renderLabel(r){const s=r?.properties?.name,a=r?.id;return typeof s=="string"?s+" ("+a+")":String(a)},rewriteUrl(r){return r.searchParams.set("properties","name"),r}}),n=new Ua("Photon Geocoder",["city","street"],this._httpService);this._state.searchSources=[tt(e),tt(o),tt(n)]}async initSelectionSources(){const e=["ogc_kitas","ogc_kataster"],o=await this._mapRegistry.expectMapModel(B),n=o.layers.getOperationalLayers({sortByDisplayOrder:!0});for(const r of n){if(!e.includes(r.id)||!$a(r.olLayer))continue;const s=this._vectorSelectionSourceFactory.createSelectionSource({vectorLayer:r.olLayer,label:r.title}),a=s.on("changed:status",()=>{s.status!=="available"&&(s.status==="unavailable"||s.status?.kind==="unavailable")&&o.removeHighlights()});this._resources.push(a,s),this._state.selectionSources.unshift(tt(s)),this._state.sourceMetadata.set(tt(s),r.attributes.resultListMetadata)}}}function $a(t){return t instanceof _e&&t.getSource()instanceof Ze}const Yt=.75,_t=.1;let qa=class extends Fr{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const o=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",r=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r):this.collapseLabel_=r;const s=e.label!==void 0?e.label:"›";typeof s=="string"?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=n,l.appendChild(a),l.addEventListener(Vr.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const u=new zr({view:e.view,controls:new ko,interactions:new ko});this.ovmap_=u,e.layers&&e.layers.forEach(function(N){u.addLayer(N)});const c=document.createElement("div");c.className="ol-overviewmap-box",c.style.boxSizing="border-box",this.boxOverlay_=new lt({position:[0,0],positioning:"center-center",element:c}),this.ovmap_.addOverlay(this.boxOverlay_);const p=o+" "+Br+" "+Gr+(this.collapsed_&&this.collapsible_?" "+Co:"")+(this.collapsible_?"":" ol-uncollapsible"),g=this.element;g.className=p,g.appendChild(this.ovmapDiv_),g.appendChild(l);const b=this,w=this.boxOverlay_,y=this.boxOverlay_.getElement(),k=function(N){return{clientX:N.clientX,clientY:N.clientY}},R=function(N){const F=k(N),Z=u.getEventCoordinateInternal(F);w.setPosition(Z)},A=function(N){const F=u.getEventCoordinateInternal(N);b.getMap().getView().setCenterInternal(F),window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",A)};y.addEventListener("mousedown",function(){window.addEventListener("mousemove",R),window.addEventListener("mouseup",A)})}setMap(e){const o=this.getMap();if(e!==o){if(o){const n=o.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(pn(e,Ur.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===$t.VIEW){const o=e.oldValue;o&&this.unbindView_(o);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===$t.TARGET||e.key===$t.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const o=new gn({projection:e.getProjection()});this.ovmap_.setView(o)}e.addChangeListener(Mo.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(Mo.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),o=this.ovmap_;if(!e.isRendered()||!o.isRendered())return;const n=e.getSize(),s=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&Hr(s,this.viewExtent_))return;this.viewExtent_=s;const a=o.getSize(),u=o.getView().calculateExtentInternal(a),c=o.getPixelFromCoordinateInternal(Wr(s)),p=o.getPixelFromCoordinateInternal($r(s)),g=Math.abs(c[0]-p[0]),b=Math.abs(c[1]-p[1]),w=a[0],y=a[1];g<w*_t||b<y*_t||g>w*Yt||b>y*Yt?this.resetExtent_():fn(u,s)||this.recenter_()}resetExtent_(){const e=this.getMap(),o=this.ovmap_,n=e.getSize(),s=e.getView().calculateExtentInternal(n),a=o.getView(),l=Math.log(Yt/_t)/Math.LN2,u=1/(Math.pow(2,l/2)*_t);qr(s,u),a.fitInternal(Kr(s))}recenter_(){const e=this.getMap(),o=this.ovmap_,n=e.getView();o.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),o=this.ovmap_;if(!e.isRendered()||!o.isRendered())return;const n=e.getSize(),r=e.getView(),s=o.getView(),a=this.rotateWithView_?0:-r.getRotation(),l=this.boxOverlay_,u=this.boxOverlay_.getElement(),c=r.getCenterInternal(),p=r.getResolution(),g=s.getResolution(),b=n[0]*p/g,w=n[1]*p/g;if(l.setPosition(c),u){u.style.width=b+"px",u.style.height=w+"px";const y="rotate("+a+"rad)";u.style.transform=y}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Yr(this.ovmap_,hn.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Co),this.collapsed_?Ao(this.collapseLabel_,this.label_):Ao(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};const Ka=qa;async function Ya(t,e,o,n){const s=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=await t.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:o}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${s}>`}});if(!a||!a.ok||a.status!==201)return Promise.reject(new Error("Request failed: "+a.status));const l=a.headers.get("location");if(!l)return Promise.reject(new Error("Request failed: no Location response header"));const u=l.substring(l.lastIndexOf("/")+1);return Promise.resolve(u)}var ve;class Za extends po{constructor(o){super();L(this,ve,void 0);$(this,"_httpService");$(this,"_intl");$(this,"_map");$(this,"_polygonDrawStyle");$(this,"_state");$(this,"_editLayerURL");$(this,"_drawSource");$(this,"_drawLayer");$(this,"_drawInteraction");$(this,"_olMap");$(this,"_mapContainer");$(this,"_tooltip");$(this,"_enterHandler");$(this,"_escapeHandler");$(this,"_interactionListener");$(this,"_mapListener");this._httpService=o.httpService,this._intl=o.intl,this._polygonDrawStyle=o.polygonDrawStyle,this._map=o.map,this._olMap=o.map.olMap,this._state="active:initialized",this._editLayerURL=o.ogcApiFeatureLayerUrl,this._drawSource=new Ze,this._drawLayer=new _e({source:this._drawSource,zIndex:ho,properties:{name:"editing-layer"}}),this._drawInteraction=new _n({source:this._drawSource,type:"Polygon",style:this._polygonDrawStyle}),this._tooltip=this._createTooltip(this._olMap),this._enterHandler=n=>{if(n.code==="Enter"&&n.target===this._olMap.getTargetElement()){const r=this._drawInteraction.getOverlay().getSource().getFeatures();r[0]&&r[0].getGeometry().getCoordinates()[0].length>4&&this._drawInteraction.finishDrawing()}},this._escapeHandler=n=>{n.code==="Escape"&&n.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(o){this._state=o,this.emit(o)}_start(){this._olMap.addLayer(this._drawLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.element.classList.remove("editing-tooltip-hidden");const o=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.continue"})}),n=this._drawInteraction.on("drawend",s=>{this._setState("active:saving");const a=this._editLayerURL,l=s.feature.getGeometry();if(!l){this._destroy(),_(this,ve)?.reject(new Error("no geometry available"));return}const u=this._olMap.getView().getProjection(),p=new zt({dataProjection:u}).writeGeometryObject(l,{rightHanded:!0,decimals:10});Ya(this._httpService,a,p,u).then(g=>{this._destroy(),_(this,ve)?.resolve(g)}).catch(g=>{console.log(g),this._destroy(),_(this,ve)?.reject(g)})}),r=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(o,n),this._mapListener.push(r)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.begin"}),this._setState("active:initialized")}stop(){this._destroy(),_(this,ve)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._drawLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(o=>{le(o)}),this._mapListener.map(o=>{o.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._state="inactive"}whenComplete(){return(_(this,ve)??I(this,ve,fr())).promise}_createTooltip(o){const n=document.createElement("div");n.className="editing-tooltip editing-tooltip-hidden",n.textContent=this._intl.formatMessage({id:"tooltip.begin"});const r=new lt({element:n,offset:[15,0],positioning:"center-left"}),s=o.on("pointermove",a=>{a.dragging||r.setPosition(a.coordinate)});return o.addOverlay(r),{overlay:r,element:n,destroy(){le(s),o.removeOverlay(r)}}}}ve=new WeakMap;class Xa{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}start(e,o){if(!o||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let r=this._workflows.get(n);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new Za({map:e,ogcApiFeatureLayerUrl:o,polygonDrawStyle:this._serviceOptions.properties.polygonDrawStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,r),this._connectToWorkflowComplete(r,n),r}stop(e){const o=this._workflows.get(e);if(o)o.stop();else return new Error("No workflow found for mapId: "+e)}reset(e){const o=this._workflows.get(e);if(o)o.reset();else return new Error("No workflow found for mapId: "+e)}_connectToWorkflowComplete(e,o){e.whenComplete().finally(()=>{this._workflows.delete(o)})}}new Jt([407354,5754673]),new Jt([404740,5757893]);var Ce,be,ht,ft,gt,ao;class Ja extends po{constructor(o,n,r){super();L(this,gt);$(this,"label");L(this,Ce,{kind:"available"});L(this,be,void 0);L(this,ht,void 0);L(this,ft,void 0);this.label=n,I(this,be,o),I(this,ft,r),W(this,gt,ao).call(this),I(this,ht,_(this,be).on("change:visible",()=>{W(this,gt,ao).call(this)}))}destroy(){le(_(this,ht))}get status(){return _(this,Ce)}async select(o,n){if(o.type!=="extent")throw new Error(`Unsupported selection kind: ${o.type}`);if(_(this,Ce).kind!=="available"||_(this,be).getSource()===null)return[];const r=[];_(this,be).getSource().forEachFeatureIntersectingExtent(o.extent,l=>{if(!l.getGeometry())return;const u={...l.getProperties()};delete u.geometries;const c={id:l.getId()?.toString()||vn(),geometry:l.getGeometry(),properties:u};r.push(c)});const s=r.filter(l=>l!=null);return s.length>n.maxResults?s.slice(0,n.maxResults):s}}Ce=new WeakMap,be=new WeakMap,ht=new WeakMap,ft=new WeakMap,gt=new WeakSet,ao=function(){const n=_(this,be).getVisible()?{kind:"available"}:{kind:"unavailable",reason:_(this,ft)};n.kind!==_(this,Ce).kind&&(I(this,Ce,n),this.emit("changed:status"))};var mt;class Qa{constructor({intl:e}){L(this,mt,void 0);I(this,mt,e)}createSelectionSource(e){return new Ja(e.vectorLayer,e.label,_(this,mt).formatMessage({id:"layerNotVisibleReason"}))}}mt=new WeakMap;const Pe=he("local-storage"),el=0,ae={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var ze,ne,we,Be,re,Tt,Gn,Ot,Un,Me,it,Se,je,jt,Hn;class tl{constructor(e){L(this,Tt);L(this,Ot);L(this,Me);L(this,Se);L(this,jt);L(this,ze,void 0);L(this,ne,{});L(this,we,void 0);L(this,Be,void 0);L(this,re,void 0);I(this,ze,sl(e.properties)),I(this,we,il()),_(this,we)&&(W(this,Ot,Un).call(this),I(this,Be,W(this,jt,Hn).call(this)))}destroy(){_(this,re)&&(clearTimeout(_(this,re)),I(this,re,void 0)),_(this,we)&&W(this,Me,it).call(this)}get isSupported(){return!!_(this,Be)}get(e){return W(this,Se,je).call(this).get(e)}set(e,o){return W(this,Se,je).call(this).set(e,o)}remove(e){return W(this,Se,je).call(this).remove(e)}removeAll(){return W(this,Se,je).call(this).removeAll()}getNamespace(e){return W(this,Se,je).call(this).getNamespace(e)}}ze=new WeakMap,ne=new WeakMap,we=new WeakMap,Be=new WeakMap,re=new WeakMap,Tt=new WeakSet,Gn=function(){_(this,re)&&clearTimeout(_(this,re)),I(this,re,setTimeout(()=>{I(this,re,void 0),W(this,Me,it).call(this)},el))},Ot=new WeakSet,Un=function(){try{const e=_(this,we);if(!e)throw new ie(ae.INTERNAL,"Local storage is not available.");const o=e.getItem(_(this,ze));if(o==null){I(this,ne,{}),W(this,Me,it).call(this);return}try{const n=JSON.parse(o);if(!Ke(n))throw new ie(ae.CORRUPTED_DATA,"Persisted value should be an object.");I(this,ne,n)}catch(n){Pe.warn("Invalid persisted data, reverting to default.",n),I(this,ne,{}),W(this,Me,it).call(this)}}catch(e){Pe.error("Failed to load from local storage",e)}},Me=new WeakSet,it=function(){try{const e=_(this,we);if(!e)throw new ie(ae.INTERNAL,"Local storage is not available.");const o=JSON.stringify(_(this,ne));e.setItem(_(this,ze),o)}catch(e){Pe.error("Failed to save to local storage",e)}},Se=new WeakSet,je=function(){const e=_(this,Be);if(!e)throw new ie(ae.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},jt=new WeakSet,Hn=function(){const e={getByPath:o=>Fo(ol(_(this,ne),o)),setByPath:(o,n)=>{if(!rl(n))throw new ie(ae.INVALID_VALUE,"The value is not supported by local storage.");if(n=Fo(n),o.length===0){if(!Ke(n))throw new ie(ae.INVALID_VALUE,"The root value must be a plain object.");I(this,ne,n)}else nl(_(this,ne),o,n);W(this,Tt,Gn).call(this)}};return new wo([],e)};class wo{path;access;constructor(e,o){this.path=e,this.access=o}get(e){return this.access.getByPath([...this.path,e])}set(e,o){this.access.setByPath([...this.path,e],o)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const o=this.get(e);if(o===void 0)this.set(e,{});else if(!Ke(o))throw new ie(ae.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new wo(this.path.concat([e]),this.access)}}const No="trails-state";function ol(t,e){let o=t;for(const n of e){if(!Ke(o))throw new ie(ae.INVALID_PATH,`Cannot get nested property '${n}' because the parent is no object.`);o=o[n]}return o}function nl(t,e,o){if(!e.length)throw new ie(ae.INTERNAL,"Path must not be empty.");let n=t;for(let s=0,a=e.length-1;s<a;++s){const l=e[s],u=n[l];if(!Ke(u))throw new ie(ae.INVALID_PATH,`Cannot set property on '${l}' because it is no object.`);n=u}const r=e[e.length-1];n[r]=o}function Ke(t){return!!(t&&typeof t=="object"&&!Array.isArray(t))}function rl(t){const e=typeof t;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||t===null||Array.isArray(t)||Ke(t)}function sl(t){const e=t.storageId;return!e||typeof e!="string"?(Pe.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${No}'.`),No):e}function il(){if(typeof Storage>"u"){Pe.warn("Local storage is not supported by this browser.");return}try{const t=globalThis.localStorage;if(!t){Pe.warn("Local storage is not supported by this browser.");return}return t}catch(t){Pe.warn("Local storage is not supported by this browser.",t);return}}function Fo(t){return t!=null&&(t=JSON.parse(JSON.stringify(t))),t}const al={"ol-map":{name:"ol-map",services:{MapConfigProviderImpl:{name:"MapConfigProviderImpl",clazz:ha,provides:[{name:"map.MapConfigProvider",qualifier:void 0}],references:{vectorSourceFactory:{name:"ogc-features.VectorSourceFactory",qualifier:void 0,all:!1}}},AppModel:{name:"AppModel",clazz:Wa,provides:[{name:"ol-app.AppModel",qualifier:void 0}],references:{ogcSearchSourceFactory:{name:"ogc-features.SearchSourceFactory",qualifier:void 0,all:!1},vectorSelectionSourceFactory:{name:"selection.VectorSelectionSourceFactory",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1},mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1},{name:"ol-app.AppModel",qualifier:void 0,all:!1},{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"editing.EditingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/chakra-integration":{name:"@open-pioneer/chakra-integration",services:{},ui:{references:[]},properties:{}},"@open-pioneer/experimental-layout-sidebar":{name:"@open-pioneer/experimental-layout-sidebar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/http":{name:"@open-pioneer/http",services:{HttpServiceImpl:{name:"HttpServiceImpl",clazz:Zr,provides:[{name:"http.HttpService",qualifier:"http.HttpService"}],references:{interceptors:{name:"http.Interceptor",qualifier:void 0,all:!0}}}},ui:{references:[]},properties:{}},"@open-pioneer/map":{name:"@open-pioneer/map",services:{MapRegistryImpl:{name:"MapRegistryImpl",clazz:Xr,provides:[{name:"map.MapRegistry",qualifier:void 0}],references:{providers:{name:"map.MapConfigProvider",qualifier:void 0,all:!0},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/notifier":{name:"@open-pioneer/notifier",services:{NotificationServiceImpl:{name:"NotificationServiceImpl",clazz:ys,provides:[{name:"notifier.NotificationService",qualifier:"notifier.NotificationService"}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/printing":{name:"@open-pioneer/printing",services:{PrintingServiceImpl:{name:"PrintingServiceImpl",clazz:xs,provides:[{name:"printing.PrintingService",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"printing.PrintingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/react-utils":{name:"@open-pioneer/react-utils",services:{},ui:{references:[]},properties:{}},"@open-pioneer/result-list":{name:"@open-pioneer/result-list",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime":{name:"@open-pioneer/runtime",services:{},ui:{references:[]},properties:{}},"@open-pioneer/theme":{name:"@open-pioneer/theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/toc":{name:"@open-pioneer/toc",services:{},ui:{references:[]},properties:{}},"@open-pioneer/core":{name:"@open-pioneer/core",services:{},ui:{references:[]},properties:{}},"@open-pioneer/base-theme":{name:"@open-pioneer/base-theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime-react-support":{name:"@open-pioneer/runtime-react-support",services:{},ui:{references:[]},properties:{}},"@open-pioneer/basemap-switcher":{name:"@open-pioneer/basemap-switcher",services:{},ui:{references:[]},properties:{}},"@open-pioneer/coordinate-viewer":{name:"@open-pioneer/coordinate-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/overview-map":{name:"@open-pioneer/overview-map",services:{},ui:{references:[]},properties:{}},"@open-pioneer/ogc-features":{name:"@open-pioneer/ogc-features",services:{VectorSourceFactory:{name:"VectorSourceFactory",clazz:Ms,provides:[{name:"ogc-features.VectorSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}},SearchSourceFactory:{name:"SearchSourceFactory",clazz:As,provides:[{name:"ogc-features.SearchSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{}},"@open-pioneer/scale-bar":{name:"@open-pioneer/scale-bar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-viewer":{name:"@open-pioneer/scale-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/editing":{name:"@open-pioneer/editing",services:{EditingServiceImpl:{name:"EditingServiceImpl",clazz:Xa,provides:[{name:"editing.EditingService",qualifier:void 0}],references:{mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{polygonDrawStyle:{value:{"stroke-color":"yellow","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(0, 0, 255, 0.2)","circle-stroke-color":"rgba(0, 0, 255, 0.7)","circle-stroke-width":2},required:!1}}},"@open-pioneer/geolocation":{name:"@open-pioneer/geolocation",services:{},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/legend":{name:"@open-pioneer/legend",services:{},ui:{references:[]},properties:{}},"@open-pioneer/map-navigation":{name:"@open-pioneer/map-navigation",services:{},ui:{references:[]},properties:{}},"@open-pioneer/measurement":{name:"@open-pioneer/measurement",services:{},ui:{references:[]},properties:{}},"@open-pioneer/search":{name:"@open-pioneer/search",services:{},ui:{references:[]},properties:{}},"@open-pioneer/selection":{name:"@open-pioneer/selection",services:{VectorSelectionSourceFactory:{name:"VectorSelectionSourceFactory",clazz:Qa,provides:[{name:"selection.VectorSelectionSourceFactory",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/spatial-bookmarks":{name:"@open-pioneer/spatial-bookmarks",services:{},ui:{references:[{name:"local-storage.LocalStorageService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/local-storage":{name:"@open-pioneer/local-storage",services:{LocalStorageServiceImpl:{name:"LocalStorageServiceImpl",clazz:tl,provides:[{name:"local-storage.LocalStorageService",qualifier:"local-storage.LocalStorageService"}],references:{}}},ui:{references:[]},properties:{storageId:{value:null,required:!1}}}},ll=`.search-box{position:absolute;width:500px;max-width:100%;z-index:1}.spatial-bookmarks{max-height:300px}:root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.printing-overlay{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10000;-webkit-user-select:none;user-select:none;pointer-events:all;cursor:wait;display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:#b4b4b4cc}.printing-overlay-status{flex:1 1 auto;font-size:1.5em;text-align:center}.editing-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.editing-tooltip-hidden{visibility:hidden}.measurement-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.measurement-active-tooltip{background:rgba(0,0,0,.9);border-radius:4px;border-color:#000000e6;opacity:.9;color:#fff}.measurement-finished-tooltip{background-color:#4cb3ffe6;color:#000;border:1px solid white}.measurement-active-tooltip:before,.measurement-finished-tooltip:before{border-top:6px solid rgba(0,0,0,.9);border-right:6px solid transparent;border-left:6px solid transparent;content:"";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.measurement-finished-tooltip:before{border-top-color:#4cb3ff}.search-component .chakra-divider{display:none}.search-component .search-highlighted-match{font-weight:700}.search-component .search-value-container{cursor:text;padding-left:30px!important}.search-component .search-invisible{display:none}.selection-drag-box{background-color:#ffffff4d!important;border:3px solid var(--chakra-colors-background_primary)!important}.selection-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.selection .react-select{cursor:default}.map-container .selection-active{cursor:crosshair}.map-container .selection-inactive{cursor:no-drop}.selection-source-value.selection-source-value--disabled{opacity:.4}.selection-source-value.selection-source-value--disabled span{margin:0 6px 0 0}.layout-sidebar{height:100%;position:absolute;top:0}.layout-sidebar[data-theme=light]{background-color:var(--chakra-colors-whiteAlpha-700)}.layout-sidebar[data-theme=dark]{background-color:var(--chakra-colors-blackAlpha-700)}.layout-sidebar .layout-sidebar-main{transition:width .3s ease-out 0s;border-right:1px solid var(--chakra-colors-chakra-border-color)}.layout-sidebar .layout-sidebar-content{overflow:auto;transition:width .3s ease-out 0s}.layout-sidebar .layout-sidebar-content .content-section .content-header{font-size:1.5em;background-color:var(--chakra-colors-blackAlpha-500);padding:.5rem 1rem}.layout-sidebar .layout-sidebar-content .content-section .content-body{padding:1rem}.result-list-no-data-message{text-align:center;margin-top:50px;font-weight:700;font-size:larger}.result-list-table th,.result-list-table td{overflow-wrap:break-word}.result-list-table.result-list-table--is-resizing *{cursor:col-resize}.result-list-table thead{position:sticky;top:0;z-index:1;background:var(--chakra-colors-background_body)}.result-list-table th{position:relative;border-right-width:thin}.result-list-table tbody tr:hover{background:var(--chakra-colors-background_light)}.result-list-table .result-list-resizer{position:absolute;top:0;height:100%;right:0;width:8px;background:var(--chakra-colors-trails-100);transform:scaleX(.25);cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none;padding-left:0}.result-list-table th:last-child .result-list-resizer{width:8px;transform:translate(50%) scaleX(.25)}.result-list-table th .result-list-resizer.result-list-resizer--is-resizing{background:var(--chakra-colors-trails-500);transform:scale(1)}.result-list-table th .result-list-resizer:hover{transform:scale(1)}.overview-map .ol-overviewmap{position:relative;height:100%;width:100%}.overview-map .ol-overviewmap:not(.ol-collapsed){border:1px solid black}.overview-map .ol-overviewmap .ol-overviewmap-map{border:none;width:100%;height:100%}.overview-map .ol-overviewmap .ol-overviewmap-box{border:2px solid red}.scale-bar .ol-scale-bar{margin-bottom:8px;margin-right:8px}.scale-bar .ol-scale-bar,.scale-bar .ol-scale-line{position:relative;bottom:0;left:0;background:none}.scale-bar .ol-scale-bar .ol-scale-bar-inner,.scale-bar .ol-scale-bar .ol-scale-line-inner,.scale-bar .ol-scale-line .ol-scale-bar-inner,.scale-bar .ol-scale-line .ol-scale-line-inner{color:var(--chakra-white);border-color:var(--chakra-white)}
`,cl=["en","de"];function ul(t){switch(t){case"en":return to(()=>import("./04db0d12bd7d.js"),[],import.meta.url).then(e=>e.default);case"de":return to(()=>import("./d791bd8f1ea0.js"),[],import.meta.url).then(e=>e.default)}throw new Error(`Unsupported locale: '${t}'`)}const dl=gr(ll),pl=Object.freeze(Object.defineProperty({__proto__:null,loadMessages:ul,locales:cl,packages:al,styles:dl},Symbol.toStringTag,{value:"Module"})),hl="@open-pioneer/coordinate-viewer",fl=ce.bind(void 0,hl),gl=4,ml=t=>{const{mapId:e,precision:o,displayProjectionCode:n}=t,{containerProps:r}=oe("coordinate-viewer",t),{map:s}=Y(e),a=s?.olMap,l=On(a)?.getCode()??"";let{coordinates:u}=bl(a);u=u&&n?Sl(u,l,n):u;const c=vl(u,o),p=n||l,g=c?c+" "+p:"";return i.jsx(j,{...r,children:i.jsx(pe,{className:"coordinate-viewer-text",children:g})})};function vl(t,e){const o=fl();return t?wl(t,e,o):""}function bl(t){const[e,o]=d.useState();return d.useEffect(()=>{if(!t)return;const n=t.on("pointermove",r=>{o(r.coordinate)});return()=>le(n)},[t]),{coordinates:e}}function wl(t,e,o){if(t[0]==null||t[1]==null)return"";const n=e??gl,[r,s]=t,a=o.formatNumber(r,{maximumFractionDigits:n,minimumFractionDigits:n}),l=o.formatNumber(s,{maximumFractionDigits:n,minimumFractionDigits:n});return a+" "+l}function Sl(t,e,o){return Jr(t,e,o)}function Vo(t){const e=d.useRef(null);return d.useLayoutEffect(()=>{e.current=t}),d.useCallback((...n)=>{const r=e.current;return r(...n)},[])}const yl="@open-pioneer/notifier",xl=Xe.bind(void 0,yl);var Wn=En({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),_l=En({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const El=!1;function kl(t){const{position:e="top-right"}=t,o=Fs(),n=xl("notifier.NotificationService"),[r,s]=d.useState(!El),a=Vo(u=>{const c=u.level==="error"?i.jsx(Wn,{h:"100%",w:"100%"}):void 0;o({position:e,title:u.title,description:u.message||null,status:u.level,isClosable:!0,duration:u.displayDuration??null,icon:c})}),l=Vo(()=>{o.closeAll()});return d.useEffect(()=>{const u=n.registerHandler({showNotification:a,closeAll:l});return()=>u.destroy()},[r,n,a,l]),i.jsx(i.Fragment,{})}const Cl=t=>{const{mapId:e,displayMode:o="line"}=t,{containerProps:n}=oe("scale-bar",t),{map:r}=Y(e),s=d.useRef(null);return d.useEffect(()=>{if(s.current&&r){const a=r.olMap,l=new _s({units:"metric",target:s.current,bar:o==="bar"});return a.addControl(l),()=>{a.removeControl(l)}}},[o,r]),i.jsx(j,{...n,ref:s})},Ml="@open-pioneer/scale-viewer",Al=ce.bind(void 0,Ml),Pl=t=>{const{mapId:e}=t,{containerProps:o}=oe("scale-viewer",t),{map:n}=Y(e),r=Al(),s=aa(n?.olMap),a=s?r.formatNumber(s):void 0;return i.jsx(j,{...o,children:a&&i.jsxs(pe,{children:["1:",a]})})},$n="ol-map",xe=Xe.bind(void 0,$n),Ee=ce.bind(void 0,$n);let Ll=0;function Rl(t,e){const o=`atom${++Ll}`,n={toString:()=>o};return typeof t=="function"?n.read=t:(n.init=t,n.read=function(r){return r(this)},n.write=function(r,s,a){return s(this,typeof a=="function"?a(r(this)):a)}),e&&(n.write=e),n}const zo=t=>"init"in t,Bo=t=>!!t.write,Pt=new WeakMap,Il=(t,e)=>{Pt.set(t,e),t.catch(()=>{}).finally(()=>Pt.delete(t))},Go=(t,e)=>{const o=Pt.get(t);o&&(Pt.delete(t),o(e))},Uo=(t,e)=>{t.status="fulfilled",t.value=e},Ho=(t,e)=>{t.status="rejected",t.reason=e},Tl=t=>typeof t?.then=="function",ot=(t,e)=>!!t&&"v"in t&&"v"in e&&Object.is(t.v,e.v),Wo=(t,e)=>!!t&&"e"in t&&"e"in e&&Object.is(t.e,e.e),Oe=t=>!!t&&"v"in t&&t.v instanceof Promise,Ol=(t,e)=>"v"in t&&"v"in e&&t.v.orig&&t.v.orig===e.v.orig,Et=t=>{if("e"in t)throw t.e;return t.v},So=()=>{const t=new WeakMap,e=new WeakMap,o=new Map;let n,r;const s=f=>t.get(f),a=(f,m)=>{const v=t.get(f);if(t.set(f,m),o.has(f)||o.set(f,v),Oe(v)){const h="v"in m?m.v instanceof Promise?m.v:Promise.resolve(m.v):Promise.reject(m.e);v.v!==h&&Go(v.v,h)}},l=(f,m,v)=>{const h=new Map;let S=!1;v.forEach((M,x)=>{!M&&x===f&&(M=m),M&&(h.set(x,M),m.d.get(x)!==M&&(S=!0))}),(S||m.d.size!==h.size)&&(m.d=h)},u=(f,m,v)=>{const h=s(f),S={d:h?.d||new Map,v:m};if(v&&l(f,S,v),ot(h,S)&&h.d===S.d)return h;if(Oe(h)&&Oe(S)&&Ol(h,S)){if(h.d===S.d)return h;S.v=h.v}return a(f,S),S},c=(f,m,v,h)=>{if(Tl(m)){let S;const M=()=>{const C=s(f);if(!Oe(C)||C.v!==x)return;const V=u(f,x,v);e.has(f)&&C.d!==V.d&&X(f,V,C.d)},x=new Promise((C,V)=>{let O=!1;m.then(G=>{O||(O=!0,Uo(x,G),C(G),M())},G=>{O||(O=!0,Ho(x,G),V(G),M())}),S=G=>{O||(O=!0,G.then(q=>Uo(x,q),q=>Ho(x,q)),C(G))}});return x.orig=m,x.status="pending",Il(x,C=>{C&&S(C),h?.()}),u(f,x,v)}return u(f,m,v)},p=(f,m,v)=>{const h=s(f),S={d:h?.d||new Map,e:m};return v&&l(f,S,v),Wo(h,S)&&h.d===S.d?h:(a(f,S),S)},g=(f,m)=>{const v=s(f);if(!m&&v&&(e.has(f)||Array.from(v.d).every(([O,G])=>{if(O===f)return!0;const q=g(O);return q===G||ot(q,G)})))return v;const h=new Map;let S=!0;const M=O=>{if(O===f){const q=s(O);if(q)return h.set(O,q),Et(q);if(zo(O))return h.set(O,void 0),O.init;throw new Error("no atom init")}const G=g(O);return h.set(O,G),Et(G)};let x,C;const V={get signal(){return x||(x=new AbortController),x.signal},get setSelf(){return!C&&Bo(f)&&(C=(...O)=>{if(!S)return N(f,...O)}),C}};try{const O=f.read(M,V);return c(f,O,h,()=>x?.abort())}catch(O){return p(f,O,h)}finally{S=!1}},b=f=>Et(g(f)),w=f=>{let m=e.get(f);return m||(m=F(f)),m},y=(f,m)=>!m.l.size&&(!m.t.size||m.t.size===1&&m.t.has(f)),k=f=>{const m=e.get(f);m&&y(f,m)&&Z(f)},R=f=>{const m=new Map,v=new WeakMap,h=x=>{var C;const V=new Set((C=e.get(x))==null?void 0:C.t);return o.forEach((O,G)=>{var q;(q=s(G))!=null&&q.d.has(x)&&V.add(G)}),V},S=x=>{h(x).forEach(C=>{C!==x&&(m.set(C,(m.get(C)||new Set).add(x)),v.set(C,(v.get(C)||0)+1),S(C))})};S(f);const M=x=>{h(x).forEach(C=>{var V;if(C!==x){let O=v.get(C);if(O&&v.set(C,--O),!O){let G=!!((V=m.get(C))!=null&&V.size);if(G){const q=s(C),sr=g(C,!0);G=!ot(q,sr)}G||m.forEach(q=>q.delete(C))}M(C)}})};M(f)},A=(f,...m)=>{let v=!0;const h=x=>Et(g(x)),S=(x,...C)=>{let V;if(x===f){if(!zo(x))throw new Error("atom not writable");const O=s(x),G=c(x,C[0]);ot(O,G)||R(x)}else V=A(x,...C);if(!v){const O=P()}return V},M=f.write(h,S,...m);return v=!1,M},N=(f,...m)=>{const v=A(f,...m),h=P();return v},F=(f,m,v)=>{var h;const S=v||[];(h=s(f))==null||h.d.forEach((x,C)=>{const V=e.get(C);V?V.t.add(f):C!==f&&F(C,f,S)}),g(f);const M={t:new Set(m&&[m]),l:new Set};if(e.set(f,M),Bo(f)&&f.onMount){const{onMount:x}=f;S.push(()=>{const C=x((...V)=>N(f,...V));C&&(M.u=C)})}return v||S.forEach(x=>x()),M},Z=f=>{var m;const v=(m=e.get(f))==null?void 0:m.u;v&&v(),e.delete(f);const h=s(f);h&&(Oe(h)&&Go(h.v),h.d.forEach((S,M)=>{if(M!==f){const x=e.get(M);x&&(x.t.delete(f),y(M,x)&&Z(M))}}))},X=(f,m,v)=>{const h=new Set(m.d.keys());v?.forEach((S,M)=>{if(h.has(M)){h.delete(M);return}const x=e.get(M);x&&(x.t.delete(f),y(M,x)&&Z(M))}),h.forEach(S=>{const M=e.get(S);M?M.t.add(f):e.has(f)&&F(S,f)})},P=()=>{let f;for(;o.size;){const m=Array.from(o);o.clear(),m.forEach(([v,h])=>{const S=s(v);if(S){const M=e.get(v);M&&S.d!==h?.d&&X(v,S,h?.d),M&&!(!Oe(h)&&(ot(h,S)||Wo(h,S)))&&M.l.forEach(x=>x())}})}};return{get:b,set:N,sub:(f,m)=>{const v=w(f),h=P(),S=v.l;return S.add(m),()=>{S.delete(m),k(f)}}}};let Zt;const jl=()=>(Zt||(Zt=So()),Zt),qn=d.createContext(void 0),Dl=t=>{const e=d.useContext(qn);return t?.store||e||jl()},Nl=({children:t,store:e})=>{const o=d.useRef();return!e&&!o.current&&(o.current=So()),d.createElement(qn.Provider,{value:e||o.current},t)},Fl=t=>typeof t?.then=="function",Vl=an.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)});function zl(t,e){const o=Dl(e),[[n,r,s],a]=d.useReducer(c=>{const p=o.get(t);return Object.is(c[0],p)&&c[1]===o&&c[2]===t?c:[p,o,t]},void 0,()=>[o.get(t),o,t]);let l=n;(r!==o||s!==t)&&(a(),l=o.get(t));const u=e?.delay;return d.useEffect(()=>{const c=o.sub(t,()=>{if(typeof u=="number"){setTimeout(a,u);return}a()});return a(),c},[o,t,u]),d.useDebugValue(l),Fl(l)?Vl(l):l}const Kn="@open-pioneer/spatial-bookmarks",Bl=Xe.bind(void 0,Kn),Gl=ce.bind(void 0,Kn),ge=he("spatial-bookmark:SpatialBookmarkViewModel");class Ul{map;packageNamespace;writableBookmarks=Rl([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,o){this.map=e,this.packageNamespace=o.getNamespace("spatial-bookmarks"),this.store=So(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const o=this.map.olMap,n=o.getView().calculateExtent(),r=o.getView().getProjection().getCode(),s={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},a={id:vn(),title:e,extent:s,projection:r};ge.debug("Created a new bookmark",a);const l=this.writableBookmarks;this.store.set(l,[...this.store.get(l),a])}activateBookmark(e){ge.debug("Activating bookmark",e);const o=this.getBookmarkExtent(e);ge.debug("Attempting to apply extent",o),this.applyExtent(o)}deleteBookmark(e){ge.debug("Deleting bookmark",e);const o=this.writableBookmarks;this.store.set(o,[...this.store.get(o).filter(n=>n.id!==e)])}deleteAllBookmarks(){ge.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){ge.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{Hl(e),this.store.set(this.writableBookmarks,e)}catch(o){ge.error("Bookmarks data in local storage is invalid, resetting to default value.",o),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){ge.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const n=this.map.olMap.getView(),r=e.extent,s=[r.minX,r.minY,r.maxX,r.maxY],a=n.getProjection(),l=e.projection;return Qr(s,l,a)}applyExtent(e){const n=this.map.olMap.getView(),r=es(e),s=n.getResolutionForExtent(e);n.setCenter(r),n.setResolution(s)}}function Hl(t){if(!Array.isArray(t))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of t)Wl(e)}function Wl(t){if(!t||typeof t!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=t;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if($l(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function $l(t){if(!t||typeof t!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=t;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const ql=t=>{const{map:e}=Y(t.mapId),o=Bl("local-storage.LocalStorageService"),n=ec(e,o);return n&&i.jsx(Nl,{store:n.store,children:i.jsx(Kl,{...t,viewModel:n})})};function Kl(t){const{viewModel:e}=t,o=Gl(),n=d.useRef([]),[r,s]=d.useState(!1),a=zl(e.bookmarks),[l,u]=d.useState(""),c=l.trim().length>0,{containerProps:p}=oe("spatial-bookmarks",t),[g,b]=d.useState("list"),w=()=>{e.deleteAllBookmarks(),b("list")},y=()=>{c&&(e.createBookmark(l),b("list"),u(""),s(!0))};d.useEffect(()=>{if(r){const F=n.current;F&&F[a.length-1]?.scrollIntoView?.(),s(!1)}},[a,r]);const k=()=>i.jsxs(eo,{children:[i.jsxs(Ht,{rounded:"md",status:"warning",children:[i.jsx(Wt,{}),o.formatMessage({id:"bookmark.alert.delete"})]}),i.jsx(Jl,{intl:o,onClear:w,onCancel:()=>b("list")})]}),R=()=>i.jsxs(eo,{children:[i.jsxs(Ht,{rounded:"md",status:"info",children:[i.jsx(Wt,{}),o.formatMessage({id:"bookmark.alert.create"})]}),i.jsx(Bt,{"aria-label":o.formatMessage({id:"bookmark.input.label"}),placeholder:o.formatMessage({id:"bookmark.input.placeholder"}),value:l,onChange:F=>{u(F.target.value)},onKeyDown:F=>{F.key==="Enter"&&y()},isRequired:!0,isInvalid:!c,autoFocus:!0}),i.jsx(Ql,{intl:o,isInvalid:!c,onCancel:()=>{u(""),b("list")},onSave:y})]}),A=()=>i.jsxs(i.Fragment,{children:[a.length?Yl(a,e,o,n):i.jsxs(Ht,{rounded:"md",status:"info",children:[i.jsx(Wt,{}),o.formatMessage({id:"bookmark.alert.noSaved"})]}),i.jsx(Xl,{intl:o,bookmarks:a,showCreate:()=>b("create"),showDelete:()=>b("delete")})]}),N=i.jsxs(i.Fragment,{children:[g==="list"&&A(),g==="create"&&R(),g==="delete"&&k()]});return i.jsx(de,{flexDirection:"column",...p,children:N})}function Yl(t,e,o,n){const r=o.formatMessage({id:"bookmark.button.deleteOne"}),s=t.map((a,l)=>i.jsx(Zl,{index:l,listItemNodes:n,bookmark:a,onActivate:()=>e.activateBookmark(a),onDelete:()=>e.deleteBookmark(a.id),deleteBtnLabel:r},a.id));return i.jsx(xn,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":o.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:s})}const $o={ArrowDown:1,ArrowUp:-1};function Zl(t){const{index:e,listItemNodes:o,bookmark:n,onDelete:r,onActivate:s,deleteBtnLabel:a}=t,l=n.title,u=c=>{const p=c.key;if(p==="Enter"){c.target===c.currentTarget&&s();return}if($o[p]!=null){const g=o.current?.length;if(!g)return;let b=(e+$o[p])%g;b<0&&(b=g-1),o.current[b]?.focus()}};return i.jsx(j,{as:"li",p:1,ref:c=>{if(!c){o.current.splice(e,1);return}o.current[e]=c},className:yt("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:u,onClick:s,children:i.jsxs(de,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[i.jsx(Mn,{children:i.jsx(Sn,{})}),i.jsx(pe,{ps:2,noOfLines:1,children:l}),i.jsx(Is,{}),i.jsx(ln,{hasArrow:!0,label:a,placement:"right",children:i.jsx(Vt,{className:"spatial-bookmarks-item-delete","aria-label":a,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:i.jsx(yn,{}),onClick:c=>{r(),c.stopPropagation()}})},e)]})})}function Xl(t){const{intl:e,bookmarks:o,showCreate:n,showDelete:r}=t;return i.jsxs(yo,{children:[i.jsx(Ye,{isDisabled:o.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:i.jsx(yn,{}),onClick:r,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),i.jsx(Ye,{onClick:n,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function Jl(t){const{intl:e,onCancel:o,onClear:n}=t;return i.jsxs(yo,{children:[i.jsx(Ye,{variant:"outline",onClick:o,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),i.jsx(Ye,{onClick:n,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function Ql(t){const{intl:e,onCancel:o,onSave:n,isInvalid:r}=t;return i.jsxs(yo,{children:[i.jsx(Ye,{variant:"outline",onClick:()=>o(),children:e.formatMessage({id:"bookmark.button.cancel"})}),i.jsx(Ye,{isDisabled:r,onClick:()=>n(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function yo(t){return i.jsx(de,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:t.children})}function Ye(t){return i.jsx(Vt,{width:"100%",...t})}function ec(t,e){const[o,n]=d.useState();return d.useEffect(()=>{let r;return t?r=new Ul(t,e):r=void 0,n(r),()=>r?.destroy()},[t,e]),o}function tc(){const t=d.useId(),e=Ee();return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"spatialBookmarkTitle"})}),children:i.jsx(ql,{mapId:B})})})})}const Yn="@open-pioneer/printing",qo=Xe.bind(void 0,Yn),oc=ce.bind(void 0,Yn),nc="map";class rc{olMap;title="";fileFormat="pdf";i18n;printingService;printMap=void 0;overlay=void 0;constructor(e,o,n){this.olMap=e,this.printingService=o,this.i18n=n}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Es(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",o=this.title||nc;return{title:e,fileName:o}}async exportMapInPNG(e){const o=document.createElement("canvas");o.width=e.width,o.height=e.height+50,o.style.backgroundColor="#fff";const n=o.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:r,fileName:s}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,o.width,o.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const a=o.width/2;n.fillText(r,a,20),n.drawImage(e,0,50);const l=document.createElement("a");l.setAttribute("download",s+".png");const u=ks(o);if(!u)throw new Error("Failed to get image data URL");l.href=u,l.click()}async exportMapInPDF(e){const{jsPDF:o}=await to(()=>import("./ebcc82f8af76.js"),["./ebcc82f8af76.js","./a419295615be.js","./12d50d22e7a5.js","./a804c6ae25fd.js","./37379e2f5af0.js","./4533599bd8ef.js","./f413d8ffea52.js","./81064a1e15a2.js","./3f67a442b387.js"],import.meta.url),n=new o({orientation:"landscape",unit:"mm",format:"a4"}),r=n.internal.pageSize.getWidth(),s=n.internal.pageSize.getHeight(),a=15,l=20,u=s-l;n.setFontSize(20);const{title:c,fileName:p}=this.getTitleAndFileName();n.text(c,r/2,a,{align:"center"});const g=e.width/e.height;let b=u,w=b*g;w>=r&&(w=r,b=w/g);const y=(r-w)/2,k=l+(u-b)/2;n.addImage(e,"",y,k,w,b),n.save(p+".pdf")}}const sc=he("printing"),ic=t=>{const e=oc(),{mapId:o}=t,{containerProps:n}=oe("printing",t),[r,s]=d.useState("pdf"),[a,l]=d.useState(""),[u,c]=d.useState(!1),p=qo("printing.PrintingService"),g=qo("notifier.NotificationService"),{map:b}=Y(o),w=ac(b,e,p);d.useEffect(()=>{w?.setFileFormat(r)},[w,r]),d.useEffect(()=>{w?.setTitle(a)},[w,a]);function y(R){(R==="png"||R==="pdf")&&s(R)}function k(){u||!w||(c(!0),w.handleMapExport().catch(R=>{const A=e.formatMessage({id:"printingFailed"});g.notify({level:"error",message:A}),sc.error("Failed to print the map",R)}).finally(()=>{c(!1)}))}return i.jsxs(j,{...n,children:[i.jsxs(At,{mb:4,alignItems:"center",children:[i.jsxs(oo,{mb:2,children:[i.jsx(at,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),i.jsx(Bt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:a,onChange:R=>{l(R.target.value)},isRequired:!0,autoFocus:!0})]}),i.jsxs(oo,{mb:2,children:[i.jsx(at,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),i.jsxs(go,{value:r,onChange:R=>y(R.target.value),className:"printing-select",children:[i.jsx("option",{value:"png",children:"PNG"}),i.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),i.jsx(Vt,{isLoading:u,loadingText:e.formatMessage({id:"printingMap"}),disabled:u,padding:2,className:"printing-export-button",onClick:k,width:"100%",children:e.formatMessage({id:"export"})})]})};function ac(t,e,o){const[n,r]=d.useState(void 0);return d.useEffect(()=>{if(!t)return;const s=new rc(t.olMap,o,{overlayText:e.formatMessage({id:"printingMap"})});return r(s),()=>{s.destroy(),r(void 0)}},[t,e,o]),n}function lc(){const t=d.useId(),e=Ee();return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"printingTitle"})}),children:i.jsx(ic,{mapId:B})})})})}const cc="@open-pioneer/legend",Zn=ce.bind(void 0,cc),uc=t=>{const{mapId:e,showBaseLayers:o=!1}=t,{containerProps:n}=oe("legend",t),{map:r}=Y(e);return i.jsx(j,{...n,children:r?i.jsx(dc,{map:r,showBaseLayers:o}):null})};function dc(t){const{map:e,showBaseLayers:o}=t,r=fc(e).map(s=>i.jsx(Xn,{layer:s,showBaseLayers:o},s.id));return i.jsx(xn,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:r})}function Xn(t){const{layer:e,showBaseLayers:o}=t,{isVisible:n}=mc(e),r=gc(e);if(!n||!o&&!("parentLayer"in e)&&e.isBaseLayer)return;const s=[];return r?.length&&r.forEach(a=>{s.push(i.jsx(Xn,{layer:a,showBaseLayers:o},a.id))}),i.jsxs(i.Fragment,{children:[i.jsx(pc,{layer:e,showBaseLayers:o}),s]})}function pc(t){const e=Zn(),{layer:o,showBaseLayers:n}=t,r=vc(o),s=hc(o);let a;r?.Component?a=i.jsx(r.Component,{layer:o}):r?.imageUrl?a=i.jsx(Ko,{layer:o,imageUrl:r.imageUrl}):s&&(a=i.jsx(Ko,{layer:o,imageUrl:s}));const l=!("parentLayer"in o)&&o.isBaseLayer;return a?i.jsxs(j,{as:"li",className:yt("legend-item",`layer-${bc(o.id)}`),children:[n&&l?i.jsx(pe,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,a]}):void 0}function Ko(t){const e=Zn(),{layer:o,imageUrl:n}=t;return i.jsxs(j,{children:[i.jsx(pe,{children:o.title}),i.jsx(Cs,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:o.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:i.jsx(j,{children:i.jsxs(pe,{children:[i.jsx(Wn,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function hc(t){const e=d.useCallback(()=>t.legend,[t]),o=d.useCallback(n=>{const r=t.on("changed:legend",n);return()=>r.destroy()},[t]);return d.useSyncExternalStore(o,e)}function fc(t){const e=d.useCallback(n=>{const r=t.layers.on("changed",n);return()=>r.destroy()},[t]),o=d.useCallback(()=>{let n=t.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[t]);return Jn(e,o)}function gc(t){const e=d.useCallback(n=>{const r=t.sublayers?.on("changed",n);return()=>r?.destroy()},[t]),o=d.useCallback(()=>{if(!t.sublayers)return;let r=t.sublayers?.getSublayers({sortByDisplayOrder:!0});return r=r.reverse(),r},[t]);return Jn(e,o)}function Jn(t,e){const o=d.useRef(),n=d.useCallback(s=>{const a=t(()=>{o.current=void 0,s()});return()=>{o.current=void 0,a()}},[t]),r=d.useCallback(()=>{if(o.current)return o.current.value;const s=e();return o.current={value:s},s},[e]);return d.useSyncExternalStore(n,r)}function mc(t){const e=d.useCallback(()=>t.visible,[t]),o=d.useCallback(r=>{const s=t.on("changed:visible",r);return()=>s.destroy()},[t]);return{isVisible:d.useSyncExternalStore(o,e)}}function vc(t){const[e,o]=d.useState(void 0);return d.useEffect(()=>{o(t.attributes.legend);const n=t.on("changed:attributes",()=>{o(t.attributes.legend)});return()=>n.destroy()},[t]),e}function bc(t){return t.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function wc(){const t=d.useId(),e=Ee();return i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"legendTitle"})}),children:i.jsx(j,{overflowY:"auto",maxHeight:300,children:i.jsx(uc,{mapId:B,showBaseLayers:!0})})})})}const Qn="@open-pioneer/geolocation",Sc=Xe.bind(void 0,Qn),yc=ce.bind(void 0,Qn);function xc(t){return Ts({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(t)}const Yo=he("geolocation:GeolocationController"),Zo=17;class _c extends po{olMap;positionHighlightLayer;geolocation;maxZoom=Zo;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,o){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Po,this.accuracyFeature.setStyle(Jo()),this.positionFeature=new Po,this.positionFeature.setStyle(Xo()),this.positionHighlightLayer=new _e({source:new Ze({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(ho);const n=o||Ec();this.geolocation=new $i({tracking:!1,trackingOptions:n,projection:e.getView()?.getProjection()}),this.trackingOptions=n,this.geolocation.on("error",r=>this.handleGeolocationError(r))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(n=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const r=this.geolocation.on("change:accuracyGeometry",()=>{const u=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(u),this.accuracyFeature?.getGeometry()!==void 0&&n(),this.isInitialZoom){const c=this?.accuracyFeature?.getGeometry()?.getExtent();if(c){const p=ca(c);if(!p)return;e.getView().fit(p,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),s=this.geolocation.on("change:position",()=>{const u=this.geolocation.getPosition();u&&(u[0]||u[1])!==void 0&&(this.positionFeature?.setGeometry(new Jt(u)),this.setMapToPosition&&e.getView().setCenter(u),this.positionFeature?.getGeometry()!==void 0&&n())}),a=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),l=e.on("pointermove",u=>{u.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(r,s,a,l),e.addLayer(this.positionHighlightLayer)}).catch(n=>{Yo.error("Failed to determine location",n)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{le(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??Xo())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??Jo())}setMaxZoom(e){this.maxZoom=e??Zo}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){Yo.error("Error from geolocation API:",e.message);const o=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",o)}}const Xo=()=>new Le({image:new uo({radius:6,fill:new We({color:"#3399CC"}),stroke:new Ae({color:"#fff",width:2})})}),Jo=()=>new Le({stroke:new Ae({color:"#3399CC",width:3}),fill:new We({color:"rgba(0, 0, 255, 0.05)"})}),Ec=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),kc=d.forwardRef(function(e,o){const{mapId:n,maxZoom:r,positionFeatureStyle:s,accuracyFeatureStyle:a,trackingOptions:l}=e,{containerProps:u}=oe("geolocation",e),c=!!navigator.geolocation,[p,g]=d.useState(!1),[b,w]=d.useState(!1),{map:y}=Y(n),k=yc(),R=Sc("notifier.NotificationService"),A=Cc(y,r,l,s,a),N=(()=>c?p?k.formatMessage({id:"locateMeEnd"}):k.formatMessage({id:"locateMeStart"}):k.formatMessage({id:"locateNotSupported"}))();d.useEffect(()=>{if(A===void 0)return;const Z=A.on("error",function(X){const P=k.formatMessage({id:"error"}),H=(()=>{switch(X){case"permission-denied":return k.formatMessage({id:"permissionDenied"});case"position-unavailable":return k.formatMessage({id:"positionUnavailable"});case"timeout":return k.formatMessage({id:"timeout"});case"unknown":return k.formatMessage({id:"unknownError"})}})();w(!1),g(!1),R.notify({level:"error",title:P,message:H})});return()=>{Z.destroy()}},[A,k,R]),d.useEffect(()=>{if(!A){w(!1);return}return p&&(w(!0),A.startGeolocation().then(()=>{w(!1)})),()=>{A?.stopGeolocation(),w(!1)}},[A,p]);const F=()=>{y&&g(!p)};return i.jsx(ee,{ref:o,label:N,icon:i.jsx(xc,{}),onClick:()=>F(),isActive:p,isLoading:b,isDisabled:!c,...u})});function Cc(t,e,o,n,r){const[s,a]=d.useState();return d.useEffect(()=>{if(!t)return;const l=new _c(t.olMap,o);return a(l),()=>{l.destroy(),a(void 0)}},[t,o]),d.useEffect(()=>{s?.setPositionFeatureStyle(n)},[s,n]),d.useEffect(()=>{s?.setAccuracyFeatureStyle(r)},[s,r]),d.useEffect(()=>{s?.setMaxZoom(e)},[s,e]),s}function Mc(t){const{toolState:e,onToolStateChange:o}=t,n=Ee(),r=xe("ol-app.AppModel"),s=qe(r.state).resultListState,a=s.open,{map:l}=Y(B),u=xe("editing.EditingService"),c=xe("notifier.NotificationService"),p=Re((g,b)=>{o(g,b??!e[g])});return Ac(l,u,c,n,e,p),i.jsxs(de,{role:"toolbar","aria-label":n.formatMessage({id:"ariaLabel.toolbar"}),direction:"column",gap:1,padding:1,children:[i.jsx(ee,{label:e.editingActive?n.formatMessage({id:"stopEditingTitle"}):n.formatMessage({id:"startEditingTitle"}),icon:e.editingActive?i.jsx(ls,{}):i.jsx(cs,{}),isActive:e.editingActive,onClick:()=>p("editingActive")}),i.jsx(ee,{label:n.formatMessage({id:"resetEditingTitle"}),icon:i.jsx(us,{}),onClick:()=>u.reset(B)}),s.input&&i.jsx(ee,{label:n.formatMessage({id:"resultListTitle"}),icon:i.jsx(ds,{}),isActive:s.open,onClick:()=>r.setResultListVisibility(!a)}),i.jsx(ee,{label:n.formatMessage({id:"printingTitle"}),icon:i.jsx(ps,{}),isActive:e.printingActive,onClick:()=>p("printingActive")}),i.jsx(ee,{label:n.formatMessage({id:"spatialBookmarkTitle"}),icon:i.jsx(hs,{}),isActive:e.bookmarksActive,onClick:()=>p("bookmarksActive")}),i.jsx(kc,{mapId:B}),i.jsx(ee,{label:n.formatMessage({id:"tocTitle"}),icon:i.jsx(fs,{}),isActive:e.tocActive,onClick:()=>p("tocActive")}),i.jsx(ee,{label:n.formatMessage({id:"legendTitle"}),icon:i.jsx(gs,{}),isActive:e.legendActive,onClick:()=>p("legendActive")}),i.jsx(ee,{label:n.formatMessage({id:"measurementTitle"}),icon:i.jsx(ms,{}),isActive:e.measurementActive,onClick:()=>p("measurementActive")}),i.jsx(ee,{label:n.formatMessage({id:"selectionTitle"}),icon:i.jsx(vs,{}),isActive:e.selectionActive,onClick:()=>p("selectionActive")}),i.jsx(ee,{label:n.formatMessage({id:"overviewMapTitle"}),icon:i.jsx(Sn,{}),isActive:e.overviewMapActive,onClick:()=>p("overviewMapActive")}),i.jsx(Ps,{mapId:B}),i.jsx(Ls,{mapId:B}),i.jsx(Rs,{mapId:B})]})}function Ac(t,e,o,n,r,s){d.useEffect(()=>{if(!t)return;function a(){if(!t)throw Error("map is undefined");try{const u=t.layers.getLayerById("krankenhaus"),c=new URL(u.attributes.collectionURL+"/items");e.start(t,c).whenComplete().then(g=>{if(!g)return;o.notify({level:"info",message:n.formatMessage({id:"editing.featureCreated"},{featureId:g}),displayDuration:4e3}),(u?.olLayer).getSource()?.refresh()}).catch(g=>{console.error(g)}).finally(()=>{s("editingActive",!1)})}catch(u){console.log(u)}}function l(){e.stop(B)}r.editingActive?a():l()},[t,e,o,n,r.editingActive,s])}const Pc="@open-pioneer/measurement",Lc=ce.bind(void 0,Pc);class Rc{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,o){this.olMap=e,this.messages=o;const n=this.source=new Ze;this.layer=new _e({source:n}),this.layer.setZIndex(ho),e.addLayer(this.layer);const r=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){le(r)}});const s=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",s),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",s)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const o=ts(e);this.activeFeatureStyle=(n,...r)=>{const s=n?.getGeometry()?.getType();if(s==="Polygon"||s==="LineString"||s==="Point")return o(n,...r)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const o=e==="area"?"Polygon":"LineString",n=this.draw=new _n({source:this.source,type:o,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let r,s;n.on("drawstart",a=>{r=this.measureTooltip=this.createMeasureTooltip();const l=this.sketch=a.feature;if(!l)return;let u;s=l.getGeometry()?.on("change",c=>{const p=c.target,g=this.olMap.getView().getProjection();let b="";p instanceof bn?(b=Tc(p,g,this.messages),u=p.getInteriorPoint().getCoordinates()||null):p instanceof Cn&&(b=Oc(p,g,this.messages),u=p.getLastCoordinate()||null),r&&(r.element.innerHTML=b,u&&r?.overlay.setPosition(u))})}),n.on("drawend",()=>{if(r){const a=r.element.classList;a.remove("measurement-active-tooltip"),a.remove("printing-hide"),a.add("measurement-finished-tooltip"),r.overlay.setOffset([0,-7]),this.overlayTooltips.push(r),this.measureTooltip=r=void 0}this.sketch=void 0,s&&le(s)}),n.on("drawabort",()=>{r&&(r.destroy(),this.measureTooltip=r=void 0),this.sketch=void 0,s&&le(s)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const o=new lt({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n=this.olMap;return n.addOverlay(o),{overlay:o,element:e,destroy(){n.removeOverlay(o)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const o=new lt({element:e,offset:[15,0],positioning:"center-left"}),n=this.olMap;return n.addOverlay(o),{overlay:o,element:e,destroy(){n.removeOverlay(o)}}}handlePointerMove(e){if(e.dragging)return;const o=this.helpTooltip,n=Ic(this.messages,this.sketch);o.element.textContent=n,o.overlay.setPosition(e.coordinate),o.element.classList.remove("hidden")}}function Ic(t,e){if(e){const o=e.getGeometry();if(o instanceof bn||o instanceof Cn)return t.getContinueMessage()}return t.getHelpMessage()}function Tc(t,e,o){const n=os(t,{projection:e});let r;return n>=1e6?r=`${o.formatNumber(n/1e6)} km<sup>2</sup>`:r=`${o.formatNumber(n)} m<sup>2</sup>`,r}function Oc(t,e,o){const n=ns(t,{projection:e});let r;return n>=1e3?r=`${o.formatNumber(n/1e3)} km`:r=`${o.formatNumber(n)} m`,r}const jc=t=>{const e=Lc(),{mapId:o,activeFeatureStyle:n,finishedFeatureStyle:r}=t,{containerProps:s}=oe("measurement",t),[a,l]=d.useState("distance"),u=w=>e.formatMessage({id:w}),c=Y(o),p=Dc(c.map,e);d.useEffect(()=>{p?.setActiveFeatureStyle(n??Nc())},[p,n]),d.useEffect(()=>{p?.setFinishedFeatureStyle(r??Fc())},[p,r]),d.useEffect(()=>{if(p)return p.startMeasurement(a),()=>{p.stopMeasurement()}},[p,a]);function g(w){if(w==="distance"||w==="area")l(w);else throw new Error(`Unexpected measurement type: '${w}'.`)}function b(){p?.clearMeasurements()}return i.jsxs(j,{...s,children:[i.jsx(pe,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),i.jsx(At,{mb:4,alignItems:"center",children:i.jsxs(oo,{mb:2,children:[i.jsx(at,{mb:1,children:u("measurementLabel")}),i.jsxs(go,{value:a,onChange:w=>g(w.target.value),className:"measurement-select",children:[i.jsx("option",{value:"distance",children:u("distance")}),i.jsx("option",{value:"area",children:u("area")})]})]})}),i.jsx(Vt,{padding:2,className:"measurement-delete-button",onClick:b,width:"100%",children:u("deleteMeasurementLabel")})]})};function Dc(t,e){const[o,n]=d.useState(void 0);return d.useEffect(()=>{if(!t)return;const r=new Rc(t.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(s){return e.formatNumber(s,{maximumFractionDigits:2})}});return n(r),()=>{r.destroy(),n(void 0)}},[t,e]),o}function Nc(){return[new Le({stroke:new Ae({color:"#fff",lineDash:[10,10],width:5})}),new Le({fill:new We({color:"rgba(0,0,0,0.15)"}),stroke:new Ae({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new uo({radius:5,stroke:new Ae({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new We({color:"rgba(255, 255, 255, 0.2)"})})})]}function Fc(){return[new Le({stroke:new Ae({color:"#fff",width:5})}),new Le({stroke:new Ae({color:"#0b96fc",width:3}),fill:new We({color:"rgba(11,150,252,0.15)"})})]}function Vc(){const t=d.useId(),e=Ee();return i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"measurementTitle"})}),children:i.jsx(jc,{mapId:B})})})}const zc="200px",Bc="300px",Gc=t=>{const{mapId:e,olLayer:o,height:n=zc,width:r=Bc}=t,{containerProps:s}=oe("overview-map",t),a=d.useRef(null),{map:l}=Y(e);return d.useEffect(()=>{if(a.current&&l&&o){const u=l.olMap,c=new Ka({className:"ol-overviewmap",layers:[o],collapsible:!1,collapsed:!1,target:a.current});return u.addControl(c),()=>{u.removeControl(c)}}},[l,o]),i.jsx(j,{height:n,width:r,ref:a,...s})};function Uc(){const t=d.useMemo(()=>new co({source:new mn}),[]);return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",maxWidth:325,children:i.jsx(j,{role:"dialog",children:i.jsx(Gc,{mapId:B,olLayer:t})})})}function Hc(){const t=xe("ol-app.AppModel"),e=qe(t.state).resultListState,[o,n]=d.useState([]),[r,s]=d.useState([]),a=d.useCallback(l=>{n(l.features),s(l.getFeatureIds())},[]);return d.useEffect(()=>{console.log("Anzahl Features: "+o.length),console.log("SelectedIds: "+r.toString())},[o,r]),e.input&&i.jsx(j,{className:"result-list-container",position:"absolute",visibility:e.open?"visible":"hidden",bottom:"0",backgroundColor:"white",width:"100%",height:"400px",zIndex:1,borderTop:"2px solid",borderBottom:"2px solid",borderColor:"trails.100",children:i.jsx(js,{input:e.input,mapId:B,onSelectionChange:a},e.key)})}const Wc="@open-pioneer/search",Gt=ce.bind(void 0,Wc);function $c(t){const e=t.selectProps.inputValue.length>0,o={...t,className:yt(t.className,{"search-invisible":!e})};return i.jsx(fe.Menu,{...o,children:t.children})}function qc(t){const o=Gt().formatMessage({id:"noOptionsText"});return i.jsx(fe.NoOptionsMessage,{...t,children:i.jsx(te.span,{className:"search-no-match",children:o})})}function Kc(t){const o=Gt().formatMessage({id:"loadingText"});return i.jsx(fe.LoadingMessage,{...t,children:i.jsx(te.span,{className:"search-loading-text",children:o})})}function Yc({children:t,...e}){const o={...e,className:yt(e.className,"search-value-container")};return i.jsxs(fe.ValueContainer,{...o,children:[!!t&&i.jsx(_l,{style:{position:"absolute",left:8}}),t]})}function Zc(t){const e={...t,isHidden:!1};return i.jsx(fe.Input,{...e})}function Xc(t){return null}function Jc(t){return i.jsxs(fe.IndicatorsContainer,{...t,children:[t.children,!t.selectProps.isLoading&&t.selectProps.inputValue&&i.jsx(Qc,{selectProps:t.selectProps,clearValue:t.clearValue})]})}function Qc(t){const o=Gt().formatMessage({id:"ariaLabel.clearButton"}),n=r=>{r.preventDefault(),r.stopPropagation(),t.clearValue()};return i.jsx(mr,{role:"button",size:"md",mr:1,"aria-label":o,onClick:n,onTouchEnd:n,onMouseDown:r=>r.preventDefault()})}function eu(t){return null}function tu(t){const e=t.selectProps.inputValue,o=t.data.label,n={...t,className:yt(t.className,"search-option")};return i.jsx(fe.Option,{...n,children:i.jsx(te.div,{className:"search-option-label",children:e.trim().length>0?ou(o,e):o})})}function ou(t,e){const o=t.toLowerCase().indexOf(e.toLowerCase());return o>=0?i.jsxs(i.Fragment,{children:[t.substring(0,o),i.jsx(te.span,{className:"search-highlighted-match",children:t.substring(o,o+e.length)},"highlighted"),t.substring(o+e.length)]}):t}const Qo=he("search:SearchController"),en=200,tn=5;var vt,Ge,Ue,He,se,Dt,er;class nu{constructor(e,o){L(this,Dt);L(this,vt,void 0);L(this,Ge,[]);L(this,Ue,tn);L(this,He,en);L(this,se,void 0);I(this,vt,e),I(this,Ge,o)}destroy(){_(this,se)?.abort(),I(this,se,void 0)}async search(e){if(_(this,se)?.abort(),I(this,se,void 0),!e)return[];const o=I(this,se,new AbortController);try{return await ru(o.signal,_(this,He)),o.signal.aborted&&(Qo.debug(`search canceled with ${e}`),vr()),(await Promise.all(_(this,Ge).map(r=>W(this,Dt,er).call(this,r,e,o.signal)))).filter(r=>r!=null)}finally{_(this,se)===o&&I(this,se,void 0)}}get searchTypingDelay(){return _(this,He)}set searchTypingDelay(e){I(this,He,e??en)}get maxResultsPerSource(){return _(this,Ue)}set maxResultsPerSource(e){I(this,Ue,e??tn)}get sources(){return _(this,Ge)}}vt=new WeakMap,Ge=new WeakMap,Ue=new WeakMap,He=new WeakMap,se=new WeakMap,Dt=new WeakSet,er=async function(e,o,n){const r=e.label,s=_(this,vt).olMap.getView().getProjection();try{const a=_(this,Ue);let l=await e.search(o,{maxResults:a,signal:n,mapProjection:s});return l.length>a&&(l=l.slice(0,a)),{label:r,source:e,results:l}}catch(a){Mt(a)||Qo.error(`search for source ${r} failed`,a);return}};async function ru(t,e){t.aborted||await new Promise(o=>{const n=()=>{t.removeEventListener("abort",n),clearTimeout(r),o()};t.addEventListener("abort",n);const r=setTimeout(n,e)})}const Lt=he("search:Search"),su=t=>{const{mapId:e,sources:o,searchTypingDelay:n,maxResultsPerGroup:r,onSelect:s,onClear:a}=t,{containerProps:l}=oe("search",t),{map:u}=Y(e),c=Gt(),p=cu(o,n,r,u),{input:g,search:b,selectedOption:w,onInputChanged:y,onResultConfirmed:k}=uu(p),R=lu(),A=iu(c),N=au(),F=Re((P,H)=>{H.action==="input-change"&&y(P)}),Z=Re((P,H)=>{switch(H.action){case"select-option":P&&(k(P),s?.({source:P.source,result:P.result}));break;case"clear":y(""),X.current?.blur(),X.current?.focus(),a?.();break;default:Lt.debug(`Unhandled action type '${H.action}'.`);break}}),X=d.useRef(null);return i.jsx(j,{...l,children:i.jsx(no,{className:"search-component",classNamePrefix:"react-select",ref:X,inputValue:g,onInputChange:F,"aria-label":c.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:A,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:R,isClearable:!0,placeholder:c.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:b.kind==="loading",options:b.kind==="ready"?b.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:N,onChange:Z,value:w,menuPosition:"fixed"})})};function iu(t){return d.useMemo(()=>({onFocus:({focused:s})=>`${s.label} ${t.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:s,label:a})=>{let l="";switch(s){case"select-option":l=`${a} ${t.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":l=`${a} ${t.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return l},guidance:()=>`${t.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[t])}function au(){return d.useMemo(()=>({Menu:$c,Input:Zc,SingleValue:Xc,Option:tu,NoOptionsMessage:qc,LoadingMessage:Kc,ValueContainer:Yc,IndicatorsContainer:Jc,ClearIndicator:eu}),[])}function lu(){const[t,e]=cn("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return d.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:t,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[t,e])}function cu(t,e,o,n){const[r,s]=d.useState(void 0);return d.useEffect(()=>{if(!n)return;const a=new nu(n,t);return s(a),()=>{a.destroy(),s(void 0)}},[n,t]),d.useEffect(()=>{r&&(r.searchTypingDelay=e)},[r,e]),d.useEffect(()=>{r&&(r.maxResultsPerSource=o)},[r,o]),r}function uu(t){const[e,o]=d.useReducer((l,u)=>{switch(u.kind){case"input":return{...l,query:u.query,selectedOption:null};case"select-option":return{...l,selectedOption:u.option,query:u.option.label};case"load-results":return{...l,search:{kind:"loading"}};case"accept-results":return{...l,search:{kind:"ready",results:u.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=d.useRef(),r=Re(l=>{if(!t){n.current=void 0,o({kind:"accept-results",results:[]});return}Lt.isDebug()&&Lt.debug(`Starting new search for query ${JSON.stringify(l)}.`),o({kind:"load-results"});const u=n.current=du(t,l).then(c=>{n.current===u&&o({kind:"accept-results",results:c})})}),s=d.useCallback(l=>{o({kind:"select-option",option:l})},[]),a=d.useCallback(l=>{o({kind:"input",query:l}),r(l)},[r]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:s,onInputChanged:a}}async function du(t,e){let o;try{o=await t.search(e)}catch(n){Mt(n)||Lt.error("Search failed",n),o=[]}return pu(o)}function pu(t){return t.map((o,n)=>({label:o.label,options:o.results.map(r=>({value:`${n}-${r.id}`,label:r.label,source:o.source,result:r}))}))}function tr(t,e){const o=t.olMap.getViewport();t.highlightAndZoom(e,{viewPadding:o&&o.offsetWidth<1e3?{top:150,right:75,bottom:50,left:75}:{top:150,right:400,bottom:50,left:400}})}function hu(){const{map:t}=Y(B),e=xe("ol-app.AppModel"),o=qe(e.state).searchSources;function n(s){if(console.debug("The user selected the following item: ",s.result),!t)return;const a=s.result.geometry;a&&tr(t,[a])}function r(){console.debug("The user cleared the search"),t?.removeHighlights()}return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",mt:5,className:"search-box",children:i.jsx(su,{mapId:B,sources:o,maxResultsPerGroup:10,onSelect:n,onClear:r})})}const or="@open-pioneer/selection",fu=Xe.bind(void 0,or),xo=ce.bind(void 0,or),nt="selection-active",kt="selection-inactive";class gu{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,o,n,r,s){let a;switch(o){case _o.extent:default:a=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,s,a,this.interactionResources)),this.interactionResources.push(this.createDrag(e,a,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=r}initViewport(e){const o=e.getViewport();return o.classList.add(nt),o.oncontextmenu=n=>(n.preventDefault(),!1),o}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const o=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipMessage,o.classList.remove(kt),o.classList.add(nt),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,o.classList.remove(nt),o.classList.add(kt),this.isActive=!1)}createDragBox(e,o,n,r){const s=new Lo({className:"selection-drag-box",condition:rs});return e.addInteraction(s),s.on("boxend",function(){o(s.getGeometry())}),{interaction:s,destroy(){e.removeInteraction(s),r.splice(r.indexOf(this)),s.dispose(),n.classList.remove(nt),n.classList.remove(kt),n.oncontextmenu=null}}}createDrag(e,o,n){const r=function(l){return l.originalEvent.button==2},s=new Ro({condition:r});return e.addInteraction(s),{interaction:s,destroy(){e.removeInteraction(s),n.splice(n.indexOf(this)),s.dispose(),o.classList.remove(nt),o.classList.remove(kt),o.oncontextmenu=null}}}createHelpTooltip(e,o){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.textContent=o;const r=new lt({element:n,offset:[15,0],positioning:"center-left"}),s=e.on("pointermove",a=>{r.setPosition(a.coordinate)});return e.addOverlay(r),{overlay:r,element:n,destroy(){e.removeOverlay(r),r.dispose(),le(s)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Lo)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Ro)}}const Xt=he("selection:SelectionController"),mu=1e4;var bt,wt,St,Nt,nr;class vu{constructor(e){L(this,Nt);L(this,bt,void 0);L(this,wt,void 0);L(this,St,void 0);const{mapModel:o,onError:n,maxResults:r=mu}=e;I(this,bt,o),I(this,wt,r),I(this,St,n)}destroy(){}async select(e,o){if(o)return await W(this,Nt,nr).call(this,e,o)}}bt=new WeakMap,wt=new WeakMap,St=new WeakMap,Nt=new WeakSet,nr=async function(e,o){const n=_(this,bt).olMap.getView().getProjection();try{Xt.debug(`Starting selection on source '${e.label}'`);const r=_(this,wt);let s=await e.select({type:"extent",extent:o},{maxResults:r,mapProjection:n,signal:new AbortController().signal});return s.length>r&&(s=s.slice(0,r)),Xt.debug(`Found ${s.length} results on source '${e.label}'`),{source:e,results:s}}catch(r){Xt.error(`selection from source ${e.label} failed`,r),_(this,St).call(this);return}};var _o=(t=>(t.extent="EXTENT",t.polygon="POLYGON",t.free="FREEPOLYGON",t.circle="CIRCLE",t))(_o||{});const on={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},bu=t=>{const e=xo(),{mapId:o,sources:n,onSelectionComplete:r,onSelectionSourceChanged:s}=t,{containerProps:a}=oe("selection",t),[l,u]=d.useState(()=>n.find(P=>(P.status??"available")==="available")),c=Y(o),{onExtentSelected:p}=yu(c.map,n,l,r),g=Eu(),w=d.useCallback(P=>{const H=[];if(P||(P=["EXTENT"]),P.forEach(f=>{Object.values(_o).includes(f)&&H.push({label:e.formatMessage({id:f}),value:f})}),H.length===0)throw new Error("methods does not contain valid values");return H},[e])(void 0),[y,k]=d.useState(w[0]),R=Re(P=>{k(P)}),[A,N]=d.useState(!0);_u(c.map,y,e,p,A);const F=d.useMemo(()=>n.map(P=>({label:P.label,value:P})),[n]),Z=d.useMemo(()=>F.find(P=>P.value===l),[F,l]),X=Re(P=>{u(P?.value),s&&s({source:P?.value})});return d.useEffect(()=>{if(!l){N(!1);return}const P=e.formatMessage({id:"sourceNotAvailable"}),H=()=>l&&lo(l,P).kind==="available";N(H());const f=l.on("changed:status",()=>{N(H())});return()=>f.destroy()},[l,N,e]),i.jsxs(eo,{...a,spacing:2,children:[w.length>1&&i.jsxs(At,{children:[i.jsx(at,{children:e.formatMessage({id:"selectMethod"})}),i.jsx(no,{className:"selection-method react-select",...on,options:w,onChange:R,value:y,chakraStyles:g})]}),i.jsxs(At,{children:[i.jsx(at,{children:e.formatMessage({id:"selectSource"})}),i.jsx(no,{className:"selection-source react-select",...on,options:F,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:Z,onChange:X,components:{Option:wu,SingleValue:Su},isOptionDisabled:P=>P.value===void 0||P.value.status==="unavailable",getOptionLabel:P=>P.label+(P.value===void 0||P.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:g})]})]})};function wu(t){const{value:e}=t.data,{isAvailable:o,content:n}=rr(e,!1);return i.jsx(fe.Option,{...t,isDisabled:!o,className:"selection-source-option",children:n})}function Su(t){const{value:e}=t.data,{isAvailable:o,content:n}=rr(e,!0),r=o?"selection-source-value":"selection-source-value selection-source-value--disabled";return i.jsx(fe.SingleValue,{...t,isDisabled:!o,className:r,children:n})}function rr(t,e){const o=t?.label,n=xu(t);return{isAvailable:n.kind==="available",content:i.jsxs(de,{direction:"row",alignItems:"center",grow:1,children:[!e&&i.jsx(de,{grow:1,children:o}),n.kind==="unavailable"&&i.jsx(j,{ml:2,children:i.jsx(ln,{label:n.reason,placement:"right",openDelay:500,children:i.jsx(te.span,{children:i.jsx(br,{as:Os,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&o]})}}function yu(t,e,o,n){const r=fu("notifier.NotificationService"),s=xo(),[a,l]=d.useState(void 0);d.useEffect(()=>{if(!t)return;const c=new vu({mapModel:t,onError(){r.notify({level:"error",message:s.formatMessage({id:"selectionFailed"})})}});return l(c),()=>{c.destroy()}},[t,r,e,s]);const u=Re(async c=>{if(!a||!o)return;const p=await a.select(o,c.getExtent());p&&n?.(p)});return{controller:a,onExtentSelected:u}}function lo(t,e){const o=t.status??"available",n=typeof o=="string"?{kind:o}:o;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function xu(t){const e=xo(),[o,n]=d.useState(()=>({kind:"available"}));return d.useEffect(()=>{if(!t){n({kind:"available"});return}const r=e.formatMessage({id:"sourceNotAvailable"});n(lo(t,r));const s=t.on?.("changed:status",()=>{n(lo(t,r))});return()=>s?.destroy()},[t,e]),o}function _u(t,e,o,n,r){d.useEffect(()=>{if(!t)return;const s=new gu(t.olMap,e.value,o.formatMessage({id:"tooltip"}),o.formatMessage({id:"disabledTooltip"}),n);return s.setActive(r),()=>{s?.destroy()}},[t,e,o,n,r])}function Eu(){const[t,e]=cn("colors",["background_body","border"],["#ffffff","#ffffff"]);return d.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:t})}),[t,e])}function ku(){const t=Ee(),e=xe("notifier.NotificationService"),o=d.useId(),{map:n}=Y(B),r=xe("ol-app.AppModel"),s=qe(r.state).selectionSources,a=qe(r.state).sourceMetadata,l={numberOptions:{maximumFractionDigits:3},dateOptions:{dateStyle:"medium",timeStyle:"medium",timeZone:"UTC"}};function u(p){const{source:g,results:b}=p;if(!n){console.debug("Map not ready");return}n?.removeHighlights();const w=b.map(k=>k.geometry);w.length>0&&tr(n,w);const y=a.get(g);if(!y){console.warn("Can not show results because no metadata could be found");return}r.setResultListInput({columns:y,data:b,formatOptions:l}),e.notify({level:"info",message:t.formatMessage({id:"foundResults"},{resultsCount:b.length}),displayDuration:4e3})}function c(p){n?.removeHighlights()}return i.jsx(j,{role:"dialog","aria-labelledby":o,children:i.jsx(Ie,{title:i.jsx(Te,{id:o,size:"md",mb:2,children:t.formatMessage({id:"selectionTitle"})}),children:i.jsx(bu,{mapId:B,sources:s,onSelectionComplete:u,onSelectionSourceChanged:c})})})}function Cu(t){const e=d.useId(),o=Ee();return i.jsx(j,{role:"dialog","aria-labelledby":e,children:i.jsx(Ie,{title:i.jsx(Te,{id:e,size:"md",mb:2,children:i.jsx(pe,{children:o.formatMessage({id:"tocTitle"})})}),children:i.jsx(j,{overflowY:"auto",maxHeight:t.maxHeight,children:i.jsx(Ss,{mapId:B,showTools:!0,basemapSwitcherProps:{allowSelectingEmptyBasemap:!0}})})})})}const Mu={bookmarksActive:!1,legendActive:!0,overviewMapActive:!0,tocActive:!0,printingActive:!1};function Au(){const t=Ee(),{map:e}=Y(B),[o,n]=d.useState(),[r,s]=d.useState(Mu),a={...r,editingActive:o==="editing",measurementActive:o==="measurement",selectionActive:o==="selection"},l=(b,w)=>{if(b==="selectionActive"||b==="measurementActive"||b==="editingActive"){let y;switch(b){case"editingActive":y="editing";break;case"measurementActive":y="measurement";break;case"selectionActive":y="selection";break}y!==o&&w?(n(y),e?.removeHighlights()):y===o&&!w&&(n(void 0),e?.removeHighlights())}else s({...r,[b]:w})},u=xe("ol-app.AppModel"),c=qe(u.state).resultListState,p=c.input&&c.open,g=[a.tocActive&&i.jsx(Cu,{maxHeight:a.legendActive||o?"300px":"75vh"},"toc"),a.legendActive&&i.jsx(wc,{},"legend"),o==="selection"?i.jsx(ku,{},"selection"):o==="measurement"?i.jsx(Vc,{},"measurement"):void 0];return i.jsxs(de,{height:"100%",direction:"column",overflow:"hidden",children:[i.jsx(kl,{position:"top-right"}),i.jsxs(Ie,{title:i.jsx(j,{role:"region","aria-label":t.formatMessage({id:"ariaLabel.header"}),textAlign:"center",py:1,children:i.jsx(Te,{size:"md",children:"OpenLayers Base Packages - Default Sample"})}),children:[i.jsx(de,{flex:"1",direction:"column",position:"relative",children:i.jsxs(ss,{mapId:B,role:"main","aria-label":t.formatMessage({id:"ariaLabel.map"}),viewPadding:p?{bottom:400}:void 0,children:[i.jsx(Ns,{centerContent:!0,children:i.jsx(hu,{})}),i.jsx(Qe,{position:"top-left",horizontalGap:20,verticalGap:20,children:i.jsx(Pu,{children:g})}),i.jsx(Qe,{position:"top-right",horizontalGap:20,verticalGap:20,children:a.overviewMapActive&&i.jsx(Uc,{})}),i.jsx(Qe,{horizontalGap:20,position:"bottom-left",children:a.bookmarksActive&&i.jsx(tc,{})}),i.jsx(Qe,{horizontalGap:20,position:"bottom-left",children:a.printingActive&&i.jsx(lc,{})}),i.jsx(Qe,{position:"bottom-right",horizontalGap:10,verticalGap:45,children:i.jsx(Mc,{toolState:a,onToolStateChange:l})}),i.jsx(Hc,{})]})}),i.jsxs(de,{role:"region","aria-label":t.formatMessage({id:"ariaLabel.footer"}),gap:3,alignItems:"center",justifyContent:"center",children:[i.jsx(ml,{mapId:B,precision:2,displayProjectionCode:"EPSG:4326"}),i.jsx(Cl,{mapId:B}),i.jsx(Pl,{mapId:B})]})]})]})}function Pu(t){const e=t.children,o=[];for(const n of e)n&&(o.length&&o.push(i.jsx(Ds,{mt:4,mb:4},o.length)),o.push(n));if(o.length!==0)return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",width:350,maxWidth:350,children:o})}const Lu=wr({component:Au,theme:Sr,appMetadata:pl,config:{properties:{"@open-pioneer/local-storage":{storageId:"ol-app-state"},"@open-pioneer/editing":{polygonDrawStyle:{"stroke-color":"red","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(255, 0, 0, 0.2)","circle-stroke-color":"rgba(255, 0, 0, 0.7)","circle-stroke-width":2}}}},async resolveConfig(t){const e=t.getAttribute("forced-locale");if(e)return{locale:e}}});customElements.define("ol-map-app",Lu);const Ru=document.getElementsByTagName("body")[0];Iu();function Iu(){const t=window.location.search,o=new URLSearchParams(t).get("lang"),n=document.createElement("ol-map-app");n.classList.add("full-height"),n.classList.add("app"),n.setAttribute("id","test"),o&&n.setAttribute("forced-locale",o),Ru.appendChild(n)}
