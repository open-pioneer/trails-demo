const __vite__fileDeps=["./pMh224UXewIN.js","./Dch09mLNbtBx.js","./DHEZUrHC5iJj.js","./DTCJ8zUXYCFK.js","./a3NqtvQioZOS.js","./Blm8unLDZoRX.js","./CV2vCj2hnT-X.js","./DqjceUz0qOuV.js","./BIA8ntS0DxTH.js","./DNr9U4lV2nYc.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Gs=Object.defineProperty;var $s=(t,e,s)=>e in t?Gs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var kt=(t,e,s)=>($s(t,typeof e!="symbol"?e+"":e,s),s),nt=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var C=(t,e,s)=>(nt(t,e,"read from private field"),s?s.call(t):e.get(t)),A=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},I=(t,e,s,n)=>(nt(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s);var V=(t,e,s)=>(nt(t,e,"access private method"),s);import{b8 as qt,b9 as Hs,ap as Us,ao as _t,ba as zs,bb as Ws,B as Ks,bc as Ys,bd as Zs,be as Xs,bf as Js,bg as Qt,bh as es,bi as qs,bj as Qs,ay as ts,bk as en,bl as tn,L as re,bm as sn,bn as nn,Z as $,l as ht,N as ss,bo as ns,bp as on,E as rn,aY as an,f as Mt,bq as cn,br as ln,bs as Pt,bt as un,bu as ot,V as dn,bv as At,av as hn,aA as fn,bw as gn,bx as pn,by as mn,bz as vn,bA as It,Y as ee,bB as z,a2 as W,bC as bn,X as De,bD as yn,bE as wn,a0 as Pe,bF as Be,k as Tt,b as os,a as is,Q as rs,c as Se,C as as,F as Ae,b1 as ue,a1 as Sn,bG as xn,aU as cs,bH as En,bI as Cn,bJ as Lt,bK as kn,bL as Ot}from"./a3NqtvQioZOS.js";import{u as _n,e as Mn,r as u,f as Pn,h as Qe,i as ls,o as us,k as ds,j as a,l as K,m as An,n as In,c as fe,E as q,R as Tn,A as it,p as rt,F as hs,B as et,C as Ln,t as On,q as fs,s as gs,I as Nn}from"./DTCJ8zUXYCFK.js";import{T as ae,V as ft,L as ps}from"./BIA8ntS0DxTH.js";import{S as jn,c as Rn,a as Fn,I as Vn,D as Dn}from"./CtHd35rtROIO.js";import{j as Bn,k as ms}from"./CC9DYHcJfVQy.js";import{S as Gn}from"./CKUc2QYdJAHT.js";import{_ as $n}from"./Dch09mLNbtBx.js";import{u as vs,F as Ue}from"./DqjceUz0qOuV.js";import{F as Ie}from"./vPrb6pfZCATP.js";import{H as gt}from"./CCVYFdIzwr5R.js";import{c as bs}from"./CAA67vYgO4r4.js";import{G as Hn,F as Un}from"./CV2vCj2hnT-X.js";import{L as ys}from"./DLM7jEbkYSrZ.js";import{u as de}from"./Blm8unLDZoRX.js";import{c as te,S as pt}from"./DHEZUrHC5iJj.js";function zn(t){const{theme:e}=_n(),s=Mn();return u.useMemo(()=>Pn(e.direction,{...s,...t}),[t,e.direction,s])}var tt=Qe(function(e,s){const{htmlSize:n,...o}=e,i=ls("Input",o),r=us(o),c=vs(r),l=ds("chakra-input",e.className);return a.jsx(K.input,{size:n,...c,__css:i.field,ref:s,className:l})});tt.displayName="Input";tt.id="Input";var ws=K("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});ws.displayName="Center";var Wn={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Qe(function(e,s){const{axis:n="both",...o}=e;return a.jsx(K.div,{ref:s,__css:Wn[n],...o,position:"absolute"})});var Ss=Qe(function(e,s){const{children:n,placeholder:o,className:i,...r}=e;return a.jsxs(K.select,{...r,ref:s,className:ds("chakra-select",i),children:[o&&a.jsx("option",{value:"",children:o}),n]})});Ss.displayName="SelectField";function Kn(t,e){const s={},n={};for(const[o,i]of Object.entries(t))e.includes(o)?s[o]=i:n[o]=i;return[s,n]}var bt=Qe((t,e)=>{var s;const n=ls("Select",t),{rootProps:o,placeholder:i,icon:r,color:c,height:l,h:f,minH:g,minHeight:w,iconColor:x,iconSize:S,...M}=us(t),[P,R]=Kn(M,In),_=vs(R),O={width:"100%",height:"fit-content",position:"relative",color:c},j={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(s=n.field)==null?void 0:s._focus}};return a.jsxs(K.div,{className:"chakra-select__wrapper",__css:O,...P,...o,children:[a.jsx(Ss,{ref:e,height:f??l,minH:g??w,placeholder:i,..._,__css:j,children:t.children}),a.jsx(xs,{"data-disabled":An(_.disabled),...(x||c)&&{color:x||c},__css:n.icon,...S&&{fontSize:S},children:r})]})});bt.displayName="Select";var Yn=t=>a.jsx("svg",{viewBox:"0 0 24 24",...t,children:a.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Zn=K("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),xs=t=>{const{children:e=a.jsx(Yn,{}),...s}=t,n=u.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return a.jsx(Zn,{...s,className:"chakra-select__icon-wrapper",children:u.isValidElement(e)?n:null})};xs.displayName="SelectIcon";const N={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Xn={ERROR:"error"};class Jn extends Ks{constructor(e){super(Xn.ERROR),this.code=e.code,this.message=e.message}}let qn=class extends qt{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Hs,this.watchId_=void 0,this.addChangeListener(N.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(N.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Us(_t("EPSG:4326"),e),this.position_&&this.set(N.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const s=e.coords;this.set(N.ACCURACY,s.accuracy),this.set(N.ALTITUDE,s.altitude===null?void 0:s.altitude),this.set(N.ALTITUDE_ACCURACY,s.altitudeAccuracy===null?void 0:s.altitudeAccuracy),this.set(N.HEADING,s.heading===null?void 0:zs(s.heading)),this.position_?(this.position_[0]=s.longitude,this.position_[1]=s.latitude):this.position_=[s.longitude,s.latitude];const n=this.transform_(this.position_);this.set(N.POSITION,n.slice()),this.set(N.SPEED,s.speed===null?void 0:s.speed);const o=Ws(this.position_,s.accuracy);o.applyTransform(this.transform_),this.set(N.ACCURACY_GEOMETRY,o),this.changed()}positionError_(e){this.dispatchEvent(new Jn(e))}getAccuracy(){return this.get(N.ACCURACY)}getAccuracyGeometry(){return this.get(N.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(N.ALTITUDE)}getAltitudeAccuracy(){return this.get(N.ALTITUDE_ACCURACY)}getHeading(){return this.get(N.HEADING)}getPosition(){return this.get(N.POSITION)}getProjection(){return this.get(N.PROJECTION)}getSpeed(){return this.get(N.SPEED)}getTracking(){return this.get(N.TRACKING)}getTrackingOptions(){return this.get(N.TRACKING_OPTIONS)}setProjection(e){this.set(N.PROJECTION,_t(e))}setTracking(e){this.set(N.TRACKING,e)}setTrackingOptions(e){this.set(N.TRACKING_OPTIONS,e)}};const D={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class ze extends qt{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Ys,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(D.ELEMENT,this.handleElementChanged),this.addChangeListener(D.MAP,this.handleMapChanged),this.addChangeListener(D.OFFSET,this.handleOffsetChanged),this.addChangeListener(D.POSITION,this.handlePositionChanged),this.addChangeListener(D.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(D.ELEMENT)}getId(){return this.id}getMap(){return this.get(D.MAP)||null}getOffset(){return this.get(D.OFFSET)}getPosition(){return this.get(D.POSITION)}getPositioning(){return this.get(D.POSITIONING)}handleElementChanged(){Zs(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Xs(this.element),Js(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Qt(e,es.POSTRENDER,this.render,this),this.updatePixelPosition();const s=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(D.ELEMENT,e)}setMap(e){this.set(D.MAP,e)}setOffset(e){this.set(D.OFFSET,e)}setPosition(e){this.set(D.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const s=this.getMap();if(!s||!s.getTargetElement()||!this.get(D.POSITION))return;const n=this.getRect(s.getTargetElement(),s.getSize()),o=this.getElement(),i=this.getRect(o,[qs(o),Qs(o)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!ts(n,i)){const c=i[0]-n[0],l=n[2]-i[2],f=i[1]-n[1],g=n[3]-i[3],w=[0,0];if(c<0?w[0]=c-r:l<0&&(w[0]=Math.abs(l)+r),f<0?w[1]=f-r:g<0&&(w[1]=Math.abs(g)+r),w[0]!==0||w[1]!==0){const x=s.getView().getCenterInternal(),S=s.getPixelFromCoordinateInternal(x);if(!S)return;const M=[S[0]+w[0],S[1]+w[1]],P=e.animation||{};s.getView().animateInternal({center:s.getCoordinateFromPixelInternal(M),duration:P.duration,easing:P.easing})}}}getRect(e,s){const n=e.getBoundingClientRect(),o=n.left+window.pageXOffset,i=n.top+window.pageYOffset;return[o,i,o+s[0],i+s[1]]}setPositioning(e){this.set(D.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),s=this.getPosition();if(!e||!e.isRendered()||!s){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(s),o=e.getSize();this.updateRenderedPosition(n,o)}updateRenderedPosition(e,s){const n=this.element.style,o=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const r=Math.round(e[0]+o[0])+"px",c=Math.round(e[1]+o[1])+"px";let l="0%",f="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?l="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(l="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?f="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(f="-50%");const g=`translate(${l}, ${f}) translate(${r}, ${c})`;this.rendered.transform_!=g&&(this.rendered.transform_=g,n.transform=g)}getOptions(){return this.options}}const Nr=en,Qn=25.4/.28,eo=39.37;function yt(t){return wt(t,to,so)}function to(t){return t.getView()}function so(t,e){return t.on("change:view",e)}function Es(t){return yt(t)?.getProjection()}function no(t){const e=yt(t);return wt(e,oo,io)}function oo(t){return t.getResolution()}function io(t,e){return t.on("change:resolution",e)}function ro(t){const e=yt(t);return wt(e,ao,co)}function ao(t){return t.getCenter()}function co(t,e){return t.on("change:center",e)}function lo(t){const e=ro(t),s=no(t),n=Es(t);return u.useMemo(()=>{if(n==null||s==null||e==null)return;const i=tn(n,s,e);return Math.round(i*eo*Qn)},[n,s,e])}function wt(t,e,s){const n=u.useCallback(()=>t?e(t):void 0,[t,e]),o=u.useCallback(i=>{if(!t)return()=>{};const r=s(t,i);return()=>re(r)},[t,s]);return u.useSyncExternalStore(o,n)}const uo=1.2;function ho(t,e=uo){fo(t);const s=sn(t),n=nn(t),o=s*e,i=n*e;return[t[0]-(o-s)/2,t[1]-(i-n)/2,t[2]+(o-s)/2,t[3]+(i-n)/2]}function fo(t){if(t.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${t.length}).`)}const go={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function jr(t){return a.jsxs($,{children:[a.jsx(ae,{children:t.layer.title}),a.jsx($,{style:go})]})}new ht([407354,5754673]),new ht([404740,5757893]);var ce,ne,Te,Le,Oe,mt;class po extends ss{constructor(s,n,o){super();A(this,Oe);kt(this,"label");A(this,ce,{kind:"available"});A(this,ne,void 0);A(this,Te,void 0);A(this,Le,void 0);this.label=n,I(this,ne,s),I(this,Le,o),V(this,Oe,mt).call(this),I(this,Te,C(this,ne).on("change:visible",()=>{V(this,Oe,mt).call(this)}))}destroy(){re(C(this,Te))}get status(){return C(this,ce)}async select(s,n){if(s.type!=="extent")throw new Error(`Unsupported selection kind: ${s.type}`);if(C(this,ce).kind!=="available"||C(this,ne).getSource()===null)return[];const o=[];C(this,ne).getSource().forEachFeatureIntersectingExtent(s.extent,c=>{if(!c.getGeometry())return;const l={...c.getProperties()};delete l.geometries;const f={id:c.getId()?.toString()||ns(),geometry:c.getGeometry(),properties:l};o.push(f)});const i=o.filter(c=>c!=null);return i.length>n.maxResults?i.slice(0,n.maxResults):i}}ce=new WeakMap,ne=new WeakMap,Te=new WeakMap,Le=new WeakMap,Oe=new WeakSet,mt=function(){const n=C(this,ne).getVisible()?{kind:"available"}:{kind:"unavailable",reason:C(this,Le)};n.kind!==C(this,ce).kind&&(I(this,ce,n),this.emit("changed:status"))};var Ne;class Rr{constructor({intl:e}){A(this,Ne,void 0);I(this,Ne,e)}createSelectionSource(e){return new po(e.vectorLayer,e.label,C(this,Ne).formatMessage({id:"layerNotVisibleReason"}))}}Ne=new WeakMap;const at=.75,Ge=.1;let mo=class extends on{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const s=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",o=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const i=e.label!==void 0?e.label:"›";typeof i=="string"?(this.label_=document.createElement("span"),this.label_.textContent=i):this.label_=i;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,c=document.createElement("button");c.setAttribute("type","button"),c.title=n,c.appendChild(r),c.addEventListener(rn.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new an({view:e.view,controls:new Mt,interactions:new Mt});this.ovmap_=l,e.layers&&e.layers.forEach(function(O){l.addLayer(O)});const f=document.createElement("div");f.className="ol-overviewmap-box",f.style.boxSizing="border-box",this.boxOverlay_=new ze({position:[0,0],positioning:"center-center",element:f}),this.ovmap_.addOverlay(this.boxOverlay_);const g=s+" "+cn+" "+ln+(this.collapsed_&&this.collapsible_?" "+Pt:"")+(this.collapsible_?"":" ol-uncollapsible"),w=this.element;w.className=g,w.appendChild(this.ovmapDiv_),w.appendChild(c);const x=this,S=this.boxOverlay_,M=this.boxOverlay_.getElement(),P=function(O){return{clientX:O.clientX,clientY:O.clientY}},R=function(O){const j=P(O),B=l.getEventCoordinateInternal(j);S.setPosition(B)},_=function(O){const j=l.getEventCoordinateInternal(O);x.getMap().getView().setCenterInternal(j),window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",_)};M.addEventListener("mousedown",function(){window.addEventListener("mousemove",R),window.addEventListener("mouseup",_)})}setMap(e){const s=this.getMap();if(e!==s){if(s){const n=s.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(Qt(e,un.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===ot.VIEW){const s=e.oldValue;s&&this.unbindView_(s);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===ot.TARGET||e.key===ot.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const s=new dn({projection:e.getProjection()});this.ovmap_.setView(s)}e.addChangeListener(At.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(At.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),s=this.ovmap_;if(!e.isRendered()||!s.isRendered())return;const n=e.getSize(),i=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&hn(i,this.viewExtent_))return;this.viewExtent_=i;const r=s.getSize(),l=s.getView().calculateExtentInternal(r),f=s.getPixelFromCoordinateInternal(fn(i)),g=s.getPixelFromCoordinateInternal(gn(i)),w=Math.abs(f[0]-g[0]),x=Math.abs(f[1]-g[1]),S=r[0],M=r[1];w<S*Ge||x<M*Ge||w>S*at||x>M*at?this.resetExtent_():ts(l,i)||this.recenter_()}resetExtent_(){const e=this.getMap(),s=this.ovmap_,n=e.getSize(),i=e.getView().calculateExtentInternal(n),r=s.getView(),c=Math.log(at/Ge)/Math.LN2,l=1/(Math.pow(2,c/2)*Ge);pn(i,l),r.fitInternal(mn(i))}recenter_(){const e=this.getMap(),s=this.ovmap_,n=e.getView();s.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),s=this.ovmap_;if(!e.isRendered()||!s.isRendered())return;const n=e.getSize(),o=e.getView(),i=s.getView(),r=this.rotateWithView_?0:-o.getRotation(),c=this.boxOverlay_,l=this.boxOverlay_.getElement(),f=o.getCenterInternal(),g=o.getResolution(),w=i.getResolution(),x=n[0]*g/w,S=n[1]*g/w;if(c.setPosition(f),l){l.style.width=x+"px",l.style.height=S+"px";const M="rotate("+r+"rad)";l.style.transform=M}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=vn(this.ovmap_,es.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Pt),this.collapsed_?It(this.collapseLabel_,this.label_):It(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};const he=fe("local-storage"),vo=0,Q={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var me,Z,oe,ve,X,Ye,Cs,Ze,ks,le,Me,ie,pe,Xe,_s;class Vr{constructor(e){A(this,Ye);A(this,Ze);A(this,le);A(this,ie);A(this,Xe);A(this,me,void 0);A(this,Z,{});A(this,oe,void 0);A(this,ve,void 0);A(this,X,void 0);I(this,me,So(e.properties)),I(this,oe,xo()),C(this,oe)&&(V(this,Ze,ks).call(this),I(this,ve,V(this,Xe,_s).call(this)))}destroy(){C(this,X)&&(clearTimeout(C(this,X)),I(this,X,void 0)),C(this,oe)&&V(this,le,Me).call(this)}get isSupported(){return!!C(this,ve)}get(e){return V(this,ie,pe).call(this).get(e)}set(e,s){return V(this,ie,pe).call(this).set(e,s)}remove(e){return V(this,ie,pe).call(this).remove(e)}removeAll(){return V(this,ie,pe).call(this).removeAll()}getNamespace(e){return V(this,ie,pe).call(this).getNamespace(e)}}me=new WeakMap,Z=new WeakMap,oe=new WeakMap,ve=new WeakMap,X=new WeakMap,Ye=new WeakSet,Cs=function(){C(this,X)&&clearTimeout(C(this,X)),I(this,X,setTimeout(()=>{I(this,X,void 0),V(this,le,Me).call(this)},vo))},Ze=new WeakSet,ks=function(){try{const e=C(this,oe);if(!e)throw new q(Q.INTERNAL,"Local storage is not available.");const s=e.getItem(C(this,me));if(s==null){I(this,Z,{}),V(this,le,Me).call(this);return}try{const n=JSON.parse(s);if(!xe(n))throw new q(Q.CORRUPTED_DATA,"Persisted value should be an object.");I(this,Z,n)}catch(n){he.warn("Invalid persisted data, reverting to default.",n),I(this,Z,{}),V(this,le,Me).call(this)}}catch(e){he.error("Failed to load from local storage",e)}},le=new WeakSet,Me=function(){try{const e=C(this,oe);if(!e)throw new q(Q.INTERNAL,"Local storage is not available.");const s=JSON.stringify(C(this,Z));e.setItem(C(this,me),s)}catch(e){he.error("Failed to save to local storage",e)}},ie=new WeakSet,pe=function(){const e=C(this,ve);if(!e)throw new q(Q.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},Xe=new WeakSet,_s=function(){const e={getByPath:s=>jt(bo(C(this,Z),s)),setByPath:(s,n)=>{if(!wo(n))throw new q(Q.INVALID_VALUE,"The value is not supported by local storage.");if(n=jt(n),s.length===0){if(!xe(n))throw new q(Q.INVALID_VALUE,"The root value must be a plain object.");I(this,Z,n)}else yo(C(this,Z),s,n);V(this,Ye,Cs).call(this)}};return new St([],e)};class St{path;access;constructor(e,s){this.path=e,this.access=s}get(e){return this.access.getByPath([...this.path,e])}set(e,s){this.access.setByPath([...this.path,e],s)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const s=this.get(e);if(s===void 0)this.set(e,{});else if(!xe(s))throw new q(Q.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new St(this.path.concat([e]),this.access)}}const Nt="trails-state";function bo(t,e){let s=t;for(const n of e){if(!xe(s))throw new q(Q.INVALID_PATH,`Cannot get nested property '${n}' because the parent is no object.`);s=s[n]}return s}function yo(t,e,s){if(!e.length)throw new q(Q.INTERNAL,"Path must not be empty.");let n=t;for(let i=0,r=e.length-1;i<r;++i){const c=e[i],l=n[c];if(!xe(l))throw new q(Q.INVALID_PATH,`Cannot set property on '${c}' because it is no object.`);n=l}const o=e[e.length-1];n[o]=s}function xe(t){return!!(t&&typeof t=="object"&&!Array.isArray(t))}function wo(t){const e=typeof t;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||t===null||Array.isArray(t)||xe(t)}function So(t){const e=t.storageId;return!e||typeof e!="string"?(he.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${Nt}'.`),Nt):e}function xo(){if(typeof Storage>"u"){he.warn("Local storage is not supported by this browser.");return}try{const t=globalThis.localStorage;if(!t){he.warn("Local storage is not supported by this browser.");return}return t}catch(t){he.warn("Local storage is not supported by this browser.",t);return}}function jt(t){return t!=null&&(t=JSON.parse(JSON.stringify(t))),t}const Eo="@open-pioneer/coordinate-viewer",Co=ee.bind(void 0,Eo),ko=4,Dr=t=>{const{mapId:e,precision:s,displayProjectionCode:n}=t,{containerProps:o}=z("coordinate-viewer",t),{map:i}=W(e),r=i?.olMap,c=Es(r)?.getCode()??"";let{coordinates:l}=Mo(r);l=l&&n?Ao(l,c,n):l;const f=_o(l,s),g=n||c,w=f?f+" "+g:"";return a.jsx($,{...o,children:a.jsx(ae,{className:"coordinate-viewer-text",children:w})})};function _o(t,e){const s=Co();return t?Po(t,e,s):""}function Mo(t){const[e,s]=u.useState();return u.useEffect(()=>{if(!t)return;const n=t.on("pointermove",o=>{s(o.coordinate)});return()=>re(n)},[t]),{coordinates:e}}function Po(t,e,s){if(t[0]==null||t[1]==null)return"";const n=e??ko,[o,i]=t,r=s.formatNumber(o,{maximumFractionDigits:n,minimumFractionDigits:n}),c=s.formatNumber(i,{maximumFractionDigits:n,minimumFractionDigits:n});return r+" "+c}function Ao(t,e,s){return bn(t,e,s)}function Rt(t){const e=u.useRef(null);return u.useLayoutEffect(()=>{e.current=t}),u.useCallback((...n)=>{const o=e.current;return o(...n)},[])}const Io="@open-pioneer/notifier",To=De.bind(void 0,Io);var Ms=bs({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Lo=bs({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const Oo=!1;function Br(t){const{position:e="top-right"}=t,s=zn(),n=To("notifier.NotificationService"),[o,i]=u.useState(!Oo),r=Rt(l=>{const f=l.level==="error"?a.jsx(Ms,{h:"100%",w:"100%"}):void 0;s({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:f})}),c=Rt(()=>{s.closeAll()});return u.useEffect(()=>{const l=n.registerHandler({showNotification:r,closeAll:c});return()=>l.destroy()},[o,n,r,c]),a.jsx(a.Fragment,{})}const Gr=t=>{const{mapId:e,displayMode:s="line"}=t,{containerProps:n}=z("scale-bar",t),{map:o}=W(e),i=u.useRef(null);return u.useEffect(()=>{if(i.current&&o){const r=o.olMap,c=new jn({units:"metric",target:i.current,bar:s==="bar"});return r.addControl(c),()=>{r.removeControl(c)}}},[s,o]),a.jsx($,{...n,ref:i})},No="@open-pioneer/scale-viewer",jo=ee.bind(void 0,No),$r=t=>{const{mapId:e}=t,{containerProps:s}=z("scale-viewer",t),{map:n}=W(e),o=jo(),i=lo(n?.olMap),r=i?o.formatNumber(i):void 0;return a.jsx($,{...s,children:r&&a.jsxs(ae,{children:["1:",r]})})};var F={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let Ro=0;function Fo(t,e){const s=`atom${++Ro}`,n={toString:()=>s};return typeof t=="function"?n.read=t:(n.init=t,n.read=Vo,n.write=Do),n}function Vo(t){return t(this)}function Do(t,e,s){return e(this,typeof s=="function"?s(t(this)):s)}const ct=(t,e)=>t.unstable_is?t.unstable_is(e):e===t,lt=t=>"init"in t,ut=t=>!!t.write,We=new WeakMap,Bo=(t,e)=>{We.set(t,e),t.catch(()=>{}).finally(()=>We.delete(t))},Ft=(t,e)=>{const s=We.get(t);s&&(We.delete(t),s(e))},Vt=(t,e)=>{t.status="fulfilled",t.value=e},Dt=(t,e)=>{t.status="rejected",t.reason=e},Go=t=>typeof t?.then=="function",Ce=(t,e)=>!!t&&"v"in t&&"v"in e&&Object.is(t.v,e.v),Bt=(t,e)=>!!t&&"e"in t&&"e"in e&&Object.is(t.e,e.e),ge=t=>!!t&&"v"in t&&t.v instanceof Promise,$o=(t,e)=>"v"in t&&"v"in e&&t.v.orig&&t.v.orig===e.v.orig,$e=t=>{if("e"in t)throw t.e;return t.v},Ps=()=>{const t=new WeakMap,e=new WeakMap,s=[],n=new WeakMap;let o,i;(F?"production":void 0)!=="production"&&(o=new Set,i=new Set);const r=d=>t.get(d),c=(d,h)=>{h.d.forEach((y,m)=>{var b;if(!n.has(m)){const p=r(m);(b=s[s.length-1])==null||b.add(m),n.set(m,[p,new Set]),p&&c(m,p)}n.get(m)[1].add(d)})},l=(d,h)=>{var y;(F?"production":void 0)!=="production"&&Object.freeze(h);const m=r(d);if(t.set(d,h),n.has(d)||((y=s[s.length-1])==null||y.add(d),n.set(d,[m,new Set]),c(d,h)),ge(m)){const b="v"in h?h.v instanceof Promise?h.v:Promise.resolve(h.v):Promise.reject(h.e);m.v!==b&&Ft(m.v,b)}},f=(d,h,y,m)=>{const b=new Map(m?h.d:null);let p=!1;y.forEach((v,E)=>{!v&&ct(d,E)&&(v=h),v?(b.set(E,v),h.d.get(E)!==v&&(p=!0)):(F?"production":void 0)!=="production"&&console.warn("[Bug] atom state not found")}),(p||h.d.size!==b.size)&&(h.d=b)},g=(d,h,y,m)=>{const b=r(d),p={d:b?.d||new Map,v:h};if(y&&f(d,p,y,m),Ce(b,p)&&b.d===p.d)return b;if(ge(b)&&ge(p)&&$o(b,p)){if(b.d===p.d)return b;p.v=b.v}return l(d,p),p},w=(d,h,y,m)=>{if(Go(h)){let b;const p=()=>{const E=r(d);if(!ge(E)||E.v!==v)return;const T=g(d,v,y);e.has(d)&&E.d!==T.d&&H(d,T,E.d)},v=new Promise((E,T)=>{let k=!1;h.then(L=>{k||(k=!0,Vt(v,L),E(L),p())},L=>{k||(k=!0,Dt(v,L),T(L),p())}),b=L=>{k||(k=!0,L.then(Y=>Vt(v,Y),Y=>Dt(v,Y)),E(L))}});return v.orig=h,v.status="pending",Bo(v,E=>{E&&b(E),m?.()}),g(d,v,y,!0)}return g(d,h,y)},x=(d,h,y)=>{const m=r(d),b={d:m?.d||new Map,e:h};return y&&f(d,b,y),Bt(m,b)&&m.d===b.d?m:(l(d,b),b)},S=(d,h)=>{const y=r(d);if(!h&&y&&(e.has(d)||Array.from(y.d).every(([k,L])=>{if(k===d)return!0;const Y=S(k);return Y===L||Ce(Y,L)})))return y;const m=new Map;let b=!0;const p=k=>{if(ct(d,k)){const Y=r(k);if(Y)return m.set(k,Y),$e(Y);if(lt(k))return m.set(k,void 0),k.init;throw new Error("no atom init")}const L=S(k);return m.set(k,L),$e(L)};let v,E;const T={get signal(){return v||(v=new AbortController),v.signal},get setSelf(){return(F?"production":void 0)!=="production"&&!ut(d)&&console.warn("setSelf function cannot be used with read-only atom"),!E&&ut(d)&&(E=(...k)=>{if((F?"production":void 0)!=="production"&&b&&console.warn("setSelf function cannot be called in sync"),!b)return _(d,...k)}),E}};try{const k=d.read(p,T);return w(d,k,m,()=>v?.abort())}catch(k){return x(d,k,m)}finally{b=!1}},M=d=>$e(S(d)),P=d=>{const h=v=>{var E,T;const k=new Set((E=e.get(v))==null?void 0:E.t);return(T=n.get(v))==null||T[1].forEach(L=>{k.add(L)}),k},y=new Array,m=new Set,b=v=>{if(!m.has(v)){m.add(v);for(const E of h(v))v!==E&&b(E);y.push(v)}};b(d);const p=new Set([d]);for(let v=y.length-1;v>=0;--v){const E=y[v],T=r(E);if(!T)continue;let k=!1;for(const L of T.d.keys())if(L!==E&&p.has(L)){k=!0;break}if(k){const L=S(E,!0);Ce(T,L)||p.add(E)}}},R=(d,...h)=>{const y=p=>$e(S(p)),m=(p,...v)=>{const E=s.length>0;E||s.push(new Set([p]));let T;if(ct(d,p)){if(!lt(p))throw new Error("atom not writable");const k=r(p),L=w(p,v[0]);Ce(k,L)||P(p)}else T=R(p,...v);if(!E){const k=G(s.pop());(F?"production":void 0)!=="production"&&o.forEach(L=>L({type:"async-write",flushed:k}))}return T};return d.write(y,m,...h)},_=(d,...h)=>{s.push(new Set([d]));const y=R(d,...h),m=G(s.pop());return(F?"production":void 0)!=="production"&&o.forEach(b=>b({type:"write",flushed:m})),y},O=(d,h,y)=>{var m;const b=e.get(d);if(b)return h&&b.t.add(h),b;const p=y||[];(m=r(d))==null||m.d.forEach((E,T)=>{T!==d&&O(T,d,p)}),S(d);const v={t:new Set(h&&[h]),l:new Set};if(e.set(d,v),(F?"production":void 0)!=="production"&&i.add(d),ut(d)&&d.onMount){const{onMount:E}=d;p.push(()=>{const T=E((...k)=>_(d,...k));T&&(v.u=T)})}return y||p.forEach(E=>E()),v},j=(d,h)=>!h.l.size&&(!h.t.size||h.t.size===1&&h.t.has(d)),B=(d,h)=>{if(!j(d,h))return;const y=h.u;y&&y(),e.delete(d),(F?"production":void 0)!=="production"&&i.delete(d);const m=r(d);m?(ge(m)&&Ft(m.v),m.d.forEach((b,p)=>{if(p!==d){const v=e.get(p);v&&(v.t.delete(d),B(p,v))}})):(F?"production":void 0)!=="production"&&console.warn("[Bug] could not find atom state to unmount",d)},H=(d,h,y)=>{const m=new Set(h.d.keys()),b=new Set;y?.forEach((p,v)=>{if(m.has(v)){m.delete(v);return}b.add(v);const E=e.get(v);E&&E.t.delete(d)}),m.forEach(p=>{O(p,d)}),b.forEach(p=>{const v=e.get(p);v&&B(p,v)})},G=d=>{let h;(F?"production":void 0)!=="production"&&(h=new Set);const y=[],m=b=>{var p;if(!n.has(b))return;const[v,E]=n.get(b);n.delete(b),y.push([b,v]),E.forEach(m),(p=r(b))==null||p.d.forEach((T,k)=>m(k))};if(d.forEach(m),y.forEach(([b,p])=>{const v=r(b);if(!v){(F?"production":void 0)!=="production"&&console.warn("[Bug] no atom state to flush");return}if(v!==p){const E=e.get(b);E&&v.d!==p?.d&&H(b,v,p?.d),E&&!(!ge(p)&&(Ce(p,v)||Bt(p,v)))&&(E.l.forEach(T=>T()),(F?"production":void 0)!=="production"&&h.add(b))}}),(F?"production":void 0)!=="production")return h},U=(d,h)=>{const y=O(d),m=G([d]),b=y.l;return b.add(h),(F?"production":void 0)!=="production"&&o.forEach(p=>p({type:"sub",flushed:m})),()=>{b.delete(h),B(d,y),(F?"production":void 0)!=="production"&&o.forEach(p=>p({type:"unsub"}))}};return(F?"production":void 0)!=="production"?{get:M,set:_,sub:U,dev_subscribe_store:d=>(o.add(d),()=>{o.delete(d)}),dev_get_mounted_atoms:()=>i.values(),dev_get_atom_state:d=>t.get(d),dev_get_mounted:d=>e.get(d),dev_restore_atoms:d=>{s.push(new Set);for(const[y,m]of d)lt(y)&&(w(y,m),P(y));const h=G(s.pop());o.forEach(y=>y({type:"restore",flushed:h}))}}:{get:M,set:_,sub:U}};let ke;const Ho=()=>(ke||(ke=Ps(),(F?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=ke),globalThis.__JOTAI_DEFAULT_STORE__!==ke&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),ke),As=Ps,Uo=Ho,Is=u.createContext(void 0),zo=t=>u.useContext(Is)||Uo(),Wo=({children:t,store:e})=>{const s=u.useRef();return!e&&!s.current&&(s.current=As()),u.createElement(Is.Provider,{value:e||s.current},t)},Ko=t=>typeof t?.then=="function",Yo=Tn.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)});function Zo(t,e){const s=zo(),[[n,o,i],r]=u.useReducer(f=>{const g=s.get(t);return Object.is(f[0],g)&&f[1]===s&&f[2]===t?f:[g,s,t]},void 0,()=>[s.get(t),s,t]);let c=n;return(o!==s||i!==t)&&(r(),c=s.get(t)),u.useEffect(()=>{const f=s.sub(t,()=>{r()});return r(),f},[s,t,void 0]),u.useDebugValue(c),Ko(c)?Yo(c):c}const Ts="@open-pioneer/spatial-bookmarks",Xo=De.bind(void 0,Ts),Jo=ee.bind(void 0,Ts),se=fe("spatial-bookmark:SpatialBookmarkViewModel");class qo{map;packageNamespace;writableBookmarks=Fo([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,s){this.map=e,this.packageNamespace=s.getNamespace("spatial-bookmarks"),this.store=As(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const s=this.map.olMap,n=s.getView().calculateExtent(),o=s.getView().getProjection().getCode(),i={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},r={id:ns(),title:e,extent:i,projection:o};se.debug("Created a new bookmark",r);const c=this.writableBookmarks;this.store.set(c,[...this.store.get(c),r])}activateBookmark(e){se.debug("Activating bookmark",e);const s=this.getBookmarkExtent(e);se.debug("Attempting to apply extent",s),this.applyExtent(s)}deleteBookmark(e){se.debug("Deleting bookmark",e);const s=this.writableBookmarks;this.store.set(s,[...this.store.get(s).filter(n=>n.id!==e)])}deleteAllBookmarks(){se.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){se.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{Qo(e),this.store.set(this.writableBookmarks,e)}catch(s){se.error("Bookmarks data in local storage is invalid, resetting to default value.",s),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){se.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const n=this.map.olMap.getView(),o=e.extent,i=[o.minX,o.minY,o.maxX,o.maxY],r=n.getProjection(),c=e.projection;return yn(i,c,r)}applyExtent(e){const n=this.map.olMap.getView(),o=wn(e),i=n.getResolutionForExtent(e);n.setCenter(o),n.setResolution(i)}}function Qo(t){if(!Array.isArray(t))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of t)ei(e)}function ei(t){if(!t||typeof t!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=t;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(ti(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function ti(t){if(!t||typeof t!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=t;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const Hr=t=>{const{map:e}=W(t.mapId),s=Xo("local-storage.LocalStorageService"),n=ci(e,s);return n&&a.jsx(Wo,{store:n.store,children:a.jsx(si,{...t,viewModel:n})})};function si(t){const{viewModel:e}=t,s=Jo(),n=u.useRef([]),[o,i]=u.useState(!1),r=Zo(e.bookmarks),[c,l]=u.useState(""),f=c.trim().length>0,{containerProps:g}=z("spatial-bookmarks",t),[w,x]=u.useState("list"),S=()=>{e.deleteAllBookmarks(),x("list")},M=()=>{f&&(e.createBookmark(c),x("list"),l(""),i(!0))};u.useEffect(()=>{if(o){const j=n.current;j&&j[r.length-1]?.scrollIntoView?.(),i(!1)}},[r,o]);const P=()=>a.jsxs(ft,{children:[a.jsxs(it,{rounded:"md",status:"warning",children:[a.jsx(rt,{}),s.formatMessage({id:"bookmark.alert.delete"})]}),a.jsx(ri,{intl:s,onClear:S,onCancel:()=>x("list")})]}),R=()=>a.jsxs(ft,{children:[a.jsxs(it,{rounded:"md",status:"info",children:[a.jsx(rt,{}),s.formatMessage({id:"bookmark.alert.create"})]}),a.jsx(tt,{"aria-label":s.formatMessage({id:"bookmark.input.label"}),placeholder:s.formatMessage({id:"bookmark.input.placeholder"}),value:c,onChange:j=>{l(j.target.value)},onKeyDown:j=>{j.key==="Enter"&&M()},isRequired:!0,isInvalid:!f,autoFocus:!0}),a.jsx(ai,{intl:s,isInvalid:!f,onCancel:()=>{l(""),x("list")},onSave:M})]}),_=()=>a.jsxs(a.Fragment,{children:[r.length?ni(r,e,s,n):a.jsxs(it,{rounded:"md",status:"info",children:[a.jsx(rt,{}),s.formatMessage({id:"bookmark.alert.noSaved"})]}),a.jsx(ii,{intl:s,bookmarks:r,showCreate:()=>x("create"),showDelete:()=>x("delete")})]}),O=a.jsxs(a.Fragment,{children:[w==="list"&&_(),w==="create"&&R(),w==="delete"&&P()]});return a.jsx(Pe,{flexDirection:"column",...g,children:O})}function ni(t,e,s,n){const o=s.formatMessage({id:"bookmark.button.deleteOne"}),i=t.map((r,c)=>a.jsx(oi,{index:c,listItemNodes:n,bookmark:r,onActivate:()=>e.activateBookmark(r),onDelete:()=>e.deleteBookmark(r.id),deleteBtnLabel:o},r.id));return a.jsx(ps,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":s.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:i})}const Gt={ArrowDown:1,ArrowUp:-1};function oi(t){const{index:e,listItemNodes:s,bookmark:n,onDelete:o,onActivate:i,deleteBtnLabel:r}=t,c=n.title,l=f=>{const g=f.key;if(g==="Enter"){f.target===f.currentTarget&&i();return}if(Gt[g]!=null){const w=s.current?.length;if(!w)return;let x=(e+Gt[g])%w;x<0&&(x=w-1),s.current[x]?.focus()}};return a.jsx($,{as:"li",p:1,ref:f=>{if(!f){s.current.splice(e,1);return}s.current[e]=f},className:Be("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:l,onClick:i,children:a.jsxs(Pe,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[a.jsx(ws,{children:a.jsx(Bn,{})}),a.jsx(ae,{ps:2,noOfLines:1,children:c}),a.jsx(Gn,{}),a.jsx(hs,{hasArrow:!0,label:r,placement:"right",children:a.jsx(et,{className:"spatial-bookmarks-item-delete","aria-label":r,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:a.jsx(ms,{}),onClick:f=>{o(),f.stopPropagation()}})},e)]})})}function ii(t){const{intl:e,bookmarks:s,showCreate:n,showDelete:o}=t;return a.jsxs(xt,{children:[a.jsx(Ee,{isDisabled:s.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:a.jsx(ms,{}),onClick:o,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),a.jsx(Ee,{onClick:n,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function ri(t){const{intl:e,onCancel:s,onClear:n}=t;return a.jsxs(xt,{children:[a.jsx(Ee,{variant:"outline",onClick:s,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),a.jsx(Ee,{onClick:n,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function ai(t){const{intl:e,onCancel:s,onSave:n,isInvalid:o}=t;return a.jsxs(xt,{children:[a.jsx(Ee,{variant:"outline",onClick:()=>s(),children:e.formatMessage({id:"bookmark.button.cancel"})}),a.jsx(Ee,{isDisabled:o,onClick:()=>n(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function xt(t){return a.jsx(Pe,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:t.children})}function Ee(t){return a.jsx(et,{width:"100%",...t})}function ci(t,e){const[s,n]=u.useState();return u.useEffect(()=>{let o;return t?o=new qo(t,e):o=void 0,n(o),()=>o?.destroy()},[t,e]),s}const Ls="@open-pioneer/printing",$t=De.bind(void 0,Ls),li=ee.bind(void 0,Ls),ui="map";class di{olMap;title="";fileFormat="pdf";i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,s,n){this.olMap=e,this.printingService=s,this.i18n=n}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}setViewPadding(e){this.viewPadding=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Rn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",s=this.title||ui;return{title:e,fileName:s}}async exportMapInPNG(e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height+50,s.style.backgroundColor="#fff";const n=s.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:o,fileName:i}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,s.width,s.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const r=s.width/2;n.fillText(o,r,20),n.drawImage(e,0,50);const c=document.createElement("a");c.setAttribute("download",i+".png");const l=Fn(s);if(!l)throw new Error("Failed to get image data URL");c.href=l,c.click()}async exportMapInPDF(e){const{jsPDF:s}=await $n(()=>import("./pMh224UXewIN.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),n=new s({orientation:"landscape",unit:"mm",format:"a4"}),o=n.internal.pageSize.getWidth(),i=n.internal.pageSize.getHeight(),r=15,c=20,l=i-c;n.setFontSize(20);const{title:f,fileName:g}=this.getTitleAndFileName();n.text(f,o/2,r,{align:"center"});const w=e.width/e.height;let x=l,S=x*w;S>=o&&(S=o,x=S/w);const M=(o-S)/2,P=c+(l-x)/2;n.addImage(e,"",M,P,S,x),n.save(g+".pdf")}}const hi=fe("printing"),Ur=t=>{const e=li(),{mapId:s,viewPadding:n="auto"}=t,{containerProps:o}=z("printing",t),[i,r]=u.useState("pdf"),[c,l]=u.useState(""),[f,g]=u.useState(!1),w=$t("printing.PrintingService"),x=$t("notifier.NotificationService"),{map:S}=W(s),M=fi(S,e,w,n);u.useEffect(()=>{M?.setFileFormat(i)},[M,i]),u.useEffect(()=>{M?.setTitle(c)},[M,c]);function P(_){(_==="png"||_==="pdf")&&r(_)}function R(){f||!M||(g(!0),M.handleMapExport().catch(_=>{const O=e.formatMessage({id:"printingFailed"});x.notify({level:"error",message:O}),hi.error("Failed to print the map",_)}).finally(()=>{g(!1)}))}return a.jsxs($,{...o,children:[a.jsxs(Ue,{mb:4,alignItems:"center",children:[a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),a.jsx(tt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:c,onChange:_=>{l(_.target.value)},autoFocus:!0})]}),a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),a.jsxs(bt,{value:i,onChange:_=>P(_.target.value),className:"printing-select",children:[a.jsx("option",{value:"png",children:"PNG"}),a.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),a.jsx(et,{isLoading:f,loadingText:e.formatMessage({id:"printingMap"}),disabled:f,padding:2,className:"printing-export-button",onClick:R,width:"100%",children:e.formatMessage({id:"export"})})]})};function fi(t,e,s,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!t)return;const r=new di(t.olMap,s,{overlayText:e.formatMessage({id:"printingMap"})});return i(r),()=>{r.destroy(),i(void 0)}},[t,e,s]),u.useEffect(()=>{o?.setViewPadding(n)},[o,n]),o}const gi="@open-pioneer/legend",Os=ee.bind(void 0,gi),zr=t=>{const{mapId:e,showBaseLayers:s=!1}=t,{containerProps:n}=z("legend",t),{map:o}=W(e);return a.jsx($,{...n,children:o?a.jsx(pi,{map:o,showBaseLayers:s}):null})};function pi(t){const{map:e,showBaseLayers:s}=t,o=bi(e).map(i=>a.jsx(Ns,{layer:i,showBaseLayers:s},i.id));return a.jsx(ps,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:o})}function Ns(t){const{layer:e,showBaseLayers:s}=t,{isVisible:n}=wi(e),o=yi(e);if(!n||!s&&!("parentLayer"in e)&&e.isBaseLayer)return;const i=[];return o?.length&&o.forEach(r=>{i.push(a.jsx(Ns,{layer:r,showBaseLayers:s},r.id))}),a.jsxs(a.Fragment,{children:[a.jsx(mi,{layer:e,showBaseLayers:s}),i]})}function mi(t){const e=Os(),{layer:s,showBaseLayers:n}=t,o=Si(s),i=vi(s);let r;o?.Component?r=a.jsx(o.Component,{layer:s}):o?.imageUrl?r=a.jsx(Ht,{layer:s,imageUrl:o.imageUrl}):i&&(r=a.jsx(Ht,{layer:s,imageUrl:i}));const c=!("parentLayer"in s)&&s.isBaseLayer;return r?a.jsxs($,{as:"li",className:Be("legend-item",`layer-${xi(s.id)}`),children:[n&&c?a.jsx(ae,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,r]}):void 0}function Ht(t){const e=Os(),{layer:s,imageUrl:n}=t;return a.jsxs($,{children:[a.jsx(ae,{children:s.title}),a.jsx(Vn,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:s.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:a.jsx($,{children:a.jsxs(ae,{children:[a.jsx(Ms,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function vi(t){const e=u.useCallback(()=>t.legend,[t]),s=u.useCallback(n=>{const o=t.on("changed:legend",n);return()=>o.destroy()},[t]);return u.useSyncExternalStore(s,e)}function bi(t){const e=u.useCallback(n=>{const o=t.layers.on("changed",n);return()=>o.destroy()},[t]),s=u.useCallback(()=>{let n=t.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[t]);return js(e,s)}function yi(t){const e=u.useCallback(n=>{const o=t.sublayers?.on("changed",n);return()=>o?.destroy()},[t]),s=u.useCallback(()=>{if(!t.sublayers)return;let o=t.sublayers?.getSublayers({sortByDisplayOrder:!0});return o=o.reverse(),o},[t]);return js(e,s)}function js(t,e){const s=u.useRef(),n=u.useCallback(i=>{const r=t(()=>{s.current=void 0,i()});return()=>{s.current=void 0,r()}},[t]),o=u.useCallback(()=>{if(s.current)return s.current.value;const i=e();return s.current={value:i},i},[e]);return u.useSyncExternalStore(n,o)}function wi(t){const e=u.useCallback(()=>t.visible,[t]),s=u.useCallback(o=>{const i=t.on("changed:visible",o);return()=>i.destroy()},[t]);return{isVisible:u.useSyncExternalStore(s,e)}}function Si(t){const[e,s]=u.useState(void 0);return u.useEffect(()=>{s(t.attributes.legend);const n=t.on("changed:attributes",()=>{s(t.attributes.legend)});return()=>n.destroy()},[t]),e}function xi(t){return t.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const Rs="@open-pioneer/geolocation",Ei=De.bind(void 0,Rs),Ci=ee.bind(void 0,Rs);function ki(t){return Hn({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(t)}const Ut=fe("geolocation:GeolocationController"),zt=17;class _i extends ss{olMap;positionHighlightLayer;geolocation;maxZoom=zt;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,s){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Tt,this.accuracyFeature.setStyle(Kt()),this.positionFeature=new Tt,this.positionFeature.setStyle(Wt()),this.positionHighlightLayer=new os({source:new is({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(rs);const n=s||Mi();this.geolocation=new qn({tracking:!1,trackingOptions:n,projection:e.getView()?.getProjection()}),this.trackingOptions=n,this.geolocation.on("error",o=>this.handleGeolocationError(o))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(n=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const o=this.geolocation.on("change:accuracyGeometry",()=>{const l=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(l),this.accuracyFeature?.getGeometry()!==void 0&&n(),this.isInitialZoom){const f=this?.accuracyFeature?.getGeometry()?.getExtent();if(f){const g=ho(f);if(!g)return;e.getView().fit(g,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),i=this.geolocation.on("change:position",()=>{const l=this.geolocation.getPosition();l&&(l[0]||l[1])!==void 0&&(this.positionFeature?.setGeometry(new ht(l)),this.setMapToPosition&&e.getView().setCenter(l),this.positionFeature?.getGeometry()!==void 0&&n())}),r=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),c=e.on("pointermove",l=>{l.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(o,i,r,c),e.addLayer(this.positionHighlightLayer)}).catch(n=>{Ut.error("Failed to determine location",n)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{re(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??Wt())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??Kt())}setMaxZoom(e){this.maxZoom=e??zt}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){Ut.error("Error from geolocation API:",e.message);const s=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",s)}}const Wt=()=>new Se({image:new as({radius:6,fill:new Ae({color:"#3399CC"}),stroke:new ue({color:"#fff",width:2})})}),Kt=()=>new Se({stroke:new ue({color:"#3399CC",width:3}),fill:new Ae({color:"rgba(0, 0, 255, 0.05)"})}),Mi=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),Wr=u.forwardRef(function(e,s){const{mapId:n,maxZoom:o,positionFeatureStyle:i,accuracyFeatureStyle:r,trackingOptions:c}=e,{containerProps:l}=z("geolocation",e),f=!!navigator.geolocation,[g,w]=u.useState(!1),[x,S]=u.useState(!1),{map:M}=W(n),P=Ci(),R=Ei("notifier.NotificationService"),_=Pi(M,o,c,i,r),O=f?g?P.formatMessage({id:"locateMeEnd"}):P.formatMessage({id:"locateMeStart"}):P.formatMessage({id:"locateNotSupported"});u.useEffect(()=>{if(_===void 0)return;const B=_.on("error",function(H){const G=P.formatMessage({id:"error"}),U=(()=>{switch(H){case"permission-denied":return P.formatMessage({id:"permissionDenied"});case"position-unavailable":return P.formatMessage({id:"positionUnavailable"});case"timeout":return P.formatMessage({id:"timeout"});case"unknown":return P.formatMessage({id:"unknownError"})}})();S(!1),w(!1),R.notify({level:"error",title:G,message:U})});return()=>{B.destroy()}},[_,P,R]),u.useEffect(()=>{if(!_){S(!1);return}return g&&(S(!0),_.startGeolocation().then(()=>{S(!1)})),()=>{_?.stopGeolocation(),S(!1)}},[_,g]);const j=()=>{M&&w(!g)};return a.jsx(Sn,{ref:s,label:O,icon:a.jsx(ki,{}),onClick:()=>j(),isActive:g,isLoading:x,isDisabled:!f,...l})});function Pi(t,e,s,n,o){const[i,r]=u.useState();return u.useEffect(()=>{if(!t)return;const c=new _i(t.olMap,s);return r(c),()=>{c.destroy(),r(void 0)}},[t,s]),u.useEffect(()=>{i?.setPositionFeatureStyle(n)},[i,n]),u.useEffect(()=>{i?.setAccuracyFeatureStyle(o)},[i,o]),u.useEffect(()=>{i?.setMaxZoom(e)},[i,e]),i}const Ai="@open-pioneer/measurement",Ii=ee.bind(void 0,Ai);class Ti{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,s){this.olMap=e,this.messages=s;const n=this.source=new is;this.layer=new os({source:n}),this.layer.setZIndex(rs),e.addLayer(this.layer);const o=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){re(o)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const s=xn(e);this.activeFeatureStyle=(n,...o)=>{const i=n?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return s(n,...o)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const s=e==="area"?"Polygon":"LineString",n=this.draw=new Dn({source:this.source,type:s,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let o,i;n.on("drawstart",r=>{o=this.measureTooltip=this.createMeasureTooltip();const c=this.sketch=r.feature;if(!c)return;let l;i=c.getGeometry()?.on("change",f=>{const g=f.target,w=this.olMap.getView().getProjection();let x="";g instanceof cs?(x=Oi(g,w,this.messages),l=g.getInteriorPoint().getCoordinates()||null):g instanceof ys&&(x=Ni(g,w,this.messages),l=g.getLastCoordinate()||null),o&&(o.element.innerHTML=x,l&&o?.overlay.setPosition(l))})}),n.on("drawend",()=>{if(o){const r=o.element.classList;r.remove("measurement-active-tooltip"),r.remove("printing-hide"),r.add("measurement-finished-tooltip"),o.overlay.setOffset([0,-7]),this.overlayTooltips.push(o),this.measureTooltip=o=void 0}this.sketch=void 0,i&&re(i)}),n.on("drawabort",()=>{o&&(o.destroy(),this.measureTooltip=o=void 0),this.sketch=void 0,i&&re(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const s=new ze({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n=this.olMap;return n.addOverlay(s),{overlay:s,element:e,destroy(){n.removeOverlay(s)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const s=new ze({element:e,offset:[15,0],positioning:"center-left"}),n=this.olMap;return n.addOverlay(s),{overlay:s,element:e,destroy(){n.removeOverlay(s)}}}handlePointerMove(e){if(e.dragging)return;const s=this.helpTooltip,n=Li(this.messages,this.sketch);s.element.textContent=n,s.overlay.setPosition(e.coordinate),s.element.classList.remove("hidden")}}function Li(t,e){if(e){const s=e.getGeometry();if(s instanceof cs||s instanceof ys)return t.getContinueMessage()}return t.getHelpMessage()}function Oi(t,e,s){const n=En(t,{projection:e});let o;return n>=1e6?o=`${s.formatNumber(n/1e6)} km<sup>2</sup>`:o=`${s.formatNumber(n)} m<sup>2</sup>`,o}function Ni(t,e,s){const n=Cn(t,{projection:e});let o;return n>=1e3?o=`${s.formatNumber(n/1e3)} km`:o=`${s.formatNumber(n)} m`,o}const Kr=t=>{const e=Ii(),{mapId:s,activeFeatureStyle:n,finishedFeatureStyle:o}=t,{containerProps:i}=z("measurement",t),[r,c]=u.useState("distance"),l=S=>e.formatMessage({id:S}),f=W(s),g=ji(f.map,e);u.useEffect(()=>{g?.setActiveFeatureStyle(n??Ri())},[g,n]),u.useEffect(()=>{g?.setFinishedFeatureStyle(o??Fi())},[g,o]),u.useEffect(()=>{if(g)return g.startMeasurement(r),()=>{g.stopMeasurement()}},[g,r]);function w(S){if(S==="distance"||S==="area")c(S);else throw new Error(`Unexpected measurement type: '${S}'.`)}function x(){g?.clearMeasurements()}return a.jsxs($,{...i,children:[a.jsx(ae,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),a.jsx(Ue,{mb:4,alignItems:"center",children:a.jsxs(gt,{mb:2,children:[a.jsx(Ie,{mb:1,children:l("measurementLabel")}),a.jsxs(bt,{value:r,onChange:S=>w(S.target.value),className:"measurement-select",children:[a.jsx("option",{value:"distance",children:l("distance")}),a.jsx("option",{value:"area",children:l("area")})]})]})}),a.jsx(et,{padding:2,className:"measurement-delete-button",onClick:x,width:"100%",children:l("deleteMeasurementLabel")})]})};function ji(t,e){const[s,n]=u.useState(void 0);return u.useEffect(()=>{if(!t)return;const o=new Ti(t.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(i){return e.formatNumber(i,{maximumFractionDigits:2})}});return n(o),()=>{o.destroy(),n(void 0)}},[t,e]),s}function Ri(){return[new Se({stroke:new ue({color:"#fff",lineDash:[10,10],width:5})}),new Se({fill:new Ae({color:"rgba(0,0,0,0.15)"}),stroke:new ue({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new as({radius:5,stroke:new ue({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new Ae({color:"rgba(255, 255, 255, 0.2)"})})})]}function Fi(){return[new Se({stroke:new ue({color:"#fff",width:5})}),new Se({stroke:new ue({color:"#0b96fc",width:3}),fill:new Ae({color:"rgba(11,150,252,0.15)"})})]}const Vi="200px",Di="300px",Yr=t=>{const{mapId:e,olLayer:s,height:n=Vi,width:o=Di}=t,{containerProps:i}=z("overview-map",t),r=u.useRef(null),{map:c}=W(e);return u.useEffect(()=>{if(r.current&&c&&s){const l=c.olMap,f=new mo({className:"ol-overviewmap",layers:[s],collapsible:!1,collapsed:!1,target:r.current});return l.addControl(f),()=>{l.removeControl(f)}}},[c,s]),a.jsx($,{height:n,width:o,ref:r,...i})},Bi="@open-pioneer/search",st=ee.bind(void 0,Bi);function Gi(t){const e=t.selectProps.inputValue.length>0,s={...t,className:Be(t.className,{"search-invisible":!e})};return a.jsx(te.Menu,{...s,children:t.children})}function $i(t){const s=st().formatMessage({id:"noOptionsText"});return a.jsx(te.NoOptionsMessage,{...t,children:a.jsx(K.span,{className:"search-no-match",children:s})})}function Hi(t){const s=st().formatMessage({id:"loadingText"});return a.jsx(te.LoadingMessage,{...t,children:a.jsx(K.span,{className:"search-loading-text",children:s})})}function Ui({children:t,...e}){const s={...e,className:Be(e.className,"search-value-container")};return a.jsxs(te.ValueContainer,{...s,children:[!!t&&a.jsx(Lo,{style:{position:"absolute",left:8}}),t]})}function zi(t){const e={...t,isHidden:!1};return a.jsx(te.Input,{...e})}function Wi(t){return null}function Ki(t){return a.jsxs(te.IndicatorsContainer,{...t,children:[t.children,!t.selectProps.isLoading&&t.selectProps.inputValue&&a.jsx(Yi,{selectProps:t.selectProps,clearValue:t.clearValue})]})}function Yi(t){const s=st().formatMessage({id:"ariaLabel.clearButton"}),n=o=>{o.preventDefault(),o.stopPropagation(),t.clearValue()};return a.jsx(Ln,{role:"button",size:"md",mr:1,"aria-label":s,onClick:n,onTouchEnd:n,onMouseDown:o=>o.preventDefault()})}function Zi(t){return null}function Xi(t){const e=t.selectProps.inputValue,s=t.data.label,n={...t,className:Be(t.className,"search-option")};return a.jsx(te.Option,{...n,children:a.jsx(K.div,{className:"search-option-label",children:e.trim().length>0?Ji(s,e):s})})}function Ji(t,e){const s=t.toLowerCase().indexOf(e.toLowerCase());return s>=0?a.jsxs(a.Fragment,{children:[t.substring(0,s),a.jsx(K.span,{className:"search-highlighted-match",children:t.substring(s,s+e.length)},"highlighted"),t.substring(s+e.length)]}):t}const Yt=fe("search:SearchController"),Zt=200,Xt=5;var je,be,ye,we,J,Je,Fs;class qi{constructor(e,s){A(this,Je);A(this,je,void 0);A(this,be,[]);A(this,ye,Xt);A(this,we,Zt);A(this,J,void 0);I(this,je,e),I(this,be,s)}destroy(){C(this,J)?.abort(),I(this,J,void 0)}async search(e){if(C(this,J)?.abort(),I(this,J,void 0),!e)return[];const s=I(this,J,new AbortController);try{return await Qi(s.signal,C(this,we)),s.signal.aborted&&(Yt.debug(`search canceled with ${e}`),On()),(await Promise.all(C(this,be).map(o=>V(this,Je,Fs).call(this,o,e,s.signal)))).filter(o=>o!=null)}finally{C(this,J)===s&&I(this,J,void 0)}}get searchTypingDelay(){return C(this,we)}set searchTypingDelay(e){I(this,we,e??Zt)}get maxResultsPerSource(){return C(this,ye)}set maxResultsPerSource(e){I(this,ye,e??Xt)}get sources(){return C(this,be)}}je=new WeakMap,be=new WeakMap,ye=new WeakMap,we=new WeakMap,J=new WeakMap,Je=new WeakSet,Fs=async function(e,s,n){const o=e.label,i=C(this,je).olMap.getView().getProjection();try{const r=C(this,ye);let c=await e.search(s,{maxResults:r,signal:n,mapProjection:i});return c.length>r&&(c=c.slice(0,r)),{label:o,source:e,results:c}}catch(r){fs(r)||Yt.error(`search for source ${o} failed`,r);return}};async function Qi(t,e){t.aborted||await new Promise(s=>{const n=()=>{t.removeEventListener("abort",n),clearTimeout(o),s()};t.addEventListener("abort",n);const o=setTimeout(n,e)})}const Ke=fe("search:Search"),Zr=t=>{const{mapId:e,sources:s,searchTypingDelay:n,maxResultsPerGroup:o,onSelect:i,onClear:r}=t,{containerProps:c}=z("search",t),{map:l}=W(e),f=st(),g=nr(s,n,o,l),{input:w,search:x,selectedOption:S,onInputChanged:M,onResultConfirmed:P}=or(g),R=sr(),_=er(f),O=tr(),j=de((G,U)=>{U.action==="input-change"&&M(G)}),B=de((G,U)=>{switch(U.action){case"select-option":G&&(P(G),i?.({source:G.source,result:G.result}));break;case"clear":M(""),H.current?.blur(),H.current?.focus(),r?.();break;default:Ke.debug(`Unhandled action type '${U.action}'.`);break}}),H=u.useRef(null);return a.jsx($,{...c,children:a.jsx(pt,{className:"search-component",classNamePrefix:"react-select",ref:H,inputValue:w,onInputChange:j,"aria-label":f.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:_,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:R,isClearable:!0,placeholder:f.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:x.kind==="loading",options:x.kind==="ready"?x.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:O,onChange:B,value:S,menuPosition:"fixed"})})};function er(t){return u.useMemo(()=>({onFocus:({focused:i})=>`${i.label} ${t.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:i,label:r})=>{let c="";switch(i){case"select-option":c=`${r} ${t.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":c=`${r} ${t.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return c},guidance:()=>`${t.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[t])}function tr(){return u.useMemo(()=>({Menu:Gi,Input:zi,SingleValue:Wi,Option:Xi,NoOptionsMessage:$i,LoadingMessage:Hi,ValueContainer:Ui,IndicatorsContainer:Ki,ClearIndicator:Zi}),[])}function sr(){const[t,e]=gs("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return u.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:t,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[t,e])}function nr(t,e,s,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!n)return;const r=new qi(n,t);return i(r),()=>{r.destroy(),i(void 0)}},[n,t]),u.useEffect(()=>{o&&(o.searchTypingDelay=e)},[o,e]),u.useEffect(()=>{o&&(o.maxResultsPerSource=s)},[o,s]),o}function or(t){const[e,s]=u.useReducer((c,l)=>{switch(l.kind){case"input":return{...c,query:l.query,selectedOption:null};case"select-option":return{...c,selectedOption:l.option,query:l.option.label};case"load-results":return{...c,search:{kind:"loading"}};case"accept-results":return{...c,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=u.useRef(),o=de(c=>{if(!t){n.current=void 0,s({kind:"accept-results",results:[]});return}Ke.isDebug()&&Ke.debug(`Starting new search for query ${JSON.stringify(c)}.`),s({kind:"load-results"});const l=n.current=ir(t,c).then(f=>{n.current===l&&s({kind:"accept-results",results:f})})}),i=u.useCallback(c=>{s({kind:"select-option",option:c})},[]),r=u.useCallback(c=>{s({kind:"input",query:c}),o(c)},[o]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:i,onInputChanged:r}}async function ir(t,e){let s;try{s=await t.search(e)}catch(n){fs(n)||Ke.error("Search failed",n),s=[]}return rr(s)}function rr(t){return t.map((s,n)=>({label:s.label,options:s.results.map(o=>({value:`${n}-${o.id}`,label:o.label,source:s.source,result:o}))}))}const Vs="@open-pioneer/selection",ar=De.bind(void 0,Vs),Et=ee.bind(void 0,Vs),_e="selection-active",He="selection-inactive";class cr{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,s,n,o,i){let r;switch(s){case Ct.extent:default:r=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,i,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=o}initViewport(e){const s=e.getViewport();return s.classList.add(_e),s.oncontextmenu=n=>(n.preventDefault(),!1),s}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const s=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipMessage,s.classList.remove(He),s.classList.add(_e),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,s.classList.remove(_e),s.classList.add(He),this.isActive=!1)}createDragBox(e,s,n,o){const i=new Lt({className:"selection-drag-box",condition:kn});return e.addInteraction(i),i.on("boxend",function(){s(i.getGeometry())}),{interaction:i,destroy(){e.removeInteraction(i),o.splice(o.indexOf(this)),i.dispose(),n.classList.remove(_e),n.classList.remove(He),n.oncontextmenu=null}}}createDrag(e,s,n){const o=function(c){return c.originalEvent.button==2},i=new Ot({condition:o});return e.addInteraction(i),{interaction:i,destroy(){e.removeInteraction(i),n.splice(n.indexOf(this)),i.dispose(),s.classList.remove(_e),s.classList.remove(He),s.oncontextmenu=null}}}createHelpTooltip(e,s){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.textContent=s;const o=new ze({element:n,offset:[15,0],positioning:"center-left"}),i=e.on("pointermove",r=>{o.setPosition(r.coordinate)});return e.addOverlay(o),{overlay:o,element:n,destroy(){e.removeOverlay(o),o.dispose(),re(i)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Lt)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Ot)}}const dt=fe("selection:SelectionController"),lr=1e4;var Re,Fe,Ve,qe,Ds;class ur{constructor(e){A(this,qe);A(this,Re,void 0);A(this,Fe,void 0);A(this,Ve,void 0);const{mapModel:s,onError:n,maxResults:o=lr}=e;I(this,Re,s),I(this,Fe,o),I(this,Ve,n)}destroy(){}async select(e,s){if(s)return await V(this,qe,Ds).call(this,e,s)}}Re=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,qe=new WeakSet,Ds=async function(e,s){const n=C(this,Re).olMap.getView().getProjection();try{dt.debug(`Starting selection on source '${e.label}'`);const o=C(this,Fe);let i=await e.select({type:"extent",extent:s},{maxResults:o,mapProjection:n,signal:new AbortController().signal});return i.length>o&&(i=i.slice(0,o)),dt.debug(`Found ${i.length} results on source '${e.label}'`),{source:e,results:i}}catch(o){dt.error(`selection from source ${e.label} failed`,o),C(this,Ve).call(this);return}};var Ct=(t=>(t.extent="EXTENT",t.polygon="POLYGON",t.free="FREEPOLYGON",t.circle="CIRCLE",t))(Ct||{});const Jt={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},Xr=t=>{const e=Et(),{mapId:s,sources:n,onSelectionComplete:o,onSelectionSourceChanged:i}=t,{containerProps:r}=z("selection",t),[c,l]=u.useState(()=>n.find(h=>(h.status??"available")==="available")),f=W(s),{onExtentSelected:g}=fr(f.map,n,c,o),w=mr(),[x,S]=u.useState(!1),P=u.useCallback(h=>{const y=[];if(h||(h=["EXTENT"]),h.forEach(m=>{Object.values(Ct).includes(m)&&y.push({label:e.formatMessage({id:m}),value:m})}),y.length===0)throw new Error("methods does not contain valid values");return y},[e])(void 0),[R,_]=u.useState(P[0]),O=de(h=>{_(h)}),[j,B]=u.useState(!0);pr(f.map,R,e,g,j);const H=u.useMemo(()=>n.map(h=>({label:h.label,value:h})),[n]),G=u.useMemo(()=>H.find(h=>h.value===c),[H,c]),U=de(h=>{l(h?.value),i&&i({source:h?.value})});u.useEffect(()=>{if(!c){B(!1);return}const h=e.formatMessage({id:"sourceNotAvailable"}),y=()=>c&&vt(c,h).kind==="available";B(y());const m=c.on("changed:status",()=>{B(y())});return()=>m.destroy()},[c,B,e]);const d=de(h=>{!x&&h.key==="Enter"&&S(!0)});return a.jsxs(ft,{...r,spacing:2,children:[P.length>1&&a.jsxs(Ue,{children:[a.jsx(Ie,{children:e.formatMessage({id:"selectMethod"})}),a.jsx(pt,{className:"selection-method react-select",...Jt,options:P,onChange:O,value:R,chakraStyles:w})]}),a.jsxs(Ue,{children:[a.jsx(Ie,{children:e.formatMessage({id:"selectSource"})}),a.jsx(pt,{className:"selection-source react-select",...Jt,options:H,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:G,onChange:U,components:{Option:dr,SingleValue:hr},isOptionDisabled:h=>h.value===void 0||h.value.status==="unavailable",getOptionLabel:h=>h.label+(h.value===void 0||h.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:w,onKeyDown:d,menuIsOpen:x,onMenuOpen:()=>S(!0),onMenuClose:()=>S(!1)})]})]})};function dr(t){const{value:e}=t.data,{isAvailable:s,content:n}=Bs(e,!1);return a.jsx(te.Option,{...t,isDisabled:!s,className:"selection-source-option",children:n})}function hr(t){const{value:e}=t.data,{isAvailable:s,content:n}=Bs(e,!0),o=s?"selection-source-value":"selection-source-value selection-source-value--disabled";return a.jsx(te.SingleValue,{...t,isDisabled:!s,className:o,children:n})}function Bs(t,e){const s=t?.label,n=gr(t);return{isAvailable:n.kind==="available",content:a.jsxs(Pe,{direction:"row",alignItems:"center",grow:1,children:[!e&&a.jsx(Pe,{grow:1,children:s}),n.kind==="unavailable"&&a.jsx($,{ml:2,children:a.jsx(hs,{label:n.reason,placement:"right",openDelay:500,children:a.jsx(K.span,{children:a.jsx(Nn,{as:Un,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&s]})}}function fr(t,e,s,n){const o=ar("notifier.NotificationService"),i=Et(),[r,c]=u.useState(void 0);u.useEffect(()=>{if(!t)return;const f=new ur({mapModel:t,onError(){o.notify({level:"error",message:i.formatMessage({id:"selectionFailed"})})}});return c(f),()=>{f.destroy()}},[t,o,e,i]);const l=de(async f=>{if(!r||!s)return;const g=await r.select(s,f.getExtent());g&&n?.(g)});return{controller:r,onExtentSelected:l}}function vt(t,e){const s=t.status??"available",n=typeof s=="string"?{kind:s}:s;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function gr(t){const e=Et(),[s,n]=u.useState(()=>({kind:"available"}));return u.useEffect(()=>{if(!t){n({kind:"available"});return}const o=e.formatMessage({id:"sourceNotAvailable"});n(vt(t,o));const i=t.on?.("changed:status",()=>{n(vt(t,o))});return()=>i?.destroy()},[t,e]),s}function pr(t,e,s,n,o){u.useEffect(()=>{if(!t)return;const i=new cr(t.olMap,e.value,s.formatMessage({id:"tooltip"}),s.formatMessage({id:"disabledTooltip"}),n);return i.setActive(o),()=>{i?.destroy()}},[t,e,s,n,o])}function mr(){const[t,e]=gs("colors",["background_body","border"],["#ffffff","#ffffff"]);return u.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:t})}),[t,e])}export{jr as C,Wr as G,Vr as L,Kr as M,Br as N,ze as O,Ur as P,Hr as S,Rr as V,Nr as W,zr as a,Yr as b,Zr as c,Xr as d,Dr as e,Gr as f,$r as g,bt as h};
