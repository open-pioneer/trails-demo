var z=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var c=(n,e,t)=>(z(n,e,"read from private field"),t?t.call(n):e.get(n)),I=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},m=(n,e,t,s)=>(z(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);var X=(n,e,t)=>(z(n,e,"access private method"),t);import{r as l,f as S,u as U,o as L,a as se,j as i,c as _,b as A,d as Ie,e as be,g as ie,h as je,i as _e,k as Ae,T as Ee,A as Z,l as ee,m as we,n as Ne,F as te,B as W,p as Ce,q as Le,s as Pe,t as Fe,v as Me,w as re,x as Re,y as Te}from"./34cc1436503a.js";const M=Symbol("EventEmitterState");class ae{[M]=new Be;on(e,t){return this[M].on(e,{listener:t})}once(e,t){return this[M].on(e,{listener:t,once:!0})}emit(e,...t){this[M].emit(e,t[0])}}class Be{handlers=new Map;on(e,t){let s=this.handlers.get(e);return s||(s=new Set,this.handlers.set(e,s)),s.add(t),{destroy(){t.removed=!0,s?.delete(t),s=void 0}}}emit(e,t){const s=this.handlers.get(e);if(!s)return;const r=[...s];for(const a of r)a.removed||(a.once&&(a.removed=!0,s.delete(a)),a.listener(t))}}function oe(n){return l.Children.toArray(n).filter(e=>l.isValidElement(e))}var D=S(function(e,t){var s;const r=U("FormLabel",e),a=L(e),{className:u,children:g,requiredIndicator:o=i.jsx(ce,{}),optionalIndicator:x=null,...p}=a,f=se(),d=(s=f?.getLabelProps(p,t))!=null?s:{ref:t,...p};return i.jsxs(_.label,{...d,className:A("chakra-form__label",a.className),__css:{display:"block",textAlign:"start",...r},children:[g,f?.isRequired?o:x]})});D.displayName="FormLabel";var ce=S(function(e,t){const s=se(),r=Ie();if(!s?.isRequired)return null;const a=A("chakra-form__required-indicator",e.className);return i.jsx(_.span,{...s?.getRequiredIndicatorProps(e,t),__css:r.requiredIndicator,className:a})});ce.displayName="RequiredIndicator";var[qe,ze]=be({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),le=S(function(e,t){const s=ie("Input",e),{children:r,className:a,...u}=L(e),g=A("chakra-input__group",a),o={},x=oe(r),p=s.field;x.forEach(d=>{var h,k;s&&(p&&d.type.id==="InputLeftElement"&&(o.paddingStart=(h=p.height)!=null?h:p.h),p&&d.type.id==="InputRightElement"&&(o.paddingEnd=(k=p.height)!=null?k:p.h),d.type.id==="InputRightAddon"&&(o.borderEndRadius=0),d.type.id==="InputLeftAddon"&&(o.borderStartRadius=0))});const f=x.map(d=>{var h,k;const N=je({size:((h=d.props)==null?void 0:h.size)||e.size,variant:((k=d.props)==null?void 0:k.variant)||e.variant});return d.type.id!=="Input"?l.cloneElement(d,N):l.cloneElement(d,Object.assign(N,o,d.props))});return i.jsx(_.div,{className:g,ref:t,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate"},"data-group":!0,...u,children:i.jsx(qe,{value:s,children:f})})});le.displayName="InputGroup";var Ge=_("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),B=S(function(e,t){var s,r;const{placement:a="left",...u}=e,g=ze(),o=g.field,p={[a==="left"?"insetStart":"insetEnd"]:"0",width:(s=o?.height)!=null?s:o?.h,height:(r=o?.height)!=null?r:o?.h,fontSize:o?.fontSize,...g.element};return i.jsx(Ge,{ref:t,__css:p,...u})});B.id="InputElement";B.displayName="InputElement";var ue=S(function(e,t){const{className:s,...r}=e,a=A("chakra-input__left-element",s);return i.jsx(B,{ref:t,placement:"left",className:a,...r})});ue.id="InputLeftElement";ue.displayName="InputLeftElement";var H=S(function(e,t){const{className:s,...r}=e,a=A("chakra-input__right-element",s);return i.jsx(B,{ref:t,placement:"right",className:a,...r})});H.id="InputRightElement";H.displayName="InputRightElement";var R=S(function(e,t){const{htmlSize:s,...r}=e,a=ie("Input",r),u=L(r),g=_e(u),o=A("chakra-input",e.className);return i.jsx(_.input,{size:s,...g,__css:a.field,ref:t,className:o})});R.displayName="Input";R.id="Input";function de(n,e){return Array.isArray(n)?n.map(t=>t===null?null:e(t)):Ae(n)?Object.keys(n).reduce((t,s)=>(t[s]=e(n[s]),t),{}):n!=null?e(n):null}var he=n=>i.jsx(_.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});he.displayName="StackItem";var O="& > *:not(style) ~ *:not(style)";function We(n){const{spacing:e,direction:t}=n,s={column:{marginTop:e,marginEnd:0,marginBottom:0,marginStart:0},row:{marginTop:0,marginEnd:0,marginBottom:0,marginStart:e},"column-reverse":{marginTop:0,marginEnd:0,marginBottom:e,marginStart:0},"row-reverse":{marginTop:0,marginEnd:e,marginBottom:0,marginStart:0}};return{flexDirection:t,[O]:de(t,r=>s[r])}}function De(n){const{spacing:e,direction:t}=n,s={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":de(t,r=>s[r])}}var me=S((n,e)=>{const{isInline:t,direction:s,align:r,justify:a,spacing:u="0.5rem",wrap:g,children:o,divider:x,className:p,shouldWrapChildren:f,...d}=n,h=t?"row":s??"column",k=l.useMemo(()=>We({direction:h,spacing:u}),[h,u]),N=l.useMemo(()=>De({spacing:u,direction:h}),[u,h]),P=!!x,K=!f&&!P,ve=l.useMemo(()=>{const q=oe(o);return K?q:q.map((F,Y)=>{const J=typeof F.key<"u"?F.key:Y,ye=Y+1===q.length,Q=f?i.jsx(he,{children:F},J):F;if(!P)return Q;const Se=l.cloneElement(x,{__css:N}),ke=ye?null:Se;return i.jsxs(l.Fragment,{children:[Q,ke]},J)})},[x,N,P,K,f,o]),xe=A("chakra-stack",p);return i.jsx(_.div,{ref:e,display:"flex",alignItems:r,justifyContent:a,flexDirection:k.flexDirection,flexWrap:g,className:xe,__css:P?{}:{[O]:k[O]},...d,children:ve})});me.displayName="Stack";var pe=S((n,e)=>i.jsx(me,{align:"center",...n,direction:"column",ref:e}));pe.displayName="VStack";var $=S(function(e,t){const s=U("Heading",e),{className:r,...a}=L(e);return i.jsx(_.h2,{ref:t,className:A("chakra-heading",e.className),...a,__css:s})});$.displayName="Heading";var V=S(function(e,t){const{className:s,centerContent:r,...a}=L(e),u=U("Container",e);return i.jsx(_.div,{ref:t,className:A("chakra-container",s),...a,__css:{...u,...r&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});V.displayName="Container";function Oe({doLogin:n,wasLoggedIn:e}){const[t,s]=l.useState(""),[r,a]=l.useState(""),[u,g]=l.useState(!1),[o,x]=l.useState(),[p,f]=l.useState(e),d=h=>{h.preventDefault();const k=n(t,r);x(k||""),f(!1)};return i.jsx(V,{p:5,children:i.jsxs(pe,{as:"form",onSubmit:d,spacing:4,children:[i.jsx($,{as:"h1",textAlign:"center",children:"Login"}),i.jsxs(Ee,{textAlign:"center",children:["Please enter your user name and password to authenticate.",i.jsx("br",{}),"Note: credentials are ",'"admin"'," / ",'"admin"']}),o&&i.jsxs(Z,{status:"error",children:[i.jsx(ee,{}),i.jsx(we,{children:o})]}),p&&i.jsxs(Z,{status:"info",mb:5,children:[i.jsx(ee,{}),i.jsxs(Ne,{children:["Logout successful.",i.jsx("br",{}),"You can use the form below to log in again."]})]}),i.jsxs(te,{children:[i.jsx(D,{children:"User name"}),i.jsx(R,{placeholder:"User name",value:t,onChange:h=>s(h.target.value),autoComplete:"username"})]}),i.jsxs(te,{children:[i.jsx(D,{children:"Password"}),i.jsxs(le,{children:[i.jsx(R,{pr:"4.5rem",type:u?"text":"password",placeholder:"Enter password",value:r,onChange:h=>a(h.target.value),autoComplete:"current-password"}),i.jsx(H,{width:"4.5rem",children:i.jsx(W,{h:"1.75rem",size:"sm",onClick:()=>g(!u),children:u?"Hide":"Show"})})]})]}),i.jsx(W,{type:"submit",children:"Login"})]})})}var b,E,C;class Ue extends ae{constructor(){super();I(this,b,{kind:"pending"});I(this,E,void 0);I(this,C,!1);m(this,E,setTimeout(()=>{m(this,b,{kind:"not-authenticated"}),this.emit("changed")},500))}destroy(){clearTimeout(c(this,E)),m(this,E,void 0)}getAuthState(){return c(this,b)}getLoginBehavior(){const t=(r,a)=>{if(r==="admin"&&a==="admin")m(this,b,{kind:"authenticated",sessionInfo:{userId:"admin",userName:"Arnold Administrator"}}),m(this,C,!0),this.emit("changed");else return"Invalid user name or password!"};return{kind:"fallback",Fallback:()=>l.createElement(Oe,{doLogin:t,wasLoggedIn:c(this,C)})}}logout(){(c(this,b).kind==="authenticated"||c(this,b).kind==="pending")&&(m(this,b,{kind:"not-authenticated"}),clearTimeout(c(this,E)),m(this,E,void 0),this.emit("changed"))}}b=new WeakMap,E=new WeakMap,C=new WeakMap;const G=Fe("authentication:AuthService");var j,v,y,w,T,ge;class He extends ae{constructor(t){super();I(this,T);I(this,j,void 0);I(this,v,void 0);I(this,y,void 0);I(this,w,void 0);m(this,j,t.references.plugin),m(this,v,c(this,j).getAuthState()),m(this,w,c(this,j).on?.("changed",()=>X(this,T,ge).call(this))),G.debug(`Constructed with initial auth state '${c(this,v).kind}'`,c(this,v))}destroy(){c(this,y)?.reject(Ce()),m(this,y,void 0),m(this,w,Le(c(this,w)))}getAuthState(){return c(this,v)}getSessionInfo(){return c(this,v).kind!=="pending"?Promise.resolve(ne(c(this,v))):(c(this,y)||m(this,y,Pe()),c(this,y).promise)}getLoginBehavior(){return c(this,j).getLoginBehavior()}logout(){G.debug("Triggering logout"),c(this,j).logout()}}j=new WeakMap,v=new WeakMap,y=new WeakMap,w=new WeakMap,T=new WeakSet,ge=function(){const t=c(this,j).getAuthState();m(this,v,t),t.kind!=="pending"&&c(this,y)&&(c(this,y).resolve(ne(t)),m(this,y,void 0)),G.debug(`Auth state changed to '${c(this,v).kind}'`,c(this,v)),this.emit("changed")};function ne(n){return n.kind==="authenticated"?n.sessionInfo:void 0}const $e={"auth-app":{name:"auth-app",services:{TestAuthPlugin:{name:"TestAuthPlugin",clazz:Ue,provides:[{name:"authentication.AuthPlugin",qualifier:void 0}],references:{}}},ui:{references:[{name:"authentication.AuthService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/core":{name:"@open-pioneer/core",services:{},ui:{references:[]},properties:{}},"@open-pioneer/chakra-integration":{name:"@open-pioneer/chakra-integration",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime":{name:"@open-pioneer/runtime",services:{},ui:{references:[]},properties:{}},"@open-pioneer/authentication":{name:"@open-pioneer/authentication",services:{AuthServiceImpl:{name:"AuthServiceImpl",clazz:He,provides:[{name:"authentication.AuthService",qualifier:void 0}],references:{plugin:{name:"authentication.AuthPlugin",qualifier:void 0,all:!1}}}},ui:{references:[{name:"authentication.AuthService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/runtime-react-support":{name:"@open-pioneer/runtime-react-support",services:{},ui:{references:[]},properties:{}},"@open-pioneer/test-utils":{name:"@open-pioneer/test-utils",services:{},ui:{references:[]},properties:{}}},Ve="",Ke=[];function Ye(n){throw new Error(`Unsupported locale: '${n}'`)}const Je=Me(Ve),Qe=Object.freeze(Object.defineProperty({__proto__:null,loadMessages:Ye,locales:Ke,packages:$e,styles:Je},Symbol.toStringTag,{value:"Module"})),Xe="@open-pioneer/authentication",Ze=re.bind(void 0,Xe);function fe(n){const e=l.useCallback(r=>{const a=n.on("changed",r);return()=>a.destroy()},[n]),t=l.useCallback(()=>n.getAuthState(),[n]);return l.useSyncExternalStore(e,t)}const et=n=>{const e=Ze("authentication.AuthService"),t=fe(e),s=l.useMemo(()=>{if(t.kind==="not-authenticated")return e.getLoginBehavior()},[e,t.kind]);switch(l.useEffect(()=>{t.kind==="not-authenticated"&&s?.kind==="effect"&&s.login()},[s,t.kind]),t.kind){case"pending":return null;case"not-authenticated":{if(!s||s.kind!=="fallback")return null;const r=s.Fallback;return n.renderFallback?i.jsx(i.Fragment,{children:n.renderFallback(r)}):i.jsx(r,{...n.fallbackProps})}case"authenticated":return i.jsx(i.Fragment,{children:n.children})}},tt="auth-app",nt=re.bind(void 0,tt);function st(){const n=nt("authentication.AuthService"),e=fe(n),t=()=>{n.logout()};return e.kind==="not-authenticated"||e.kind==="pending"?null:i.jsx(W,{colorScheme:"red",onClick:t,children:"Log out"})}function it(){return i.jsx(et,{children:i.jsxs(V,{p:5,children:[i.jsx($,{as:"h1",children:"Authenticated"}),"This is the actual content of the app. Authentication was successful.",i.jsx(Re,{pt:5,flexDirection:"row",justifyContent:"center",children:i.jsx(st,{})})]})})}const rt=Te({component:it,appMetadata:Qe});customElements.define("auth-app",rt);
