const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BxxsUwimoiOf.js","./Dch09mLNbtBx.js","./B_degmIyx8_O.js","./BQe9eC9szWYu.js","./CwRzEUH9Boe-.js","./CFcx7qJFwJ4i.js","./Cx2t2uGpSjFN.js","./CIyuZeO9T2nk.js","./CwIpeg7hf6__.js","./CiLCVU3wcpbH.js"])))=>i.map(i=>d[i]);
var Ts=Object.defineProperty;var vt=t=>{throw TypeError(t)};var Ls=(t,e,s)=>e in t?Ts(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var bt=(t,e,s)=>Ls(t,typeof e!="symbol"?e+"":e,s),We=(t,e,s)=>e.has(t)||vt("Cannot "+s);var k=(t,e,s)=>(We(t,e,"read from private field"),s?s.call(t):e.get(t)),A=(t,e,s)=>e.has(t)?vt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),_=(t,e,s,n)=>(We(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s),N=(t,e,s)=>(We(t,e,"access private method"),s);import{b7 as Ut,b8 as Ns,ao as Os,an as yt,b9 as js,ba as Rs,B as Fs,bb as Ds,bc as Vs,bd as Bs,be as Gs,bf as zt,bg as Kt,bh as $s,bi as Hs,ax as Wt,bj as Us,bk as zs,L as Q,bl as Ks,bm as Ws,Z as R,bn as Ys,E as Zs,aX as Xs,f as wt,bo as Js,bp as qs,bq as xt,br as Qs,bs as Ye,V as en,bt as St,au as tn,az as sn,bu as nn,bv as on,bw as rn,bx as an,by as Ct,l as st,N as Yt,bz as Zt,Y,bA as D,a1 as V,bB as cn,X as Te,bC as ln,bD as un,a0 as we,bE as Le,k as Et,b as Xt,a as Jt,Q as qt,c as fe,C as Qt,F as xe,b0 as ne,bF as dn,aT as es,bG as hn,bH as fn,bI as kt,bJ as gn,bK as Mt}from"./CwRzEUH9Boe-.js";import{u as pn,e as mn,r as u,f as vn,h as He,i as ts,o as ss,k as ns,j as a,l as B,m as bn,n as yn,c as ie,E as z,R as wn,A as Ze,p as Xe,F as os,B as Ue,C as xn,t as Sn,q as is,s as rs,I as Cn}from"./BQe9eC9szWYu.js";import{T as ee,V as nt,L as as}from"./CIyuZeO9T2nk.js";import{u as W}from"./CFcx7qJFwJ4i.js";import{S as En,c as kn,a as Mn,I as _n,D as Pn}from"./DacjzysfVaM7.js";import{j as In,k as cs}from"./DyU9iwk1JBMi.js";import{S as An}from"./DxbseSk_ju_Z.js";import{_ as Tn}from"./Dch09mLNbtBx.js";import{u as ls,F as De}from"./Cx2t2uGpSjFN.js";import{F as Se}from"./BSA8_DfPVMv2.js";import{H as ot}from"./Bz8f9wQDlkiP.js";import{c as us}from"./zS-fdIGDdBUq.js";import{T as Ln}from"./BXIrMMxIhmPv.js";import{G as Nn,F as On}from"./CiLCVU3wcpbH.js";import{L as ds}from"./CMjaaoqopx3e.js";import{F as Z,r as it}from"./B_degmIyx8_O.js";function jn(t){const{theme:e}=pn(),s=mn();return u.useMemo(()=>vn(e.direction,{...s,...t}),[t,e.direction,s])}var ze=He(function(e,s){const{htmlSize:n,...o}=e,i=ts("Input",o),r=ss(o),c=ls(r),l=ns("chakra-input",e.className);return a.jsx(B.input,{size:n,...c,__css:i.field,ref:s,className:l})});ze.displayName="Input";ze.id="Input";var hs=B("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});hs.displayName="Center";var Rn={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};He(function(e,s){const{axis:n="both",...o}=e;return a.jsx(B.div,{ref:s,__css:Rn[n],...o,position:"absolute"})});var fs=He(function(e,s){const{children:n,placeholder:o,className:i,...r}=e;return a.jsxs(B.select,{...r,ref:s,className:ns("chakra-select",i),children:[o&&a.jsx("option",{value:"",children:o}),n]})});fs.displayName="SelectField";function Fn(t,e){const s={},n={};for(const[o,i]of Object.entries(t))e.includes(o)?s[o]=i:n[o]=i;return[s,n]}var ct=He((t,e)=>{var s;const n=ts("Select",t),{rootProps:o,placeholder:i,icon:r,color:c,height:l,h:f,minH:g,minHeight:v,iconColor:y,iconSize:x,...m}=ss(t),[d,p]=Fn(m,yn),h=ls(p),b={width:"100%",height:"fit-content",position:"relative",color:c},S={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(s=n.field)==null?void 0:s._focus}};return a.jsxs(B.div,{className:"chakra-select__wrapper",__css:b,...d,...o,children:[a.jsx(fs,{ref:e,height:f??l,minH:g??v,placeholder:i,...h,__css:S,children:t.children}),a.jsx(gs,{"data-disabled":bn(h.disabled),...(y||c)&&{color:y||c},__css:n.icon,...x&&{fontSize:x},children:r})]})});ct.displayName="Select";var Dn=t=>a.jsx("svg",{viewBox:"0 0 24 24",...t,children:a.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Vn=B("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),gs=t=>{const{children:e=a.jsx(Dn,{}),...s}=t,n=u.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return a.jsx(Vn,{...s,className:"chakra-select__icon-wrapper",children:u.isValidElement(e)?n:null})};gs.displayName="SelectIcon";const T={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Bn={ERROR:"error"};class Gn extends Fs{constructor(e){super(Bn.ERROR),this.code=e.code,this.message=e.message}}let $n=class extends Ut{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Ns,this.watchId_=void 0,this.addChangeListener(T.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(T.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Os(yt("EPSG:4326"),e),this.position_&&this.set(T.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const s=e.coords;this.set(T.ACCURACY,s.accuracy),this.set(T.ALTITUDE,s.altitude===null?void 0:s.altitude),this.set(T.ALTITUDE_ACCURACY,s.altitudeAccuracy===null?void 0:s.altitudeAccuracy),this.set(T.HEADING,s.heading===null?void 0:js(s.heading)),this.position_?(this.position_[0]=s.longitude,this.position_[1]=s.latitude):this.position_=[s.longitude,s.latitude];const n=this.transform_(this.position_);this.set(T.POSITION,n.slice()),this.set(T.SPEED,s.speed===null?void 0:s.speed);const o=Rs(this.position_,s.accuracy);o.applyTransform(this.transform_),this.set(T.ACCURACY_GEOMETRY,o),this.changed()}positionError_(e){this.dispatchEvent(new Gn(e))}getAccuracy(){return this.get(T.ACCURACY)}getAccuracyGeometry(){return this.get(T.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(T.ALTITUDE)}getAltitudeAccuracy(){return this.get(T.ALTITUDE_ACCURACY)}getHeading(){return this.get(T.HEADING)}getPosition(){return this.get(T.POSITION)}getProjection(){return this.get(T.PROJECTION)}getSpeed(){return this.get(T.SPEED)}getTracking(){return this.get(T.TRACKING)}getTrackingOptions(){return this.get(T.TRACKING_OPTIONS)}setProjection(e){this.set(T.PROJECTION,yt(e))}setTracking(e){this.set(T.TRACKING,e)}setTrackingOptions(e){this.set(T.TRACKING_OPTIONS,e)}};const O={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Ve extends Ut{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Ds,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(O.ELEMENT,this.handleElementChanged),this.addChangeListener(O.MAP,this.handleMapChanged),this.addChangeListener(O.OFFSET,this.handleOffsetChanged),this.addChangeListener(O.POSITION,this.handlePositionChanged),this.addChangeListener(O.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(O.ELEMENT)}getId(){return this.id}getMap(){return this.get(O.MAP)||null}getOffset(){return this.get(O.OFFSET)}getPosition(){return this.get(O.POSITION)}getPositioning(){return this.get(O.POSITIONING)}handleElementChanged(){Vs(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Bs(this.element),Gs(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=zt(e,Kt.POSTRENDER,this.render,this),this.updatePixelPosition();const s=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(O.ELEMENT,e)}setMap(e){this.set(O.MAP,e)}setOffset(e){this.set(O.OFFSET,e)}setPosition(e){this.set(O.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const s=this.getMap();if(!s||!s.getTargetElement()||!this.get(O.POSITION))return;const n=this.getRect(s.getTargetElement(),s.getSize()),o=this.getElement(),i=this.getRect(o,[$s(o),Hs(o)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!Wt(n,i)){const c=i[0]-n[0],l=n[2]-i[2],f=i[1]-n[1],g=n[3]-i[3],v=[0,0];if(c<0?v[0]=c-r:l<0&&(v[0]=Math.abs(l)+r),f<0?v[1]=f-r:g<0&&(v[1]=Math.abs(g)+r),v[0]!==0||v[1]!==0){const y=s.getView().getCenterInternal(),x=s.getPixelFromCoordinateInternal(y);if(!x)return;const m=[x[0]+v[0],x[1]+v[1]],d=e.animation||{};s.getView().animateInternal({center:s.getCoordinateFromPixelInternal(m),duration:d.duration,easing:d.easing})}}}getRect(e,s){const n=e.getBoundingClientRect(),o=n.left+window.pageXOffset,i=n.top+window.pageYOffset;return[o,i,o+s[0],i+s[1]]}setPositioning(e){this.set(O.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),s=this.getPosition();if(!e||!e.isRendered()||!s){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(s),o=e.getSize();this.updateRenderedPosition(n,o)}updateRenderedPosition(e,s){const n=this.element.style,o=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const r=Math.round(e[0]+o[0])+"px",c=Math.round(e[1]+o[1])+"px";let l="0%",f="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?l="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(l="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?f="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(f="-50%");const g=`translate(${l}, ${f}) translate(${r}, ${c})`;this.rendered.transform_!=g&&(this.rendered.transform_=g,n.transform=g)}getOptions(){return this.options}}const Pr=Us,Hn=25.4/.28,Un=39.37;function lt(t){return ut(t,zn,Kn)}function zn(t){return t.getView()}function Kn(t,e){return t.on("change:view",e)}function ps(t){return lt(t)?.getProjection()}function Wn(t){const e=lt(t);return ut(e,Yn,Zn)}function Yn(t){return t.getResolution()}function Zn(t,e){return t.on("change:resolution",e)}function Xn(t){const e=lt(t);return ut(e,Jn,qn)}function Jn(t){return t.getCenter()}function qn(t,e){return t.on("change:center",e)}function Qn(t){const e=Xn(t),s=Wn(t),n=ps(t);return u.useMemo(()=>{if(n==null||s==null||e==null)return;const i=zs(n,s,e);return Math.round(i*Un*Hn)},[n,s,e])}function ut(t,e,s){const n=u.useCallback(()=>t?e(t):void 0,[t,e]),o=u.useCallback(i=>{if(!t)return()=>{};const r=s(t,i);return()=>Q(r)},[t,s]);return u.useSyncExternalStore(o,n)}const eo=1.2;function to(t,e=eo){so(t);const s=Ks(t),n=Ws(t),o=s*e,i=n*e;return[t[0]-(o-s)/2,t[1]-(i-n)/2,t[2]+(o-s)/2,t[3]+(i-n)/2]}function so(t){if(t.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${t.length}).`)}const no={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function Ir(t){return a.jsxs(R,{children:[a.jsx(ee,{children:t.layer.title}),a.jsx(R,{style:no})]})}const Je=.75,Ne=.1;let oo=class extends Ys{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const s=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",o=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;const i=e.label!==void 0?e.label:"›";typeof i=="string"?(this.label_=document.createElement("span"),this.label_.textContent=i):this.label_=i;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,c=document.createElement("button");c.setAttribute("type","button"),c.title=n,c.appendChild(r),c.addEventListener(Zs.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new Xs({view:e.view,controls:new wt,interactions:new wt});this.ovmap_=l,e.layers&&e.layers.forEach(function(b){l.addLayer(b)});const f=document.createElement("div");f.className="ol-overviewmap-box",f.style.boxSizing="border-box",this.boxOverlay_=new Ve({position:[0,0],positioning:"center-center",element:f}),this.ovmap_.addOverlay(this.boxOverlay_);const g=s+" "+Js+" "+qs+(this.collapsed_&&this.collapsible_?" "+xt:"")+(this.collapsible_?"":" ol-uncollapsible"),v=this.element;v.className=g,v.appendChild(this.ovmapDiv_),v.appendChild(c);const y=this,x=this.boxOverlay_,m=this.boxOverlay_.getElement(),d=function(b){return{clientX:b.clientX,clientY:b.clientY}},p=function(b){const S=d(b),C=l.getEventCoordinateInternal(S);x.setPosition(C)},h=function(b){const S=l.getEventCoordinateInternal(b);y.getMap().getView().setCenterInternal(S),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",h)};m.addEventListener("mousedown",function(){window.addEventListener("mousemove",p),window.addEventListener("mouseup",h)})}setMap(e){const s=this.getMap();if(e!==s){if(s){const n=s.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(zt(e,Qs.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===Ye.VIEW){const s=e.oldValue;s&&this.unbindView_(s);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===Ye.TARGET||e.key===Ye.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const s=new en({projection:e.getProjection()});this.ovmap_.setView(s)}e.addChangeListener(St.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(St.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),s=this.ovmap_;if(!e.isRendered()||!s.isRendered())return;const n=e.getSize(),i=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&tn(i,this.viewExtent_))return;this.viewExtent_=i;const r=s.getSize(),l=s.getView().calculateExtentInternal(r),f=s.getPixelFromCoordinateInternal(sn(i)),g=s.getPixelFromCoordinateInternal(nn(i)),v=Math.abs(f[0]-g[0]),y=Math.abs(f[1]-g[1]),x=r[0],m=r[1];v<x*Ne||y<m*Ne||v>x*Je||y>m*Je?this.resetExtent_():Wt(l,i)||this.recenter_()}resetExtent_(){const e=this.getMap(),s=this.ovmap_,n=e.getSize(),i=e.getView().calculateExtentInternal(n),r=s.getView(),c=Math.log(Je/Ne)/Math.LN2,l=1/(Math.pow(2,c/2)*Ne);on(i,l),r.fitInternal(rn(i))}recenter_(){const e=this.getMap(),s=this.ovmap_,n=e.getView();s.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),s=this.ovmap_;if(!e.isRendered()||!s.isRendered())return;const n=e.getSize(),o=e.getView(),i=s.getView(),r=this.rotateWithView_?0:-o.getRotation(),c=this.boxOverlay_,l=this.boxOverlay_.getElement(),f=o.getCenterInternal(),g=o.getResolution(),v=i.getResolution(),y=n[0]*g/v,x=n[1]*g/v;if(c.setPosition(f),l){l.style.width=y+"px",l.style.height=x+"px";const m="rotate("+r+"rad)";l.style.transform=m}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=an(this.ovmap_,Kt.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(xt),this.collapsed_?Ct(this.collapseLabel_,this.label_):Ct(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};new st([407354,5754673]),new st([404740,5757893]);var se,J,Ce,Ee,ke,rt;class io extends Yt{constructor(s,n,o){super();A(this,ke);bt(this,"label");A(this,se,{kind:"available"});A(this,J);A(this,Ce);A(this,Ee);this.label=n,_(this,J,s),_(this,Ee,o),N(this,ke,rt).call(this),_(this,Ce,k(this,J).on("change:visible",()=>{N(this,ke,rt).call(this)}))}destroy(){Q(k(this,Ce))}get status(){return k(this,se)}async select(s,n){if(s.type!=="extent")throw new Error(`Unsupported selection kind: ${s.type}`);if(k(this,se).kind!=="available"||k(this,J).getSource()===null)return[];const o=[];k(this,J).getSource().forEachFeatureIntersectingExtent(s.extent,c=>{if(!c.getGeometry())return;const l={...c.getProperties()};delete l.geometries;const f={id:c.getId()?.toString()||Zt(),geometry:c.getGeometry(),properties:l};o.push(f)});const i=o.filter(c=>c!=null);return i.length>n.maxResults?i.slice(0,n.maxResults):i}}se=new WeakMap,J=new WeakMap,Ce=new WeakMap,Ee=new WeakMap,ke=new WeakSet,rt=function(){const n=k(this,J).getVisible()?{kind:"available"}:{kind:"unavailable",reason:k(this,Ee)};n.kind!==k(this,se).kind&&(_(this,se,n),this.emit("changed:status"))};var Me;class Tr{constructor({intl:e}){A(this,Me);_(this,Me,e)}createSelectionSource(e){return new io(e.vectorLayer,e.label,k(this,Me).formatMessage({id:"layerNotVisibleReason"}))}}Me=new WeakMap;const oe=ie("local-storage"),ro=0,K={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var ce,$,q,le,H,L,ms,vs,be,ae,bs;class Lr{constructor(e){A(this,L);A(this,ce);A(this,$,{});A(this,q);A(this,le);A(this,H);_(this,ce,uo(e.properties)),_(this,q,ho()),k(this,q)&&(N(this,L,vs).call(this),_(this,le,N(this,L,bs).call(this)))}destroy(){k(this,H)&&(clearTimeout(k(this,H)),_(this,H,void 0)),k(this,q)&&N(this,L,be).call(this)}get isSupported(){return!!k(this,le)}get(e){return N(this,L,ae).call(this).get(e)}set(e,s){return N(this,L,ae).call(this).set(e,s)}remove(e){return N(this,L,ae).call(this).remove(e)}removeAll(){return N(this,L,ae).call(this).removeAll()}getNamespace(e){return N(this,L,ae).call(this).getNamespace(e)}}ce=new WeakMap,$=new WeakMap,q=new WeakMap,le=new WeakMap,H=new WeakMap,L=new WeakSet,ms=function(){k(this,H)&&clearTimeout(k(this,H)),_(this,H,setTimeout(()=>{_(this,H,void 0),N(this,L,be).call(this)},ro))},vs=function(){try{const e=k(this,q);if(!e)throw new z(K.INTERNAL,"Local storage is not available.");const s=e.getItem(k(this,ce));if(s==null){_(this,$,{}),N(this,L,be).call(this);return}try{const n=JSON.parse(s);if(!ge(n))throw new z(K.CORRUPTED_DATA,"Persisted value should be an object.");_(this,$,n)}catch(n){oe.warn("Invalid persisted data, reverting to default.",n),_(this,$,{}),N(this,L,be).call(this)}}catch(e){oe.error("Failed to load from local storage",e)}},be=function(){try{const e=k(this,q);if(!e)throw new z(K.INTERNAL,"Local storage is not available.");const s=JSON.stringify(k(this,$));e.setItem(k(this,ce),s)}catch(e){oe.error("Failed to save to local storage",e)}},ae=function(){const e=k(this,le);if(!e)throw new z(K.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},bs=function(){const e={getByPath:s=>Pt(ao(k(this,$),s)),setByPath:(s,n)=>{if(!lo(n))throw new z(K.INVALID_VALUE,"The value is not supported by local storage.");if(n=Pt(n),s.length===0){if(!ge(n))throw new z(K.INVALID_VALUE,"The root value must be a plain object.");_(this,$,n)}else co(k(this,$),s,n);N(this,L,ms).call(this)}};return new dt([],e)};class dt{path;access;constructor(e,s){this.path=e,this.access=s}get(e){return this.access.getByPath([...this.path,e])}set(e,s){this.access.setByPath([...this.path,e],s)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const s=this.get(e);if(s===void 0)this.set(e,{});else if(!ge(s))throw new z(K.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new dt(this.path.concat([e]),this.access)}}const _t="trails-state";function ao(t,e){let s=t;for(const n of e){if(!ge(s))throw new z(K.INVALID_PATH,`Cannot get nested property '${n}' because the parent is no object.`);s=s[n]}return s}function co(t,e,s){if(!e.length)throw new z(K.INTERNAL,"Path must not be empty.");let n=t;for(let i=0,r=e.length-1;i<r;++i){const c=e[i],l=n[c];if(!ge(l))throw new z(K.INVALID_PATH,`Cannot set property on '${c}' because it is no object.`);n=l}const o=e[e.length-1];n[o]=s}function ge(t){return!!(t&&typeof t=="object"&&!Array.isArray(t))}function lo(t){const e=typeof t;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||t===null||Array.isArray(t)||ge(t)}function uo(t){const e=t.storageId;return!e||typeof e!="string"?(oe.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${_t}'.`),_t):e}function ho(){if(typeof Storage>"u"){oe.warn("Local storage is not supported by this browser.");return}try{const t=globalThis.localStorage;if(!t){oe.warn("Local storage is not supported by this browser.");return}return t}catch(t){oe.warn("Local storage is not supported by this browser.",t);return}}function Pt(t){return t!=null&&(t=JSON.parse(JSON.stringify(t))),t}const fo="@open-pioneer/coordinate-viewer",go=Y.bind(void 0,fo),po=4,Nr=t=>{const{mapId:e,precision:s,displayProjectionCode:n}=t,{containerProps:o}=D("coordinate-viewer",t),{map:i}=V(e),r=i?.olMap,c=ps(r)?.getCode()??"";let{coordinates:l}=vo(r);l=l&&n?yo(l,c,n):l;const f=mo(l,s),g=n||c,v=f?f+" "+g:"";return a.jsx(R,{...o,children:a.jsx(ee,{className:"coordinate-viewer-text",children:v})})};function mo(t,e){const s=go();return t?bo(t,e,s):""}function vo(t){const[e,s]=u.useState();return u.useEffect(()=>{if(!t)return;const n=t.on("pointermove",o=>{s(o.coordinate)});return()=>Q(n)},[t]),{coordinates:e}}function bo(t,e,s){if(t[0]==null||t[1]==null)return"";const n=e??po,[o,i]=t,r=s.formatNumber(o,{maximumFractionDigits:n,minimumFractionDigits:n}),c=s.formatNumber(i,{maximumFractionDigits:n,minimumFractionDigits:n});return r+" "+c}function yo(t,e,s){return cn(t,e,s)}const wo="@open-pioneer/notifier",xo=Te.bind(void 0,wo);var ys=us({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),So=us({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const Co=!1;function Or(t){const{position:e="top-right"}=t,s=jn(),n=xo("notifier.NotificationService"),[o,i]=u.useState(!Co),r=W(l=>{const f=l.level==="error"?a.jsx(ys,{h:"100%",w:"100%"}):void 0;s({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:f})}),c=W(()=>{s.closeAll()});return u.useEffect(()=>{const l=n.registerHandler({showNotification:r,closeAll:c});return()=>l.destroy()},[o,n,r,c]),a.jsx(a.Fragment,{})}const jr=t=>{const{mapId:e,displayMode:s="line"}=t,{containerProps:n}=D("scale-bar",t),{map:o}=V(e),i=u.useRef(null);return u.useEffect(()=>{if(i.current&&o){const r=o.olMap,c=new En({units:"metric",target:i.current,bar:s==="bar"});return r.addControl(c),()=>{r.removeControl(c)}}},[s,o]),a.jsx(R,{...n,ref:i})},Eo="@open-pioneer/scale-viewer",ko=Y.bind(void 0,Eo),Rr=t=>{const{mapId:e}=t,{containerProps:s}=D("scale-viewer",t),{map:n}=V(e),o=ko(),i=Qn(n?.olMap),r=i?o.formatNumber(i):void 0;return a.jsx(R,{...s,children:r&&a.jsxs(ee,{children:["1:",r]})})};var G={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let Mo=0;function _o(t,e){const s=`atom${++Mo}`,n={toString:()=>s};return typeof t=="function"?n.read=t:(n.init=t,n.read=Po,n.write=Io),n}function Po(t){return t(this)}function Io(t,e,s){return e(this,typeof s=="function"?s(t(this)):s)}const It=(t,e)=>t.unstable_is?t.unstable_is(e):e===t,qe=t=>"init"in t,Qe=t=>!!t.write,ye=Symbol((G?"production":void 0)!=="production"?"CONTINUE_PROMISE":""),ht="pending",Ao="fulfilled",To="rejected",Lo=t=>typeof t=="object"&&t!==null&&ye in t,Oe=new WeakMap,No=(t,e,s)=>{if(!Oe.has(t)){let n;const o=new Promise((i,r)=>{let c=t;const l=g=>v=>{c===g&&(o.status=Ao,o.value=v,i(v),s())},f=g=>v=>{c===g&&(o.status=To,o.reason=v,r(v),s())};t.then(l(t),f(t)),n=(g,v)=>{g&&(Oe.set(g,o),c=g,g.then(l(g),f(g)),e(),e=v)}});o.status=ht,o[ye]=n,Oe.set(t,o)}return Oe.get(t)},Oo=t=>typeof t?.then=="function",At=t=>"v"in t||"e"in t,je=t=>{if("e"in t)throw t.e;if((G?"production":void 0)!=="production"&&!("v"in t))throw new Error("[Bug] atom state is not initialized");return t.v},Re=t=>{const e=t.v;return Lo(e)&&e.status===ht?e:null},Tt=(t,e,s)=>{s.p.has(t)||(s.p.add(t),e.then(()=>{s.p.delete(t)},()=>{s.p.delete(t)}))},re=()=>[new Map,new Map,new Set],et=(t,e,s)=>{t[0].has(e)||t[0].set(e,new Set),t[1].set(e,s)},jo=(t,e,s)=>{const n=t[0].get(e);n&&n.add(s)},Ro=(t,e)=>t[0].get(e),Lt=(t,e)=>{t[2].add(e)},te=t=>{for(;t[1].size||t[2].size;){t[0].clear();const e=new Set(t[1].values());t[1].clear();const s=new Set(t[2]);t[2].clear(),e.forEach(n=>{var o;return(o=n.m)==null?void 0:o.l.forEach(i=>i())}),s.forEach(n=>n())}},ft=()=>{const t=new WeakMap;let e;(G?"production":void 0)!=="production"&&(e=new Set);const s=m=>{let d=t.get(m);return d||(d={d:new Map,p:new Set,n:0},t.set(m,d)),d},n=(m,d,p,h=()=>{},b=()=>{})=>{const S="v"in d,C=d.v,P=Re(d);if(Oo(p))if(P)P!==p&&(P[ye](p,h),++d.n);else{const M=No(p,h,b);if(M.status===ht)for(const w of d.d.keys()){const I=s(w);Tt(m,M,I)}d.v=M,delete d.e}else P&&P[ye](Promise.resolve(p),h),d.v=p,delete d.e;(!S||!Object.is(C,d.v))&&++d.n},o=(m,d,p,h)=>{var b;if((G?"production":void 0)!=="production"&&p===d)throw new Error("[Bug] atom cannot depend on itself");const S=s(d);S.d.set(p,h.n);const C=Re(S);C&&Tt(d,C,h),(b=h.m)==null||b.t.add(d),m&&jo(m,p,d)},i=(m,d,p)=>{const h=s(d);if(!p?.(d)&&At(h)&&(h.m||Array.from(h.d).every(([w,I])=>i(m,w,p).n===I)))return h;h.d.clear();let b=!0;const S=w=>{if(It(d,w)){const E=s(w);if(!At(E))if(qe(w))n(w,E,w.init);else throw new Error("no atom init");return je(E)}const I=i(m,w,p);if(b)o(m,d,w,I);else{const E=re();o(E,d,w,I),g(E,d,h),te(E)}return je(I)};let C,P;const M={get signal(){return C||(C=new AbortController),C.signal},get setSelf(){return(G?"production":void 0)!=="production"&&!Qe(d)&&console.warn("setSelf function cannot be used with read-only atom"),!P&&Qe(d)&&(P=(...w)=>{if((G?"production":void 0)!=="production"&&b&&console.warn("setSelf function cannot be called in sync"),!b)return f(d,...w)}),P}};try{const w=d.read(S,M);return n(d,h,w,()=>C?.abort(),()=>{if(h.m){const I=re();g(I,d,h),te(I)}}),h}catch(w){return delete h.v,h.e=w,++h.n,h}finally{b=!1}},r=m=>je(i(void 0,m)),c=(m,d)=>{const p=M=>{var w,I;const E=s(M),j=new Set((w=E.m)==null?void 0:w.t);for(const F of E.p)j.add(F);return(I=Ro(m,M))==null||I.forEach(F=>{j.add(F)}),j},h=[],b=new Set,S=M=>{if(!b.has(M)){b.add(M);for(const w of p(M))M!==w&&S(w);h.push(M)}};S(d);const C=new Set([d]),P=M=>b.has(M);for(let M=h.length-1;M>=0;--M){const w=h[M],I=s(w),E=I.n;let j=!1;for(const F of I.d.keys())if(F!==w&&C.has(F)){j=!0;break}j&&(i(m,w,P),g(m,w,I),E!==I.n&&(et(m,w,I),C.add(w))),b.delete(w)}},l=(m,d,...p)=>{const h=C=>je(i(m,C)),b=(C,...P)=>{let M;if(It(d,C)){if(!qe(C))throw new Error("atom not writable");const w=s(C),I="v"in w,E=w.v,j=P[0];n(C,w,j),g(m,C,w),(!I||!Object.is(E,w.v))&&(et(m,C,w),c(m,C))}else M=l(m,C,...P);return te(m),M};return d.write(h,b,...p)},f=(m,...d)=>{const p=re(),h=l(p,m,...d);return te(p),h},g=(m,d,p)=>{if(p.m&&!Re(p)){for(const h of p.d.keys())p.m.d.has(h)||(v(m,h).t.add(d),p.m.d.add(h));for(const h of p.m.d||[])if(!p.d.has(h)){const b=y(m,h);b?.t.delete(d),p.m.d.delete(h)}}},v=(m,d)=>{const p=s(d);if(!p.m){i(m,d);for(const h of p.d.keys())v(m,h).t.add(d);if(p.m={l:new Set,d:new Set(p.d.keys()),t:new Set},(G?"production":void 0)!=="production"&&e.add(d),Qe(d)&&d.onMount){const h=p.m,{onMount:b}=d;Lt(m,()=>{const S=b((...C)=>l(m,d,...C));S&&(h.u=S)})}}return p.m},y=(m,d)=>{const p=s(d);if(p.m&&!p.m.l.size&&!Array.from(p.m.t).some(h=>s(h).m)){const h=p.m.u;h&&Lt(m,h),delete p.m,(G?"production":void 0)!=="production"&&e.delete(d);for(const S of p.d.keys()){const C=y(m,S);C?.t.delete(d)}const b=Re(p);b&&b[ye](void 0,()=>{});return}return p.m},x=(m,d)=>{const p=re(),h=v(p,m);te(p);const b=h.l;return b.add(d),()=>{b.delete(d);const S=re();y(S,m),te(S)}};return(G?"production":void 0)!=="production"?{get:r,set:f,sub:x,dev4_get_internal_weak_map:()=>t,dev4_get_mounted_atoms:()=>e,dev4_restore_atoms:d=>{const p=re();for(const[h,b]of d)if(qe(h)){const S=s(h),C="v"in S,P=S.v;n(h,S,b),g(p,h,S),(!C||!Object.is(P,S.v))&&(et(p,h,S),c(p,h))}te(p)}}:{get:r,set:f,sub:x}};let me;const Fo=()=>(me||(me=ft(),(G?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=me),globalThis.__JOTAI_DEFAULT_STORE__!==me&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),me),ws=u.createContext(void 0),Do=t=>u.useContext(ws)||Fo(),Vo=({children:t,store:e})=>{const s=u.useRef();return!e&&!s.current&&(s.current=ft()),u.createElement(ws.Provider,{value:e||s.current},t)},Bo=t=>typeof t?.then=="function",Go=wn.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)});function $o(t,e){const s=Do(),[[n,o,i],r]=u.useReducer(f=>{const g=s.get(t);return Object.is(f[0],g)&&f[1]===s&&f[2]===t?f:[g,s,t]},void 0,()=>[s.get(t),s,t]);let c=n;return(o!==s||i!==t)&&(r(),c=s.get(t)),u.useEffect(()=>{const f=s.sub(t,()=>{r()});return r(),f},[s,t,void 0]),u.useDebugValue(c),Bo(c)?Go(c):c}const xs="@open-pioneer/spatial-bookmarks",Ho=Te.bind(void 0,xs),Uo=Y.bind(void 0,xs),X=ie("spatial-bookmark:SpatialBookmarkViewModel");class zo{map;packageNamespace;writableBookmarks=_o([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,s){this.map=e,this.packageNamespace=s.getNamespace("spatial-bookmarks"),this.store=ft(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const s=this.map.olMap,n=s.getView().calculateExtent(),o=s.getView().getProjection().getCode(),i={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},r={id:Zt(),title:e,extent:i,projection:o};X.debug("Created a new bookmark",r);const c=this.writableBookmarks;this.store.set(c,[...this.store.get(c),r])}activateBookmark(e){X.debug("Activating bookmark",e);const s=this.getBookmarkExtent(e);X.debug("Attempting to apply extent",s),this.applyExtent(s)}deleteBookmark(e){X.debug("Deleting bookmark",e);const s=this.writableBookmarks;this.store.set(s,[...this.store.get(s).filter(n=>n.id!==e)])}deleteAllBookmarks(){X.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){X.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{Ko(e),this.store.set(this.writableBookmarks,e)}catch(s){X.error("Bookmarks data in local storage is invalid, resetting to default value.",s),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){X.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const n=this.map.olMap.getView(),o=e.extent,i=[o.minX,o.minY,o.maxX,o.maxY],r=n.getProjection(),c=e.projection;return ln(i,c,r)}applyExtent(e){const n=this.map.olMap.getView(),o=un(e),i=n.getResolutionForExtent(e);n.setCenter(o),n.setResolution(i)}}function Ko(t){if(!Array.isArray(t))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of t)Wo(e)}function Wo(t){if(!t||typeof t!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=t;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(Yo(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function Yo(t){if(!t||typeof t!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=t;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const Fr=t=>{const{map:e}=V(t.mapId),s=Ho("local-storage.LocalStorageService"),n=ti(e,s);return n&&a.jsx(Vo,{store:n.store,children:a.jsx(Zo,{...t,viewModel:n})})};function Zo(t){const{viewModel:e}=t,s=Uo(),n=u.useRef([]),[o,i]=u.useState(!1),r=$o(e.bookmarks),[c,l]=u.useState(""),f=c.trim().length>0,{containerProps:g}=D("spatial-bookmarks",t),[v,y]=u.useState("list"),x=()=>{e.deleteAllBookmarks(),y("list")},m=()=>{f&&(e.createBookmark(c),y("list"),l(""),i(!0))};u.useEffect(()=>{if(o){const S=n.current;S&&S[r.length-1]?.scrollIntoView?.(),i(!1)}},[r,o]);const d=()=>a.jsxs(nt,{children:[a.jsxs(Ze,{rounded:"md",status:"warning",children:[a.jsx(Xe,{}),s.formatMessage({id:"bookmark.alert.delete"})]}),a.jsx(Qo,{intl:s,onClear:x,onCancel:()=>y("list")})]}),p=()=>a.jsxs(nt,{children:[a.jsxs(Ze,{rounded:"md",status:"info",children:[a.jsx(Xe,{}),s.formatMessage({id:"bookmark.alert.create"})]}),a.jsx(ze,{"aria-label":s.formatMessage({id:"bookmark.input.label"}),placeholder:s.formatMessage({id:"bookmark.input.placeholder"}),value:c,onChange:S=>{l(S.target.value)},onKeyDown:S=>{S.key==="Enter"&&m()},isRequired:!0,isInvalid:!f,autoFocus:!0}),a.jsx(ei,{intl:s,isInvalid:!f,onCancel:()=>{l(""),y("list")},onSave:m})]}),h=()=>a.jsxs(a.Fragment,{children:[r.length?Xo(r,e,s,n):a.jsxs(Ze,{rounded:"md",status:"info",children:[a.jsx(Xe,{}),s.formatMessage({id:"bookmark.alert.noSaved"})]}),a.jsx(qo,{intl:s,bookmarks:r,showCreate:()=>y("create"),showDelete:()=>y("delete")})]}),b=a.jsxs(a.Fragment,{children:[v==="list"&&h(),v==="create"&&p(),v==="delete"&&d()]});return a.jsx(we,{flexDirection:"column",...g,children:b})}function Xo(t,e,s,n){const o=s.formatMessage({id:"bookmark.button.deleteOne"}),i=t.map((r,c)=>a.jsx(Jo,{index:c,listItemNodes:n,bookmark:r,onActivate:()=>e.activateBookmark(r),onDelete:()=>e.deleteBookmark(r.id),deleteBtnLabel:o},r.id));return a.jsx(as,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":s.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:i})}const Nt={ArrowDown:1,ArrowUp:-1};function Jo(t){const{index:e,listItemNodes:s,bookmark:n,onDelete:o,onActivate:i,deleteBtnLabel:r}=t,c=n.title,l=f=>{const g=f.key;if(g==="Enter"){f.target===f.currentTarget&&i();return}if(Nt[g]!=null){const v=s.current?.length;if(!v)return;let y=(e+Nt[g])%v;y<0&&(y=v-1),s.current[y]?.focus()}};return a.jsx(R,{as:"li",p:1,ref:f=>{if(!f){s.current.splice(e,1);return}s.current[e]=f},className:Le("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:l,onClick:i,children:a.jsxs(we,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[a.jsx(hs,{children:a.jsx(In,{})}),a.jsx(ee,{ps:2,noOfLines:1,children:c}),a.jsx(An,{}),a.jsx(os,{hasArrow:!0,label:r,placement:"right",children:a.jsx(Ue,{className:"spatial-bookmarks-item-delete","aria-label":r,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:a.jsx(cs,{}),onClick:f=>{o(),f.stopPropagation()}})},e)]})})}function qo(t){const{intl:e,bookmarks:s,showCreate:n,showDelete:o}=t;return a.jsxs(gt,{children:[a.jsx(pe,{isDisabled:s.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:a.jsx(cs,{}),onClick:o,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),a.jsx(pe,{onClick:n,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function Qo(t){const{intl:e,onCancel:s,onClear:n}=t;return a.jsxs(gt,{children:[a.jsx(pe,{variant:"outline",onClick:s,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),a.jsx(pe,{onClick:n,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function ei(t){const{intl:e,onCancel:s,onSave:n,isInvalid:o}=t;return a.jsxs(gt,{children:[a.jsx(pe,{variant:"outline",onClick:()=>s(),children:e.formatMessage({id:"bookmark.button.cancel"})}),a.jsx(pe,{isDisabled:o,onClick:()=>n(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function gt(t){return a.jsx(we,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:t.children})}function pe(t){return a.jsx(Ue,{width:"100%",...t})}function ti(t,e){const[s,n]=u.useState();return u.useEffect(()=>{let o;return t?o=new zo(t,e):o=void 0,n(o),()=>o?.destroy()},[t,e]),s}const Ss="@open-pioneer/printing",Ot=Te.bind(void 0,Ss),si=Y.bind(void 0,Ss),ni="map";class oi{olMap;title="";fileFormat="pdf";i18n;printingService;viewPadding;printMap=void 0;overlay=void 0;constructor(e,s,n){this.olMap=e,this.printingService=s,this.i18n=n}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}setViewPadding(e){this.viewPadding=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1,viewPadding:this.viewPadding});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=kn(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",s=this.title||ni;return{title:e,fileName:s}}async exportMapInPNG(e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height+50,s.style.backgroundColor="#fff";const n=s.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:o,fileName:i}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,s.width,s.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const r=s.width/2;n.fillText(o,r,20),n.drawImage(e,0,50);const c=document.createElement("a");c.setAttribute("download",i+".png");const l=Mn(s);if(!l)throw new Error("Failed to get image data URL");c.href=l,c.click()}async exportMapInPDF(e){const{jsPDF:s}=await Tn(async()=>{const{jsPDF:p}=await import("./BxxsUwimoiOf.js");return{jsPDF:p}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),n=new s({orientation:"landscape",unit:"mm",format:"a4"}),o=n.internal.pageSize.getWidth(),i=n.internal.pageSize.getHeight(),r=15,c=20,l=i-c;n.setFontSize(20);const{title:f,fileName:g}=this.getTitleAndFileName();n.text(f,o/2,r,{align:"center"});const v=e.width/e.height;let y=l,x=y*v;x>=o&&(x=o,y=x/v);const m=(o-x)/2,d=c+(l-y)/2;n.addImage(e,"",m,d,x,y),n.save(g+".pdf")}}const ii=ie("printing"),Dr=t=>{const e=si(),{mapId:s,viewPadding:n="auto"}=t,{containerProps:o}=D("printing",t),[i,r]=u.useState("pdf"),[c,l]=u.useState(""),[f,g]=u.useState(!1),v=Ot("printing.PrintingService"),y=Ot("notifier.NotificationService"),{map:x}=V(s),m=ri(x,e,v,n);u.useEffect(()=>{m?.setFileFormat(i)},[m,i]),u.useEffect(()=>{m?.setTitle(c)},[m,c]);function d(h){(h==="png"||h==="pdf")&&r(h)}function p(){f||!m||(g(!0),m.handleMapExport().catch(h=>{const b=e.formatMessage({id:"printingFailed"});y.notify({level:"error",message:b}),ii.error("Failed to print the map",h)}).finally(()=>{g(!1)}))}return a.jsxs(R,{...o,children:[a.jsxs(De,{mb:4,alignItems:"center",children:[a.jsxs(ot,{mb:2,children:[a.jsx(Se,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),a.jsx(ze,{placeholder:e.formatMessage({id:"input.placeholder"}),value:c,onChange:h=>{l(h.target.value)},autoFocus:!0})]}),a.jsxs(ot,{mb:2,children:[a.jsx(Se,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),a.jsxs(ct,{value:i,onChange:h=>d(h.target.value),className:"printing-select",children:[a.jsx("option",{value:"png",children:"PNG"}),a.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),a.jsx(Ue,{isLoading:f,loadingText:e.formatMessage({id:"printingMap"}),disabled:f,padding:2,className:"printing-export-button",onClick:p,width:"100%",children:e.formatMessage({id:"export"})})]})};function ri(t,e,s,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!t)return;const r=new oi(t.olMap,s,{overlayText:e.formatMessage({id:"printingMap"})});return i(r),()=>{r.destroy(),i(void 0)}},[t,e,s]),u.useEffect(()=>{o?.setViewPadding(n)},[o,n]),o}const ai="@open-pioneer/legend",Cs=Y.bind(void 0,ai),Vr=t=>{const{mapId:e,showBaseLayers:s=!1}=t,{containerProps:n}=D("legend",t),{map:o}=V(e);return a.jsx(R,{...n,children:o?a.jsx(ci,{map:o,showBaseLayers:s}):null})};function ci(t){const{map:e,showBaseLayers:s}=t,o=di(e).map(i=>a.jsx(Es,{layer:i,showBaseLayers:s},i.id));return a.jsx(as,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:o})}function Es(t){const{layer:e,showBaseLayers:s}=t,{isVisible:n}=fi(e),o=hi(e);if(!n||!s&&!("parentLayer"in e)&&e.isBaseLayer)return;const i=[];return o?.length&&o.forEach(r=>{i.push(a.jsx(Es,{layer:r,showBaseLayers:s},r.id))}),a.jsxs(a.Fragment,{children:[a.jsx(li,{layer:e,showBaseLayers:s}),i]})}function li(t){const e=Cs(),{layer:s,showBaseLayers:n}=t,o=gi(s),i=ui(s);let r;o?.Component?r=a.jsx(o.Component,{layer:s}):o?.imageUrl?r=a.jsx(jt,{layer:s,imageUrl:o.imageUrl}):i&&(r=a.jsx(jt,{layer:s,imageUrl:i}));const c=!("parentLayer"in s)&&s.isBaseLayer;return r?a.jsxs(R,{as:"li",className:Le("legend-item",`layer-${pi(s.id)}`),children:[n&&c?a.jsx(ee,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,r]}):void 0}function jt(t){const e=Cs(),{layer:s,imageUrl:n}=t;return a.jsxs(R,{children:[a.jsx(ee,{children:s.title}),a.jsx(_n,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:s.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:a.jsx(R,{children:a.jsxs(ee,{children:[a.jsx(ys,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function ui(t){const e=u.useCallback(()=>t.legend,[t]),s=u.useCallback(n=>{const o=t.on("changed:legend",n);return()=>o.destroy()},[t]);return u.useSyncExternalStore(s,e)}function di(t){const e=u.useCallback(n=>{const o=t.layers.on("changed",n);return()=>o.destroy()},[t]),s=u.useCallback(()=>{let n=t.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[t]);return ks(e,s)}function hi(t){const e=u.useCallback(n=>{const o=t.sublayers?.on("changed",n);return()=>o?.destroy()},[t]),s=u.useCallback(()=>{if(!t.sublayers)return;let o=t.sublayers?.getSublayers({sortByDisplayOrder:!0});return o=o.reverse(),o},[t]);return ks(e,s)}function ks(t,e){const s=u.useRef(),n=u.useCallback(i=>{const r=t(()=>{s.current=void 0,i()});return()=>{s.current=void 0,r()}},[t]),o=u.useCallback(()=>{if(s.current)return s.current.value;const i=e();return s.current={value:i},i},[e]);return u.useSyncExternalStore(n,o)}function fi(t){const e=u.useCallback(()=>t.visible,[t]),s=u.useCallback(o=>{const i=t.on("changed:visible",o);return()=>i.destroy()},[t]);return{isVisible:u.useSyncExternalStore(s,e)}}function gi(t){const[e,s]=u.useState(void 0);return u.useEffect(()=>{s(t.attributes.legend);const n=t.on("changed:attributes",()=>{s(t.attributes.legend)});return()=>n.destroy()},[t]),e}function pi(t){return t.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}const Ms="@open-pioneer/geolocation",mi=Te.bind(void 0,Ms),vi=Y.bind(void 0,Ms);function bi(t){return Nn({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"},child:[]}]})(t)}const Rt=ie("geolocation:GeolocationController"),Ft=17;class yi extends Yt{olMap;positionHighlightLayer;geolocation;maxZoom=Ft;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,s){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Et,this.accuracyFeature.setStyle(Vt()),this.positionFeature=new Et,this.positionFeature.setStyle(Dt()),this.positionHighlightLayer=new Xt({source:new Jt({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(qt);const n=s||wi();this.geolocation=new $n({tracking:!1,trackingOptions:n,projection:e.getView()?.getProjection()}),this.trackingOptions=n,this.geolocation.on("error",o=>this.handleGeolocationError(o))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(n=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const o=this.geolocation.on("change:accuracyGeometry",()=>{const l=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(l),this.accuracyFeature?.getGeometry()!==void 0&&n(),this.isInitialZoom){const f=this?.accuracyFeature?.getGeometry()?.getExtent();if(f){const g=to(f);if(!g)return;e.getView().fit(g,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),i=this.geolocation.on("change:position",()=>{const l=this.geolocation.getPosition();l&&(l[0]||l[1])!==void 0&&(this.positionFeature?.setGeometry(new st(l)),this.setMapToPosition&&e.getView().setCenter(l),this.positionFeature?.getGeometry()!==void 0&&n())}),r=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),c=e.on("pointermove",l=>{l.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(o,i,r,c),e.addLayer(this.positionHighlightLayer)}).catch(n=>{Rt.error("Failed to determine location",n)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{Q(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??Dt())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??Vt())}setMaxZoom(e){this.maxZoom=e??Ft}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){Rt.error("Error from geolocation API:",e.message);const s=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",s)}}const Dt=()=>new fe({image:new Qt({radius:6,fill:new xe({color:"#3399CC"}),stroke:new ne({color:"#fff",width:2})})}),Vt=()=>new fe({stroke:new ne({color:"#3399CC",width:3}),fill:new xe({color:"rgba(0, 0, 255, 0.05)"})}),wi=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),Br=u.forwardRef(function(e,s){const{mapId:n,maxZoom:o,positionFeatureStyle:i,accuracyFeatureStyle:r,trackingOptions:c}=e,{containerProps:l}=D("geolocation",e),f=!!navigator.geolocation,[g,v]=u.useState(!1),[y,x]=u.useState(!1),{map:m}=V(n),d=vi(),p=mi("notifier.NotificationService"),h=xi(m,o,c,i,r),b=f?g?d.formatMessage({id:"locateMeEnd"}):d.formatMessage({id:"locateMeStart"}):d.formatMessage({id:"locateNotSupported"});u.useEffect(()=>{if(h===void 0)return;const C=h.on("error",function(P){const M=d.formatMessage({id:"error"}),w=(()=>{switch(P){case"permission-denied":return d.formatMessage({id:"permissionDenied"});case"position-unavailable":return d.formatMessage({id:"positionUnavailable"});case"timeout":return d.formatMessage({id:"timeout"});case"unknown":return d.formatMessage({id:"unknownError"})}})();x(!1),v(!1),p.notify({level:"error",title:M,message:w})});return()=>{C.destroy()}},[h,d,p]),u.useEffect(()=>{if(!h){x(!1);return}return g&&(x(!0),h.startGeolocation().then(()=>{x(!1)})),()=>{h?.stopGeolocation(),x(!1)}},[h,g]);const S=()=>{m&&v(!g)};return a.jsx(Ln,{ref:s,label:b,icon:a.jsx(bi,{}),onClick:()=>S(),isActive:g,isLoading:y,isDisabled:!f,...l})});function xi(t,e,s,n,o){const[i,r]=u.useState();return u.useEffect(()=>{if(!t)return;const c=new yi(t.olMap,s);return r(c),()=>{c.destroy(),r(void 0)}},[t,s]),u.useEffect(()=>{i?.setPositionFeatureStyle(n)},[i,n]),u.useEffect(()=>{i?.setAccuracyFeatureStyle(o)},[i,o]),u.useEffect(()=>{i?.setMaxZoom(e)},[i,e]),i}const Si="@open-pioneer/measurement",Ci=Y.bind(void 0,Si);class Ei{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,s){this.olMap=e,this.messages=s;const n=this.source=new Jt;this.layer=new Xt({source:n}),this.layer.setZIndex(qt),e.addLayer(this.layer);const o=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){Q(o)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const s=dn(e);this.activeFeatureStyle=(n,...o)=>{const i=n?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return s(n,...o)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const s=e==="area"?"Polygon":"LineString",n=this.draw=new Pn({source:this.source,type:s,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let o,i;n.on("drawstart",r=>{o=this.measureTooltip=this.createMeasureTooltip();const c=this.sketch=r.feature;if(!c)return;let l;i=c.getGeometry()?.on("change",f=>{const g=f.target,v=this.olMap.getView().getProjection();let y="";g instanceof es?(y=Mi(g,v,this.messages),l=g.getInteriorPoint().getCoordinates()||null):g instanceof ds&&(y=_i(g,v,this.messages),l=g.getLastCoordinate()||null),o&&(o.element.innerHTML=y,l&&o?.overlay.setPosition(l))})}),n.on("drawend",()=>{if(o){const r=o.element.classList;r.remove("measurement-active-tooltip"),r.remove("printing-hide"),r.add("measurement-finished-tooltip"),o.overlay.setOffset([0,-7]),this.overlayTooltips.push(o),this.measureTooltip=o=void 0}this.sketch=void 0,i&&Q(i)}),n.on("drawabort",()=>{o&&(o.destroy(),this.measureTooltip=o=void 0),this.sketch=void 0,i&&Q(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const s=new Ve({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n=this.olMap;return n.addOverlay(s),{overlay:s,element:e,destroy(){n.removeOverlay(s)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const s=new Ve({element:e,offset:[15,0],positioning:"center-left"}),n=this.olMap;return n.addOverlay(s),{overlay:s,element:e,destroy(){n.removeOverlay(s)}}}handlePointerMove(e){if(e.dragging)return;const s=this.helpTooltip,n=ki(this.messages,this.sketch);s.element.textContent=n,s.overlay.setPosition(e.coordinate),s.element.classList.remove("hidden")}}function ki(t,e){if(e){const s=e.getGeometry();if(s instanceof es||s instanceof ds)return t.getContinueMessage()}return t.getHelpMessage()}function Mi(t,e,s){const n=hn(t,{projection:e});let o;return n>=1e6?o=`${s.formatNumber(n/1e6)} km<sup>2</sup>`:o=`${s.formatNumber(n)} m<sup>2</sup>`,o}function _i(t,e,s){const n=fn(t,{projection:e});let o;return n>=1e3?o=`${s.formatNumber(n/1e3)} km`:o=`${s.formatNumber(n)} m`,o}const Gr=t=>{const e=Ci(),{mapId:s,activeFeatureStyle:n,finishedFeatureStyle:o}=t,{containerProps:i}=D("measurement",t),[r,c]=u.useState("distance"),l=x=>e.formatMessage({id:x}),f=V(s),g=Pi(f.map,e);u.useEffect(()=>{g?.setActiveFeatureStyle(n??Ii())},[g,n]),u.useEffect(()=>{g?.setFinishedFeatureStyle(o??Ai())},[g,o]),u.useEffect(()=>{if(g)return g.startMeasurement(r),()=>{g.stopMeasurement()}},[g,r]);function v(x){if(x==="distance"||x==="area")c(x);else throw new Error(`Unexpected measurement type: '${x}'.`)}function y(){g?.clearMeasurements()}return a.jsxs(R,{...i,children:[a.jsx(ee,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),a.jsx(De,{mb:4,alignItems:"center",children:a.jsxs(ot,{mb:2,children:[a.jsx(Se,{mb:1,children:l("measurementLabel")}),a.jsxs(ct,{value:r,onChange:x=>v(x.target.value),className:"measurement-select",children:[a.jsx("option",{value:"distance",children:l("distance")}),a.jsx("option",{value:"area",children:l("area")})]})]})}),a.jsx(Ue,{padding:2,className:"measurement-delete-button",onClick:y,width:"100%",children:l("deleteMeasurementLabel")})]})};function Pi(t,e){const[s,n]=u.useState(void 0);return u.useEffect(()=>{if(!t)return;const o=new Ei(t.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(i){return e.formatNumber(i,{maximumFractionDigits:2})}});return n(o),()=>{o.destroy(),n(void 0)}},[t,e]),s}function Ii(){return[new fe({stroke:new ne({color:"#fff",lineDash:[10,10],width:5})}),new fe({fill:new xe({color:"rgba(0,0,0,0.15)"}),stroke:new ne({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new Qt({radius:5,stroke:new ne({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new xe({color:"rgba(255, 255, 255, 0.2)"})})})]}function Ai(){return[new fe({stroke:new ne({color:"#fff",width:5})}),new fe({stroke:new ne({color:"#0b96fc",width:3}),fill:new xe({color:"rgba(11,150,252,0.15)"})})]}const Ti="200px",Li="300px",$r=t=>{const{mapId:e,olLayer:s,height:n=Ti,width:o=Li}=t,{containerProps:i}=D("overview-map",t),r=u.useRef(null),{map:c}=V(e);return u.useEffect(()=>{if(r.current&&c&&s){const l=c.olMap,f=new oo({className:"ol-overviewmap",layers:[s],collapsible:!1,collapsed:!1,target:r.current});return l.addControl(f),()=>{l.removeControl(f)}}},[c,s]),a.jsx(R,{height:n,width:o,ref:r,...i})},Ni="@open-pioneer/search",Ke=Y.bind(void 0,Ni);function Oi(t){const e=t.selectProps.inputValue.length>0,s={...t,className:Le(t.className,{"search-invisible":!e})};return a.jsx(Z.Menu,{...s,children:t.children})}function ji(t){const s=Ke().formatMessage({id:"noOptionsText"});return a.jsx(Z.NoOptionsMessage,{...t,children:a.jsx(B.span,{className:"search-no-match",children:s})})}function Ri(t){const s=Ke().formatMessage({id:"loadingText"});return a.jsx(Z.LoadingMessage,{...t,children:a.jsx(B.span,{className:"search-loading-text",children:s})})}function Fi({children:t,...e}){const s={...e,className:Le(e.className,"search-value-container")};return a.jsxs(Z.ValueContainer,{...s,children:[!!t&&a.jsx(So,{style:{position:"absolute",left:8}}),t]})}function Di(t){const e={...t,isHidden:!1};return a.jsx(Z.Input,{...e})}function Vi(t){return null}function Bi(t){return a.jsxs(Z.IndicatorsContainer,{...t,children:[t.children,!t.selectProps.isLoading&&t.selectProps.inputValue&&a.jsx(Gi,{selectProps:t.selectProps,clearValue:t.clearValue})]})}function Gi(t){const s=Ke().formatMessage({id:"ariaLabel.clearButton"}),n=o=>{o.preventDefault(),o.stopPropagation(),t.clearValue()};return a.jsx(xn,{role:"button",size:"md",mr:1,"aria-label":s,onClick:n,onTouchEnd:n,onMouseDown:o=>o.preventDefault()})}function $i(t){return null}function Hi(t){const e=t.selectProps.inputValue,s=t.data.label,n={...t,className:Le(t.className,"search-option")};return a.jsx(Z.Option,{...n,children:a.jsx(B.div,{className:"search-option-label",children:e.trim().length>0?Ui(s,e):s})})}function Ui(t,e){const s=t.toLowerCase().indexOf(e.toLowerCase());return s>=0?a.jsxs(a.Fragment,{children:[t.substring(0,s),a.jsx(B.span,{className:"search-highlighted-match",children:t.substring(s,s+e.length)},"highlighted"),t.substring(s+e.length)]}):t}const Bt=ie("search:SearchController"),Gt=200,$t=5;var _e,ue,de,he,U,Ge,_s;class zi{constructor(e,s){A(this,Ge);A(this,_e);A(this,ue,[]);A(this,de,$t);A(this,he,Gt);A(this,U);_(this,_e,e),_(this,ue,s)}destroy(){k(this,U)?.abort(),_(this,U,void 0)}async search(e){if(k(this,U)?.abort(),_(this,U,void 0),!e)return[];const s=_(this,U,new AbortController);try{return await Ki(s.signal,k(this,he)),s.signal.aborted&&(Bt.debug(`search canceled with ${e}`),Sn()),(await Promise.all(k(this,ue).map(o=>N(this,Ge,_s).call(this,o,e,s.signal)))).filter(o=>o!=null)}finally{k(this,U)===s&&_(this,U,void 0)}}get searchTypingDelay(){return k(this,he)}set searchTypingDelay(e){_(this,he,e??Gt)}get maxResultsPerSource(){return k(this,de)}set maxResultsPerSource(e){_(this,de,e??$t)}get sources(){return k(this,ue)}}_e=new WeakMap,ue=new WeakMap,de=new WeakMap,he=new WeakMap,U=new WeakMap,Ge=new WeakSet,_s=async function(e,s,n){const o=e.label,i=k(this,_e).olMap.getView().getProjection();try{const r=k(this,de);let c=await e.search(s,{maxResults:r,signal:n,mapProjection:i});return c.length>r&&(c=c.slice(0,r)),{label:o,source:e,results:c}}catch(r){is(r)||Bt.error(`search for source ${o} failed`,r);return}};async function Ki(t,e){t.aborted||await new Promise(s=>{const n=()=>{t.removeEventListener("abort",n),clearTimeout(o),s()};t.addEventListener("abort",n);const o=setTimeout(n,e)})}const Be=ie("search:Search"),Hr=t=>{const{mapId:e,sources:s,searchTypingDelay:n,maxResultsPerGroup:o,onSelect:i,onClear:r}=t,{containerProps:c}=D("search",t),{map:l}=V(e),f=Ke(),g=Xi(s,n,o,l),{input:v,search:y,selectedOption:x,onInputChanged:m,onResultConfirmed:d}=Ji(g),p=Zi(),h=Wi(f),b=Yi(),S=W((M,w)=>{w.action==="input-change"&&m(M)}),C=W((M,w)=>{switch(w.action){case"select-option":M&&(d(M),i?.({source:M.source,result:M.result}));break;case"clear":m(""),P.current?.blur(),P.current?.focus(),r?.();break;default:Be.debug(`Unhandled action type '${w.action}'.`);break}}),P=u.useRef(null);return a.jsx(R,{...c,children:a.jsx(it,{className:"search-component",classNamePrefix:"react-select",ref:P,inputValue:v,onInputChange:S,"aria-label":f.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:h,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:p,isClearable:!0,placeholder:f.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:y.kind==="loading",options:y.kind==="ready"?y.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:b,onChange:C,value:x,menuPosition:"fixed"})})};function Wi(t){return u.useMemo(()=>({onFocus:({focused:i})=>`${i.label} ${t.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:i,label:r})=>{let c="";switch(i){case"select-option":c=`${r} ${t.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":c=`${r} ${t.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return c},guidance:()=>`${t.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[t])}function Yi(){return u.useMemo(()=>({Menu:Oi,Input:Di,SingleValue:Vi,Option:Hi,NoOptionsMessage:ji,LoadingMessage:Ri,ValueContainer:Fi,IndicatorsContainer:Bi,ClearIndicator:$i}),[])}function Zi(){const[t,e]=rs("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return u.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:t,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[t,e])}function Xi(t,e,s,n){const[o,i]=u.useState(void 0);return u.useEffect(()=>{if(!n)return;const r=new zi(n,t);return i(r),()=>{r.destroy(),i(void 0)}},[n,t]),u.useEffect(()=>{o&&(o.searchTypingDelay=e)},[o,e]),u.useEffect(()=>{o&&(o.maxResultsPerSource=s)},[o,s]),o}function Ji(t){const[e,s]=u.useReducer((c,l)=>{switch(l.kind){case"input":return{...c,query:l.query,selectedOption:null};case"select-option":return{...c,selectedOption:l.option,query:l.option.label};case"load-results":return{...c,search:{kind:"loading"}};case"accept-results":return{...c,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=u.useRef(),o=W(c=>{if(!t){n.current=void 0,s({kind:"accept-results",results:[]});return}Be.isDebug()&&Be.debug(`Starting new search for query ${JSON.stringify(c)}.`),s({kind:"load-results"});const l=n.current=qi(t,c).then(f=>{n.current===l&&s({kind:"accept-results",results:f})})}),i=u.useCallback(c=>{s({kind:"select-option",option:c})},[]),r=u.useCallback(c=>{s({kind:"input",query:c}),o(c)},[o]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:i,onInputChanged:r}}async function qi(t,e){let s;try{s=await t.search(e)}catch(n){is(n)||Be.error("Search failed",n),s=[]}return Qi(s)}function Qi(t){return t.map((s,n)=>({label:s.label,options:s.results.map(o=>({value:`${n}-${o.id}`,label:o.label,source:s.source,result:o}))}))}const Ps="@open-pioneer/selection",er=Te.bind(void 0,Ps),pt=Y.bind(void 0,Ps),ve="selection-active",Fe="selection-inactive";class tr{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,s,n,o,i){let r;switch(s){case mt.extent:default:r=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,i,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=o}initViewport(e){const s=e.getViewport();return s.classList.add(ve),s.oncontextmenu=n=>(n.preventDefault(),!1),s}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const s=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipMessage,s.classList.remove(Fe),s.classList.add(ve),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,s.classList.remove(ve),s.classList.add(Fe),this.isActive=!1)}createDragBox(e,s,n,o){const i=new kt({className:"selection-drag-box",condition:gn});return e.addInteraction(i),i.on("boxend",function(){s(i.getGeometry())}),{interaction:i,destroy(){e.removeInteraction(i),o.splice(o.indexOf(this)),i.dispose(),n.classList.remove(ve),n.classList.remove(Fe),n.oncontextmenu=null}}}createDrag(e,s,n){const o=function(c){return c.originalEvent.button==2},i=new Mt({condition:o});return e.addInteraction(i),{interaction:i,destroy(){e.removeInteraction(i),n.splice(n.indexOf(this)),i.dispose(),s.classList.remove(ve),s.classList.remove(Fe),s.oncontextmenu=null}}}createHelpTooltip(e,s){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.textContent=s;const o=new Ve({element:n,offset:[15,0],positioning:"center-left"}),i=e.on("pointermove",r=>{o.setPosition(r.coordinate)});return e.addOverlay(o),{overlay:o,element:n,destroy(){e.removeOverlay(o),o.dispose(),Q(i)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof kt)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Mt)}}const tt=ie("selection:SelectionController"),sr=1e4;var Pe,Ie,Ae,$e,Is;class nr{constructor(e){A(this,$e);A(this,Pe);A(this,Ie);A(this,Ae);const{mapModel:s,onError:n,maxResults:o=sr}=e;_(this,Pe,s),_(this,Ie,o),_(this,Ae,n)}destroy(){}async select(e,s){if(s)return await N(this,$e,Is).call(this,e,s)}}Pe=new WeakMap,Ie=new WeakMap,Ae=new WeakMap,$e=new WeakSet,Is=async function(e,s){const n=k(this,Pe).olMap.getView().getProjection();try{tt.debug(`Starting selection on source '${e.label}'`);const o=k(this,Ie);let i=await e.select({type:"extent",extent:s},{maxResults:o,mapProjection:n,signal:new AbortController().signal});return i.length>o&&(i=i.slice(0,o)),tt.debug(`Found ${i.length} results on source '${e.label}'`),{source:e,results:i}}catch(o){tt.error(`selection from source ${e.label} failed`,o),k(this,Ae).call(this);return}};var mt=(t=>(t.extent="EXTENT",t.polygon="POLYGON",t.free="FREEPOLYGON",t.circle="CIRCLE",t))(mt||{});const Ht={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},Ur=t=>{const e=pt(),{mapId:s,sources:n,onSelectionComplete:o,onSelectionSourceChanged:i}=t,{containerProps:r}=D("selection",t),[c,l]=u.useState(()=>n.find(E=>(E.status??"available")==="available")),f=V(s),{onExtentSelected:g}=rr(f.map,n,c,o),v=lr(),[y,x]=u.useState(!1),d=u.useCallback(E=>{const j=[];if(E||(E=["EXTENT"]),E.forEach(F=>{Object.values(mt).includes(F)&&j.push({label:e.formatMessage({id:F}),value:F})}),j.length===0)throw new Error("methods does not contain valid values");return j},[e])(void 0),[p,h]=u.useState(d[0]),b=W(E=>{h(E)}),[S,C]=u.useState(!0);cr(f.map,p,e,g,S);const P=u.useMemo(()=>n.map(E=>({label:E.label,value:E})),[n]),M=u.useMemo(()=>P.find(E=>E.value===c),[P,c]),w=W(E=>{l(E?.value),i&&i({source:E?.value})});u.useEffect(()=>{if(!c){C(!1);return}const E=e.formatMessage({id:"sourceNotAvailable"}),j=()=>c&&at(c,E).kind==="available";C(j());const F=c.on("changed:status",()=>{C(j())});return()=>F.destroy()},[c,C,e]);const I=W(E=>{!y&&E.key==="Enter"&&x(!0)});return a.jsxs(nt,{...r,spacing:2,children:[d.length>1&&a.jsxs(De,{children:[a.jsx(Se,{children:e.formatMessage({id:"selectMethod"})}),a.jsx(it,{className:"selection-method react-select",...Ht,options:d,onChange:b,value:p,chakraStyles:v})]}),a.jsxs(De,{children:[a.jsx(Se,{children:e.formatMessage({id:"selectSource"})}),a.jsx(it,{className:"selection-source react-select",...Ht,options:P,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:M,onChange:w,components:{Option:or,SingleValue:ir},isOptionDisabled:E=>E.value===void 0||E.value.status==="unavailable",getOptionLabel:E=>E.label+(E.value===void 0||E.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:v,onKeyDown:I,menuIsOpen:y,onMenuOpen:()=>x(!0),onMenuClose:()=>x(!1)})]})]})};function or(t){const{value:e}=t.data,{isAvailable:s,content:n}=As(e,!1);return a.jsx(Z.Option,{...t,isDisabled:!s,className:"selection-source-option",children:n})}function ir(t){const{value:e}=t.data,{isAvailable:s,content:n}=As(e,!0),o=s?"selection-source-value":"selection-source-value selection-source-value--disabled";return a.jsx(Z.SingleValue,{...t,isDisabled:!s,className:o,children:n})}function As(t,e){const s=t?.label,n=ar(t);return{isAvailable:n.kind==="available",content:a.jsxs(we,{direction:"row",alignItems:"center",grow:1,children:[!e&&a.jsx(we,{grow:1,children:s}),n.kind==="unavailable"&&a.jsx(R,{ml:2,children:a.jsx(os,{label:n.reason,placement:"right",openDelay:500,children:a.jsx(B.span,{children:a.jsx(Cn,{as:On,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&s]})}}function rr(t,e,s,n){const o=er("notifier.NotificationService"),i=pt(),[r,c]=u.useState(void 0);u.useEffect(()=>{if(!t)return;const f=new nr({mapModel:t,onError(){o.notify({level:"error",message:i.formatMessage({id:"selectionFailed"})})}});return c(f),()=>{f.destroy()}},[t,o,e,i]);const l=W(async f=>{if(!r||!s)return;const g=await r.select(s,f.getExtent());g&&n?.(g)});return{controller:r,onExtentSelected:l}}function at(t,e){const s=t.status??"available",n=typeof s=="string"?{kind:s}:s;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function ar(t){const e=pt(),[s,n]=u.useState(()=>({kind:"available"}));return u.useEffect(()=>{if(!t){n({kind:"available"});return}const o=e.formatMessage({id:"sourceNotAvailable"});n(at(t,o));const i=t.on?.("changed:status",()=>{n(at(t,o))});return()=>i?.destroy()},[t,e]),s}function cr(t,e,s,n,o){u.useEffect(()=>{if(!t)return;const i=new tr(t.olMap,e.value,s.formatMessage({id:"tooltip"}),s.formatMessage({id:"disabledTooltip"}),n);return i.setActive(o),()=>{i?.destroy()}},[t,e,s,n,o])}function lr(){const[t,e]=rs("colors",["background_body","border"],["#ffffff","#ffffff"]);return u.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:t})}),[t,e])}export{Ir as C,Br as G,Lr as L,Gr as M,Or as N,Ve as O,Dr as P,Fr as S,Tr as V,Pr as W,Vr as a,$r as b,Hr as c,Ur as d,Nr as e,jr as f,Rr as g,ct as h};
