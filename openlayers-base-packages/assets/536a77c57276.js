var sr=Object.defineProperty;var ir=(t,e,o)=>e in t?sr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var $=(t,e,o)=>(ir(t,typeof e!="symbol"?e+"":e,o),o),Ut=(t,e,o)=>{if(!e.has(t))throw TypeError("Cannot "+o)};var x=(t,e,o)=>(Ut(t,e,"read from private field"),o?o.call(t):e.get(t)),L=(t,e,o)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,o)},I=(t,e,o,n)=>(Ut(t,e,"write to private field"),n?n.call(t,o):e.set(t,o),o);var W=(t,e,o)=>(Ut(t,e,"access private method"),o);import{u as ar,a as lr,r as d,c as cr,f as Ft,b as nn,o as rn,d as sn,j as i,e as te,g as ur,l as dr,i as Mt,h as pe,k as hr,R as an,m as pr,E as ie,n as fr,A as Ht,p as Wt,F as ln,B as Vt,C as gr,t as mr,q as cn,I as vr,s as br}from"./a804c6ae25fd.js";import{t as wr}from"./86b0ef7fa05f.js";import{b as un,B as dn,i as Sr,g as yr,a as Eo,t as xr,c as _r,d as Er,C as kr,r as Cr,e as Mr,u as Ar,l as hn,M as pn,o as Pr,f as Lr,h as fn,A as Rr,T as co,I as Ir,j as Tr,k as Or,m as le,n as jr,p as Dr,q as j,V as gn,S as rt,O as mn,s as Ze,v as _e,w as Le,x as uo,F as We,E as ho,y as po,z as Nr,D as Fr,G as Vr,H as ko,J as zr,K as Br,L as Co,N as Gr,P as $t,Q as Mo,R as Ur,U as Hr,W as Wr,X as $r,Y as qr,Z as Kr,_ as Ao,$ as Jt,a0 as vn,a1 as Yr,a2 as Zr,a3 as ce,a4 as oe,a5 as Y,a6 as Xr,a7 as Xe,a8 as Jr,a9 as Qr,aa as de,ab as yt,ac as Ie,ad as Te,ae as Po,af as Ae,ag as ee,ah as es,ai as bn,aj as ts,ak as os,al as Lo,am as ns,an as Ro,ao as rs,ap as Qe}from"./ea69738d0fa3.js";import{m as D,a as _,X as wn,p as z,r as T,b as J,c as fo,d as Qt,e as ye,f as ss,g as is,W as xt,P as Sn,h as yn,i as as,j as ls,k as cs,l as us,n as ds,o as hs,q as ps,s as fs,t as gs,u as ms}from"./ef626f1da786.js";import{o as vs,W as bs}from"./8c56ff03b06e.js";import{G as zt,T as ws}from"./271b8f3e26b0.js";import{T as he,V as eo,L as xn}from"./81064a1e15a2.js";import{D as _n,N as Ss,P as ys,S as xs,c as _s,a as Es,I as ks}from"./aa13c3c07a12.js";import{V as Cs,S as Ms,I as As,Z as Ps,a as Ls}from"./fd77302f93ee.js";import{_ as to}from"./a419295615be.js";import{c as En}from"./14997e1cc74a.js";import{S as Rs}from"./a80ff04620c9.js";import{u as kn,F as At}from"./f413d8ffea52.js";import{F as at}from"./b816276102a2.js";import{H as oo}from"./e8bf978be9d7.js";import{G as Is,F as Ts}from"./4533599bd8ef.js";import{u as Re,R as Os}from"./b2ec7453d2a8.js";import{L as Cn}from"./4003bea57c15.js";import{c as fe,S as no,D as js}from"./fa97955b3ec5.js";import{C as Ds}from"./88ffbff35e76.js";import"./65112a061528.js";import"./3f67a442b387.js";import"./43de92519f96.js";import"./8feb64e69a5d.js";function Ns(t){const{theme:e}=ar(),o=lr();return d.useMemo(()=>cr(e.direction,{...o,...t}),[t,e.direction,o])}var Bt=Ft(function(e,o){const{htmlSize:n,...r}=e,s=nn("Input",r),a=rn(r),l=kn(a),c=sn("chakra-input",e.className);return i.jsx(te.input,{size:n,...l,__css:s.field,ref:o,className:c})});Bt.displayName="Input";Bt.id="Input";var Mn=te("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Mn.displayName="Center";var Fs={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Ft(function(e,o){const{axis:n="both",...r}=e;return i.jsx(te.div,{ref:o,__css:Fs[n],...r,position:"absolute"})});var An=Ft(function(e,o){const{children:n,placeholder:r,className:s,...a}=e;return i.jsxs(te.select,{...a,ref:o,className:sn("chakra-select",s),children:[r&&i.jsx("option",{value:"",children:r}),n]})});An.displayName="SelectField";function Vs(t,e){const o={},n={};for(const[r,s]of Object.entries(t))e.includes(r)?o[r]=s:n[r]=s;return[o,n]}var go=Ft((t,e)=>{var o;const n=nn("Select",t),{rootProps:r,placeholder:s,icon:a,color:l,height:c,h:u,minH:h,minHeight:f,iconColor:w,iconSize:b,...E}=rn(t),[k,R]=Vs(E,dr),A=kn(R),N={width:"100%",height:"fit-content",position:"relative",color:l},F={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...(o=n.field)==null?void 0:o._focus}};return i.jsxs(te.div,{className:"chakra-select__wrapper",__css:N,...k,...r,children:[i.jsx(An,{ref:e,height:u??c,minH:h??f,placeholder:s,...A,__css:F,children:t.children}),i.jsx(Pn,{"data-disabled":ur(A.disabled),...(w||l)&&{color:w||l},__css:n.icon,...b&&{fontSize:b},children:a})]})});go.displayName="Select";var zs=t=>i.jsx("svg",{viewBox:"0 0 24 24",...t,children:i.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Bs=te("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Pn=t=>{const{children:e=i.jsx(zs,{}),...o}=t,n=d.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return i.jsx(Bs,{...o,className:"chakra-select__icon-wrapper",children:d.isValidElement(e)?n:null})};Pn.displayName="SelectIcon";const Q=[null,"http://www.opengis.net/ows/1.1"],Gs=D(Q,{ServiceIdentification:_(pi),ServiceProvider:_(gi),OperationsMetadata:_(di)});class Us extends wn{constructor(){super()}readFromNode(e){const o=z({},Gs,e,[]);return o||null}}const Hs=D(Q,{DeliveryPoint:_(T),City:_(T),AdministrativeArea:_(T),PostalCode:_(T),Country:_(T),ElectronicMailAddress:_(T)}),Ws=D(Q,{Value:J(mi)}),$s=D(Q,{AllowedValues:_(ri)}),qs=D(Q,{Phone:_(hi),Address:_(ni)}),Ks=D(Q,{HTTP:_(ci)}),Ys=D(Q,{Get:J(li),Post:void 0}),Zs=D(Q,{DCP:_(ai)}),Xs=D(Q,{Operation:ui}),Js=D(Q,{Voice:_(T),Facsimile:_(T)}),Qs=D(Q,{Constraint:J(si)}),ei=D(Q,{IndividualName:_(T),PositionName:_(T),ContactInfo:_(ii)}),ti=D(Q,{Abstract:_(T),AccessConstraints:_(T),Fees:_(T),Title:_(T),ServiceTypeVersion:_(T),ServiceType:_(T)}),oi=D(Q,{ProviderName:_(T),ProviderSite:_(fo),ServiceContact:_(fi)});function ni(t,e){return z({},Hs,t,e)}function ri(t,e){return z({},Ws,t,e)}function si(t,e){const o=t.getAttribute("name");if(o)return z({name:o},$s,t,e)}function ii(t,e){return z({},qs,t,e)}function ai(t,e){return z({},Ks,t,e)}function li(t,e){const o=fo(t);if(o)return z({href:o},Qs,t,e)}function ci(t,e){return z({},Ys,t,e)}function ui(t,e){const o=t.getAttribute("name"),n=z({},Zs,t,e);if(!n)return;const r=e[e.length-1];r[o]=n}function di(t,e){return z({},Xs,t,e)}function hi(t,e){return z({},Js,t,e)}function pi(t,e){return z({},ti,t,e)}function fi(t,e){return z({},ei,t,e)}function gi(t,e){return z({},oi,t,e)}function mi(t,e){return T(t)}const vi=Us,ue=[null,"http://www.opengis.net/wmts/1.0"],Je=[null,"http://www.opengis.net/ows/1.1"],bi=D(ue,{Contents:_(Pi)});class wi extends wn{constructor(){super(),this.owsParser_=new vi}readFromNode(e){let o=e.getAttribute("version");o&&(o=o.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=o,n=z(n,bi,e,[]),n||null):null}}const Si=D(ue,{Layer:J(Li),TileMatrixSet:J(Ri)}),yi=D(ue,{Style:J(Ii),Format:J(T),TileMatrixSetLink:J(Ti),Dimension:J(Oi),ResourceURL:J(ji)},D(Je,{Title:_(T),Abstract:_(T),WGS84BoundingBox:_(Rn),BoundingBox:J(Di),Identifier:_(T)})),xi=D(ue,{LegendURL:J(Ni)},D(Je,{Title:_(T),Identifier:_(T)})),_i=D(ue,{TileMatrixSet:_(T),TileMatrixSetLimits:_(Vi)}),Ei=D(ue,{TileMatrixLimits:Qt(zi)}),ki=D(ue,{TileMatrix:_(T),MinTileRow:_(ye),MaxTileRow:_(ye),MinTileCol:_(ye),MaxTileCol:_(ye)}),Ci=D(ue,{Default:_(T),Value:J(T)},D(Je,{Identifier:_(T)})),Ln=D(Je,{LowerCorner:Qt(ro),UpperCorner:Qt(ro)}),Mi=D(ue,{WellKnownScaleSet:_(T),TileMatrix:J(Fi)},D(Je,{SupportedCRS:_(T),Identifier:_(T),BoundingBox:_(Rn)})),Ai=D(ue,{TopLeftCorner:_(ro),ScaleDenominator:_(ss),TileWidth:_(ye),TileHeight:_(ye),MatrixWidth:_(ye),MatrixHeight:_(ye)},D(Je,{Identifier:_(T)}));function Pi(t,e){return z({},Si,t,e)}function Li(t,e){return z({},yi,t,e)}function Ri(t,e){return z({},Mi,t,e)}function Ii(t,e){const o=z({},xi,t,e);if(!o)return;const n=t.getAttribute("isDefault")==="true";return o.isDefault=n,o}function Ti(t,e){return z({},_i,t,e)}function Oi(t,e){return z({},Ci,t,e)}function ji(t,e){const o=t.getAttribute("format"),n=t.getAttribute("template"),r=t.getAttribute("resourceType"),s={};return o&&(s.format=o),n&&(s.template=n),r&&(s.resourceType=r),s}function Rn(t,e){const o=z([],Ln,t,e);if(o.length==2)return un(o)}function Di(t,e){const o=t.getAttribute("crs"),n=z([],Ln,t,e);if(n.length==2)return{extent:un(n),crs:o}}function Ni(t,e){const o={};return o.format=t.getAttribute("format"),o.href=fo(t),o}function ro(t,e){const o=T(t).split(/\s+/);if(!o||o.length!=2)return;const n=+o[0],r=+o[1];if(!(isNaN(n)||isNaN(r)))return[n,r]}function Fi(t,e){return z({},Ai,t,e)}function Vi(t,e){return z([],Ei,t,e)}function zi(t,e){return z({},ki,t,e)}const Bi=wi,U={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Gi={ERROR:"error"};class Ui extends Er{constructor(e){super(Gi.ERROR),this.code=e.code,this.message=e.message}}let Hi=class extends dn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Sr,this.watchId_=void 0,this.addChangeListener(U.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(U.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=yr(Eo("EPSG:4326"),e),this.position_&&this.set(U.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const o=e.coords;this.set(U.ACCURACY,o.accuracy),this.set(U.ALTITUDE,o.altitude===null?void 0:o.altitude),this.set(U.ALTITUDE_ACCURACY,o.altitudeAccuracy===null?void 0:o.altitudeAccuracy),this.set(U.HEADING,o.heading===null?void 0:xr(o.heading)),this.position_?(this.position_[0]=o.longitude,this.position_[1]=o.latitude):this.position_=[o.longitude,o.latitude];const n=this.transform_(this.position_);this.set(U.POSITION,n.slice()),this.set(U.SPEED,o.speed===null?void 0:o.speed);const r=_r(this.position_,o.accuracy);r.applyTransform(this.transform_),this.set(U.ACCURACY_GEOMETRY,r),this.changed()}positionError_(e){this.dispatchEvent(new Ui(e))}getAccuracy(){return this.get(U.ACCURACY)}getAccuracyGeometry(){return this.get(U.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(U.ALTITUDE)}getAltitudeAccuracy(){return this.get(U.ALTITUDE_ACCURACY)}getHeading(){return this.get(U.HEADING)}getPosition(){return this.get(U.POSITION)}getProjection(){return this.get(U.PROJECTION)}getSpeed(){return this.get(U.SPEED)}getTracking(){return this.get(U.TRACKING)}getTrackingOptions(){return this.get(U.TRACKING_OPTIONS)}setProjection(e){this.set(U.PROJECTION,Eo(e))}setTracking(e){this.set(U.TRACKING,e)}setTrackingOptions(e){this.set(U.TRACKING_OPTIONS,e)}};const Wi=Hi,K={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class $i extends dn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+kr,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(K.ELEMENT,this.handleElementChanged),this.addChangeListener(K.MAP,this.handleMapChanged),this.addChangeListener(K.OFFSET,this.handleOffsetChanged),this.addChangeListener(K.POSITION,this.handlePositionChanged),this.addChangeListener(K.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(K.ELEMENT)}getId(){return this.id}getMap(){return this.get(K.MAP)||null}getOffset(){return this.get(K.OFFSET)}getPosition(){return this.get(K.POSITION)}getPositioning(){return this.get(K.POSITIONING)}handleElementChanged(){Cr(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Mr(this.element),Ar(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=hn(e,pn.POSTRENDER,this.render,this),this.updatePixelPosition();const o=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?o.insertBefore(this.element,o.childNodes[0]||null):o.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(K.ELEMENT,e)}setMap(e){this.set(K.MAP,e)}setOffset(e){this.set(K.OFFSET,e)}setPosition(e){this.set(K.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const o=this.getMap();if(!o||!o.getTargetElement()||!this.get(K.POSITION))return;const n=this.getRect(o.getTargetElement(),o.getSize()),r=this.getElement(),s=this.getRect(r,[Pr(r),Lr(r)]);e=e||{};const a=e.margin===void 0?20:e.margin;if(!fn(n,s)){const l=s[0]-n[0],c=n[2]-s[2],u=s[1]-n[1],h=n[3]-s[3],f=[0,0];if(l<0?f[0]=l-a:c<0&&(f[0]=Math.abs(c)+a),u<0?f[1]=u-a:h<0&&(f[1]=Math.abs(h)+a),f[0]!==0||f[1]!==0){const w=o.getView().getCenterInternal(),b=o.getPixelFromCoordinateInternal(w);if(!b)return;const E=[b[0]+f[0],b[1]+f[1]],k=e.animation||{};o.getView().animateInternal({center:o.getCoordinateFromPixelInternal(E),duration:k.duration,easing:k.easing})}}}getRect(e,o){const n=e.getBoundingClientRect(),r=n.left+window.pageXOffset,s=n.top+window.pageYOffset;return[r,s,r+o[0],s+o[1]]}setPositioning(e){this.set(K.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),o=this.getPosition();if(!e||!e.isRendered()||!o){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(o),r=e.getSize();this.updateRenderedPosition(n,r)}updateRenderedPosition(e,o){const n=this.element.style,r=this.getOffset(),s=this.getPositioning();this.setVisible(!0);const a=Math.round(e[0]+r[0])+"px",l=Math.round(e[1]+r[1])+"px";let c="0%",u="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?c="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(c="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?u="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(u="-50%");const h=`translate(${c}, ${u}) translate(${a}, ${l})`;this.rendered.transform_!=h&&(this.rendered.transform_=h,n.transform=h)}getOptions(){return this.options}}const lt=$i,ke=pe("map:WMTSLayer");var De,Ne,Fe,Ve,ct,ut,dt,ht,Rt,In,It,Tn;class qi extends Rr{constructor(o){const n=new co;super({...o,olLayer:n});L(this,Rt);L(this,It);L(this,De,void 0);L(this,Ne,void 0);L(this,Fe,void 0);L(this,Ve,void 0);L(this,ct,void 0);L(this,ut,void 0);L(this,dt,void 0);L(this,ht,new AbortController);I(this,De,o.url),I(this,Ne,o.name),I(this,Ve,n),I(this,Fe,o.matrixSet),I(this,dt,o.sourceOptions)}destroy(){super.destroy(),x(this,ht).abort()}get legend(){return x(this,ut)}__attach(o){super.__attach(o),W(this,Rt,In).call(this).then(n=>{const s=new Bi().read(n),a=vs(s,{layer:x(this,Ne),matrixSet:x(this,Fe)});if(!a)throw new Error("Layer was not found in capabilities");const l=new bs({...a,...x(this,dt),tileLoadFunction:(h,f)=>{W(this,It,Tn).call(this,h,f)}});I(this,ct,l),x(this,Ve).setSource(x(this,ct));const c=l.getStyle(),u=Yi(s,this.name,c);I(this,ut,u),this.__emitChangeEvent("changed:legend")}).catch(n=>{if(Mt(n)){ke.error(`Layer ${this.name} has been destroyed before fetching the data`);return}ke.error(`Failed fetching WMTS capabilities for Layer ${this.name}`,n)})}get layer(){return x(this,Ve)}get url(){return x(this,De)}get name(){return x(this,Ne)}get matrixSet(){return x(this,Fe)}get sublayers(){}}De=new WeakMap,Ne=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,ct=new WeakMap,ut=new WeakMap,dt=new WeakMap,ht=new WeakMap,Rt=new WeakSet,In=async function(){const o=this.map.__sharedDependencies.httpService;return is(x(this,De),o,x(this,ht).signal)},It=new WeakSet,Tn=async function(o,n){const r=this.map.__sharedDependencies.httpService;try{if(!(o instanceof Ir))throw new Error("Only 'ImageTile' is supported for now.");const s=o.getImage();if(!Ki(s))throw new Error("Only <img> tags are supported as tiles for now.");const a=await r.fetch(n);if(!a.ok)throw new Error(`Tile request failed with status ${a.status}.`);const l=await a.blob(),c=URL.createObjectURL(l),u=()=>{URL.revokeObjectURL(c),s.removeEventListener("load",u),s.removeEventListener("error",u)};s.addEventListener("load",u),s.addEventListener("error",u),s.src=c}catch(s){o.setState(Tr.ERROR),Mt(s)||ke.error("Failed to load tile",s)}};function Ki(t){return t.tagName==="IMG"}function Yi(t,e,o){const r=t?.Contents?.Layer;let s=r?.find(u=>u?.Identifier===e);if(!s&&(ke.debug("Failed to find the active layer in WMTS layer capabilities."),s=r?.[0],!s)){ke.debug("No layer in WMTS capabilities - giving up.");return}const a=s.Style;let l=a?.find(u=>u?.Identifier===o);if(!l&&(ke.debug("Failed to find active style in WMTS layer."),l=a?.[0],!l)){ke.debug("No style in WMTS layer capabilities - giving up.");return}return l.LegendURL?.[0]?.href}const Io=qi,Zi=25.4/.28,Xi=39.37;function mo(t){return vo(t,Ji,Qi)}function Ji(t){return t.getView()}function Qi(t,e){return t.on("change:view",e)}function On(t){return mo(t)?.getProjection()}function ea(t){const e=mo(t);return vo(e,ta,oa)}function ta(t){return t.getResolution()}function oa(t,e){return t.on("change:resolution",e)}function na(t){const e=mo(t);return vo(e,ra,sa)}function ra(t){return t.getCenter()}function sa(t,e){return t.on("change:center",e)}function ia(t){const e=na(t),o=ea(t),n=On(t);return d.useMemo(()=>{if(n==null||o==null||e==null)return;const s=Or(n,o,e);return Math.round(s*Xi*Zi)},[n,o,e])}function vo(t,e,o){const n=d.useCallback(()=>t?e(t):void 0,[t,e]),r=d.useCallback(s=>{if(!t)return()=>{};const a=o(t,s);return()=>le(a)},[t,o]);return d.useSyncExternalStore(r,n)}const aa=1.2;function la(t,e=aa){ca(t);const o=jr(t),n=Dr(t),r=o*e,s=n*e;return[t[0]-(r-o)/2,t[1]-(s-n)/2,t[2]+(r-o)/2,t[3]+(s-n)/2]}function ca(t){if(t.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${t.length}).`)}const ua={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function da(t){return i.jsxs(j,{children:[i.jsx(he,{children:t.layer.title}),i.jsx(j,{style:ua})]})}const B="main";class ha{mapId=B;vectorSourceFactory;constructor(e){this.vectorSourceFactory=e.references.vectorSourceFactory}async getMapConfig(){const e={Component:da};return{advanced:{view:new gn({center:[404747,5757920],zoom:13,constrainResolution:!0,projection:"EPSG:25832"})},layers:[new xt({title:"Linfos",visible:!0,url:"https://www.wms.nrw.de/umwelt/linfos",sublayers:[{name:"SonstigeSchutzgebiete",title:"SonstigeSchutzgebiete"},{name:"SCH_GSG",title:"SCH_GSG"}]}),new Io({isBaseLayer:!0,title:"Topplus grau",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_grau",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new Io({isBaseLayer:!0,title:"Topplus farbig",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_col",matrixSet:"EPSG_25832_14",visible:!0,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new rt({title:"OSM",visible:!1,isBaseLayer:!0,olLayer:new co({source:new mn})}),new rt({title:"Haltestellen Stadt Rostock",visible:!0,description:"Haltestellen des öffentlichen Personenverkehrs in der Hanse- und Universitätsstadt Rostock.",olLayer:pa(),attributes:{legend:e}}),new rt({id:"ogc_kitas",title:"Kindertagesstätten",visible:!0,olLayer:fa(),attributes:{legend:e,resultListMetadata:[{id:"id",displayName:"ID",width:100,getPropertyValue(o){return o.id}},{propertyName:"pointOfContact.address.postCode",displayName:"PLZ",width:120},{propertyName:"name",displayName:"Name"},{propertyName:"inspireId",displayName:"inspireID"},{displayName:"Gefördert",width:160,getPropertyValue(o){switch(o.properties?.gefoerdert){case"ja":return!0;case"nein":return!1;default:return o.properties?.gefoerdert}}}]}}),new rt({id:"ogc_kataster",title:"Liegenschaftskatasterbezirke in NRW (viele Daten)",visible:!1,olLayer:ga(this.vectorSourceFactory),attributes:{resultListMetadata:[{propertyName:"id",displayName:"ID",width:600,getPropertyValue(o){return o.id}},{displayName:"Aktualit",width:600,getPropertyValue(o){const n=o.properties?.aktualit;return typeof n=="string"&&!isNaN(Date.parse(n))?new Date(n):n}}]}}),ba(this.vectorSourceFactory),wa(),Sa(),ma(),va()]}}}function pa(){const t=new Ze({url:"https://geo.sv.rostock.de/download/opendata/haltestellen/haltestellen.json",format:new zt,attributions:"Haltestellen Stadt Rostock, Creative Commons CC Zero License (cc-zero)"});return new _e({source:t})}function fa(){const t=new Ze({url:"https://ogc-api.nrw.de/inspire-us-kindergarten/v1/collections/governmentalservice/items?f=json&limit=10000",format:new zt,attributions:'&copy; <a href="http://www.bkg.bund.de" target="_blank">Bundesamt f&uuml;r Kartographie und Geod&auml;sie</a> 2017, <a href="http://sg.geodatenzentrum.de/web_public/Datenquellen_TopPlus_Open.pdf" target="_blank">Datenquellen</a>'});return new _e({source:t,style:new Le({image:new uo({fill:new We({color:"blue"}),radius:4})})})}function ga(t){const e=t.createVectorSource({baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"katasterbezirk",limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`});return new _e({source:e})}function ma(){return new xt({title:"Verwaltungsgebiete",visible:!0,url:"https://www.wms.nrw.de/geobasis/wms_nw_dvg",sublayers:[{name:"nw_dvg_bld",title:"NRW"}]})}function va(){return new xt({title:"Bodenkarte zur Landwirtschaftlichen Standorterkundung",visible:!0,url:"https://www.wms.nrw.de/gd/bk05l",sublayers:[{name:"Versickerung_und_Stofftransport",title:"Versickerung und Stofftransport",sublayers:[{name:"Sickerwasserrate",title:"Sickerwasserrate",sublayers:[{name:"Szenario_Wald",title:"Szenario Wald",sublayers:[{name:"Sickerwasserrate_Wald",title:"Sickerwasserrate Wald"},{name:"Direktabfluss_Wald",title:"Direktabfluss Wald"}]},{name:"Szenario_Gruenland",title:"Szenario Grünland",sublayers:[{name:"Sickerwasserrate_Gruenland",title:"Sickerwasserrate Grünland"},{name:"Direktabfluss_Gruenland",title:"Direktabfluss Grünland"}]}]}]},{name:"Wasserhaushalt",title:"Wasserhaushalt",sublayers:[{name:"Kapillaraufstieg_von_Grundwasser",title:"Kapillaraufstieg von Grundwasser",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/gd/bk05l?request=GetLegendGraphic%26version=1.3.0%26format=image/png%26layer=Kapillaraufstieg_von_Grundwasser"}}},{name:"Luftkapazitaet_We",title:"Luftkapazitaet (We)",attributes:{legend:{}}}]}]})}function ba(t){const e="https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1",o="governmentalservice",n=t.createVectorSource({baseUrl:e,collectionId:o,limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`}),r=new _e({source:n});return new rt({id:"krankenhaus",title:"Krankenhäuser",visible:!0,olLayer:r,attributes:{collectionURL:e+"/collections/"+o}})}function wa(){return new xt({title:"Schulstandorte",description:"Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.",visible:!0,url:"https://www.wms.nrw.de/wms/wms_nw_inspire-schulen",sublayers:[{name:"US.education",title:"INSPIRE - WMS Schulstandorte NRW",attributes:{legend:{}}}],sourceOptions:{ratio:1}})}function Sa(){return new xt({title:"Straßennetz Landesbetrieb Straßenbau NRW",url:"https://www.wms.nrw.de/wms/strassen_nrw_wms",visible:!0,sublayers:[{name:"1",title:"Verwaltungen",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/legends/wms/strassen_nrw_wms/1.png"}}},{name:"4",title:"Abschnitte und Äste"},{name:"6",title:"Unfälle"}]})}const ya=Symbol(),bo=Symbol(),et="a",Ct="w";let xa=(t,e)=>new Proxy(t,e);const so=Object.getPrototypeOf,io=new WeakMap,jn=t=>t&&(io.has(t)?io.get(t):so(t)===Object.prototype||so(t)===Array.prototype),To=t=>typeof t=="object"&&t!==null,_a=t=>{if(Array.isArray(t))return Array.from(t);const e=Object.getOwnPropertyDescriptors(t);return Object.values(e).forEach(o=>{o.configurable=!0}),Object.create(so(t),e)},Dn=t=>t[bo]||t,Nn=(t,e,o,n)=>{if(!jn(t))return t;let r=n&&n.get(t);if(!r){const c=Dn(t);r=(u=>Object.values(Object.getOwnPropertyDescriptors(u)).some(h=>!h.configurable&&!h.writable))(c)?[c,_a(c)]:[c],n?.set(t,r)}const[s,a]=r;let l=o&&o.get(s);return l&&l[1].f===!!a||(l=((c,u)=>{const h={f:u};let f=!1;const w=(E,k)=>{if(!f){let R=h[et].get(c);if(R||(R={},h[et].set(c,R)),E===Ct)R[Ct]=!0;else{let A=R[E];A||(A=new Set,R[E]=A),A.add(k)}}},b={get:(E,k)=>k===bo?c:(w("k",k),Nn(Reflect.get(E,k),h[et],h.c,h.t)),has:(E,k)=>k===ya?(f=!0,h[et].delete(c),!0):(w("h",k),Reflect.has(E,k)),getOwnPropertyDescriptor:(E,k)=>(w("o",k),Reflect.getOwnPropertyDescriptor(E,k)),ownKeys:E=>(w(Ct),Reflect.ownKeys(E))};return u&&(b.set=b.deleteProperty=()=>!1),[b,h]})(s,!!a),l[1].p=xa(a||s,l[0]),o&&o.set(s,l)),l[1][et]=e,l[1].c=o,l[1].t=n,l[1].p},Fn=(t,e,o,n)=>{if(Object.is(t,e))return!1;if(!To(t)||!To(e))return!0;const r=o.get(Dn(t));if(!r)return!0;if(n){const a=n.get(t);if(a&&a.n===e)return a.g;n.set(t,{n:e,g:!1})}let s=null;try{for(const a of r.h||[])if(s=Reflect.has(t,a)!==Reflect.has(e,a),s)return s;if(r[Ct]===!0){if(s=((a,l)=>{const c=Reflect.ownKeys(a),u=Reflect.ownKeys(l);return c.length!==u.length||c.some((h,f)=>h!==u[f])})(t,e),s)return s}else for(const a of r.o||[])if(s=!!Reflect.getOwnPropertyDescriptor(t,a)!=!!Reflect.getOwnPropertyDescriptor(e,a),s)return s;for(const a of r.k||[])if(s=Fn(t[a],e[a],o,n),s)return s;return s===null&&(s=!0),s}finally{n&&n.set(t,{n:e,g:s})}},Ea=t=>jn(t)&&t[bo]||null,Oo=(t,e=!0)=>{io.set(t,e)};const qt=t=>typeof t=="object"&&t!==null,me=new WeakMap,st=new WeakSet,ka=(t=Object.is,e=(u,h)=>new Proxy(u,h),o=u=>qt(u)&&!st.has(u)&&(Array.isArray(u)||!(Symbol.iterator in u))&&!(u instanceof WeakMap)&&!(u instanceof WeakSet)&&!(u instanceof Error)&&!(u instanceof Number)&&!(u instanceof Date)&&!(u instanceof String)&&!(u instanceof RegExp)&&!(u instanceof ArrayBuffer),n=u=>{switch(u.status){case"fulfilled":return u.value;case"rejected":throw u.reason;default:throw u}},r=new WeakMap,s=(u,h,f=n)=>{const w=r.get(u);if(w?.[0]===h)return w[1];const b=Array.isArray(u)?[]:Object.create(Object.getPrototypeOf(u));return Oo(b,!0),r.set(u,[h,b]),Reflect.ownKeys(u).forEach(E=>{if(Object.getOwnPropertyDescriptor(b,E))return;const k=Reflect.get(u,E),{enumerable:R}=Reflect.getOwnPropertyDescriptor(u,E),A={value:k,enumerable:R,configurable:!0};if(st.has(k))Oo(k,!1);else if(k instanceof Promise)delete A.value,A.get=()=>f(k);else if(me.has(k)){const[N,F]=me.get(k);A.value=s(N,F(),f)}Object.defineProperty(b,E,A)}),Object.preventExtensions(b)},a=new WeakMap,l=[1,1],c=u=>{if(!qt(u))throw new Error("object required");const h=a.get(u);if(h)return h;let f=l[0];const w=new Set,b=(m,v=++l[0])=>{f!==v&&(f=v,w.forEach(p=>p(m,v)))};let E=l[1];const k=(m=++l[1])=>(E!==m&&!w.size&&(E=m,A.forEach(([v])=>{const p=v[1](m);p>f&&(f=p)})),f),R=m=>(v,p)=>{const S=[...v];S[1]=[m,...S[1]],b(S,p)},A=new Map,N=(m,v)=>{if(w.size){const p=v[3](R(m));A.set(m,[v,p])}else A.set(m,[v])},F=m=>{var v;const p=A.get(m);p&&(A.delete(m),(v=p[1])==null||v.call(p))},Z=m=>(w.add(m),w.size===1&&A.forEach(([p,S],M)=>{const y=p[3](R(M));A.set(M,[p,y])}),()=>{w.delete(m),w.size===0&&A.forEach(([p,S],M)=>{S&&(S(),A.set(M,[p]))})}),X=Array.isArray(u)?[]:Object.create(Object.getPrototypeOf(u)),H=e(X,{deleteProperty(m,v){const p=Reflect.get(m,v);F(v);const S=Reflect.deleteProperty(m,v);return S&&b(["delete",[v],p]),S},set(m,v,p,S){const M=Reflect.has(m,v),y=Reflect.get(m,v,S);if(M&&(t(y,p)||a.has(p)&&t(y,a.get(p))))return!0;F(v),qt(p)&&(p=Ea(p)||p);let C=p;if(p instanceof Promise)p.then(V=>{p.status="fulfilled",p.value=V,b(["resolve",[v],V])}).catch(V=>{p.status="rejected",p.reason=V,b(["reject",[v],V])});else{!me.has(p)&&o(p)&&(C=c(p));const V=!st.has(C)&&me.get(C);V&&N(v,V)}return Reflect.set(m,v,C,S),b(["set",[v],p,y]),!0}});a.set(u,H);const g=[X,k,s,Z];return me.set(H,g),Reflect.ownKeys(u).forEach(m=>{const v=Object.getOwnPropertyDescriptor(u,m);"value"in v&&(H[m]=u[m],delete v.value,delete v.writable),Object.defineProperty(X,m,v)}),H})=>[c,me,st,t,e,o,n,r,s,a,l],[Ca]=ka();function Vn(t={}){return Ca(t)}function Ma(t,e,o){const n=me.get(t);let r;const s=[],a=n[3];let l=!1;const u=a(h=>{if(s.push(h),o){e(s.splice(0));return}r||(r=Promise.resolve().then(()=>{r=void 0,l&&e(s.splice(0))}))});return l=!0,()=>{l=!1,u()}}function jo(t,e){const o=me.get(t),[n,r,s]=o;return s(n,r(),e)}function tt(t){return st.add(t),t}var zn={exports:{}},Bn={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $e=d;function Aa(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Pa=typeof Object.is=="function"?Object.is:Aa,La=$e.useState,Ra=$e.useEffect,Ia=$e.useLayoutEffect,Ta=$e.useDebugValue;function Oa(t,e){var o=e(),n=La({inst:{value:o,getSnapshot:e}}),r=n[0].inst,s=n[1];return Ia(function(){r.value=o,r.getSnapshot=e,Kt(r)&&s({inst:r})},[t,o,e]),Ra(function(){return Kt(r)&&s({inst:r}),t(function(){Kt(r)&&s({inst:r})})},[t]),Ta(o),o}function Kt(t){var e=t.getSnapshot;t=t.value;try{var o=e();return!Pa(t,o)}catch{return!0}}function ja(t,e){return e()}var Da=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ja:Oa;Bn.useSyncExternalStore=$e.useSyncExternalStore!==void 0?$e.useSyncExternalStore:Da;zn.exports=Bn;var Na=zn.exports;const Fa=hr(Na),{use:Do}=an,{useSyncExternalStore:Va}=Fa;const za=new WeakMap;function qe(t,e){const o=e?.sync,n=d.useRef(),r=d.useRef();let s=!0;const a=Va(d.useCallback(u=>{const h=Ma(t,u,o);return u(),h},[t,o]),()=>{const u=jo(t,Do);try{if(!s&&n.current&&r.current&&!Fn(n.current,u,r.current,new WeakMap))return n.current}catch{}return u},()=>jo(t,Do));s=!1;const l=new WeakMap;d.useEffect(()=>{n.current=a,r.current=l});const c=d.useMemo(()=>new WeakMap,[]);return Nn(a,l,c,za)}function Ba(t){const e=Vn({data:Array.from(t||[]),has(o){return this.data.some(n=>n[0]===o)},set(o,n){const r=this.data.find(s=>s[0]===o);return r?r[1]=n:this.data.push([o,n]),this},get(o){var n;return(n=this.data.find(r=>r[0]===o))==null?void 0:n[1]},delete(o){const n=this.data.findIndex(r=>r[0]===o);return n===-1?!1:(this.data.splice(n,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(o){this.data.forEach(n=>{o(n[1],n[0],this)})},keys(){return this.data.map(o=>o[0]).values()},values(){return this.data.map(o=>o[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}class Ga{label;filteredTypes;httpService;constructor(e,o,n){this.label=e,this.filteredTypes=o,this.httpService=n}async search(e,{mapProjection:o,signal:n}){const r=await this.request(e,100,n),s=new zt({dataProjection:"EPSG:4326",featureProjection:o});return r.features.filter(a=>this.filteredTypes.includes(a.properties.type)).map((a,l)=>{const c=s.readGeometry(a.geometry);return{id:a.properties.osm_id||l,label:this.createLabel(a),geometry:c,properties:a.properties}})}async request(e,o,n){const r=new URL("https://photon.komoot.io/api?");r.searchParams.set("q",e),r.searchParams.set("lang","de"),r.searchParams.set("lat","51.961563"),r.searchParams.set("lon","7.628202"),r.searchParams.set("limit",o.toString());const s=await this.httpService.fetch(r,{signal:n});if(!s.ok)throw new Error("Request failed: "+s.status);return await s.json()}createLabel(e){return`${e.properties.name} (${e.properties.osm_value?e.properties.osm_value+", ":""}${e.properties.postcode?e.properties.postcode+", ":""}${e.properties.city?e.properties.city+", ":""}${e.properties.country?e.properties.country+")":")"}`}}const Ua=pe("ol-app:AppModel");class Ha{_intl;_mapRegistry;_ogcSearchSourceFactory;_vectorSelectionSourceFactory;_httpService;_state;_resources=[];_featureHighlight=void 0;constructor({references:e,intl:o}){this._mapRegistry=e.mapRegistry,this._intl=o,this._ogcSearchSourceFactory=e.ogcSearchSourceFactory,this._vectorSelectionSourceFactory=e.vectorSelectionSourceFactory,this._httpService=e.httpService,this._state=Vn({searchSources:[],selectionSources:[],sourceMetadata:Ba(),resultListState:{input:void 0,open:!1,key:0}}),this.initSearchSources(),this.initSelectionSources().catch(n=>{Ua.error("Failed to initialize selection sources",n)})}destroy(){this._resources.forEach(e=>e.destroy())}get state(){return this._state}setResultListInput(e){const o=this._state.resultListState.key;this._state.resultListState={open:!0,key:o+1,input:e}}setResultListVisibility(e){this._state.resultListState.open=e}highlightAndZoom(e,o){const n=e.olMap.getViewport();this.clearPreviousHighlight(),this._featureHighlight=e.highlightAndZoom(o,{viewPadding:n&&n.offsetWidth<1e3?{top:150,right:75,bottom:50,left:75}:{top:150,right:400,bottom:50,left:400}})}clearPreviousHighlight(){this._featureHighlight&&(this._featureHighlight.destroy(),this._featureHighlight=void 0)}initSearchSources(){const e=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.lika"}),baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"flurstueck",searchProperty:"flurstid",labelProperty:"objid"}),o=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.miningPermissions"}),baseUrl:"https://ogc-api.nrw.de/inspire-am-bergbauberechtigungen/v1",collectionId:"managementrestrictionorregulationzone",searchProperty:"thematicId",labelProperty:"name",renderLabel(r){const s=r?.properties?.name,a=r?.id;return typeof s=="string"?s+" ("+a+")":String(a)},rewriteUrl(r){return r.searchParams.set("properties","name"),r}}),n=new Ga("Photon Geocoder",["city","street"],this._httpService);this._state.searchSources=[tt(e),tt(o),tt(n)]}async initSelectionSources(){const e=["ogc_kitas","ogc_kataster"],n=(await this._mapRegistry.expectMapModel(B)).layers.getOperationalLayers({sortByDisplayOrder:!0});for(const r of n){if(!e.includes(r.id)||!Wa(r.olLayer))continue;const s=this._vectorSelectionSourceFactory.createSelectionSource({vectorLayer:r.olLayer,label:r.title}),a=s.on("changed:status",()=>{s.status!=="available"&&(s.status==="unavailable"||s.status?.kind==="unavailable")&&this.clearPreviousHighlight()});this._resources.push(a,s),this._state.selectionSources.unshift(tt(s)),this._state.sourceMetadata.set(tt(s),r.attributes.resultListMetadata)}}}function Wa(t){return t instanceof _e&&t.getSource()instanceof Ze}async function $a(t,e,o,n){const s=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=await t.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:o}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${s}>`}});if(!a||!a.ok||a.status!==201)return Promise.reject(new Error("Request failed: "+a.status));const l=a.headers.get("location");if(!l)return Promise.reject(new Error("Request failed: no Location response header"));const c=l.substring(l.lastIndexOf("/")+1);return Promise.resolve(c)}var ve;class qa extends ho{constructor(o){super();L(this,ve,void 0);$(this,"_httpService");$(this,"_intl");$(this,"_map");$(this,"_polygonDrawStyle");$(this,"_state");$(this,"_editLayerURL");$(this,"_drawSource");$(this,"_drawLayer");$(this,"_drawInteraction");$(this,"_olMap");$(this,"_mapContainer");$(this,"_tooltip");$(this,"_enterHandler");$(this,"_escapeHandler");$(this,"_interactionListener");$(this,"_mapListener");this._httpService=o.httpService,this._intl=o.intl,this._polygonDrawStyle=o.polygonDrawStyle,this._map=o.map,this._olMap=o.map.olMap,this._state="active:initialized",this._editLayerURL=o.ogcApiFeatureLayerUrl,this._drawSource=new Ze,this._drawLayer=new _e({source:this._drawSource,zIndex:po,properties:{name:"editing-layer"}}),this._drawInteraction=new _n({source:this._drawSource,type:"Polygon",style:this._polygonDrawStyle}),this._tooltip=this._createTooltip(this._olMap),this._enterHandler=n=>{if(n.code==="Enter"&&n.target===this._olMap.getTargetElement()){const r=this._drawInteraction.getOverlay().getSource().getFeatures();r[0]&&r[0].getGeometry().getCoordinates()[0].length>4&&this._drawInteraction.finishDrawing()}},this._escapeHandler=n=>{n.code==="Escape"&&n.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(o){this._state=o,this.emit(o)}_start(){this._olMap.addLayer(this._drawLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.element.classList.remove("editing-tooltip-hidden");const o=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.continue"})}),n=this._drawInteraction.on("drawend",s=>{this._setState("active:saving");const a=this._editLayerURL,l=s.feature.getGeometry();if(!l){this._destroy(),x(this,ve)?.reject(new Error("no geometry available"));return}const c=this._olMap.getView().getProjection(),h=new zt({dataProjection:c}).writeGeometryObject(l,{rightHanded:!0,decimals:10});$a(this._httpService,a,h,c).then(f=>{this._destroy(),x(this,ve)?.resolve(f)}).catch(f=>{console.log(f),this._destroy(),x(this,ve)?.reject(f)})}),r=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(o,n),this._mapListener.push(r)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.begin"}),this._setState("active:initialized")}stop(){this._destroy(),x(this,ve)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._drawLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(o=>{le(o)}),this._mapListener.map(o=>{o.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._state="inactive"}whenComplete(){return(x(this,ve)??I(this,ve,pr())).promise}_createTooltip(o){const n=document.createElement("div");n.className="editing-tooltip editing-tooltip-hidden",n.textContent=this._intl.formatMessage({id:"tooltip.begin"});const r=new lt({element:n,offset:[15,0],positioning:"center-left"}),s=o.on("pointermove",a=>{a.dragging||r.setPosition(a.coordinate)});return o.addOverlay(r),{overlay:r,element:n,destroy(){le(s),o.removeOverlay(r)}}}}ve=new WeakMap;class Ka{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}start(e,o){if(!o||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let r=this._workflows.get(n);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new qa({map:e,ogcApiFeatureLayerUrl:o,polygonDrawStyle:this._serviceOptions.properties.polygonDrawStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,r),this._connectToWorkflowComplete(r,n),r}stop(e){const o=this._workflows.get(e);if(o)o.stop();else return new Error("No workflow found for mapId: "+e)}reset(e){const o=this._workflows.get(e);if(o)o.reset();else return new Error("No workflow found for mapId: "+e)}_connectToWorkflowComplete(e,o){e.whenComplete().finally(()=>{this._workflows.delete(o)})}}const Yt=.75,_t=.1;let Ya=class extends Nr{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const o=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",r=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r):this.collapseLabel_=r;const s=e.label!==void 0?e.label:"›";typeof s=="string"?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=n,l.appendChild(a),l.addEventListener(Fr.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const c=new Vr({view:e.view,controls:new ko,interactions:new ko});this.ovmap_=c,e.layers&&e.layers.forEach(function(N){c.addLayer(N)});const u=document.createElement("div");u.className="ol-overviewmap-box",u.style.boxSizing="border-box",this.boxOverlay_=new lt({position:[0,0],positioning:"center-center",element:u}),this.ovmap_.addOverlay(this.boxOverlay_);const h=o+" "+zr+" "+Br+(this.collapsed_&&this.collapsible_?" "+Co:"")+(this.collapsible_?"":" ol-uncollapsible"),f=this.element;f.className=h,f.appendChild(this.ovmapDiv_),f.appendChild(l);const w=this,b=this.boxOverlay_,E=this.boxOverlay_.getElement(),k=function(N){return{clientX:N.clientX,clientY:N.clientY}},R=function(N){const F=k(N),Z=c.getEventCoordinateInternal(F);b.setPosition(Z)},A=function(N){const F=c.getEventCoordinateInternal(N);w.getMap().getView().setCenterInternal(F),window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",A)};E.addEventListener("mousedown",function(){window.addEventListener("mousemove",R),window.addEventListener("mouseup",A)})}setMap(e){const o=this.getMap();if(e!==o){if(o){const n=o.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(hn(e,Gr.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===$t.VIEW){const o=e.oldValue;o&&this.unbindView_(o);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===$t.TARGET||e.key===$t.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const o=new gn({projection:e.getProjection()});this.ovmap_.setView(o)}e.addChangeListener(Mo.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(Mo.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),o=this.ovmap_;if(!e.isRendered()||!o.isRendered())return;const n=e.getSize(),s=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&Ur(s,this.viewExtent_))return;this.viewExtent_=s;const a=o.getSize(),c=o.getView().calculateExtentInternal(a),u=o.getPixelFromCoordinateInternal(Hr(s)),h=o.getPixelFromCoordinateInternal(Wr(s)),f=Math.abs(u[0]-h[0]),w=Math.abs(u[1]-h[1]),b=a[0],E=a[1];f<b*_t||w<E*_t||f>b*Yt||w>E*Yt?this.resetExtent_():fn(c,s)||this.recenter_()}resetExtent_(){const e=this.getMap(),o=this.ovmap_,n=e.getSize(),s=e.getView().calculateExtentInternal(n),a=o.getView(),l=Math.log(Yt/_t)/Math.LN2,c=1/(Math.pow(2,l/2)*_t);$r(s,c),a.fitInternal(qr(s))}recenter_(){const e=this.getMap(),o=this.ovmap_,n=e.getView();o.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),o=this.ovmap_;if(!e.isRendered()||!o.isRendered())return;const n=e.getSize(),r=e.getView(),s=o.getView(),a=this.rotateWithView_?0:-r.getRotation(),l=this.boxOverlay_,c=this.boxOverlay_.getElement(),u=r.getCenterInternal(),h=r.getResolution(),f=s.getResolution(),w=n[0]*h/f,b=n[1]*h/f;if(l.setPosition(u),c){c.style.width=w+"px",c.style.height=b+"px";const E="rotate("+a+"rad)";c.style.transform=E}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Kr(this.ovmap_,pn.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Co),this.collapsed_?Ao(this.collapseLabel_,this.label_):Ao(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};const Za=Ya;new Jt([407354,5754673]),new Jt([404740,5757893]);var Ce,be,pt,ft,gt,ao;class Xa extends ho{constructor(o,n,r){super();L(this,gt);$(this,"label");L(this,Ce,{kind:"available"});L(this,be,void 0);L(this,pt,void 0);L(this,ft,void 0);this.label=n,I(this,be,o),I(this,ft,r),W(this,gt,ao).call(this),I(this,pt,x(this,be).on("change:visible",()=>{W(this,gt,ao).call(this)}))}destroy(){le(x(this,pt))}get status(){return x(this,Ce)}async select(o,n){if(o.type!=="extent")throw new Error(`Unsupported selection kind: ${o.type}`);if(x(this,Ce).kind!=="available"||x(this,be).getSource()===null)return[];const r=[];x(this,be).getSource().forEachFeatureIntersectingExtent(o.extent,l=>{if(!l.getGeometry())return;const c={...l.getProperties()};delete c.geometries;const u={id:l.getId()?.toString()||vn(),geometry:l.getGeometry(),properties:c};r.push(u)});const s=r.filter(l=>l!=null);return s.length>n.maxResults?s.slice(0,n.maxResults):s}}Ce=new WeakMap,be=new WeakMap,pt=new WeakMap,ft=new WeakMap,gt=new WeakSet,ao=function(){const n=x(this,be).getVisible()?{kind:"available"}:{kind:"unavailable",reason:x(this,ft)};n.kind!==x(this,Ce).kind&&(I(this,Ce,n),this.emit("changed:status"))};var mt;class Ja{constructor({intl:e}){L(this,mt,void 0);I(this,mt,e)}createSelectionSource(e){return new Xa(e.vectorLayer,e.label,x(this,mt).formatMessage({id:"layerNotVisibleReason"}))}}mt=new WeakMap;const Pe=pe("local-storage"),Qa=0,ae={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var ze,ne,we,Be,re,Tt,Gn,Ot,Un,Me,it,Se,je,jt,Hn;class el{constructor(e){L(this,Tt);L(this,Ot);L(this,Me);L(this,Se);L(this,jt);L(this,ze,void 0);L(this,ne,{});L(this,we,void 0);L(this,Be,void 0);L(this,re,void 0);I(this,ze,rl(e.properties)),I(this,we,sl()),x(this,we)&&(W(this,Ot,Un).call(this),I(this,Be,W(this,jt,Hn).call(this)))}destroy(){x(this,re)&&(clearTimeout(x(this,re)),I(this,re,void 0)),x(this,we)&&W(this,Me,it).call(this)}get isSupported(){return!!x(this,Be)}get(e){return W(this,Se,je).call(this).get(e)}set(e,o){return W(this,Se,je).call(this).set(e,o)}remove(e){return W(this,Se,je).call(this).remove(e)}removeAll(){return W(this,Se,je).call(this).removeAll()}getNamespace(e){return W(this,Se,je).call(this).getNamespace(e)}}ze=new WeakMap,ne=new WeakMap,we=new WeakMap,Be=new WeakMap,re=new WeakMap,Tt=new WeakSet,Gn=function(){x(this,re)&&clearTimeout(x(this,re)),I(this,re,setTimeout(()=>{I(this,re,void 0),W(this,Me,it).call(this)},Qa))},Ot=new WeakSet,Un=function(){try{const e=x(this,we);if(!e)throw new ie(ae.INTERNAL,"Local storage is not available.");const o=e.getItem(x(this,ze));if(o==null){I(this,ne,{}),W(this,Me,it).call(this);return}try{const n=JSON.parse(o);if(!Ke(n))throw new ie(ae.CORRUPTED_DATA,"Persisted value should be an object.");I(this,ne,n)}catch(n){Pe.warn("Invalid persisted data, reverting to default.",n),I(this,ne,{}),W(this,Me,it).call(this)}}catch(e){Pe.error("Failed to load from local storage",e)}},Me=new WeakSet,it=function(){try{const e=x(this,we);if(!e)throw new ie(ae.INTERNAL,"Local storage is not available.");const o=JSON.stringify(x(this,ne));e.setItem(x(this,ze),o)}catch(e){Pe.error("Failed to save to local storage",e)}},Se=new WeakSet,je=function(){const e=x(this,Be);if(!e)throw new ie(ae.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},jt=new WeakSet,Hn=function(){const e={getByPath:o=>Fo(tl(x(this,ne),o)),setByPath:(o,n)=>{if(!nl(n))throw new ie(ae.INVALID_VALUE,"The value is not supported by local storage.");if(n=Fo(n),o.length===0){if(!Ke(n))throw new ie(ae.INVALID_VALUE,"The root value must be a plain object.");I(this,ne,n)}else ol(x(this,ne),o,n);W(this,Tt,Gn).call(this)}};return new wo([],e)};class wo{path;access;constructor(e,o){this.path=e,this.access=o}get(e){return this.access.getByPath([...this.path,e])}set(e,o){this.access.setByPath([...this.path,e],o)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const o=this.get(e);if(o===void 0)this.set(e,{});else if(!Ke(o))throw new ie(ae.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new wo(this.path.concat([e]),this.access)}}const No="trails-state";function tl(t,e){let o=t;for(const n of e){if(!Ke(o))throw new ie(ae.INVALID_PATH,`Cannot get nested property '${n}' because the parent is no object.`);o=o[n]}return o}function ol(t,e,o){if(!e.length)throw new ie(ae.INTERNAL,"Path must not be empty.");let n=t;for(let s=0,a=e.length-1;s<a;++s){const l=e[s],c=n[l];if(!Ke(c))throw new ie(ae.INVALID_PATH,`Cannot set property on '${l}' because it is no object.`);n=c}const r=e[e.length-1];n[r]=o}function Ke(t){return!!(t&&typeof t=="object"&&!Array.isArray(t))}function nl(t){const e=typeof t;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||t===null||Array.isArray(t)||Ke(t)}function rl(t){const e=t.storageId;return!e||typeof e!="string"?(Pe.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${No}'.`),No):e}function sl(){if(typeof Storage>"u"){Pe.warn("Local storage is not supported by this browser.");return}try{const t=globalThis.localStorage;if(!t){Pe.warn("Local storage is not supported by this browser.");return}return t}catch(t){Pe.warn("Local storage is not supported by this browser.",t);return}}function Fo(t){return t!=null&&(t=JSON.parse(JSON.stringify(t))),t}const il={"ol-map":{name:"ol-map",services:{MapConfigProviderImpl:{name:"MapConfigProviderImpl",clazz:ha,provides:[{name:"map.MapConfigProvider",qualifier:void 0}],references:{vectorSourceFactory:{name:"ogc-features.VectorSourceFactory",qualifier:void 0,all:!1}}},AppModel:{name:"AppModel",clazz:Ha,provides:[{name:"ol-app.AppModel",qualifier:void 0}],references:{ogcSearchSourceFactory:{name:"ogc-features.SearchSourceFactory",qualifier:void 0,all:!1},vectorSelectionSourceFactory:{name:"selection.VectorSelectionSourceFactory",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1},mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1},{name:"ol-app.AppModel",qualifier:void 0,all:!1},{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"editing.EditingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/chakra-integration":{name:"@open-pioneer/chakra-integration",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime":{name:"@open-pioneer/runtime",services:{},ui:{references:[]},properties:{}},"@open-pioneer/http":{name:"@open-pioneer/http",services:{HttpServiceImpl:{name:"HttpServiceImpl",clazz:Yr,provides:[{name:"http.HttpService",qualifier:"http.HttpService"}],references:{interceptors:{name:"http.Interceptor",qualifier:void 0,all:!0}}}},ui:{references:[]},properties:{}},"@open-pioneer/notifier":{name:"@open-pioneer/notifier",services:{NotificationServiceImpl:{name:"NotificationServiceImpl",clazz:Ss,provides:[{name:"notifier.NotificationService",qualifier:"notifier.NotificationService"}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/base-theme":{name:"@open-pioneer/base-theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime-react-support":{name:"@open-pioneer/runtime-react-support",services:{},ui:{references:[]},properties:{}},"@open-pioneer/core":{name:"@open-pioneer/core",services:{},ui:{references:[]},properties:{}},"@open-pioneer/map":{name:"@open-pioneer/map",services:{MapRegistryImpl:{name:"MapRegistryImpl",clazz:Zr,provides:[{name:"map.MapRegistry",qualifier:void 0}],references:{providers:{name:"map.MapConfigProvider",qualifier:void 0,all:!0},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/react-utils":{name:"@open-pioneer/react-utils",services:{},ui:{references:[]},properties:{}},"@open-pioneer/theme":{name:"@open-pioneer/theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/experimental-layout-sidebar":{name:"@open-pioneer/experimental-layout-sidebar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/coordinate-viewer":{name:"@open-pioneer/coordinate-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/ogc-features":{name:"@open-pioneer/ogc-features",services:{VectorSourceFactory:{name:"VectorSourceFactory",clazz:Cs,provides:[{name:"ogc-features.VectorSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}},SearchSourceFactory:{name:"SearchSourceFactory",clazz:Ms,provides:[{name:"ogc-features.SearchSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{}},"@open-pioneer/overview-map":{name:"@open-pioneer/overview-map",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-bar":{name:"@open-pioneer/scale-bar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-viewer":{name:"@open-pioneer/scale-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/result-list":{name:"@open-pioneer/result-list",services:{},ui:{references:[]},properties:{}},"@open-pioneer/toc":{name:"@open-pioneer/toc",services:{},ui:{references:[]},properties:{}},"@open-pioneer/basemap-switcher":{name:"@open-pioneer/basemap-switcher",services:{},ui:{references:[]},properties:{}},"@open-pioneer/geolocation":{name:"@open-pioneer/geolocation",services:{},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/editing":{name:"@open-pioneer/editing",services:{EditingServiceImpl:{name:"EditingServiceImpl",clazz:Ka,provides:[{name:"editing.EditingService",qualifier:void 0}],references:{mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{polygonDrawStyle:{value:{"stroke-color":"yellow","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(0, 0, 255, 0.2)","circle-stroke-color":"rgba(0, 0, 255, 0.7)","circle-stroke-width":2},required:!1}}},"@open-pioneer/legend":{name:"@open-pioneer/legend",services:{},ui:{references:[]},properties:{}},"@open-pioneer/map-navigation":{name:"@open-pioneer/map-navigation",services:{},ui:{references:[]},properties:{}},"@open-pioneer/measurement":{name:"@open-pioneer/measurement",services:{},ui:{references:[]},properties:{}},"@open-pioneer/printing":{name:"@open-pioneer/printing",services:{PrintingServiceImpl:{name:"PrintingServiceImpl",clazz:ys,provides:[{name:"printing.PrintingService",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"printing.PrintingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/search":{name:"@open-pioneer/search",services:{},ui:{references:[]},properties:{}},"@open-pioneer/selection":{name:"@open-pioneer/selection",services:{VectorSelectionSourceFactory:{name:"VectorSelectionSourceFactory",clazz:Ja,provides:[{name:"selection.VectorSelectionSourceFactory",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/spatial-bookmarks":{name:"@open-pioneer/spatial-bookmarks",services:{},ui:{references:[{name:"local-storage.LocalStorageService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/local-storage":{name:"@open-pioneer/local-storage",services:{LocalStorageServiceImpl:{name:"LocalStorageServiceImpl",clazz:el,provides:[{name:"local-storage.LocalStorageService",qualifier:"local-storage.LocalStorageService"}],references:{}}},ui:{references:[]},properties:{storageId:{value:null,required:!1}}}},al=`.search-box{position:absolute;width:500px;max-width:100%;z-index:1}.spatial-bookmarks{max-height:300px}:root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.editing-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.editing-tooltip-hidden{visibility:hidden}.measurement-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.measurement-active-tooltip{background:rgba(0,0,0,.9);border-radius:4px;border-color:#000000e6;opacity:.9;color:#fff}.measurement-finished-tooltip{background-color:#4cb3ffe6;color:#000;border:1px solid white}.measurement-active-tooltip:before,.measurement-finished-tooltip:before{border-top:6px solid rgba(0,0,0,.9);border-right:6px solid transparent;border-left:6px solid transparent;content:"";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.measurement-finished-tooltip:before{border-top-color:#4cb3ff}.printing-overlay{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10000;-webkit-user-select:none;user-select:none;pointer-events:all;cursor:wait;display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:#b4b4b4cc}.printing-overlay-status{flex:1 1 auto;font-size:1.5em;text-align:center}.search-component .chakra-divider{display:none}.search-component .search-highlighted-match{font-weight:700}.search-component .search-value-container{cursor:text;padding-left:30px!important}.search-component .search-invisible{display:none}.selection-drag-box{background-color:#ffffff4d!important;border:3px solid var(--chakra-colors-background_primary)!important}.selection-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.selection .react-select{cursor:default}.map-container .selection-active{cursor:crosshair}.map-container .selection-inactive{cursor:no-drop}.selection-source-value.selection-source-value--disabled{opacity:.4}.selection-source-value.selection-source-value--disabled span{margin:0 6px 0 0}.layout-sidebar{height:100%;position:absolute;top:0}.layout-sidebar[data-theme=light]{background-color:var(--chakra-colors-whiteAlpha-700)}.layout-sidebar[data-theme=dark]{background-color:var(--chakra-colors-blackAlpha-700)}.layout-sidebar .layout-sidebar-main{transition:width .3s ease-out 0s;border-right:1px solid var(--chakra-colors-chakra-border-color)}.layout-sidebar .layout-sidebar-content{overflow:auto;transition:width .3s ease-out 0s}.layout-sidebar .layout-sidebar-content .content-section .content-header{font-size:1.5em;background-color:var(--chakra-colors-blackAlpha-500);padding:.5rem 1rem}.layout-sidebar .layout-sidebar-content .content-section .content-body{padding:1rem}.overview-map .ol-overviewmap{position:relative;height:100%;width:100%}.overview-map .ol-overviewmap:not(.ol-collapsed){border:1px solid black}.overview-map .ol-overviewmap .ol-overviewmap-map{border:none;width:100%;height:100%}.overview-map .ol-overviewmap .ol-overviewmap-box{border:2px solid red}.scale-bar .ol-scale-bar{margin-bottom:8px;margin-right:8px}.scale-bar .ol-scale-bar,.scale-bar .ol-scale-line{position:relative;bottom:0;left:0;background:none}.scale-bar .ol-scale-bar .ol-scale-bar-inner,.scale-bar .ol-scale-bar .ol-scale-line-inner,.scale-bar .ol-scale-line .ol-scale-bar-inner,.scale-bar .ol-scale-line .ol-scale-line-inner{color:var(--chakra-white);border-color:var(--chakra-white)}.result-list-no-data-message{text-align:center;margin-top:50px;font-weight:700;font-size:larger}.result-list-table th,.result-list-table td{overflow-wrap:break-word}.result-list-table.result-list-table--is-resizing *{cursor:col-resize}.result-list-table thead{position:sticky;top:0;z-index:1;background:var(--chakra-colors-background_body)}.result-list-table th{position:relative;border-right-width:thin}.result-list-table tbody tr:hover{background:var(--chakra-colors-background_light)}.result-list-table .result-list-resizer{position:absolute;top:0;height:100%;right:0;width:8px;background:var(--chakra-colors-trails-100);transform:scaleX(.25);cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none;padding-left:0}.result-list-table th:last-child .result-list-resizer{width:8px;transform:translate(50%) scaleX(.25)}.result-list-table th .result-list-resizer.result-list-resizer--is-resizing{background:var(--chakra-colors-trails-500);transform:scale(1)}.result-list-table th .result-list-resizer:hover{transform:scale(1)}
`,ll=["en","de"];function cl(t){switch(t){case"en":return to(()=>import("./c2466a6c428e.js"),[],import.meta.url).then(e=>e.default);case"de":return to(()=>import("./d791bd8f1ea0.js"),[],import.meta.url).then(e=>e.default)}throw new Error(`Unsupported locale: '${t}'`)}const ul=fr(al),dl=Object.freeze(Object.defineProperty({__proto__:null,loadMessages:cl,locales:ll,packages:il,styles:ul},Symbol.toStringTag,{value:"Module"})),hl="@open-pioneer/coordinate-viewer",pl=ce.bind(void 0,hl),fl=4,gl=t=>{const{mapId:e,precision:o,displayProjectionCode:n}=t,{containerProps:r}=oe("coordinate-viewer",t),{map:s}=Y(e),a=s?.olMap,l=On(a)?.getCode()??"";let{coordinates:c}=vl(a);c=c&&n?wl(c,l,n):c;const u=ml(c,o),h=n||l,f=u?u+" "+h:"";return i.jsx(j,{...r,children:i.jsx(he,{className:"coordinate-viewer-text",children:f})})};function ml(t,e){const o=pl();return t?bl(t,e,o):""}function vl(t){const[e,o]=d.useState();return d.useEffect(()=>{if(!t)return;const n=t.on("pointermove",r=>{o(r.coordinate)});return()=>le(n)},[t]),{coordinates:e}}function bl(t,e,o){if(t[0]==null||t[1]==null)return"";const n=e??fl,[r,s]=t,a=o.formatNumber(r,{maximumFractionDigits:n,minimumFractionDigits:n}),l=o.formatNumber(s,{maximumFractionDigits:n,minimumFractionDigits:n});return a+" "+l}function wl(t,e,o){return Xr(t,e,o)}function Vo(t){const e=d.useRef(null);return d.useLayoutEffect(()=>{e.current=t}),d.useCallback((...n)=>{const r=e.current;return r(...n)},[])}const Sl="@open-pioneer/notifier",yl=Xe.bind(void 0,Sl);var Wn=En({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),xl=En({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const _l=!1;function El(t){const{position:e="top-right"}=t,o=Ns(),n=yl("notifier.NotificationService"),[r,s]=d.useState(!_l),a=Vo(c=>{const u=c.level==="error"?i.jsx(Wn,{h:"100%",w:"100%"}):void 0;o({position:e,title:c.title,description:c.message||null,status:c.level,isClosable:!0,duration:c.displayDuration??null,icon:u})}),l=Vo(()=>{o.closeAll()});return d.useEffect(()=>{const c=n.registerHandler({showNotification:a,closeAll:l});return()=>c.destroy()},[r,n,a,l]),i.jsx(i.Fragment,{})}const kl=t=>{const{mapId:e,displayMode:o="line"}=t,{containerProps:n}=oe("scale-bar",t),{map:r}=Y(e),s=d.useRef(null);return d.useEffect(()=>{if(s.current&&r){const a=r.olMap,l=new xs({units:"metric",target:s.current,bar:o==="bar"});return a.addControl(l),()=>{a.removeControl(l)}}},[o,r]),i.jsx(j,{...n,ref:s})},Cl="@open-pioneer/scale-viewer",Ml=ce.bind(void 0,Cl),Al=t=>{const{mapId:e}=t,{containerProps:o}=oe("scale-viewer",t),{map:n}=Y(e),r=Ml(),s=ia(n?.olMap),a=s?r.formatNumber(s):void 0;return i.jsx(j,{...o,children:a&&i.jsxs(he,{children:["1:",a]})})},$n="ol-map",xe=Xe.bind(void 0,$n),Ee=ce.bind(void 0,$n);let Pl=0;function Ll(t,e){const o=`atom${++Pl}`,n={toString:()=>o};return typeof t=="function"?n.read=t:(n.init=t,n.read=function(r){return r(this)},n.write=function(r,s,a){return s(this,typeof a=="function"?a(r(this)):a)}),e&&(n.write=e),n}const zo=t=>"init"in t,Bo=t=>!!t.write,Pt=new WeakMap,Rl=(t,e)=>{Pt.set(t,e),t.catch(()=>{}).finally(()=>Pt.delete(t))},Go=(t,e)=>{const o=Pt.get(t);o&&(Pt.delete(t),o(e))},Uo=(t,e)=>{t.status="fulfilled",t.value=e},Ho=(t,e)=>{t.status="rejected",t.reason=e},Il=t=>typeof t?.then=="function",ot=(t,e)=>!!t&&"v"in t&&"v"in e&&Object.is(t.v,e.v),Wo=(t,e)=>!!t&&"e"in t&&"e"in e&&Object.is(t.e,e.e),Oe=t=>!!t&&"v"in t&&t.v instanceof Promise,Tl=(t,e)=>"v"in t&&"v"in e&&t.v.orig&&t.v.orig===e.v.orig,Et=t=>{if("e"in t)throw t.e;return t.v},So=()=>{const t=new WeakMap,e=new WeakMap,o=new Map;let n,r;const s=g=>t.get(g),a=(g,m)=>{const v=t.get(g);if(t.set(g,m),o.has(g)||o.set(g,v),Oe(v)){const p="v"in m?m.v instanceof Promise?m.v:Promise.resolve(m.v):Promise.reject(m.e);v.v!==p&&Go(v.v,p)}},l=(g,m,v)=>{const p=new Map;let S=!1;v.forEach((M,y)=>{!M&&y===g&&(M=m),M&&(p.set(y,M),m.d.get(y)!==M&&(S=!0))}),(S||m.d.size!==p.size)&&(m.d=p)},c=(g,m,v)=>{const p=s(g),S={d:p?.d||new Map,v:m};if(v&&l(g,S,v),ot(p,S)&&p.d===S.d)return p;if(Oe(p)&&Oe(S)&&Tl(p,S)){if(p.d===S.d)return p;S.v=p.v}return a(g,S),S},u=(g,m,v,p)=>{if(Il(m)){let S;const M=()=>{const C=s(g);if(!Oe(C)||C.v!==y)return;const V=c(g,y,v);e.has(g)&&C.d!==V.d&&X(g,V,C.d)},y=new Promise((C,V)=>{let O=!1;m.then(G=>{O||(O=!0,Uo(y,G),C(G),M())},G=>{O||(O=!0,Ho(y,G),V(G),M())}),S=G=>{O||(O=!0,G.then(q=>Uo(y,q),q=>Ho(y,q)),C(G))}});return y.orig=m,y.status="pending",Rl(y,C=>{C&&S(C),p?.()}),c(g,y,v)}return c(g,m,v)},h=(g,m,v)=>{const p=s(g),S={d:p?.d||new Map,e:m};return v&&l(g,S,v),Wo(p,S)&&p.d===S.d?p:(a(g,S),S)},f=(g,m)=>{const v=s(g);if(!m&&v&&(e.has(g)||Array.from(v.d).every(([O,G])=>{if(O===g)return!0;const q=f(O);return q===G||ot(q,G)})))return v;const p=new Map;let S=!0;const M=O=>{if(O===g){const q=s(O);if(q)return p.set(O,q),Et(q);if(zo(O))return p.set(O,void 0),O.init;throw new Error("no atom init")}const G=f(O);return p.set(O,G),Et(G)};let y,C;const V={get signal(){return y||(y=new AbortController),y.signal},get setSelf(){return!C&&Bo(g)&&(C=(...O)=>{if(!S)return N(g,...O)}),C}};try{const O=g.read(M,V);return u(g,O,p,()=>y?.abort())}catch(O){return h(g,O,p)}finally{S=!1}},w=g=>Et(f(g)),b=g=>{let m=e.get(g);return m||(m=F(g)),m},E=(g,m)=>!m.l.size&&(!m.t.size||m.t.size===1&&m.t.has(g)),k=g=>{const m=e.get(g);m&&E(g,m)&&Z(g)},R=g=>{const m=new Map,v=new WeakMap,p=y=>{var C;const V=new Set((C=e.get(y))==null?void 0:C.t);return o.forEach((O,G)=>{var q;(q=s(G))!=null&&q.d.has(y)&&V.add(G)}),V},S=y=>{p(y).forEach(C=>{C!==y&&(m.set(C,(m.get(C)||new Set).add(y)),v.set(C,(v.get(C)||0)+1),S(C))})};S(g);const M=y=>{p(y).forEach(C=>{var V;if(C!==y){let O=v.get(C);if(O&&v.set(C,--O),!O){let G=!!((V=m.get(C))!=null&&V.size);if(G){const q=s(C),rr=f(C,!0);G=!ot(q,rr)}G||m.forEach(q=>q.delete(C))}M(C)}})};M(g)},A=(g,...m)=>{let v=!0;const p=y=>Et(f(y)),S=(y,...C)=>{let V;if(y===g){if(!zo(y))throw new Error("atom not writable");const O=s(y),G=u(y,C[0]);ot(O,G)||R(y)}else V=A(y,...C);if(!v){const O=P()}return V},M=g.write(p,S,...m);return v=!1,M},N=(g,...m)=>{const v=A(g,...m),p=P();return v},F=(g,m,v)=>{var p;const S=v||[];(p=s(g))==null||p.d.forEach((y,C)=>{const V=e.get(C);V?V.t.add(g):C!==g&&F(C,g,S)}),f(g);const M={t:new Set(m&&[m]),l:new Set};if(e.set(g,M),Bo(g)&&g.onMount){const{onMount:y}=g;S.push(()=>{const C=y((...V)=>N(g,...V));C&&(M.u=C)})}return v||S.forEach(y=>y()),M},Z=g=>{var m;const v=(m=e.get(g))==null?void 0:m.u;v&&v(),e.delete(g);const p=s(g);p&&(Oe(p)&&Go(p.v),p.d.forEach((S,M)=>{if(M!==g){const y=e.get(M);y&&(y.t.delete(g),E(M,y)&&Z(M))}}))},X=(g,m,v)=>{const p=new Set(m.d.keys());v?.forEach((S,M)=>{if(p.has(M)){p.delete(M);return}const y=e.get(M);y&&(y.t.delete(g),E(M,y)&&Z(M))}),p.forEach(S=>{const M=e.get(S);M?M.t.add(g):e.has(g)&&F(S,g)})},P=()=>{let g;for(;o.size;){const m=Array.from(o);o.clear(),m.forEach(([v,p])=>{const S=s(v);if(S){const M=e.get(v);M&&S.d!==p?.d&&X(v,S,p?.d),M&&!(!Oe(p)&&(ot(p,S)||Wo(p,S)))&&M.l.forEach(y=>y())}})}};return{get:w,set:N,sub:(g,m)=>{const v=b(g),p=P(),S=v.l;return S.add(m),()=>{S.delete(m),k(g)}}}};let Zt;const Ol=()=>(Zt||(Zt=So()),Zt),qn=d.createContext(void 0),jl=t=>{const e=d.useContext(qn);return t?.store||e||Ol()},Dl=({children:t,store:e})=>{const o=d.useRef();return!e&&!o.current&&(o.current=So()),d.createElement(qn.Provider,{value:e||o.current},t)},Nl=t=>typeof t?.then=="function",Fl=an.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)});function Vl(t,e){const o=jl(e),[[n,r,s],a]=d.useReducer(u=>{const h=o.get(t);return Object.is(u[0],h)&&u[1]===o&&u[2]===t?u:[h,o,t]},void 0,()=>[o.get(t),o,t]);let l=n;(r!==o||s!==t)&&(a(),l=o.get(t));const c=e?.delay;return d.useEffect(()=>{const u=o.sub(t,()=>{if(typeof c=="number"){setTimeout(a,c);return}a()});return a(),u},[o,t,c]),d.useDebugValue(l),Nl(l)?Fl(l):l}const Kn="@open-pioneer/spatial-bookmarks",zl=Xe.bind(void 0,Kn),Bl=ce.bind(void 0,Kn),ge=pe("spatial-bookmark:SpatialBookmarkViewModel");class Gl{map;packageNamespace;writableBookmarks=Ll([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,o){this.map=e,this.packageNamespace=o.getNamespace("spatial-bookmarks"),this.store=So(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const o=this.map.olMap,n=o.getView().calculateExtent(),r=o.getView().getProjection().getCode(),s={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},a={id:vn(),title:e,extent:s,projection:r};ge.debug("Created a new bookmark",a);const l=this.writableBookmarks;this.store.set(l,[...this.store.get(l),a])}activateBookmark(e){ge.debug("Activating bookmark",e);const o=this.getBookmarkExtent(e);ge.debug("Attempting to apply extent",o),this.applyExtent(o)}deleteBookmark(e){ge.debug("Deleting bookmark",e);const o=this.writableBookmarks;this.store.set(o,[...this.store.get(o).filter(n=>n.id!==e)])}deleteAllBookmarks(){ge.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){ge.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{Ul(e),this.store.set(this.writableBookmarks,e)}catch(o){ge.error("Bookmarks data in local storage is invalid, resetting to default value.",o),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){ge.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const n=this.map.olMap.getView(),r=e.extent,s=[r.minX,r.minY,r.maxX,r.maxY],a=n.getProjection(),l=e.projection;return Jr(s,l,a)}applyExtent(e){const n=this.map.olMap.getView(),r=Qr(e),s=n.getResolutionForExtent(e);n.setCenter(r),n.setResolution(s)}}function Ul(t){if(!Array.isArray(t))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of t)Hl(e)}function Hl(t){if(!t||typeof t!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=t;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(Wl(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function Wl(t){if(!t||typeof t!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=t;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const $l=t=>{const{map:e}=Y(t.mapId),o=zl("local-storage.LocalStorageService"),n=Ql(e,o);return n&&i.jsx(Dl,{store:n.store,children:i.jsx(ql,{...t,viewModel:n})})};function ql(t){const{viewModel:e}=t,o=Bl(),n=d.useRef([]),[r,s]=d.useState(!1),a=Vl(e.bookmarks),[l,c]=d.useState(""),u=l.trim().length>0,{containerProps:h}=oe("spatial-bookmarks",t),[f,w]=d.useState("list"),b=()=>{e.deleteAllBookmarks(),w("list")},E=()=>{u&&(e.createBookmark(l),w("list"),c(""),s(!0))};d.useEffect(()=>{if(r){const F=n.current;F&&F[a.length-1]?.scrollIntoView?.(),s(!1)}},[a,r]);const k=()=>i.jsxs(eo,{children:[i.jsxs(Ht,{rounded:"md",status:"warning",children:[i.jsx(Wt,{}),o.formatMessage({id:"bookmark.alert.delete"})]}),i.jsx(Xl,{intl:o,onClear:b,onCancel:()=>w("list")})]}),R=()=>i.jsxs(eo,{children:[i.jsxs(Ht,{rounded:"md",status:"info",children:[i.jsx(Wt,{}),o.formatMessage({id:"bookmark.alert.create"})]}),i.jsx(Bt,{"aria-label":o.formatMessage({id:"bookmark.input.label"}),placeholder:o.formatMessage({id:"bookmark.input.placeholder"}),value:l,onChange:F=>{c(F.target.value)},onKeyDown:F=>{F.key==="Enter"&&E()},isRequired:!0,isInvalid:!u,autoFocus:!0}),i.jsx(Jl,{intl:o,isInvalid:!u,onCancel:()=>{c(""),w("list")},onSave:E})]}),A=()=>i.jsxs(i.Fragment,{children:[a.length?Kl(a,e,o,n):i.jsxs(Ht,{rounded:"md",status:"info",children:[i.jsx(Wt,{}),o.formatMessage({id:"bookmark.alert.noSaved"})]}),i.jsx(Zl,{intl:o,bookmarks:a,showCreate:()=>w("create"),showDelete:()=>w("delete")})]}),N=i.jsxs(i.Fragment,{children:[f==="list"&&A(),f==="create"&&R(),f==="delete"&&k()]});return i.jsx(de,{flexDirection:"column",...h,children:N})}function Kl(t,e,o,n){const r=o.formatMessage({id:"bookmark.button.deleteOne"}),s=t.map((a,l)=>i.jsx(Yl,{index:l,listItemNodes:n,bookmark:a,onActivate:()=>e.activateBookmark(a),onDelete:()=>e.deleteBookmark(a.id),deleteBtnLabel:r},a.id));return i.jsx(xn,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":o.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:s})}const $o={ArrowDown:1,ArrowUp:-1};function Yl(t){const{index:e,listItemNodes:o,bookmark:n,onDelete:r,onActivate:s,deleteBtnLabel:a}=t,l=n.title,c=u=>{const h=u.key;if(h==="Enter"){u.target===u.currentTarget&&s();return}if($o[h]!=null){const f=o.current?.length;if(!f)return;let w=(e+$o[h])%f;w<0&&(w=f-1),o.current[w]?.focus()}};return i.jsx(j,{as:"li",p:1,ref:u=>{if(!u){o.current.splice(e,1);return}o.current[e]=u},className:yt("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:c,onClick:s,children:i.jsxs(de,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[i.jsx(Mn,{children:i.jsx(Sn,{})}),i.jsx(he,{ps:2,noOfLines:1,children:l}),i.jsx(Rs,{}),i.jsx(ln,{hasArrow:!0,label:a,placement:"right",children:i.jsx(Vt,{className:"spatial-bookmarks-item-delete","aria-label":a,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:i.jsx(yn,{}),onClick:u=>{r(),u.stopPropagation()}})},e)]})})}function Zl(t){const{intl:e,bookmarks:o,showCreate:n,showDelete:r}=t;return i.jsxs(yo,{children:[i.jsx(Ye,{isDisabled:o.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:i.jsx(yn,{}),onClick:r,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),i.jsx(Ye,{onClick:n,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function Xl(t){const{intl:e,onCancel:o,onClear:n}=t;return i.jsxs(yo,{children:[i.jsx(Ye,{variant:"outline",onClick:o,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),i.jsx(Ye,{onClick:n,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function Jl(t){const{intl:e,onCancel:o,onSave:n,isInvalid:r}=t;return i.jsxs(yo,{children:[i.jsx(Ye,{variant:"outline",onClick:()=>o(),children:e.formatMessage({id:"bookmark.button.cancel"})}),i.jsx(Ye,{isDisabled:r,onClick:()=>n(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function yo(t){return i.jsx(de,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:t.children})}function Ye(t){return i.jsx(Vt,{width:"100%",...t})}function Ql(t,e){const[o,n]=d.useState();return d.useEffect(()=>{let r;return t?r=new Gl(t,e):r=void 0,n(r),()=>r?.destroy()},[t,e]),o}function ec(){const t=d.useId(),e=Ee();return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"spatialBookmarkTitle"})}),children:i.jsx($l,{mapId:B})})})})}const Yn="@open-pioneer/printing",qo=Xe.bind(void 0,Yn),tc=ce.bind(void 0,Yn),oc="map";class nc{olMap;title="";fileFormat="pdf";i18n;printingService;printMap=void 0;overlay=void 0;constructor(e,o,n){this.olMap=e,this.printingService=o,this.i18n=n}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=_s(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",o=this.title||oc;return{title:e,fileName:o}}async exportMapInPNG(e){const o=document.createElement("canvas");o.width=e.width,o.height=e.height+50,o.style.backgroundColor="#fff";const n=o.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:r,fileName:s}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,o.width,o.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const a=o.width/2;n.fillText(r,a,20),n.drawImage(e,0,50);const l=document.createElement("a");l.setAttribute("download",s+".png");const c=Es(o);if(!c)throw new Error("Failed to get image data URL");l.href=c,l.click()}async exportMapInPDF(e){const{jsPDF:o}=await to(()=>import("./f7ffddae5ee1.js"),["./f7ffddae5ee1.js","./a419295615be.js","./fa97955b3ec5.js","./a804c6ae25fd.js","./ea69738d0fa3.js","./4533599bd8ef.js","./f413d8ffea52.js","./81064a1e15a2.js","./3f67a442b387.js"],import.meta.url),n=new o({orientation:"landscape",unit:"mm",format:"a4"}),r=n.internal.pageSize.getWidth(),s=n.internal.pageSize.getHeight(),a=15,l=20,c=s-l;n.setFontSize(20);const{title:u,fileName:h}=this.getTitleAndFileName();n.text(u,r/2,a,{align:"center"});const f=e.width/e.height;let w=c,b=w*f;b>=r&&(b=r,w=b/f);const E=(r-b)/2,k=l+(c-w)/2;n.addImage(e,"",E,k,b,w),n.save(h+".pdf")}}const rc=pe("printing"),sc=t=>{const e=tc(),{mapId:o}=t,{containerProps:n}=oe("printing",t),[r,s]=d.useState("pdf"),[a,l]=d.useState(""),[c,u]=d.useState(!1),h=qo("printing.PrintingService"),f=qo("notifier.NotificationService"),{map:w}=Y(o),b=ic(w,e,h);d.useEffect(()=>{b?.setFileFormat(r)},[b,r]),d.useEffect(()=>{b?.setTitle(a)},[b,a]);function E(R){(R==="png"||R==="pdf")&&s(R)}function k(){c||!b||(u(!0),b.handleMapExport().catch(R=>{const A=e.formatMessage({id:"printingFailed"});f.notify({level:"error",message:A}),rc.error("Failed to print the map",R)}).finally(()=>{u(!1)}))}return i.jsxs(j,{...n,children:[i.jsxs(At,{mb:4,alignItems:"center",children:[i.jsxs(oo,{mb:2,children:[i.jsx(at,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),i.jsx(Bt,{placeholder:e.formatMessage({id:"input.placeholder"}),value:a,onChange:R=>{l(R.target.value)},isRequired:!0,autoFocus:!0})]}),i.jsxs(oo,{mb:2,children:[i.jsx(at,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),i.jsxs(go,{value:r,onChange:R=>E(R.target.value),className:"printing-select",children:[i.jsx("option",{value:"png",children:"PNG"}),i.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),i.jsx(Vt,{isLoading:c,loadingText:e.formatMessage({id:"printingMap"}),disabled:c,padding:2,className:"printing-export-button",onClick:k,width:"100%",children:e.formatMessage({id:"export"})})]})};function ic(t,e,o){const[n,r]=d.useState(void 0);return d.useEffect(()=>{if(!t)return;const s=new nc(t.olMap,o,{overlayText:e.formatMessage({id:"printingMap"})});return r(s),()=>{s.destroy(),r(void 0)}},[t,e,o]),n}function ac(){const t=d.useId(),e=Ee();return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"printingTitle"})}),children:i.jsx(sc,{mapId:B})})})})}const lc="@open-pioneer/legend",Zn=ce.bind(void 0,lc),cc=t=>{const{mapId:e,showBaseLayers:o=!1}=t,{containerProps:n}=oe("legend",t),{map:r}=Y(e);return i.jsx(j,{...n,children:r?i.jsx(uc,{map:r,showBaseLayers:o}):null})};function uc(t){const{map:e,showBaseLayers:o}=t,r=pc(e).map(s=>i.jsx(Xn,{layer:s,showBaseLayers:o},s.id));return i.jsx(xn,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:r})}function Xn(t){const{layer:e,showBaseLayers:o}=t,{isVisible:n}=gc(e),r=fc(e);if(!n||!o&&!("parentLayer"in e)&&e.isBaseLayer)return;const s=[];return r?.length&&r.forEach(a=>{s.push(i.jsx(Xn,{layer:a,showBaseLayers:o},a.id))}),i.jsxs(i.Fragment,{children:[i.jsx(dc,{layer:e,showBaseLayers:o}),s]})}function dc(t){const e=Zn(),{layer:o,showBaseLayers:n}=t,r=mc(o),s=hc(o);let a;r?.Component?a=i.jsx(r.Component,{layer:o}):r?.imageUrl?a=i.jsx(Ko,{layer:o,imageUrl:r.imageUrl}):s&&(a=i.jsx(Ko,{layer:o,imageUrl:s}));const l=!("parentLayer"in o)&&o.isBaseLayer;return a?i.jsxs(j,{as:"li",className:yt("legend-item",`layer-${vc(o.id)}`),children:[n&&l?i.jsx(he,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,a]}):void 0}function Ko(t){const e=Zn(),{layer:o,imageUrl:n}=t;return i.jsxs(j,{children:[i.jsx(he,{children:o.title}),i.jsx(ks,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:o.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:i.jsx(j,{children:i.jsxs(he,{children:[i.jsx(Wn,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function hc(t){const e=d.useCallback(()=>t.legend,[t]),o=d.useCallback(n=>{const r=t.on("changed:legend",n);return()=>r.destroy()},[t]);return d.useSyncExternalStore(o,e)}function pc(t){const e=d.useCallback(n=>{const r=t.layers.on("changed",n);return()=>r.destroy()},[t]),o=d.useCallback(()=>{let n=t.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[t]);return Jn(e,o)}function fc(t){const e=d.useCallback(n=>{const r=t.sublayers?.on("changed",n);return()=>r?.destroy()},[t]),o=d.useCallback(()=>{if(!t.sublayers)return;let r=t.sublayers?.getSublayers({sortByDisplayOrder:!0});return r=r.reverse(),r},[t]);return Jn(e,o)}function Jn(t,e){const o=d.useRef(),n=d.useCallback(s=>{const a=t(()=>{o.current=void 0,s()});return()=>{o.current=void 0,a()}},[t]),r=d.useCallback(()=>{if(o.current)return o.current.value;const s=e();return o.current={value:s},s},[e]);return d.useSyncExternalStore(n,r)}function gc(t){const e=d.useCallback(()=>t.visible,[t]),o=d.useCallback(r=>{const s=t.on("changed:visible",r);return()=>s.destroy()},[t]);return{isVisible:d.useSyncExternalStore(o,e)}}function mc(t){const[e,o]=d.useState(void 0);return d.useEffect(()=>{o(t.attributes.legend);const n=t.on("changed:attributes",()=>{o(t.attributes.legend)});return()=>n.destroy()},[t]),e}function vc(t){return t.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function bc(){const t=d.useId(),e=Ee();return i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"legendTitle"})}),children:i.jsx(j,{overflowY:"auto",maxHeight:300,children:i.jsx(cc,{mapId:B,showBaseLayers:!0})})})})}const Qn="@open-pioneer/geolocation",wc=Xe.bind(void 0,Qn),Sc=ce.bind(void 0,Qn);function yc(t){return Is({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(t)}const Yo=pe("geolocation:GeolocationController"),Zo=17;class xc extends ho{olMap;positionHighlightLayer;geolocation;maxZoom=Zo;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,o){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Po,this.accuracyFeature.setStyle(Jo()),this.positionFeature=new Po,this.positionFeature.setStyle(Xo()),this.positionHighlightLayer=new _e({source:new Ze({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(po);const n=o||_c();this.geolocation=new Wi({tracking:!1,trackingOptions:n,projection:e.getView()?.getProjection()}),this.trackingOptions=n,this.geolocation.on("error",r=>this.handleGeolocationError(r))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(n=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const r=this.geolocation.on("change:accuracyGeometry",()=>{const c=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(c),this.accuracyFeature?.getGeometry()!==void 0&&n(),this.isInitialZoom){const u=this?.accuracyFeature?.getGeometry()?.getExtent();if(u){const h=la(u);if(!h)return;e.getView().fit(h,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),s=this.geolocation.on("change:position",()=>{const c=this.geolocation.getPosition();c&&(c[0]||c[1])!==void 0&&(this.positionFeature?.setGeometry(new Jt(c)),this.setMapToPosition&&e.getView().setCenter(c),this.positionFeature?.getGeometry()!==void 0&&n())}),a=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),l=e.on("pointermove",c=>{c.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(r,s,a,l),e.addLayer(this.positionHighlightLayer)}).catch(n=>{Yo.error("Failed to determine location",n)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{le(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??Xo())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??Jo())}setMaxZoom(e){this.maxZoom=e??Zo}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){Yo.error("Error from geolocation API:",e.message);const o=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",o)}}const Xo=()=>new Le({image:new uo({radius:6,fill:new We({color:"#3399CC"}),stroke:new Ae({color:"#fff",width:2})})}),Jo=()=>new Le({stroke:new Ae({color:"#3399CC",width:3}),fill:new We({color:"rgba(0, 0, 255, 0.05)"})}),_c=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),Ec=d.forwardRef(function(e,o){const{mapId:n,maxZoom:r,positionFeatureStyle:s,accuracyFeatureStyle:a,trackingOptions:l}=e,{containerProps:c}=oe("geolocation",e),u=!!navigator.geolocation,[h,f]=d.useState(!1),[w,b]=d.useState(!1),{map:E}=Y(n),k=Sc(),R=wc("notifier.NotificationService"),A=kc(E,r,l,s,a),N=(()=>u?h?k.formatMessage({id:"locateMeEnd"}):k.formatMessage({id:"locateMeStart"}):k.formatMessage({id:"locateNotSupported"}))();d.useEffect(()=>{if(A===void 0)return;const Z=A.on("error",function(X){const P=k.formatMessage({id:"error"}),H=(()=>{switch(X){case"permission-denied":return k.formatMessage({id:"permissionDenied"});case"position-unavailable":return k.formatMessage({id:"positionUnavailable"});case"timeout":return k.formatMessage({id:"timeout"});case"unknown":return k.formatMessage({id:"unknownError"})}})();b(!1),f(!1),R.notify({level:"error",title:P,message:H})});return()=>{Z.destroy()}},[A,k,R]),d.useEffect(()=>{if(!A){b(!1);return}return h&&(b(!0),A.startGeolocation().then(()=>{b(!1)})),()=>{A?.stopGeolocation(),b(!1)}},[A,h]);const F=()=>{E&&f(!h)};return i.jsx(ee,{ref:o,label:N,icon:i.jsx(yc,{}),onClick:()=>F(),isActive:h,isLoading:w,isDisabled:!u,...c})});function kc(t,e,o,n,r){const[s,a]=d.useState();return d.useEffect(()=>{if(!t)return;const l=new xc(t.olMap,o);return a(l),()=>{l.destroy(),a(void 0)}},[t,o]),d.useEffect(()=>{s?.setPositionFeatureStyle(n)},[s,n]),d.useEffect(()=>{s?.setAccuracyFeatureStyle(r)},[s,r]),d.useEffect(()=>{s?.setMaxZoom(e)},[s,e]),s}function Cc(t){const{toolState:e,onToolStateChange:o}=t,n=Ee(),r=xe("ol-app.AppModel"),s=qe(r.state).resultListState,a=s.open,{map:l}=Y(B),c=xe("editing.EditingService"),u=xe("notifier.NotificationService"),h=Re((f,w)=>{o(f,w??!e[f])});return Mc(l,c,u,n,e,h),i.jsxs(de,{role:"toolbar","aria-label":n.formatMessage({id:"ariaLabel.toolbar"}),direction:"column",gap:1,padding:1,children:[i.jsx(ee,{label:e.editingActive?n.formatMessage({id:"stopEditingTitle"}):n.formatMessage({id:"startEditingTitle"}),icon:e.editingActive?i.jsx(as,{}):i.jsx(ls,{}),isActive:e.editingActive,onClick:()=>h("editingActive")}),i.jsx(ee,{label:n.formatMessage({id:"resetEditingTitle"}),icon:i.jsx(cs,{}),onClick:()=>c.reset(B)}),s.input&&i.jsx(ee,{label:n.formatMessage({id:"resultListTitle"}),icon:i.jsx(us,{}),isActive:s.open,onClick:()=>r.setResultListVisibility(!a)}),i.jsx(ee,{label:n.formatMessage({id:"printingTitle"}),icon:i.jsx(ds,{}),isActive:e.printingActive,onClick:()=>h("printingActive")}),i.jsx(ee,{label:n.formatMessage({id:"spatialBookmarkTitle"}),icon:i.jsx(hs,{}),isActive:e.bookmarksActive,onClick:()=>h("bookmarksActive")}),i.jsx(Ec,{mapId:B}),i.jsx(ee,{label:n.formatMessage({id:"tocTitle"}),icon:i.jsx(ps,{}),isActive:e.tocActive,onClick:()=>h("tocActive")}),i.jsx(ee,{label:n.formatMessage({id:"legendTitle"}),icon:i.jsx(fs,{}),isActive:e.legendActive,onClick:()=>h("legendActive")}),i.jsx(ee,{label:n.formatMessage({id:"measurementTitle"}),icon:i.jsx(gs,{}),isActive:e.measurementActive,onClick:()=>h("measurementActive")}),i.jsx(ee,{label:n.formatMessage({id:"selectionTitle"}),icon:i.jsx(ms,{}),isActive:e.selectionActive,onClick:()=>h("selectionActive")}),i.jsx(ee,{label:n.formatMessage({id:"overviewMapTitle"}),icon:i.jsx(Sn,{}),isActive:e.overviewMapActive,onClick:()=>h("overviewMapActive")}),i.jsx(As,{mapId:B}),i.jsx(Ps,{mapId:B}),i.jsx(Ls,{mapId:B})]})}function Mc(t,e,o,n,r,s){d.useEffect(()=>{if(!t)return;function a(){if(!t)throw Error("map is undefined");try{const c=t.layers.getLayerById("krankenhaus"),u=new URL(c.attributes.collectionURL+"/items");e.start(t,u).whenComplete().then(f=>{if(!f)return;o.notify({level:"info",message:n.formatMessage({id:"editing.featureCreated"},{featureId:f}),displayDuration:4e3}),(c?.olLayer).getSource()?.refresh()}).catch(f=>{console.error(f)}).finally(()=>{s("editingActive",!1)})}catch(c){console.log(c)}}function l(){e.stop(B)}r.editingActive?a():l()},[t,e,o,n,r.editingActive,s])}const Ac="@open-pioneer/measurement",Pc=ce.bind(void 0,Ac);class Lc{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,o){this.olMap=e,this.messages=o;const n=this.source=new Ze;this.layer=new _e({source:n}),this.layer.setZIndex(po),e.addLayer(this.layer);const r=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){le(r)}});const s=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",s),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",s)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const o=es(e);this.activeFeatureStyle=(n,...r)=>{const s=n?.getGeometry()?.getType();if(s==="Polygon"||s==="LineString"||s==="Point")return o(n,...r)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const o=e==="area"?"Polygon":"LineString",n=this.draw=new _n({source:this.source,type:o,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let r,s;n.on("drawstart",a=>{r=this.measureTooltip=this.createMeasureTooltip();const l=this.sketch=a.feature;if(!l)return;let c;s=l.getGeometry()?.on("change",u=>{const h=u.target,f=this.olMap.getView().getProjection();let w="";h instanceof bn?(w=Ic(h,f,this.messages),c=h.getInteriorPoint().getCoordinates()||null):h instanceof Cn&&(w=Tc(h,f,this.messages),c=h.getLastCoordinate()||null),r&&(r.element.innerHTML=w,c&&r?.overlay.setPosition(c))})}),n.on("drawend",()=>{if(r){const a=r.element.classList;a.remove("measurement-active-tooltip"),a.remove("printing-hide"),a.add("measurement-finished-tooltip"),r.overlay.setOffset([0,-7]),this.overlayTooltips.push(r),this.measureTooltip=r=void 0}this.sketch=void 0,s&&le(s)}),n.on("drawabort",()=>{r&&(r.destroy(),this.measureTooltip=r=void 0),this.sketch=void 0,s&&le(s)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const o=new lt({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n=this.olMap;return n.addOverlay(o),{overlay:o,element:e,destroy(){n.removeOverlay(o)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const o=new lt({element:e,offset:[15,0],positioning:"center-left"}),n=this.olMap;return n.addOverlay(o),{overlay:o,element:e,destroy(){n.removeOverlay(o)}}}handlePointerMove(e){if(e.dragging)return;const o=this.helpTooltip,n=Rc(this.messages,this.sketch);o.element.textContent=n,o.overlay.setPosition(e.coordinate),o.element.classList.remove("hidden")}}function Rc(t,e){if(e){const o=e.getGeometry();if(o instanceof bn||o instanceof Cn)return t.getContinueMessage()}return t.getHelpMessage()}function Ic(t,e,o){const n=ts(t,{projection:e});let r;return n>=1e6?r=`${o.formatNumber(n/1e6)} km<sup>2</sup>`:r=`${o.formatNumber(n)} m<sup>2</sup>`,r}function Tc(t,e,o){const n=os(t,{projection:e});let r;return n>=1e3?r=`${o.formatNumber(n/1e3)} km`:r=`${o.formatNumber(n)} m`,r}const Oc=t=>{const e=Pc(),{mapId:o,activeFeatureStyle:n,finishedFeatureStyle:r}=t,{containerProps:s}=oe("measurement",t),[a,l]=d.useState("distance"),c=b=>e.formatMessage({id:b}),u=Y(o),h=jc(u.map,e);d.useEffect(()=>{h?.setActiveFeatureStyle(n??Dc())},[h,n]),d.useEffect(()=>{h?.setFinishedFeatureStyle(r??Nc())},[h,r]),d.useEffect(()=>{if(h)return h.startMeasurement(a),()=>{h.stopMeasurement()}},[h,a]);function f(b){if(b==="distance"||b==="area")l(b);else throw new Error(`Unexpected measurement type: '${b}'.`)}function w(){h?.clearMeasurements()}return i.jsxs(j,{...s,children:[i.jsx(he,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),i.jsx(At,{mb:4,alignItems:"center",children:i.jsxs(oo,{mb:2,children:[i.jsx(at,{mb:1,children:c("measurementLabel")}),i.jsxs(go,{value:a,onChange:b=>f(b.target.value),className:"measurement-select",children:[i.jsx("option",{value:"distance",children:c("distance")}),i.jsx("option",{value:"area",children:c("area")})]})]})}),i.jsx(Vt,{padding:2,className:"measurement-delete-button",onClick:w,width:"100%",children:c("deleteMeasurementLabel")})]})};function jc(t,e){const[o,n]=d.useState(void 0);return d.useEffect(()=>{if(!t)return;const r=new Lc(t.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(s){return e.formatNumber(s,{maximumFractionDigits:2})}});return n(r),()=>{r.destroy(),n(void 0)}},[t,e]),o}function Dc(){return[new Le({stroke:new Ae({color:"#fff",lineDash:[10,10],width:5})}),new Le({fill:new We({color:"rgba(0,0,0,0.15)"}),stroke:new Ae({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new uo({radius:5,stroke:new Ae({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new We({color:"rgba(255, 255, 255, 0.2)"})})})]}function Nc(){return[new Le({stroke:new Ae({color:"#fff",width:5})}),new Le({stroke:new Ae({color:"#0b96fc",width:3}),fill:new We({color:"rgba(11,150,252,0.15)"})})]}function Fc(){const t=d.useId(),e=Ee();return i.jsx(j,{role:"dialog","aria-labelledby":t,children:i.jsx(Ie,{title:i.jsx(Te,{id:t,size:"md",mb:2,children:e.formatMessage({id:"measurementTitle"})}),children:i.jsx(Oc,{mapId:B})})})}const Vc="200px",zc="300px",Bc=t=>{const{mapId:e,olLayer:o,height:n=Vc,width:r=zc}=t,{containerProps:s}=oe("overview-map",t),a=d.useRef(null),{map:l}=Y(e);return d.useEffect(()=>{if(a.current&&l&&o){const c=l.olMap,u=new Za({className:"ol-overviewmap",layers:[o],collapsible:!1,collapsed:!1,target:a.current});return c.addControl(u),()=>{c.removeControl(u)}}},[l,o]),i.jsx(j,{height:n,width:r,ref:a,...s})};function Gc(){const t=d.useMemo(()=>new co({source:new mn}),[]);return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",maxWidth:325,children:i.jsx(j,{role:"dialog",children:i.jsx(Bc,{mapId:B,olLayer:t})})})}function Uc(){const t=xe("ol-app.AppModel"),e=qe(t.state).resultListState,[o,n]=d.useState([]),[r,s]=d.useState([]),a=d.useCallback(l=>{n(l.features),s(l.getFeatureIds())},[]);return d.useEffect(()=>{console.log("Anzahl Features: "+o.length),console.log("SelectedIds: "+r.toString())},[o,r]),e.input&&i.jsx(j,{className:"result-list-container",position:"absolute",visibility:e.open?"visible":"hidden",bottom:"0",backgroundColor:"white",width:"100%",height:"400px",zIndex:1,borderTop:"2px solid",borderBottom:"2px solid",borderColor:"trails.100",children:i.jsx(Os,{input:e.input,mapId:B,onSelectionChange:a},e.key)})}const Hc="@open-pioneer/search",Gt=ce.bind(void 0,Hc);function Wc(t){const e=t.selectProps.inputValue.length>0,o={...t,className:yt(t.className,{"search-invisible":!e})};return i.jsx(fe.Menu,{...o,children:t.children})}function $c(t){const o=Gt().formatMessage({id:"noOptionsText"});return i.jsx(fe.NoOptionsMessage,{...t,children:i.jsx(te.span,{className:"search-no-match",children:o})})}function qc(t){const o=Gt().formatMessage({id:"loadingText"});return i.jsx(fe.LoadingMessage,{...t,children:i.jsx(te.span,{className:"search-loading-text",children:o})})}function Kc({children:t,...e}){const o={...e,className:yt(e.className,"search-value-container")};return i.jsxs(fe.ValueContainer,{...o,children:[!!t&&i.jsx(xl,{style:{position:"absolute",left:8}}),t]})}function Yc(t){const e={...t,isHidden:!1};return i.jsx(fe.Input,{...e})}function Zc(t){return null}function Xc(t){return i.jsxs(fe.IndicatorsContainer,{...t,children:[t.children,!t.selectProps.isLoading&&t.selectProps.inputValue&&i.jsx(Jc,{selectProps:t.selectProps,clearValue:t.clearValue})]})}function Jc(t){const o=Gt().formatMessage({id:"ariaLabel.clearButton"}),n=r=>{r.preventDefault(),r.stopPropagation(),t.clearValue()};return i.jsx(gr,{role:"button",size:"md",mr:1,"aria-label":o,onClick:n,onTouchEnd:n,onMouseDown:r=>r.preventDefault()})}function Qc(t){return null}function eu(t){const e=t.selectProps.inputValue,o=t.data.label,n={...t,className:yt(t.className,"search-option")};return i.jsx(fe.Option,{...n,children:i.jsx(te.div,{className:"search-option-label",children:e.trim().length>0?tu(o,e):o})})}function tu(t,e){const o=t.toLowerCase().indexOf(e.toLowerCase());return o>=0?i.jsxs(i.Fragment,{children:[t.substring(0,o),i.jsx(te.span,{className:"search-highlighted-match",children:t.substring(o,o+e.length)},"highlighted"),t.substring(o+e.length)]}):t}const Qo=pe("search:SearchController"),en=200,tn=5;var vt,Ge,Ue,He,se,Dt,er;class ou{constructor(e,o){L(this,Dt);L(this,vt,void 0);L(this,Ge,[]);L(this,Ue,tn);L(this,He,en);L(this,se,void 0);I(this,vt,e),I(this,Ge,o)}destroy(){x(this,se)?.abort(),I(this,se,void 0)}async search(e){if(x(this,se)?.abort(),I(this,se,void 0),!e)return[];const o=I(this,se,new AbortController);try{return await nu(o.signal,x(this,He)),o.signal.aborted&&(Qo.debug(`search canceled with ${e}`),mr()),(await Promise.all(x(this,Ge).map(r=>W(this,Dt,er).call(this,r,e,o.signal)))).filter(r=>r!=null)}finally{x(this,se)===o&&I(this,se,void 0)}}get searchTypingDelay(){return x(this,He)}set searchTypingDelay(e){I(this,He,e??en)}get maxResultsPerSource(){return x(this,Ue)}set maxResultsPerSource(e){I(this,Ue,e??tn)}get sources(){return x(this,Ge)}}vt=new WeakMap,Ge=new WeakMap,Ue=new WeakMap,He=new WeakMap,se=new WeakMap,Dt=new WeakSet,er=async function(e,o,n){const r=e.label,s=x(this,vt).olMap.getView().getProjection();try{const a=x(this,Ue);let l=await e.search(o,{maxResults:a,signal:n,mapProjection:s});return l.length>a&&(l=l.slice(0,a)),{label:r,source:e,results:l}}catch(a){Mt(a)||Qo.error(`search for source ${r} failed`,a);return}};async function nu(t,e){t.aborted||await new Promise(o=>{const n=()=>{t.removeEventListener("abort",n),clearTimeout(r),o()};t.addEventListener("abort",n);const r=setTimeout(n,e)})}const Lt=pe("search:Search"),ru=t=>{const{mapId:e,sources:o,searchTypingDelay:n,maxResultsPerGroup:r,onSelect:s,onClear:a}=t,{containerProps:l}=oe("search",t),{map:c}=Y(e),u=Gt(),h=lu(o,n,r,c),{input:f,search:w,selectedOption:b,onInputChanged:E,onResultConfirmed:k}=cu(h),R=au(),A=su(u),N=iu(),F=Re((P,H)=>{H.action==="input-change"&&E(P)}),Z=Re((P,H)=>{switch(H.action){case"select-option":P&&(k(P),s?.({source:P.source,result:P.result}));break;case"clear":E(""),X.current?.blur(),X.current?.focus(),a?.();break;default:Lt.debug(`Unhandled action type '${H.action}'.`);break}}),X=d.useRef(null);return i.jsx(j,{...l,children:i.jsx(no,{className:"search-component",classNamePrefix:"react-select",ref:X,inputValue:f,onInputChange:F,"aria-label":u.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:A,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:R,isClearable:!0,placeholder:u.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:w.kind==="loading",options:w.kind==="ready"?w.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:N,onChange:Z,value:b,menuPosition:"fixed"})})};function su(t){return d.useMemo(()=>({onFocus:({focused:s})=>`${s.label} ${t.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:s,label:a})=>{let l="";switch(s){case"select-option":l=`${a} ${t.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":l=`${a} ${t.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return l},guidance:()=>`${t.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[t])}function iu(){return d.useMemo(()=>({Menu:Wc,Input:Yc,SingleValue:Zc,Option:eu,NoOptionsMessage:$c,LoadingMessage:qc,ValueContainer:Kc,IndicatorsContainer:Xc,ClearIndicator:Qc}),[])}function au(){const[t,e]=cn("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return d.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:t,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[t,e])}function lu(t,e,o,n){const[r,s]=d.useState(void 0);return d.useEffect(()=>{if(!n)return;const a=new ou(n,t);return s(a),()=>{a.destroy(),s(void 0)}},[n,t]),d.useEffect(()=>{r&&(r.searchTypingDelay=e)},[r,e]),d.useEffect(()=>{r&&(r.maxResultsPerSource=o)},[r,o]),r}function cu(t){const[e,o]=d.useReducer((l,c)=>{switch(c.kind){case"input":return{...l,query:c.query,selectedOption:null};case"select-option":return{...l,selectedOption:c.option,query:c.option.label};case"load-results":return{...l,search:{kind:"loading"}};case"accept-results":return{...l,search:{kind:"ready",results:c.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=d.useRef(),r=Re(l=>{if(!t){n.current=void 0,o({kind:"accept-results",results:[]});return}Lt.isDebug()&&Lt.debug(`Starting new search for query ${JSON.stringify(l)}.`),o({kind:"load-results"});const c=n.current=uu(t,l).then(u=>{n.current===c&&o({kind:"accept-results",results:u})})}),s=d.useCallback(l=>{o({kind:"select-option",option:l})},[]),a=d.useCallback(l=>{o({kind:"input",query:l}),r(l)},[r]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:s,onInputChanged:a}}async function uu(t,e){let o;try{o=await t.search(e)}catch(n){Mt(n)||Lt.error("Search failed",n),o=[]}return du(o)}function du(t){return t.map((o,n)=>({label:o.label,options:o.results.map(r=>({value:`${n}-${r.id}`,label:r.label,source:o.source,result:r}))}))}function hu(){const{map:t}=Y(B),e=xe("ol-app.AppModel"),o=qe(e.state).searchSources;function n(s){if(console.debug("The user selected the following item: ",s.result),!t)return;const a=s.result.geometry;a&&e.highlightAndZoom(t,[a])}function r(){console.debug("The user cleared the search"),e.clearPreviousHighlight()}return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",mt:5,className:"search-box",children:i.jsx(ru,{mapId:B,sources:o,maxResultsPerGroup:10,onSelect:n,onClear:r})})}const tr="@open-pioneer/selection",pu=Xe.bind(void 0,tr),xo=ce.bind(void 0,tr),nt="selection-active",kt="selection-inactive";class fu{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,o,n,r,s){let a;switch(o){case _o.extent:default:a=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,s,a,this.interactionResources)),this.interactionResources.push(this.createDrag(e,a,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=r}initViewport(e){const o=e.getViewport();return o.classList.add(nt),o.oncontextmenu=n=>(n.preventDefault(),!1),o}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const o=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipMessage,o.classList.remove(kt),o.classList.add(nt),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,o.classList.remove(nt),o.classList.add(kt),this.isActive=!1)}createDragBox(e,o,n,r){const s=new Lo({className:"selection-drag-box",condition:ns});return e.addInteraction(s),s.on("boxend",function(){o(s.getGeometry())}),{interaction:s,destroy(){e.removeInteraction(s),r.splice(r.indexOf(this)),s.dispose(),n.classList.remove(nt),n.classList.remove(kt),n.oncontextmenu=null}}}createDrag(e,o,n){const r=function(l){return l.originalEvent.button==2},s=new Ro({condition:r});return e.addInteraction(s),{interaction:s,destroy(){e.removeInteraction(s),n.splice(n.indexOf(this)),s.dispose(),o.classList.remove(nt),o.classList.remove(kt),o.oncontextmenu=null}}}createHelpTooltip(e,o){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.textContent=o;const r=new lt({element:n,offset:[15,0],positioning:"center-left"}),s=e.on("pointermove",a=>{r.setPosition(a.coordinate)});return e.addOverlay(r),{overlay:r,element:n,destroy(){e.removeOverlay(r),r.dispose(),le(s)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Lo)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Ro)}}const Xt=pe("selection:SelectionController"),gu=1e4;var bt,wt,St,Nt,or;class mu{constructor(e){L(this,Nt);L(this,bt,void 0);L(this,wt,void 0);L(this,St,void 0);const{mapModel:o,onError:n,maxResults:r=gu}=e;I(this,bt,o),I(this,wt,r),I(this,St,n)}destroy(){}async select(e,o){if(o)return await W(this,Nt,or).call(this,e,o)}}bt=new WeakMap,wt=new WeakMap,St=new WeakMap,Nt=new WeakSet,or=async function(e,o){const n=x(this,bt).olMap.getView().getProjection();try{Xt.debug(`Starting selection on source '${e.label}'`);const r=x(this,wt);let s=await e.select({type:"extent",extent:o},{maxResults:r,mapProjection:n,signal:new AbortController().signal});return s.length>r&&(s=s.slice(0,r)),Xt.debug(`Found ${s.length} results on source '${e.label}'`),{source:e,results:s}}catch(r){Xt.error(`selection from source ${e.label} failed`,r),x(this,St).call(this);return}};var _o=(t=>(t.extent="EXTENT",t.polygon="POLYGON",t.free="FREEPOLYGON",t.circle="CIRCLE",t))(_o||{});const on={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},vu=t=>{const e=xo(),{mapId:o,sources:n,onSelectionComplete:r,onSelectionSourceChanged:s}=t,{containerProps:a}=oe("selection",t),[l,c]=d.useState(()=>n.find(P=>(P.status??"available")==="available")),u=Y(o),{onExtentSelected:h}=Su(u.map,n,l,r),f=_u(),b=d.useCallback(P=>{const H=[];if(P||(P=["EXTENT"]),P.forEach(g=>{Object.values(_o).includes(g)&&H.push({label:e.formatMessage({id:g}),value:g})}),H.length===0)throw new Error("methods does not contain valid values");return H},[e])(void 0),[E,k]=d.useState(b[0]),R=Re(P=>{k(P)}),[A,N]=d.useState(!0);xu(u.map,E,e,h,A);const F=d.useMemo(()=>n.map(P=>({label:P.label,value:P})),[n]),Z=d.useMemo(()=>F.find(P=>P.value===l),[F,l]),X=Re(P=>{c(P?.value),s&&s({source:P?.value})});return d.useEffect(()=>{if(!l){N(!1);return}const P=e.formatMessage({id:"sourceNotAvailable"}),H=()=>l&&lo(l,P).kind==="available";N(H());const g=l.on("changed:status",()=>{N(H())});return()=>g.destroy()},[l,N,e]),i.jsxs(eo,{...a,spacing:2,children:[b.length>1&&i.jsxs(At,{children:[i.jsx(at,{children:e.formatMessage({id:"selectMethod"})}),i.jsx(no,{className:"selection-method react-select",...on,options:b,onChange:R,value:E,chakraStyles:f})]}),i.jsxs(At,{children:[i.jsx(at,{children:e.formatMessage({id:"selectSource"})}),i.jsx(no,{className:"selection-source react-select",...on,options:F,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:Z,onChange:X,components:{Option:bu,SingleValue:wu},isOptionDisabled:P=>P.value===void 0||P.value.status==="unavailable",getOptionLabel:P=>P.label+(P.value===void 0||P.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:f})]})]})};function bu(t){const{value:e}=t.data,{isAvailable:o,content:n}=nr(e,!1);return i.jsx(fe.Option,{...t,isDisabled:!o,className:"selection-source-option",children:n})}function wu(t){const{value:e}=t.data,{isAvailable:o,content:n}=nr(e,!0),r=o?"selection-source-value":"selection-source-value selection-source-value--disabled";return i.jsx(fe.SingleValue,{...t,isDisabled:!o,className:r,children:n})}function nr(t,e){const o=t?.label,n=yu(t);return{isAvailable:n.kind==="available",content:i.jsxs(de,{direction:"row",alignItems:"center",grow:1,children:[!e&&i.jsx(de,{grow:1,children:o}),n.kind==="unavailable"&&i.jsx(j,{ml:2,children:i.jsx(ln,{label:n.reason,placement:"right",openDelay:500,children:i.jsx(te.span,{children:i.jsx(vr,{as:Ts,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&o]})}}function Su(t,e,o,n){const r=pu("notifier.NotificationService"),s=xo(),[a,l]=d.useState(void 0);d.useEffect(()=>{if(!t)return;const u=new mu({mapModel:t,onError(){r.notify({level:"error",message:s.formatMessage({id:"selectionFailed"})})}});return l(u),()=>{u.destroy()}},[t,r,e,s]);const c=Re(async u=>{if(!a||!o)return;const h=await a.select(o,u.getExtent());h&&n?.(h)});return{controller:a,onExtentSelected:c}}function lo(t,e){const o=t.status??"available",n=typeof o=="string"?{kind:o}:o;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function yu(t){const e=xo(),[o,n]=d.useState(()=>({kind:"available"}));return d.useEffect(()=>{if(!t){n({kind:"available"});return}const r=e.formatMessage({id:"sourceNotAvailable"});n(lo(t,r));const s=t.on?.("changed:status",()=>{n(lo(t,r))});return()=>s?.destroy()},[t,e]),o}function xu(t,e,o,n,r){d.useEffect(()=>{if(!t)return;const s=new fu(t.olMap,e.value,o.formatMessage({id:"tooltip"}),o.formatMessage({id:"disabledTooltip"}),n);return s.setActive(r),()=>{s?.destroy()}},[t,e,o,n,r])}function _u(){const[t,e]=cn("colors",["background_body","border"],["#ffffff","#ffffff"]);return d.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:t})}),[t,e])}function Eu(){const t=Ee(),e=xe("notifier.NotificationService"),o=d.useId(),{map:n}=Y(B),r=xe("ol-app.AppModel"),s=qe(r.state).selectionSources,a=qe(r.state).sourceMetadata,l={numberOptions:{maximumFractionDigits:3},dateOptions:{dateStyle:"medium",timeStyle:"medium",timeZone:"UTC"}};function c(h){const{source:f,results:w}=h;if(!n){console.debug("Map not ready");return}const b=w.map(k=>k.geometry);b.length>0&&r.highlightAndZoom(n,b);const E=a.get(f);if(!E){console.warn("Can not show results because no metadata could be found");return}r.setResultListInput({columns:E,data:w,formatOptions:l}),e.notify({level:"info",message:t.formatMessage({id:"foundResults"},{resultsCount:w.length}),displayDuration:4e3})}function u(h){r.clearPreviousHighlight()}return i.jsx(j,{role:"dialog","aria-labelledby":o,children:i.jsx(Ie,{title:i.jsx(Te,{id:o,size:"md",mb:2,children:t.formatMessage({id:"selectionTitle"})}),children:i.jsx(vu,{mapId:B,sources:s,onSelectionComplete:c,onSelectionSourceChanged:u})})})}function ku(t){const e=d.useId(),o=Ee();return i.jsx(j,{role:"dialog","aria-labelledby":e,children:i.jsx(Ie,{title:i.jsx(Te,{id:e,size:"md",mb:2,children:i.jsx(he,{children:o.formatMessage({id:"tocTitle"})})}),children:i.jsx(j,{overflowY:"auto",maxHeight:t.maxHeight,children:i.jsx(ws,{mapId:B,showTools:!0,basemapSwitcherProps:{allowSelectingEmptyBasemap:!0}})})})})}const Cu={bookmarksActive:!1,legendActive:!0,overviewMapActive:!0,tocActive:!0,printingActive:!1};function Mu(){const t=Ee();Y(B);const e=xe("ol-app.AppModel"),[o,n]=d.useState(),[r,s]=d.useState(Cu),a={...r,editingActive:o==="editing",measurementActive:o==="measurement",selectionActive:o==="selection"},l=(f,w)=>{if(f==="selectionActive"||f==="measurementActive"||f==="editingActive"){let b;switch(f){case"editingActive":b="editing";break;case"measurementActive":b="measurement";break;case"selectionActive":b="selection";break}b!==o&&w?(n(b),e.clearPreviousHighlight()):b===o&&!w&&(n(void 0),e.clearPreviousHighlight())}else s({...r,[f]:w})},c=qe(e.state).resultListState,u=c.input&&c.open,h=[a.tocActive&&i.jsx(ku,{maxHeight:a.legendActive||o?"300px":"75vh"},"toc"),a.legendActive&&i.jsx(bc,{},"legend"),o==="selection"?i.jsx(Eu,{},"selection"):o==="measurement"?i.jsx(Fc,{},"measurement"):void 0];return i.jsxs(de,{height:"100%",direction:"column",overflow:"hidden",children:[i.jsx(El,{position:"top-right"}),i.jsxs(Ie,{title:i.jsx(j,{role:"region","aria-label":t.formatMessage({id:"ariaLabel.header"}),textAlign:"center",py:1,children:i.jsx(Te,{size:"md",children:"OpenLayers Base Packages - Default Sample"})}),children:[i.jsx(de,{flex:"1",direction:"column",position:"relative",children:i.jsxs(rs,{mapId:B,role:"main","aria-label":t.formatMessage({id:"ariaLabel.map"}),viewPadding:u?{bottom:400}:void 0,children:[i.jsx(Ds,{centerContent:!0,children:i.jsx(hu,{})}),i.jsx(Qe,{position:"top-left",horizontalGap:20,verticalGap:20,children:i.jsx(Au,{children:h})}),i.jsx(Qe,{position:"top-right",horizontalGap:20,verticalGap:20,children:a.overviewMapActive&&i.jsx(Gc,{})}),i.jsx(Qe,{horizontalGap:20,position:"bottom-left",children:a.bookmarksActive&&i.jsx(ec,{})}),i.jsx(Qe,{horizontalGap:20,position:"bottom-left",children:a.printingActive&&i.jsx(ac,{})}),i.jsx(Qe,{position:"bottom-right",horizontalGap:10,verticalGap:45,children:i.jsx(Cc,{toolState:a,onToolStateChange:l})}),i.jsx(Uc,{})]})}),i.jsxs(de,{role:"region","aria-label":t.formatMessage({id:"ariaLabel.footer"}),gap:3,alignItems:"center",justifyContent:"center",children:[i.jsx(gl,{mapId:B,precision:2,displayProjectionCode:"EPSG:4326"}),i.jsx(kl,{mapId:B}),i.jsx(Al,{mapId:B})]})]})]})}function Au(t){const e=t.children,o=[];for(const n of e)n&&(o.length&&o.push(i.jsx(js,{mt:4,mb:4},o.length)),o.push(n));if(o.length!==0)return i.jsx(j,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",width:350,maxWidth:350,children:o})}const Pu=br({component:Mu,theme:wr,appMetadata:dl,config:{properties:{"@open-pioneer/local-storage":{storageId:"ol-app-state"},"@open-pioneer/editing":{polygonDrawStyle:{"stroke-color":"red","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(255, 0, 0, 0.2)","circle-stroke-color":"rgba(255, 0, 0, 0.7)","circle-stroke-width":2}}}},async resolveConfig(t){const e=t.getAttribute("forced-locale");if(e)return{locale:e}}});customElements.define("ol-map-app",Pu);const Lu=document.getElementsByTagName("body")[0];Ru();function Ru(){const t=window.location.search,o=new URLSearchParams(t).get("lang"),n=document.createElement("ol-map-app");n.classList.add("full-height"),n.classList.add("app"),n.setAttribute("id","test"),o&&n.setAttribute("forced-locale",o),Lu.appendChild(n)}
