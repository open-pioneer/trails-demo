var Ps=Object.defineProperty;var Ms=(o,e,t)=>e in o?Ps(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var $=(o,e,t)=>(Ms(o,typeof e!="symbol"?e+"":e,t),t),oo=(o,e,t)=>{if(!e.has(o))throw TypeError("Cannot "+t)};var k=(o,e,t)=>(oo(o,e,"read from private field"),t?t.call(o):e.get(o)),R=(o,e,t)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,t)},O=(o,e,t,n)=>(oo(o,e,"write to private field"),n?n.call(o,t):e.set(o,t),t);var H=(o,e,t)=>(oo(o,e,"access private method"),t);import{f as Eo,j as l,r as p,u as Ls,c as ue,i as Vt,a as pe,g as As,R as _n,b as xn,E as ie,d as Ts,A as no,e as so,F as kn,B as Zt,C as Rs,t as Is,h as Cn,I as Os,k as Ds}from"./7b9bf2e5ae39.js";import{t as js}from"./6220795b0567.js";import{b as En,B as Pn,i as Ns,g as Fs,a as Go,t as Vs,c as Bs,d as Mn,S as Gs,e as zs,f as Us,h as Ws,j as Hs,r as $s,C as qs,k as Ks,l as Ys,u as Xs,m as Ln,M as An,o as Zs,n as Js,p as Tn,A as Qs,T as Po,I as ei,q as ti,s as go,v as ae,w as oi,x as ni,V as Rn,y as dt,O as In,z as Oe,D as fe,E as Re,F as Mo,G as Je,P as si,H as ii,J as ri,K as zo,L as ai,N as li,Q as Uo,R as ci,U as di,W as On,X as me,Y as ui,Z as Dn,_ as Ee,$ as Ge,a0 as Wo,a1 as hi,a2 as Jt,a3 as pi,a4 as jn,a5 as fi,a6 as gi,a7 as Lo,a8 as Nn,a9 as mi,aa as vi,ab as Y,ac as bi,ad as Fn,ae as wi,af as Ho,ag as Vn,ah as yi,ai as $o,aj as Si,ak as io,al as qo,am as _i,an as xi,ao as ki,ap as Ci,aq as Ei,ar as Pi,as as Ko,at as Mi,au as Li,av as Ai,aw as Ae,ax as Ti,ay as Ri,az as Ii,aA as Yo,aB as Oi,aC as Xo,aD as Di,aE as st}from"./a43dafd8eb62.js";import{m as F,a as C,X as Bn,p as G,r as D,b as Q,c as Ao,d as mo,e as xe,f as ji,g as Ni,W as Pt,P as Gn,h as zn,i as Fi,j as Vi,k as Bi,l as Gi,n as zi,o as Ui,q as Wi,s as Hi,t as $i,u as qi}from"./a443b269401d.js";import{o as Ki,W as Yi}from"./f0272346575e.js";import{u as te,c as Mt,T as De,S as je,a as ee}from"./6e72ec7ae19c.js";import{G as Qt,M as Xi,a as Un,b as Wn,c as Zi,T as Ji}from"./b32fa8931d06.js";import{T as he}from"./693c1ea75d35.js";import{B as N}from"./347424816aed.js";import{N as Qi,W as er,a as tr}from"./f7d3c6d7e53d.js";import{V as or,S as nr,I as sr,Z as ir,a as rr}from"./58b8f498fb13.js";import{E as To}from"./960f2965a833.js";import{L as ze}from"./74259ec9e711.js";import{_ as Bt}from"./a419295615be.js";import{u as le,a as Lt}from"./2f6cd8ce72f0.js";import{F as de}from"./b22e372ccca3.js";import{L as Hn}from"./33d79dfa7cd5.js";import{S as ar}from"./b3386f931316.js";import{V as vo}from"./3914e5d62768.js";import{I as $n}from"./5a0860c5dca8.js";import{F as Gt}from"./d8dbd56b87bf.js";import{F as pt}from"./abf9206daf56.js";import{H as bo}from"./83a3645f2b47.js";import{S as qn}from"./d465cc123d3d.js";import{G as lr,F as cr}from"./e9fe14d5121b.js";import{u as Ie}from"./2db0cada463f.js";import{R as dr}from"./49dd4f5f2660.js";import{c as ur}from"./f9554349740d.js";import{c as ge,S as wo}from"./a3e2da54293c.js";import{C as hr}from"./e43095850c0c.js";import{D as pr}from"./03b560c892f8.js";import"./5a63b44b9c7d.js";import"./49cf3dea6739.js";import"./615d5d1d4fb6.js";import"./48a7161ffa67.js";import"./a9a99471e045.js";var yo=Eo(function(e,t){const{htmlWidth:n,htmlHeight:s,alt:i,...r}=e;return l.jsx("img",{width:n,height:s,ref:t,alt:i,...r})});yo.displayName="NativeImage";function fr(o){const{loading:e,src:t,srcSet:n,onLoad:s,onError:i,crossOrigin:r,sizes:a,ignoreFallback:d}=o,[c,u]=p.useState("pending");p.useEffect(()=>{u(t?"loading":"pending")},[t]);const h=p.useRef(),f=p.useCallback(()=>{if(!t)return;g();const v=new Image;v.src=t,r&&(v.crossOrigin=r),n&&(v.srcset=n),a&&(v.sizes=a),e&&(v.loading=e),v.onload=S=>{g(),u("loaded"),s?.(S)},v.onerror=S=>{g(),u("failed"),i?.(S)},h.current=v},[t,r,n,a,s,i,e]),g=()=>{h.current&&(h.current.onload=null,h.current.onerror=null,h.current=null)};return Ls(()=>{if(!d)return c==="loading"&&f(),()=>{g()}},[c,f,d]),d?"loaded":c}var gr=(o,e)=>o!=="loaded"&&e==="beforeLoadOrError"||o==="failed"&&e==="onError";function mr(o,e=[]){const t=Object.assign({},o);for(const n of e)n in t&&delete t[n];return t}var Kn=Eo(function(e,t){const{fallbackSrc:n,fallback:s,src:i,srcSet:r,align:a,fit:d,loading:c,ignoreFallback:u,crossOrigin:h,fallbackStrategy:f="beforeLoadOrError",referrerPolicy:g,...v}=e,S=n!==void 0||s!==void 0,L=c!=null||u||!S,P=fr({...e,crossOrigin:h,ignoreFallback:L}),I=gr(P,f),A={ref:t,objectFit:d,objectPosition:a,...L?v:mr(v,["onError","onLoad"])};return I?s||l.jsx(ue.img,{as:yo,className:"chakra-image__placeholder",src:n,...A}):l.jsx(ue.img,{as:yo,src:i,srcSet:r,crossOrigin:h,loading:c,referrerPolicy:g,className:"chakra-image",...A})});Kn.displayName="Image";var Yn=ue("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Yn.displayName="Center";var vr={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Eo(function(e,t){const{axis:n="both",...s}=e;return l.jsx(ue.div,{ref:t,__css:vr[n],...s,position:"absolute"})});const J=[null,"http://www.opengis.net/ows/1.1"],br=F(J,{ServiceIdentification:C(Ur),ServiceProvider:C(Hr),OperationsMetadata:C(Gr)});class wr extends Bn{constructor(){super()}readFromNode(e){const t=G({},br,e,[]);return t||null}}const yr=F(J,{DeliveryPoint:C(D),City:C(D),AdministrativeArea:C(D),PostalCode:C(D),Country:C(D),ElectronicMailAddress:C(D)}),Sr=F(J,{Value:Q($r)}),_r=F(J,{AllowedValues:C(Or)}),xr=F(J,{Phone:C(zr),Address:C(Ir)}),kr=F(J,{HTTP:C(Vr)}),Cr=F(J,{Get:Q(Fr),Post:void 0}),Er=F(J,{DCP:C(Nr)}),Pr=F(J,{Operation:Br}),Mr=F(J,{Voice:C(D),Facsimile:C(D)}),Lr=F(J,{Constraint:Q(Dr)}),Ar=F(J,{IndividualName:C(D),PositionName:C(D),ContactInfo:C(jr)}),Tr=F(J,{Abstract:C(D),AccessConstraints:C(D),Fees:C(D),Title:C(D),ServiceTypeVersion:C(D),ServiceType:C(D)}),Rr=F(J,{ProviderName:C(D),ProviderSite:C(Ao),ServiceContact:C(Wr)});function Ir(o,e){return G({},yr,o,e)}function Or(o,e){return G({},Sr,o,e)}function Dr(o,e){const t=o.getAttribute("name");if(t)return G({name:t},_r,o,e)}function jr(o,e){return G({},xr,o,e)}function Nr(o,e){return G({},kr,o,e)}function Fr(o,e){const t=Ao(o);if(t)return G({href:t},Lr,o,e)}function Vr(o,e){return G({},Cr,o,e)}function Br(o,e){const t=o.getAttribute("name"),n=G({},Er,o,e);if(!n)return;const s=e[e.length-1];s[t]=n}function Gr(o,e){return G({},Pr,o,e)}function zr(o,e){return G({},Mr,o,e)}function Ur(o,e){return G({},Tr,o,e)}function Wr(o,e){return G({},Ar,o,e)}function Hr(o,e){return G({},Rr,o,e)}function $r(o,e){return D(o)}const qr=wr,ce=[null,"http://www.opengis.net/wmts/1.0"],nt=[null,"http://www.opengis.net/ows/1.1"],Kr=F(ce,{Contents:C(ra)});class Yr extends Bn{constructor(){super(),this.owsParser_=new qr}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=G(n,Kr,e,[]),n||null):null}}const Xr=F(ce,{Layer:Q(aa),TileMatrixSet:Q(la)}),Zr=F(ce,{Style:Q(ca),Format:Q(D),TileMatrixSetLink:Q(da),Dimension:Q(ua),ResourceURL:Q(ha)},F(nt,{Title:C(D),Abstract:C(D),WGS84BoundingBox:C(Xn),Identifier:C(D)})),Jr=F(ce,{LegendURL:Q(pa)},F(nt,{Title:C(D),Identifier:C(D)})),Qr=F(ce,{TileMatrixSet:C(D),TileMatrixSetLimits:C(ga)}),ea=F(ce,{TileMatrixLimits:mo(ma)}),ta=F(ce,{TileMatrix:C(D),MinTileRow:C(xe),MaxTileRow:C(xe),MinTileCol:C(xe),MaxTileCol:C(xe)}),oa=F(ce,{Default:C(D),Value:Q(D)},F(nt,{Identifier:C(D)})),na=F(nt,{LowerCorner:mo(So),UpperCorner:mo(So)}),sa=F(ce,{WellKnownScaleSet:C(D),TileMatrix:Q(fa)},F(nt,{SupportedCRS:C(D),Identifier:C(D),BoundingBox:C(Xn)})),ia=F(ce,{TopLeftCorner:C(So),ScaleDenominator:C(ji),TileWidth:C(xe),TileHeight:C(xe),MatrixWidth:C(xe),MatrixHeight:C(xe)},F(nt,{Identifier:C(D)}));function ra(o,e){return G({},Xr,o,e)}function aa(o,e){return G({},Zr,o,e)}function la(o,e){return G({},sa,o,e)}function ca(o,e){const t=G({},Jr,o,e);if(!t)return;const n=o.getAttribute("isDefault")==="true";return t.isDefault=n,t}function da(o,e){return G({},Qr,o,e)}function ua(o,e){return G({},oa,o,e)}function ha(o,e){const t=o.getAttribute("format"),n=o.getAttribute("template"),s=o.getAttribute("resourceType"),i={};return t&&(i.format=t),n&&(i.template=n),s&&(i.resourceType=s),i}function Xn(o,e){const t=G([],na,o,e);if(t.length==2)return En(t)}function pa(o,e){const t={};return t.format=o.getAttribute("format"),t.href=Ao(o),t}function So(o,e){const t=D(o).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],s=+t[1];if(!(isNaN(n)||isNaN(s)))return[n,s]}function fa(o,e){return G({},ia,o,e)}function ga(o,e){return G([],ea,o,e)}function ma(o,e){return G({},ta,o,e)}const va=Yr,U={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},ba={ERROR:"error"};class wa extends Mn{constructor(e){super(ba.ERROR),this.code=e.code,this.message=e.message}}let ya=class extends Pn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Ns,this.watchId_=void 0,this.addChangeListener(U.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(U.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Fs(Go("EPSG:4326"),e),this.position_&&this.set(U.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(U.ACCURACY,t.accuracy),this.set(U.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(U.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(U.HEADING,t.heading===null?void 0:Vs(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const n=this.transform_(this.position_);this.set(U.POSITION,n.slice()),this.set(U.SPEED,t.speed===null?void 0:t.speed);const s=Bs(this.position_,t.accuracy);s.applyTransform(this.transform_),this.set(U.ACCURACY_GEOMETRY,s),this.changed()}positionError_(e){this.dispatchEvent(new wa(e))}getAccuracy(){return this.get(U.ACCURACY)}getAccuracyGeometry(){return this.get(U.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(U.ALTITUDE)}getAltitudeAccuracy(){return this.get(U.ALTITUDE_ACCURACY)}getHeading(){return this.get(U.HEADING)}getPosition(){return this.get(U.POSITION)}getProjection(){return this.get(U.PROJECTION)}getSpeed(){return this.get(U.SPEED)}getTracking(){return this.get(U.TRACKING)}getTrackingOptions(){return this.get(U.TRACKING_OPTIONS)}setProjection(e){this.set(U.PROJECTION,Go(e))}setTracking(e){this.set(U.TRACKING,e)}setTrackingOptions(e){this.set(U.TRACKING_OPTIONS,e)}};const Sa=ya;class eo extends Gs{constructor(e,t,n){super(),n!==void 0&&t===void 0?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new eo(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const i=this.flatCoordinates,r=e-i[0],a=t-i[1],d=r*r+a*a;if(d<s){if(d===0)for(let c=0;c<this.stride;++c)n[c]=i[c];else{const c=this.getRadius()/Math.sqrt(d);n[0]=i[0]+c*r,n[1]=i[1]+c*a;for(let u=2;u<this.stride;++u)n[u]=i[u]}return n.length=this.stride,d}return s}containsXY(e,t){const n=this.flatCoordinates,s=e-n[0],i=t-n[1];return s*s+i*i<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return zs(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Us(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:Ws(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+n;for(let i=1;i<t;++i)s[t+i]=e[i];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let i=Hs(s,0,e,this.stride);s[i++]=s[0]+t;for(let r=1,a=this.stride;r<a;++r)s[i++]=s[r];s.length=i,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),s=this.getStride();this.setCenter($s(n,0,n.length,s,e,t,n)),this.changed()}}eo.prototype.transform;const _a=eo,K={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class xa extends Pn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+qs,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(K.ELEMENT,this.handleElementChanged),this.addChangeListener(K.MAP,this.handleMapChanged),this.addChangeListener(K.OFFSET,this.handleOffsetChanged),this.addChangeListener(K.POSITION,this.handlePositionChanged),this.addChangeListener(K.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(K.ELEMENT)}getId(){return this.id}getMap(){return this.get(K.MAP)||null}getOffset(){return this.get(K.OFFSET)}getPosition(){return this.get(K.POSITION)}getPositioning(){return this.get(K.POSITIONING)}handleElementChanged(){Ks(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Ys(this.element),Xs(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Ln(e,An.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(K.ELEMENT,e)}setMap(e){this.set(K.MAP,e)}setOffset(e){this.set(K.OFFSET,e)}setPosition(e){this.set(K.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(K.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),i=this.getRect(s,[Zs(s),Js(s)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!Tn(n,i)){const a=i[0]-n[0],d=n[2]-i[2],c=i[1]-n[1],u=n[3]-i[3],h=[0,0];if(a<0?h[0]=a-r:d<0&&(h[0]=Math.abs(d)+r),c<0?h[1]=c-r:u<0&&(h[1]=Math.abs(u)+r),h[0]!==0||h[1]!==0){const f=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(f);if(!g)return;const v=[g[0]+h[0],g[1]+h[1]],S=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(v),duration:S.duration,easing:S.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),s=n.left+window.pageXOffset,i=n.top+window.pageYOffset;return[s,i,s+t[0],i+t[1]]}setPositioning(e){this.set(K.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(n,s)}updateRenderedPosition(e,t){const n=this.element.style,s=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const r=Math.round(e[0]+s[0])+"px",a=Math.round(e[1]+s[1])+"px";let d="0%",c="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?d="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(d="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?c="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(c="-50%");const u=`translate(${d}, ${c}) translate(${r}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,n.transform=u)}getOptions(){return this.options}}const ft=xa,Pe=pe("map:WMTSLayer");var Ue,We,He,$e,gt,mt,vt,bt,Wt,Zn,Ht,Jn;class ka extends Qs{constructor(t){const n=new Po;super({...t,olLayer:n});R(this,Wt);R(this,Ht);R(this,Ue,void 0);R(this,We,void 0);R(this,He,void 0);R(this,$e,void 0);R(this,gt,void 0);R(this,mt,void 0);R(this,vt,void 0);R(this,bt,new AbortController);O(this,Ue,t.url),O(this,We,t.name),O(this,$e,n),O(this,He,t.matrixSet),O(this,vt,t.sourceOptions)}destroy(){super.destroy(),k(this,bt).abort()}get legend(){return k(this,mt)}__attach(t){super.__attach(t),H(this,Wt,Zn).call(this).then(n=>{const i=new va().read(n),r=Ki(i,{layer:k(this,We),matrixSet:k(this,He)});if(!r)throw new Error("Layer was not found in capabilities");const a=new Yi({...r,...k(this,vt),tileLoadFunction:(u,h)=>{H(this,Ht,Jn).call(this,u,h)}});O(this,gt,a),k(this,$e).setSource(k(this,gt));const d=a.getStyle(),c=Ea(i,this.name,d);O(this,mt,c),this.__emitChangeEvent("changed:legend")}).catch(n=>{if(Vt(n)){Pe.error(`Layer ${this.name} has been destroyed before fetching the data`);return}Pe.error(`Failed fetching WMTS capabilities for Layer ${this.name}`,n)})}get layer(){return k(this,$e)}get url(){return k(this,Ue)}get name(){return k(this,We)}get matrixSet(){return k(this,He)}get sublayers(){}}Ue=new WeakMap,We=new WeakMap,He=new WeakMap,$e=new WeakMap,gt=new WeakMap,mt=new WeakMap,vt=new WeakMap,bt=new WeakMap,Wt=new WeakSet,Zn=async function(){const t=this.map.__sharedDependencies.httpService;return Ni(k(this,Ue),t,k(this,bt).signal)},Ht=new WeakSet,Jn=async function(t,n){const s=this.map.__sharedDependencies.httpService;try{if(!(t instanceof ei))throw new Error("Only 'ImageTile' is supported for now.");const i=t.getImage();if(!Ca(i))throw new Error("Only <img> tags are supported as tiles for now.");const r=await s.fetch(n);if(!r.ok)throw new Error(`Tile request failed with status ${r.status}.`);const a=await r.blob(),d=URL.createObjectURL(a),c=()=>{URL.revokeObjectURL(d),i.removeEventListener("load",c),i.removeEventListener("error",c)};i.addEventListener("load",c),i.addEventListener("error",c),i.src=d}catch(i){t.setState(ti.ERROR),Vt(i)||Pe.error("Failed to load tile",i)}};function Ca(o){return o.tagName==="IMG"}function Ea(o,e,t){const s=o?.Contents?.Layer;let i=s?.find(c=>c?.Identifier===e);if(!i&&(Pe.debug("Failed to find the active layer in WMTS layer capabilities."),i=s?.[0],!i)){Pe.debug("No layer in WMTS capabilities - giving up.");return}const r=i.Style;let a=r?.find(c=>c?.Identifier===t);if(!a&&(Pe.debug("Failed to find active style in WMTS layer."),a=r?.[0],!a)){Pe.debug("No style in WMTS layer capabilities - giving up.");return}return a.LegendURL?.[0]?.href}const Zo=ka,Pa=25.4/.28,Ma=39.37;function Ro(o){return Io(o,La,Aa)}function La(o){return o.getView()}function Aa(o,e){return o.on("change:view",e)}function Qn(o){return Ro(o)?.getProjection()}function Ta(o){const e=Ro(o);return Io(e,Ra,Ia)}function Ra(o){return o.getResolution()}function Ia(o,e){return o.on("change:resolution",e)}function Oa(o){const e=Ro(o);return Io(e,Da,ja)}function Da(o){return o.getCenter()}function ja(o,e){return o.on("change:center",e)}function Na(o){const e=Oa(o),t=Ta(o),n=Qn(o);return p.useMemo(()=>{if(n==null||t==null||e==null)return;const i=go(n,t,e);return Math.round(i*Ma*Pa)},[n,t,e])}function Io(o,e,t){const n=p.useCallback(()=>o?e(o):void 0,[o,e]),s=p.useCallback(i=>{if(!o)return()=>{};const r=t(o,i);return()=>ae(r)},[o,t]);return p.useSyncExternalStore(s,n)}const Fa=1.2;function Va(o,e=Fa){Ba(o);const t=oi(o),n=ni(o),s=t*e,i=n*e;return[o[0]-(s-t)/2,o[1]-(i-n)/2,o[2]+(s-t)/2,o[3]+(i-n)/2]}function Ba(o){if(o.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${o.length}).`)}const Ga={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function za(o){return l.jsxs(N,{children:[l.jsx(he,{children:o.layer.title}),l.jsx(N,{style:Ga})]})}const B="main";class Ua{mapId=B;vectorSourceFactory;constructor(e){this.vectorSourceFactory=e.references.vectorSourceFactory}async getMapConfig(){const e={Component:za};return{advanced:{view:new Rn({center:[404747,5757920],zoom:13,constrainResolution:!0,projection:"EPSG:25832"})},layers:[new Pt({title:"Linfos",visible:!0,url:"https://www.wms.nrw.de/umwelt/linfos",sublayers:[{name:"SonstigeSchutzgebiete",title:"SonstigeSchutzgebiete"},{name:"SCH_GSG",title:"SCH_GSG"}]}),new Zo({isBaseLayer:!0,title:"Topplus grau",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_grau",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new Zo({isBaseLayer:!0,title:"Topplus farbig",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_col",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new dt({title:"OSM",visible:!1,isBaseLayer:!0,olLayer:new Po({source:new In})}),new dt({title:"Haltestellen Stadt Rostock",visible:!0,description:"Haltestellen des öffentlichen Personenverkehrs in der Hanse- und Universitätsstadt Rostock.",olLayer:Wa(),attributes:{legend:e}}),new dt({id:"ogc_kitas",title:"Kindertagesstätten",visible:!0,olLayer:Ha(),attributes:{legend:e,resultListMetadata:[{id:"id",displayName:"ID",width:100,getPropertyValue(t){return t.id}},{propertyName:"pointOfContact.address.postCode",displayName:"PLZ",width:120},{propertyName:"name",displayName:"Name"},{propertyName:"inspireId",displayName:"inspireID"},{displayName:"Gefördert",width:160,getPropertyValue(t){switch(t.properties?.gefoerdert){case"ja":return!0;case"nein":return!1;default:return t.properties?.gefoerdert}}}]}}),new dt({id:"ogc_kataster",title:"Liegenschaftskatasterbezirke in NRW (viele Daten)",visible:!1,olLayer:$a(this.vectorSourceFactory),attributes:{resultListMetadata:[{propertyName:"id",displayName:"ID",width:600,getPropertyValue(t){return t.id}},{displayName:"Aktualit",width:600,getPropertyValue(t){const n=t.properties?.aktualit;return typeof n=="string"&&!isNaN(Date.parse(n))?new Date(n):n}}]}}),Ya(this.vectorSourceFactory),Xa(),Za(),qa(),Ka()]}}}function Wa(){const o=new Oe({url:"https://geo.sv.rostock.de/download/opendata/haltestellen/haltestellen.json",format:new Qt,attributions:"Haltestellen Stadt Rostock, Creative Commons CC Zero License (cc-zero)"});return new fe({source:o})}function Ha(){const o=new Oe({url:"https://ogc-api.nrw.de/inspire-us-kindergarten/v1/collections/governmentalservice/items?f=json&limit=10000",format:new Qt,attributions:'&copy; <a href="http://www.bkg.bund.de" target="_blank">Bundesamt f&uuml;r Kartographie und Geod&auml;sie</a> 2017, <a href="http://sg.geodatenzentrum.de/web_public/Datenquellen_TopPlus_Open.pdf" target="_blank">Datenquellen</a>'});return new fe({source:o,style:new Re({image:new Mo({fill:new Je({color:"blue"}),radius:4})})})}function $a(o){const e=o.createVectorSource({baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"katasterbezirk",limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`});return new fe({source:e})}function qa(){return new Pt({title:"Verwaltungsgebiete",visible:!0,url:"https://www.wms.nrw.de/geobasis/wms_nw_dvg",sublayers:[{name:"nw_dvg_bld",title:"NRW"}]})}function Ka(){return new Pt({title:"Bodenkarte zur Landwirtschaftlichen Standorterkundung",visible:!0,url:"https://www.wms.nrw.de/gd/bk05l",sublayers:[{name:"Versickerung_und_Stofftransport",title:"Versickerung und Stofftransport",sublayers:[{name:"Sickerwasserrate",title:"Sickerwasserrate",sublayers:[{name:"Szenario_Wald",title:"Szenario Wald",sublayers:[{name:"Sickerwasserrate_Wald",title:"Sickerwasserrate Wald"},{name:"Direktabfluss_Wald",title:"Direktabfluss Wald"}]},{name:"Szenario_Gruenland",title:"Szenario Grünland",sublayers:[{name:"Sickerwasserrate_Gruenland",title:"Sickerwasserrate Grünland"},{name:"Direktabfluss_Gruenland",title:"Direktabfluss Grünland"}]}]}]},{name:"Wasserhaushalt",title:"Wasserhaushalt",sublayers:[{name:"Kapillaraufstieg_von_Grundwasser",title:"Kapillaraufstieg von Grundwasser",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/gd/bk05l?request=GetLegendGraphic%26version=1.3.0%26format=image/png%26layer=Kapillaraufstieg_von_Grundwasser"}}},{name:"Luftkapazitaet_We",title:"Luftkapazitaet (We)",attributes:{legend:{}}}]}]})}function Ya(o){const e="https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1",t="governmentalservice",n=o.createVectorSource({baseUrl:e,collectionId:t,limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`}),s=new fe({source:n});return new dt({id:"krankenhaus",title:"Krankenhäuser",visible:!0,olLayer:s,attributes:{collectionURL:e+"/collections/"+t}})}function Xa(){return new Pt({title:"Schulstandorte",description:"Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.",visible:!0,url:"https://www.wms.nrw.de/wms/wms_nw_inspire-schulen",sublayers:[{name:"US.education",title:"INSPIRE - WMS Schulstandorte NRW",attributes:{legend:{}}}],sourceOptions:{ratio:1}})}function Za(){return new Pt({title:"Straßennetz Landesbetrieb Straßenbau NRW",url:"https://www.wms.nrw.de/wms/strassen_nrw_wms",visible:!0,sublayers:[{name:"1",title:"Verwaltungen",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/legends/wms/strassen_nrw_wms/1.png"}}},{name:"4",title:"Abschnitte und Äste"},{name:"6",title:"Unfälle"}]})}const Ja=Symbol(),Oo=Symbol(),it="a",Ft="w";let Qa=(o,e)=>new Proxy(o,e);const _o=Object.getPrototypeOf,xo=new WeakMap,es=o=>o&&(xo.has(o)?xo.get(o):_o(o)===Object.prototype||_o(o)===Array.prototype),Jo=o=>typeof o=="object"&&o!==null,el=o=>{if(Array.isArray(o))return Array.from(o);const e=Object.getOwnPropertyDescriptors(o);return Object.values(e).forEach(t=>{t.configurable=!0}),Object.create(_o(o),e)},ts=o=>o[Oo]||o,os=(o,e,t,n)=>{if(!es(o))return o;let s=n&&n.get(o);if(!s){const d=ts(o);s=(c=>Object.values(Object.getOwnPropertyDescriptors(c)).some(u=>!u.configurable&&!u.writable))(d)?[d,el(d)]:[d],n?.set(o,s)}const[i,r]=s;let a=t&&t.get(i);return a&&a[1].f===!!r||(a=((d,c)=>{const u={f:c};let h=!1;const f=(v,S)=>{if(!h){let L=u[it].get(d);if(L||(L={},u[it].set(d,L)),v===Ft)L[Ft]=!0;else{let P=L[v];P||(P=new Set,L[v]=P),P.add(S)}}},g={get:(v,S)=>S===Oo?d:(f("k",S),os(Reflect.get(v,S),u[it],u.c,u.t)),has:(v,S)=>S===Ja?(h=!0,u[it].delete(d),!0):(f("h",S),Reflect.has(v,S)),getOwnPropertyDescriptor:(v,S)=>(f("o",S),Reflect.getOwnPropertyDescriptor(v,S)),ownKeys:v=>(f(Ft),Reflect.ownKeys(v))};return c&&(g.set=g.deleteProperty=()=>!1),[g,u]})(i,!!r),a[1].p=Qa(r||i,a[0]),t&&t.set(i,a)),a[1][it]=e,a[1].c=t,a[1].t=n,a[1].p},ns=(o,e,t,n)=>{if(Object.is(o,e))return!1;if(!Jo(o)||!Jo(e))return!0;const s=t.get(ts(o));if(!s)return!0;if(n){const r=n.get(o);if(r&&r.n===e)return r.g;n.set(o,{n:e,g:!1})}let i=null;try{for(const r of s.h||[])if(i=Reflect.has(o,r)!==Reflect.has(e,r),i)return i;if(s[Ft]===!0){if(i=((r,a)=>{const d=Reflect.ownKeys(r),c=Reflect.ownKeys(a);return d.length!==c.length||d.some((u,h)=>u!==c[h])})(o,e),i)return i}else for(const r of s.o||[])if(i=!!Reflect.getOwnPropertyDescriptor(o,r)!=!!Reflect.getOwnPropertyDescriptor(e,r),i)return i;for(const r of s.k||[])if(i=ns(o[r],e[r],t,n),i)return i;return i===null&&(i=!0),i}finally{n&&n.set(o,{n:e,g:i})}},tl=o=>es(o)&&o[Oo]||null,Qo=(o,e=!0)=>{xo.set(o,e)};const ro=o=>typeof o=="object"&&o!==null,be=new WeakMap,ut=new WeakSet,ol=(o=Object.is,e=(c,u)=>new Proxy(c,u),t=c=>ro(c)&&!ut.has(c)&&(Array.isArray(c)||!(Symbol.iterator in c))&&!(c instanceof WeakMap)&&!(c instanceof WeakSet)&&!(c instanceof Error)&&!(c instanceof Number)&&!(c instanceof Date)&&!(c instanceof String)&&!(c instanceof RegExp)&&!(c instanceof ArrayBuffer),n=c=>{switch(c.status){case"fulfilled":return c.value;case"rejected":throw c.reason;default:throw c}},s=new WeakMap,i=(c,u,h=n)=>{const f=s.get(c);if(f?.[0]===u)return f[1];const g=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c));return Qo(g,!0),s.set(c,[u,g]),Reflect.ownKeys(c).forEach(v=>{if(Object.getOwnPropertyDescriptor(g,v))return;const S=Reflect.get(c,v),{enumerable:L}=Reflect.getOwnPropertyDescriptor(c,v),P={value:S,enumerable:L,configurable:!0};if(ut.has(S))Qo(S,!1);else if(S instanceof Promise)delete P.value,P.get=()=>h(S);else if(be.has(S)){const[I,A]=be.get(S);P.value=i(I,A(),h)}Object.defineProperty(g,v,P)}),Object.preventExtensions(g)},r=new WeakMap,a=[1,1],d=c=>{if(!ro(c))throw new Error("object required");const u=r.get(c);if(u)return u;let h=a[0];const f=new Set,g=(w,y=++a[0])=>{h!==y&&(h=y,f.forEach(m=>m(w,y)))};let v=a[1];const S=(w=++a[1])=>(v!==w&&!f.size&&(v=w,P.forEach(([y])=>{const m=y[1](w);m>h&&(h=m)})),h),L=w=>(y,m)=>{const _=[...y];_[1]=[w,..._[1]],g(_,m)},P=new Map,I=(w,y)=>{if(f.size){const m=y[3](L(w));P.set(w,[y,m])}else P.set(w,[y])},A=w=>{var y;const m=P.get(w);m&&(P.delete(w),(y=m[1])==null||y.call(m))},X=w=>(f.add(w),f.size===1&&P.forEach(([m,_],M)=>{const x=m[3](L(M));P.set(M,[m,x])}),()=>{f.delete(w),f.size===0&&P.forEach(([m,_],M)=>{_&&(_(),P.set(M,[m]))})}),Z=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c)),W=e(Z,{deleteProperty(w,y){const m=Reflect.get(w,y);A(y);const _=Reflect.deleteProperty(w,y);return _&&g(["delete",[y],m]),_},set(w,y,m,_){const M=Reflect.has(w,y),x=Reflect.get(w,y,_);if(M&&(o(x,m)||r.has(m)&&o(x,r.get(m))))return!0;A(y),ro(m)&&(m=tl(m)||m);let E=m;if(m instanceof Promise)m.then(V=>{m.status="fulfilled",m.value=V,g(["resolve",[y],V])}).catch(V=>{m.status="rejected",m.reason=V,g(["reject",[y],V])});else{!be.has(m)&&t(m)&&(E=d(m));const V=!ut.has(E)&&be.get(E);V&&I(y,V)}return Reflect.set(w,y,E,_),g(["set",[y],m,x]),!0}});r.set(c,W);const b=[Z,S,i,X];return be.set(W,b),Reflect.ownKeys(c).forEach(w=>{const y=Object.getOwnPropertyDescriptor(c,w);"value"in y&&(W[w]=c[w],delete y.value,delete y.writable),Object.defineProperty(Z,w,y)}),W})=>[d,be,ut,o,e,t,n,s,i,r,a],[nl]=ol();function ss(o={}){return nl(o)}function sl(o,e,t){const n=be.get(o);let s;const i=[],r=n[3];let a=!1;const c=r(u=>{if(i.push(u),t){e(i.splice(0));return}s||(s=Promise.resolve().then(()=>{s=void 0,a&&e(i.splice(0))}))});return a=!0,()=>{a=!1,c()}}function en(o,e){const t=be.get(o),[n,s,i]=t;return i(n,s(),e)}function rt(o){return ut.add(o),o}var is={exports:{}},rs={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qe=p;function il(o,e){return o===e&&(o!==0||1/o===1/e)||o!==o&&e!==e}var rl=typeof Object.is=="function"?Object.is:il,al=Qe.useState,ll=Qe.useEffect,cl=Qe.useLayoutEffect,dl=Qe.useDebugValue;function ul(o,e){var t=e(),n=al({inst:{value:t,getSnapshot:e}}),s=n[0].inst,i=n[1];return cl(function(){s.value=t,s.getSnapshot=e,ao(s)&&i({inst:s})},[o,t,e]),ll(function(){return ao(s)&&i({inst:s}),o(function(){ao(s)&&i({inst:s})})},[o]),dl(t),t}function ao(o){var e=o.getSnapshot;o=o.value;try{var t=e();return!rl(o,t)}catch{return!0}}function hl(o,e){return e()}var pl=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?hl:ul;rs.useSyncExternalStore=Qe.useSyncExternalStore!==void 0?Qe.useSyncExternalStore:pl;is.exports=rs;var fl=is.exports;const gl=As(fl),{use:tn}=_n,{useSyncExternalStore:ml}=gl;const vl=new WeakMap;function et(o,e){const t=e?.sync,n=p.useRef(),s=p.useRef();let i=!0;const r=ml(p.useCallback(c=>{const u=sl(o,c,t);return c(),u},[o,t]),()=>{const c=en(o,tn);try{if(!i&&n.current&&s.current&&!ns(n.current,c,s.current,new WeakMap))return n.current}catch{}return c},()=>en(o,tn));i=!1;const a=new WeakMap;p.useEffect(()=>{n.current=r,s.current=a});const d=p.useMemo(()=>new WeakMap,[]);return os(r,a,d,vl)}function bl(o){const e=ss({data:Array.from(o||[]),has(t){return this.data.some(n=>n[0]===t)},set(t,n){const s=this.data.find(i=>i[0]===t);return s?s[1]=n:this.data.push([t,n]),this},get(t){var n;return(n=this.data.find(s=>s[0]===t))==null?void 0:n[1]},delete(t){const n=this.data.findIndex(s=>s[0]===t);return n===-1?!1:(this.data.splice(n,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(t){this.data.forEach(n=>{t(n[1],n[0],this)})},keys(){return this.data.map(t=>t[0]).values()},values(){return this.data.map(t=>t[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}class wl{label;filteredTypes;httpService;constructor(e,t,n){this.label=e,this.filteredTypes=t,this.httpService=n}async search(e,{mapProjection:t,signal:n}){const s=await this.request(e,100,n),i=new Qt({dataProjection:"EPSG:4326",featureProjection:t});return s.features.filter(r=>this.filteredTypes.includes(r.properties.type)).map((r,a)=>{const d=i.readGeometry(r.geometry);return{id:r.properties.osm_id||a,label:this.createLabel(r),geometry:d,properties:r.properties}})}async request(e,t,n){const s=new URL("https://photon.komoot.io/api?");s.searchParams.set("q",e),s.searchParams.set("lang","de"),s.searchParams.set("lat","51.961563"),s.searchParams.set("lon","7.628202"),s.searchParams.set("limit",t.toString());const i=await this.httpService.fetch(s,{signal:n});if(!i.ok)throw new Error("Request failed: "+i.status);return await i.json()}createLabel(e){return`${e.properties.name} (${e.properties.osm_value?e.properties.osm_value+", ":""}${e.properties.postcode?e.properties.postcode+", ":""}${e.properties.city?e.properties.city+", ":""}${e.properties.country?e.properties.country+")":")"}`}}const yl=pe("ol-app:AppModel");class Sl{_intl;_mapRegistry;_ogcSearchSourceFactory;_vectorSelectionSourceFactory;_httpService;_state;_resources=[];constructor({references:e,intl:t}){this._mapRegistry=e.mapRegistry,this._intl=t,this._ogcSearchSourceFactory=e.ogcSearchSourceFactory,this._vectorSelectionSourceFactory=e.vectorSelectionSourceFactory,this._httpService=e.httpService,this._state=ss({searchSources:[],selectionSources:[],sourceMetadata:bl(),resultListState:{input:void 0,open:!1,key:0}}),this.initSearchSources(),this.initSelectionSources().catch(n=>{yl.error("Failed to initialize selection sources",n)})}destroy(){this._resources.forEach(e=>e.destroy())}get state(){return this._state}setResultListInput(e){const t=this._state.resultListState.key;this._state.resultListState={open:!0,key:t+1,input:e}}setResultListVisibility(e){this._state.resultListState.open=e}initSearchSources(){const e=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.lika"}),baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"flurstueck",searchProperty:"flurstid",labelProperty:"objid"}),t=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.miningPermissions"}),baseUrl:"https://ogc-api.nrw.de/inspire-am-bergbauberechtigungen/v1",collectionId:"managementrestrictionorregulationzone",searchProperty:"thematicId",labelProperty:"name",renderLabel(s){const i=s?.properties?.name,r=s?.id;return typeof i=="string"?i+" ("+r+")":String(r)},rewriteUrl(s){return s.searchParams.set("properties","name"),s}}),n=new wl("Photon Geocoder",["city","street"],this._httpService);this._state.searchSources=[rt(e),rt(t),rt(n)]}async initSelectionSources(){const e=["ogc_kitas","ogc_kataster"],t=await this._mapRegistry.expectMapModel(B),n=t.layers.getOperationalLayers({sortByDisplayOrder:!0});for(const s of n){if(!e.includes(s.id)||!_l(s.olLayer))continue;const i=this._vectorSelectionSourceFactory.createSelectionSource({vectorLayer:s.olLayer,label:s.title}),r=i.on("changed:status",()=>{i.status!=="available"&&(i.status==="unavailable"||i.status?.kind==="unavailable")&&t.removeHighlight()});this._resources.push(r,i),this._state.selectionSources.unshift(rt(i)),this._state.sourceMetadata.set(rt(i),s.attributes.resultListMetadata)}}}function _l(o){return o instanceof fe&&o.getSource()instanceof Oe}const At={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Tt extends Mn{constructor(e,t){super(e),this.feature=t}}function xl(o,e){const t=[];for(let n=0;n<e.length;++n){const i=e[n].getGeometry();as(o,i,t)}return t}function Rt(o,e){return jn(o[0],o[1],e[0],e[1])}function Ve(o,e){const t=o.length;return e<0?o[e+t]:e>=t?o[e-t]:o[e]}function It(o,e,t){let n,s;e<t?(n=e,s=t):(n=t,s=e);const i=Math.ceil(n),r=Math.floor(s);if(i>r){const d=Be(o,n),c=Be(o,s);return Rt(d,c)}let a=0;if(n<i){const d=Be(o,n),c=Ve(o,i);a+=Rt(d,c)}if(r<s){const d=Ve(o,r),c=Be(o,s);a+=Rt(d,c)}for(let d=i;d<r-1;++d){const c=Ve(o,d),u=Ve(o,d+1);a+=Rt(c,u)}return a}function as(o,e,t){if(e instanceof ze){Ot(o,e.getCoordinates(),!1,t);return}if(e instanceof Un){const n=e.getCoordinates();for(let s=0,i=n.length;s<i;++s)Ot(o,n[s],!1,t);return}if(e instanceof Jt){const n=e.getCoordinates();for(let s=0,i=n.length;s<i;++s)Ot(o,n[s],!0,t);return}if(e instanceof Wn){const n=e.getCoordinates();for(let s=0,i=n.length;s<i;++s){const r=n[s];for(let a=0,d=r.length;a<d;++a)Ot(o,r[a],!0,t)}return}if(e instanceof Zi){const n=e.getGeometries();for(let s=0;s<n.length;++s)as(o,n[s],t);return}}const lo={index:-1,endIndex:NaN};function kl(o,e,t,n){const s=o[0],i=o[1];let r=1/0,a=-1,d=NaN;for(let h=0;h<e.targets.length;++h){const f=e.targets[h],g=f.coordinates;let v=1/0,S;for(let L=0;L<g.length-1;++L){const P=g[L],I=g[L+1],A=ls(s,i,P,I);A.squaredDistance<v&&(v=A.squaredDistance,S=L+A.along)}v<r&&(r=v,f.ring&&e.targetIndex===h&&(f.endIndex>f.startIndex?S<f.startIndex&&(S+=g.length):f.endIndex<f.startIndex&&S>f.startIndex&&(S-=g.length)),d=S,a=h)}const c=e.targets[a];let u=c.ring;if(e.targetIndex===a&&u){const h=Be(c.coordinates,d),f=t.getPixelFromCoordinate(h);Dn(f,e.startPx)>n&&(u=!1)}if(u){const h=c.coordinates,f=h.length,g=c.startIndex,v=d;if(g<v){const S=It(h,g,v);It(h,g,v-f)<S&&(d-=f)}else{const S=It(h,g,v);It(h,g,v+f)<S&&(d+=f)}}return lo.index=a,lo.endIndex=d,lo}function Ot(o,e,t,n){const s=o[0],i=o[1];for(let r=0,a=e.length-1;r<a;++r){const d=e[r],c=e[r+1],u=ls(s,i,d,c);if(u.squaredDistance===0){const h=r+u.along;n.push({coordinates:e,ring:t,startIndex:h,endIndex:h});return}}}const co={along:0,squaredDistance:0};function ls(o,e,t,n){const s=t[0],i=t[1],r=n[0],a=n[1],d=r-s,c=a-i;let u=0,h=s,f=i;return(d!==0||c!==0)&&(u=gi(((o-s)*d+(e-i)*c)/(d*d+c*c),0,1),h+=d*u,f+=c*u),co.along=u,co.squaredDistance=pi(jn(o,e,h,f),10),co}function Be(o,e){const t=o.length;let n=Math.floor(e);const s=e-n;n>=t?n-=t:n<0&&(n+=t);let i=n+1;i>=t&&(i-=t);const r=o[n],a=r[0],d=r[1],c=o[i],u=c[0]-a,h=c[1]-d;return[a+u*s,d+h*s]}class Cl extends si{constructor(e){const t=e;t.stopDown||(t.stopDown=ii),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Pl(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:ri,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const s=this.mode_;if(s==="Circle")n=function(i,r,a){const d=r||new _a([NaN,NaN]),c=zo(i[0]),u=ai(c,zo(i[i.length-1]));return d.setCenterAndRadius(c,Math.sqrt(u),this.geometryLayout_),d};else{let i;s==="Point"?i=Ge:s==="LineString"?i=ze:s==="Polygon"&&(i=Jt),n=function(r,a,d){return a?s==="Polygon"?r[0].length?a.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(r,this.geometryLayout_):a=new i(r,this.geometryLayout_),a}}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new fe({source:new Oe({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:El(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:li,this.freehandCondition_,e.freehand?this.freehandCondition_=Uo:this.freehandCondition_=e.freehandCondition?e.freehandCondition:ci,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(di.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Uo:t=e:t=fi,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===On.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===me.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===me.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===me.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===me.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===me.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===me.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===me.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new ui(me.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),i=En([n,s]),r=this.traceSource_.getFeaturesInExtent(i);if(r.length===0)return;const a=xl(e.coordinate,r);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,s=e.startIndex<=t;n===s?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const s=Math.ceil(e);let i=Math.floor(t);i===t&&(i-=1),n=i-s+1}else{const s=Math.floor(e);let i=Math.ceil(t);i===t&&(i+=1),n=s-i+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const s=[];if(t<n){const i=Math.ceil(t);let r=Math.floor(n);r===n&&(r-=1);for(let a=i;a<=r;++a)s.push(Ve(e.coordinates,a))}else{const i=Math.floor(t);let r=Math.ceil(n);r===n&&(r+=1);for(let a=i;a>=r;--a)s.push(Ve(e.coordinates,a))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Dn(t.startPx,e.pixel)<this.snapTolerance_)return;const n=kl(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const d=t.targets[t.targetIndex];this.removeTracedCoordinates_(d.startIndex,d.endIndex)}const a=t.targets[n.index];this.addTracedCoordinates_(a,a.startIndex,n.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,n.endIndex)}t.targetIndex=n.index;const s=t.targets[t.targetIndex];s.endIndex=n.endIndex;const i=Be(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(i);e.coordinate=i,e.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,s=t[0]-n[0],i=t[1]-n[1],r=s*s+i*i;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let s=!1,i=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")n=!0;else if(r==="Circle")n=this.sketchCoords_.length===2;else if(r==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const a=this.sketchCoords_;s=a[0].length>this.minPoints_,i=[a[0][0],a[0][a[0].length-2]],t?i=[a[0][0]]:i=[a[0][0],a[0][a[0].length-2]]}if(s){const a=this.getMap();for(let d=0,c=i.length;d<c;d++){const u=i[d],h=a.getPixelFromCoordinate(u),f=e[0]-h[0],g=e[1]-h[1],v=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(f*f+g*g)<=v,n){this.finishCoordinate_=u;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Ee(new Ge(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Ee);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new ze(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=Wo(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Ee(new ze(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Ee,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new Tt(At.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),i=Wo(this.geometryLayout_);let r,a;for(;e.length<i;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],a=r[r.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(r=this.sketchCoords_,a=r[r.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let s,i;const r=this.mode_;r==="LineString"||r==="Circle"?(this.finishCoordinate_=e.slice(),i=this.sketchCoords_,i.length>=this.maxPoints_&&(this.freehand_?i.pop():s=!0),i.push(e.slice()),this.geometryFunction_(i,t,n)):r==="Polygon"&&(i=this.sketchCoords_[0],i.length>=this.maxPoints_&&(this.freehand_?i.pop():s=!0),i.push(e.slice()),s&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),s=this.mode_;for(let i=0;i<e;++i){let r;if(s==="LineString"||s==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const a=this.finishCoordinate_.slice();r[r.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(r,t,n),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const a=this.sketchLine_.getGeometry();if(r.length>=2){const d=r[r.length-2].slice();r[r.length-1]=d,this.createOrUpdateSketchPoint_(d)}a.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,t,n)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const n=e.getGeometry(),s=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,n,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,n,s),t=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new Xi([t])):this.type_==="MultiLineString"?e.setGeometry(new Un([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Wn([t])),this.dispatchEvent(new Tt(At.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Tt(At.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&s.shift(),s.pop();for(let r=0;r<e.length;r++)this.addToDrawing_(e[r]);const i=e[e.length-1];this.addToDrawing_(i),this.modifyDrawing_(i)}extend(e){const n=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=n.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new Ee(new Ge(s)),this.updateSketchFeatures_(),this.dispatchEvent(new Tt(At.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function El(){const o=hi();return function(e,t){return o[e.getGeometry().getType()]}}function Pl(o){switch(o){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+o)}}const Do=Cl;async function Ml(o,e,t,n){const i=n.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),r=await o.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${i}>`}});if(!r||!r.ok||r.status!==201)return Promise.reject(new Error("Request failed: "+r.status));const a=r.headers.get("location");if(!a)return Promise.reject(new Error("Request failed: no Location response header"));const d=a.substring(a.lastIndexOf("/")+1);return Promise.resolve(d)}var we;class Ll extends To{constructor(t){super();R(this,we,void 0);$(this,"_httpService");$(this,"_intl");$(this,"_map");$(this,"_polygonDrawStyle");$(this,"_state");$(this,"_editLayerURL");$(this,"_drawSource");$(this,"_drawLayer");$(this,"_drawInteraction");$(this,"_olMap");$(this,"_mapContainer");$(this,"_tooltip");$(this,"_enterHandler");$(this,"_escapeHandler");$(this,"_interactionListener");$(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonDrawStyle=t.polygonDrawStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._drawSource=new Oe,this._drawLayer=new fe({source:this._drawSource,zIndex:Lo,properties:{name:"editing-layer"}}),this._drawInteraction=new Do({source:this._drawSource,type:"Polygon",style:this._polygonDrawStyle}),this._tooltip=this._createTooltip(this._olMap),this._enterHandler=n=>{if(n.code==="Enter"&&n.target===this._olMap.getTargetElement()){const s=this._drawInteraction.getOverlay().getSource().getFeatures();s[0]&&s[0].getGeometry().getCoordinates()[0].length>4&&this._drawInteraction.finishDrawing()}},this._escapeHandler=n=>{n.code==="Escape"&&n.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_start(){this._olMap.addLayer(this._drawLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.element.classList.remove("editing-tooltip-hidden");const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.continue"})}),n=this._drawInteraction.on("drawend",i=>{this._setState("active:saving");const r=this._editLayerURL,a=i.feature.getGeometry();if(!a){this._destroy(),k(this,we)?.reject(new Error("no geometry available"));return}const d=this._olMap.getView().getProjection(),u=new Qt({dataProjection:d}).writeGeometryObject(a,{rightHanded:!0,decimals:10});Ml(this._httpService,r,u,d).then(h=>{this._destroy(),k(this,we)?.resolve(h)}).catch(h=>{console.log(h),this._destroy(),k(this,we)?.reject(h)})}),s=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(t,n),this._mapListener.push(s)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.element.textContent=this._intl.formatMessage({id:"tooltip.begin"}),this._setState("active:initialized")}stop(){this._destroy(),k(this,we)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._drawLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{ae(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._state="inactive"}whenComplete(){return(k(this,we)??O(this,we,xn())).promise}_createTooltip(t){const n=document.createElement("div");n.className="editing-tooltip editing-tooltip-hidden",n.textContent=this._intl.formatMessage({id:"tooltip.begin"});const s=new ft({element:n,offset:[15,0],positioning:"center-left"}),i=t.on("pointermove",r=>{r.dragging||s.setPosition(r.coordinate)});return t.addOverlay(s),{overlay:s,element:n,destroy(){ae(i),t.removeOverlay(s)}}}}we=new WeakMap;class Al{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}start(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const n=e.id;let s=this._workflows.get(n);if(s)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return s=new Ll({map:e,ogcApiFeatureLayerUrl:t,polygonDrawStyle:this._serviceOptions.properties.polygonDrawStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(n,s),this._connectToWorkflowComplete(s,n),s}stop(e){const t=this._workflows.get(e);if(t)t.stop();else return new Error("No workflow found for mapId: "+e)}reset(e){const t=this._workflows.get(e);if(t)t.reset();else return new Error("No workflow found for mapId: "+e)}_connectToWorkflowComplete(e,t){e.whenComplete().finally(()=>{this._workflows.delete(t)})}}new Ge([407354,5754673]),new Ge([404740,5757893]);var Me,ye,wt,yt,St,ko;class Tl extends To{constructor(t,n,s){super();R(this,St);$(this,"label");R(this,Me,{kind:"available"});R(this,ye,void 0);R(this,wt,void 0);R(this,yt,void 0);this.label=n,O(this,ye,t),O(this,yt,s),H(this,St,ko).call(this),O(this,wt,k(this,ye).on("change:visible",()=>{H(this,St,ko).call(this)}))}destroy(){ae(k(this,wt))}get status(){return k(this,Me)}async select(t,n){if(t.type!=="extent")throw new Error(`Unsupported selection kind: ${t.type}`);if(k(this,Me).kind!=="available"||k(this,ye).getSource()===null)return[];const s=[];k(this,ye).getSource().forEachFeatureIntersectingExtent(t.extent,a=>{if(!a.getGeometry())return;const d={...a.getProperties()};delete d.geometries;const c={id:a.getId()?.toString()||Nn(),geometry:a.getGeometry(),properties:d};s.push(c)});const i=s.filter(a=>a!=null);return i.length>n.maxResults?i.slice(0,n.maxResults):i}}Me=new WeakMap,ye=new WeakMap,wt=new WeakMap,yt=new WeakMap,St=new WeakSet,ko=function(){const n=k(this,ye).getVisible()?{kind:"available"}:{kind:"unavailable",reason:k(this,yt)};n.kind!==k(this,Me).kind&&(O(this,Me,n),this.emit("changed:status"))};var _t;class Rl{constructor({intl:e}){R(this,_t,void 0);O(this,_t,e)}createSelectionSource(e){return new Tl(e.vectorLayer,e.label,k(this,_t).formatMessage({id:"layerNotVisibleReason"}))}}_t=new WeakMap;const Te=pe("local-storage"),Il=0,re={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var qe,oe,Se,Ke,ne,$t,cs,qt,ds,Le,ht,_e,Fe,Kt,us;class Ol{constructor(e){R(this,$t);R(this,qt);R(this,Le);R(this,_e);R(this,Kt);R(this,qe,void 0);R(this,oe,{});R(this,Se,void 0);R(this,Ke,void 0);R(this,ne,void 0);O(this,qe,Fl(e.properties)),O(this,Se,Vl()),k(this,Se)&&(H(this,qt,ds).call(this),O(this,Ke,H(this,Kt,us).call(this)))}destroy(){k(this,ne)&&(clearTimeout(k(this,ne)),O(this,ne,void 0)),k(this,Se)&&H(this,Le,ht).call(this)}get isSupported(){return!!k(this,Ke)}get(e){return H(this,_e,Fe).call(this).get(e)}set(e,t){return H(this,_e,Fe).call(this).set(e,t)}remove(e){return H(this,_e,Fe).call(this).remove(e)}removeAll(){return H(this,_e,Fe).call(this).removeAll()}getNamespace(e){return H(this,_e,Fe).call(this).getNamespace(e)}}qe=new WeakMap,oe=new WeakMap,Se=new WeakMap,Ke=new WeakMap,ne=new WeakMap,$t=new WeakSet,cs=function(){k(this,ne)&&clearTimeout(k(this,ne)),O(this,ne,setTimeout(()=>{O(this,ne,void 0),H(this,Le,ht).call(this)},Il))},qt=new WeakSet,ds=function(){try{const e=k(this,Se);if(!e)throw new ie(re.INTERNAL,"Local storage is not available.");const t=e.getItem(k(this,qe));if(t==null){O(this,oe,{}),H(this,Le,ht).call(this);return}try{const n=JSON.parse(t);if(!tt(n))throw new ie(re.CORRUPTED_DATA,"Persisted value should be an object.");O(this,oe,n)}catch(n){Te.warn("Invalid persisted data, reverting to default.",n),O(this,oe,{}),H(this,Le,ht).call(this)}}catch(e){Te.error("Failed to load from local storage",e)}},Le=new WeakSet,ht=function(){try{const e=k(this,Se);if(!e)throw new ie(re.INTERNAL,"Local storage is not available.");const t=JSON.stringify(k(this,oe));e.setItem(k(this,qe),t)}catch(e){Te.error("Failed to save to local storage",e)}},_e=new WeakSet,Fe=function(){const e=k(this,Ke);if(!e)throw new ie(re.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},Kt=new WeakSet,us=function(){const e={getByPath:t=>nn(Dl(k(this,oe),t)),setByPath:(t,n)=>{if(!Nl(n))throw new ie(re.INVALID_VALUE,"The value is not supported by local storage.");if(n=nn(n),t.length===0){if(!tt(n))throw new ie(re.INVALID_VALUE,"The root value must be a plain object.");O(this,oe,n)}else jl(k(this,oe),t,n);H(this,$t,cs).call(this)}};return new jo([],e)};class jo{path;access;constructor(e,t){this.path=e,this.access=t}get(e){return this.access.getByPath([...this.path,e])}set(e,t){this.access.setByPath([...this.path,e],t)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const t=this.get(e);if(t===void 0)this.set(e,{});else if(!tt(t))throw new ie(re.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new jo(this.path.concat([e]),this.access)}}const on="trails-state";function Dl(o,e){let t=o;for(const n of e){if(!tt(t))throw new ie(re.INVALID_PATH,`Cannot get nested property '${n}' because the parent is no object.`);t=t[n]}return t}function jl(o,e,t){if(!e.length)throw new ie(re.INTERNAL,"Path must not be empty.");let n=o;for(let i=0,r=e.length-1;i<r;++i){const a=e[i],d=n[a];if(!tt(d))throw new ie(re.INVALID_PATH,`Cannot set property on '${a}' because it is no object.`);n=d}const s=e[e.length-1];n[s]=t}function tt(o){return!!(o&&typeof o=="object"&&!Array.isArray(o))}function Nl(o){const e=typeof o;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||o===null||Array.isArray(o)||tt(o)}function Fl(o){const e=o.storageId;return!e||typeof e!="string"?(Te.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${on}'.`),on):e}function Vl(){if(typeof Storage>"u"){Te.warn("Local storage is not supported by this browser.");return}try{const o=globalThis.localStorage;if(!o){Te.warn("Local storage is not supported by this browser.");return}return o}catch(o){Te.warn("Local storage is not supported by this browser.",o);return}}function nn(o){return o!=null&&(o=JSON.parse(JSON.stringify(o))),o}const Bl={"ol-map":{name:"ol-map",services:{MapConfigProviderImpl:{name:"MapConfigProviderImpl",clazz:Ua,provides:[{name:"map.MapConfigProvider",qualifier:void 0}],references:{vectorSourceFactory:{name:"ogc-features.VectorSourceFactory",qualifier:void 0,all:!1}}},AppModel:{name:"AppModel",clazz:Sl,provides:[{name:"ol-app.AppModel",qualifier:void 0}],references:{ogcSearchSourceFactory:{name:"ogc-features.SearchSourceFactory",qualifier:void 0,all:!1},vectorSelectionSourceFactory:{name:"selection.VectorSelectionSourceFactory",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1},mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1},{name:"ol-app.AppModel",qualifier:void 0,all:!1},{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"editing.EditingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/chakra-integration":{name:"@open-pioneer/chakra-integration",services:{},ui:{references:[]},properties:{}},"@open-pioneer/experimental-layout-sidebar":{name:"@open-pioneer/experimental-layout-sidebar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/http":{name:"@open-pioneer/http",services:{HttpServiceImpl:{name:"HttpServiceImpl",clazz:mi,provides:[{name:"http.HttpService",qualifier:"http.HttpService"}],references:{interceptors:{name:"http.Interceptor",qualifier:void 0,all:!0}}}},ui:{references:[]},properties:{}},"@open-pioneer/map":{name:"@open-pioneer/map",services:{MapRegistryImpl:{name:"MapRegistryImpl",clazz:vi,provides:[{name:"map.MapRegistry",qualifier:void 0}],references:{providers:{name:"map.MapConfigProvider",qualifier:void 0,all:!0},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/notifier":{name:"@open-pioneer/notifier",services:{NotificationServiceImpl:{name:"NotificationServiceImpl",clazz:Qi,provides:[{name:"notifier.NotificationService",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/react-utils":{name:"@open-pioneer/react-utils",services:{},ui:{references:[]},properties:{}},"@open-pioneer/result-list":{name:"@open-pioneer/result-list",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime":{name:"@open-pioneer/runtime",services:{},ui:{references:[]},properties:{}},"@open-pioneer/theme":{name:"@open-pioneer/theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/toc":{name:"@open-pioneer/toc",services:{},ui:{references:[]},properties:{}},"@open-pioneer/core":{name:"@open-pioneer/core",services:{},ui:{references:[]},properties:{}},"@open-pioneer/base-theme":{name:"@open-pioneer/base-theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime-react-support":{name:"@open-pioneer/runtime-react-support",services:{},ui:{references:[]},properties:{}},"@open-pioneer/basemap-switcher":{name:"@open-pioneer/basemap-switcher",services:{},ui:{references:[]},properties:{}},"@open-pioneer/ogc-features":{name:"@open-pioneer/ogc-features",services:{VectorSourceFactory:{name:"VectorSourceFactory",clazz:or,provides:[{name:"ogc-features.VectorSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}},SearchSourceFactory:{name:"SearchSourceFactory",clazz:nr,provides:[{name:"ogc-features.SearchSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{}},"@open-pioneer/map-navigation":{name:"@open-pioneer/map-navigation",services:{},ui:{references:[]},properties:{}},"@open-pioneer/coordinate-viewer":{name:"@open-pioneer/coordinate-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/overview-map":{name:"@open-pioneer/overview-map",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-bar":{name:"@open-pioneer/scale-bar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-viewer":{name:"@open-pioneer/scale-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/geolocation":{name:"@open-pioneer/geolocation",services:{},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/legend":{name:"@open-pioneer/legend",services:{},ui:{references:[]},properties:{}},"@open-pioneer/editing":{name:"@open-pioneer/editing",services:{EditingServiceImpl:{name:"EditingServiceImpl",clazz:Al,provides:[{name:"editing.EditingService",qualifier:void 0}],references:{mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{polygonDrawStyle:{value:{"stroke-color":"yellow","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(0, 0, 255, 0.2)","circle-stroke-color":"rgba(0, 0, 255, 0.7)","circle-stroke-width":2},required:!1}}},"@open-pioneer/measurement":{name:"@open-pioneer/measurement",services:{},ui:{references:[]},properties:{}},"@open-pioneer/search":{name:"@open-pioneer/search",services:{},ui:{references:[]},properties:{}},"@open-pioneer/selection":{name:"@open-pioneer/selection",services:{VectorSelectionSourceFactory:{name:"VectorSelectionSourceFactory",clazz:Rl,provides:[{name:"selection.VectorSelectionSourceFactory",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/spatial-bookmarks":{name:"@open-pioneer/spatial-bookmarks",services:{},ui:{references:[{name:"local-storage.LocalStorageService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/printing":{name:"@open-pioneer/printing",services:{},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/local-storage":{name:"@open-pioneer/local-storage",services:{LocalStorageServiceImpl:{name:"LocalStorageServiceImpl",clazz:Ol,provides:[{name:"local-storage.LocalStorageService",qualifier:void 0}],references:{}}},ui:{references:[]},properties:{storageId:{value:null,required:!1}}}},Gl=`.search-box{position:absolute;width:500px;max-width:100%;z-index:1}.spatial-bookmarks{max-height:300px}:root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.editing-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.editing-tooltip-hidden{visibility:hidden}.measurement-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.measurement-active-tooltip{background:rgba(0,0,0,.9);border-radius:4px;border-color:#000000e6;opacity:.9;color:#fff}.measurement-finished-tooltip{background-color:#4cb3ffe6;color:#000;border:1px solid white}.measurement-active-tooltip:before,.measurement-finished-tooltip:before{border-top:6px solid rgba(0,0,0,.9);border-right:6px solid transparent;border-left:6px solid transparent;content:"";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.measurement-finished-tooltip:before{border-top-color:#4cb3ff}.search-component .chakra-divider{display:none}.search-component .search-highlighted-match{font-weight:700}.search-component .search-value-container{cursor:text;padding-left:30px!important}.search-component .search-invisible{display:none}.selection-drag-box{background-color:#ffffff4d!important;border:3px solid var(--chakra-colors-background_primary)!important}.selection-tooltip{position:relative;background:rgba(255,255,255,.8);border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.selection .react-select{cursor:default}.map-container .selection-active{cursor:crosshair}.map-container .selection-inactive{cursor:no-drop}.selection-source-value.selection-source-value--disabled{opacity:.4}.selection-source-value.selection-source-value--disabled span{margin:0 6px 0 0}.printing-overlay{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10000;-webkit-user-select:none;user-select:none;pointer-events:all;cursor:wait;display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:#b4b4b4cc}.printing-overlay-status{flex:1 1 auto;font-size:1.5em;text-align:center}.layout-sidebar{height:100%;position:absolute;top:0}.layout-sidebar[data-theme=light]{background-color:var(--chakra-colors-whiteAlpha-700)}.layout-sidebar[data-theme=dark]{background-color:var(--chakra-colors-blackAlpha-700)}.layout-sidebar .layout-sidebar-main{transition:width .3s ease-out 0s;border-right:1px solid var(--chakra-colors-chakra-border-color)}.layout-sidebar .layout-sidebar-content{overflow:auto;transition:width .3s ease-out 0s}.layout-sidebar .layout-sidebar-content .content-section .content-header{font-size:1.5em;background-color:var(--chakra-colors-blackAlpha-500);padding:.5rem 1rem}.layout-sidebar .layout-sidebar-content .content-section .content-body{padding:1rem}.result-list-no-data-message{text-align:center;margin-top:50px;font-weight:700;font-size:larger}.result-list-table th,.result-list-table td{overflow-wrap:break-word}.result-list-table.result-list-table--is-resizing *{cursor:col-resize}.result-list-table thead{position:sticky;top:0;z-index:1;background:var(--chakra-colors-background_body)}.result-list-table th{position:relative;border-right-width:thin}.result-list-table tbody tr:hover{background:var(--chakra-colors-background_light)}.result-list-table .result-list-resizer{position:absolute;top:0;height:100%;right:0;width:8px;background:var(--chakra-colors-trails-100);transform:scaleX(.25);cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none;padding-left:0}.result-list-table th:last-child .result-list-resizer{width:8px;transform:translate(50%) scaleX(.25)}.result-list-table th .result-list-resizer.result-list-resizer--is-resizing{background:var(--chakra-colors-trails-500);transform:scale(1)}.result-list-table th .result-list-resizer:hover{transform:scale(1)}.overview-map .ol-overviewmap{position:relative;height:100%;width:100%}.overview-map .ol-overviewmap:not(.ol-collapsed){border:1px solid black}.overview-map .ol-overviewmap .ol-overviewmap-map{border:none;width:100%;height:100%}.overview-map .ol-overviewmap .ol-overviewmap-box{border:2px solid red}.scale-bar .ol-scale-bar{margin-bottom:8px;margin-right:8px}.scale-bar .ol-scale-bar,.scale-bar .ol-scale-line{position:relative;bottom:0;left:0;background:none}.scale-bar .ol-scale-bar .ol-scale-bar-inner,.scale-bar .ol-scale-bar .ol-scale-line-inner,.scale-bar .ol-scale-line .ol-scale-bar-inner,.scale-bar .ol-scale-line .ol-scale-line-inner{color:var(--chakra-white);border-color:var(--chakra-white)}
`,zl=["en","de"];function Ul(o){switch(o){case"en":return Bt(()=>import("./164fc91039ca.js"),[],import.meta.url).then(e=>e.default);case"de":return Bt(()=>import("./4f7d6845e5b6.js"),[],import.meta.url).then(e=>e.default)}throw new Error(`Unsupported locale: '${o}'`)}const Wl=Ts(Gl),Hl=Object.freeze(Object.defineProperty({__proto__:null,loadMessages:Ul,locales:zl,packages:Bl,styles:Wl},Symbol.toStringTag,{value:"Module"})),$l="@open-pioneer/coordinate-viewer",ql=le.bind(void 0,$l),Kl=4,Yl=o=>{const{mapId:e,precision:t,displayProjectionCode:n}=o,{containerProps:s}=te("coordinate-viewer",o),{map:i}=Y(e),r=i?.olMap,a=Qn(r)?.getCode()??"";let{coordinates:d}=Zl(r);d=d&&n?Ql(d,a,n):d;const c=Xl(d,t),u=n||a,h=c?c+" "+u:"";return l.jsx(N,{...s,children:l.jsx(he,{className:"coordinate-viewer-text",children:h})})};function Xl(o,e){const t=ql();return o?Jl(o,e,t):""}function Zl(o){const[e,t]=p.useState();return p.useEffect(()=>{if(!o)return;const n=o.on("pointermove",s=>{t(s.coordinate)});return()=>ae(n)},[o]),{coordinates:e}}function Jl(o,e,t){if(o[0]==null||o[1]==null)return"";const n=e??Kl,[s,i]=o,r=t.formatNumber(s,{maximumFractionDigits:n,minimumFractionDigits:n}),a=t.formatNumber(i,{maximumFractionDigits:n,minimumFractionDigits:n});return r+" "+a}function Ql(o,e,t){return bi(o,e,t)}var ec=ur({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const uo=.75,Dt=.1;let tc=class extends Fn{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",n=e.tipLabel!==void 0?e.tipLabel:"Overview map",s=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;const i=e.label!==void 0?e.label:"›";typeof i=="string"?(this.label_=document.createElement("span"),this.label_.textContent=i):this.label_=i;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=n,a.appendChild(r),a.addEventListener(On.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const d=new wi({view:e.view,controls:new Ho,interactions:new Ho});this.ovmap_=d,e.layers&&e.layers.forEach(function(I){d.addLayer(I)});const c=document.createElement("div");c.className="ol-overviewmap-box",c.style.boxSizing="border-box",this.boxOverlay_=new ft({position:[0,0],positioning:"center-center",element:c}),this.ovmap_.addOverlay(this.boxOverlay_);const u=t+" "+Vn+" "+yi+(this.collapsed_&&this.collapsible_?" "+$o:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=u,h.appendChild(this.ovmapDiv_),h.appendChild(a);const f=this,g=this.boxOverlay_,v=this.boxOverlay_.getElement(),S=function(I){return{clientX:I.clientX,clientY:I.clientY}},L=function(I){const A=S(I),X=d.getEventCoordinateInternal(A);g.setPosition(X)},P=function(I){const A=d.getEventCoordinateInternal(I);f.getMap().getView().setCenterInternal(A),window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",P)};v.addEventListener("mousedown",function(){window.addEventListener("mousemove",L),window.addEventListener("mouseup",P)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const n=t.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(Ln(e,Si.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const n=e.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===io.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const n=this.getMap().getView();this.bindView_(n)}else!this.ovmap_.isRendered()&&(e.key===io.TARGET||e.key===io.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new Rn({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(qo.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(qo.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const n=e.getSize(),i=e.getView().calculateExtentInternal(n);if(this.viewExtent_&&_i(i,this.viewExtent_))return;this.viewExtent_=i;const r=t.getSize(),d=t.getView().calculateExtentInternal(r),c=t.getPixelFromCoordinateInternal(xi(i)),u=t.getPixelFromCoordinateInternal(ki(i)),h=Math.abs(c[0]-u[0]),f=Math.abs(c[1]-u[1]),g=r[0],v=r[1];h<g*Dt||f<v*Dt||h>g*uo||f>v*uo?this.resetExtent_():Tn(d,i)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,n=e.getSize(),i=e.getView().calculateExtentInternal(n),r=t.getView(),a=Math.log(uo/Dt)/Math.LN2,d=1/(Math.pow(2,a/2)*Dt);Ci(i,d),r.fitInternal(Ei(i))}recenter_(){const e=this.getMap(),t=this.ovmap_,n=e.getView();t.getView().setCenterInternal(n.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const n=e.getSize(),s=e.getView(),i=t.getView(),r=this.rotateWithView_?0:-s.getRotation(),a=this.boxOverlay_,d=this.boxOverlay_.getElement(),c=s.getCenterInternal(),u=s.getResolution(),h=i.getResolution(),f=n[0]*u/h,g=n[1]*u/h;if(a.setPosition(c),d){d.style.width=f+"px",d.style.height=g+"px";const v="rotate("+r+"rad)";d.style.transform=v}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Pi(this.ovmap_,An.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle($o),this.collapsed_?Ko(this.collapseLabel_,this.label_):Ko(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};const oc=tc,ho="units",nc=[1,2,5],at=25.4/.28;class sc extends Fn{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+Vn,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(ho,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(ho)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(ho,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,s=this.getUnits(),i=s=="degrees"?"degrees":"m";let r=go(n,e.resolution,t,i);const a=this.minWidth_*(this.dpi_||at)/at,d=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||at)/at:void 0;let c=a*r,u="";if(s=="degrees"){const A=Mi.degrees;c*=A,c<A/60?(u="″",r*=3600):c<A?(u="′",r*=60):u="°"}else if(s=="imperial")c<.9144?(u="in",r/=.0254):c<1609.344?(u="ft",r/=.3048):(u="mi",r/=1609.344);else if(s=="nautical")r/=1852,u="NM";else if(s=="metric")c<.001?(u="μm",r*=1e6):c<1?(u="mm",r*=1e3):c<1e3?u="m":(u="km",r/=1e3);else if(s=="us")c<.9144?(u="in",r*=39.37):c<1609.344?(u="ft",r/=.30480061):(u="mi",r/=1609.3472);else throw new Error("Invalid units");let h=3*Math.floor(Math.log(a*r)/Math.log(10)),f,g,v,S,L,P;for(;;){v=Math.floor(h/3);const A=Math.pow(10,v);if(f=nc[(h%3+3)%3]*A,g=Math.round(f/r),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(d!==void 0&&g>=d){f=S,g=L,v=P;break}else if(g>=a)break;S=f,L=g,P=v,++h}const I=this.scaleBar_?this.createScaleBar(g,f,u):f.toFixed(v<0?-v:0)+" "+u;this.renderedHTML_!=I&&(this.innerElement_.innerHTML=I,this.renderedHTML_=I),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const s=this.getScaleForResolution(),i=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),r=this.scaleBarSteps_,a=e/r,d=[this.createMarker("absolute")];for(let u=0;u<r;++u){const h=u%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";d.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(u%2===0||r===2?this.createStepText(u,e,!1,t,n):"")+"</div>")}return d.push(this.createStepText(r,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+i+"</div>":"")+d.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,s,i){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+i),d=e===0?-3:t/this.scaleBarSteps_*-1,c=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${d}px;text-align: ${e===0?"left":"center"};min-width: ${c}px;left: ${n?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=go(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||at,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const hs=sc,ic=o=>{const{mapId:e,displayMode:t="line"}=o,{containerProps:n}=te("scale-bar",o),{map:s}=Y(e),i=p.useRef(null);return p.useEffect(()=>{if(i.current&&s){const r=s.olMap,a=new hs({units:"metric",target:i.current,bar:t==="bar"});return r.addControl(a),()=>{r.removeControl(a)}}},[t,s]),l.jsx(N,{...n,ref:i})},rc="@open-pioneer/scale-viewer",ac=le.bind(void 0,rc),lc=o=>{const{mapId:e}=o,{containerProps:t}=te("scale-viewer",o),{map:n}=Y(e),s=ac(),i=Na(n?.olMap),r=i?s.formatNumber(i):void 0;return l.jsx(N,{...t,children:r&&l.jsxs(he,{children:["1:",r]})})},ps="ol-map",ke=Lt.bind(void 0,ps),Ce=le.bind(void 0,ps);let cc=0;function dc(o,e){const t=`atom${++cc}`,n={toString:()=>t};return typeof o=="function"?n.read=o:(n.init=o,n.read=function(s){return s(this)},n.write=function(s,i,r){return i(this,typeof r=="function"?r(s(this)):r)}),e&&(n.write=e),n}const sn=o=>"init"in o,rn=o=>!!o.write,zt=new WeakMap,uc=(o,e)=>{zt.set(o,e),o.catch(()=>{}).finally(()=>zt.delete(o))},an=(o,e)=>{const t=zt.get(o);t&&(zt.delete(o),t(e))},ln=(o,e)=>{o.status="fulfilled",o.value=e},cn=(o,e)=>{o.status="rejected",o.reason=e},hc=o=>typeof o?.then=="function",lt=(o,e)=>!!o&&"v"in o&&"v"in e&&Object.is(o.v,e.v),dn=(o,e)=>!!o&&"e"in o&&"e"in e&&Object.is(o.e,e.e),Ne=o=>!!o&&"v"in o&&o.v instanceof Promise,pc=(o,e)=>"v"in o&&"v"in e&&o.v.orig&&o.v.orig===e.v.orig,jt=o=>{if("e"in o)throw o.e;return o.v},No=()=>{const o=new WeakMap,e=new WeakMap,t=new Map;let n,s;const i=b=>o.get(b),r=(b,w)=>{const y=o.get(b);if(o.set(b,w),t.has(b)||t.set(b,y),Ne(y)){const m="v"in w?w.v instanceof Promise?w.v:Promise.resolve(w.v):Promise.reject(w.e);y.v!==m&&an(y.v,m)}},a=(b,w,y)=>{const m=new Map;let _=!1;y.forEach((M,x)=>{!M&&x===b&&(M=w),M&&(m.set(x,M),w.d.get(x)!==M&&(_=!0))}),(_||w.d.size!==m.size)&&(w.d=m)},d=(b,w,y)=>{const m=i(b),_={d:m?.d||new Map,v:w};if(y&&a(b,_,y),lt(m,_)&&m.d===_.d)return m;if(Ne(m)&&Ne(_)&&pc(m,_)){if(m.d===_.d)return m;_.v=m.v}return r(b,_),_},c=(b,w,y,m)=>{if(hc(w)){let _;const M=()=>{const E=i(b);if(!Ne(E)||E.v!==x)return;const V=d(b,x,y);e.has(b)&&E.d!==V.d&&Z(b,V,E.d)},x=new Promise((E,V)=>{let j=!1;w.then(z=>{j||(j=!0,ln(x,z),E(z),M())},z=>{j||(j=!0,cn(x,z),V(z),M())}),_=z=>{j||(j=!0,z.then(q=>ln(x,q),q=>cn(x,q)),E(z))}});return x.orig=w,x.status="pending",uc(x,E=>{E&&_(E),m?.()}),d(b,x,y)}return d(b,w,y)},u=(b,w,y)=>{const m=i(b),_={d:m?.d||new Map,e:w};return y&&a(b,_,y),dn(m,_)&&m.d===_.d?m:(r(b,_),_)},h=(b,w)=>{const y=i(b);if(!w&&y&&(e.has(b)||Array.from(y.d).every(([j,z])=>{if(j===b)return!0;const q=h(j);return q===z||lt(q,z)})))return y;const m=new Map;let _=!0;const M=j=>{if(j===b){const q=i(j);if(q)return m.set(j,q),jt(q);if(sn(j))return m.set(j,void 0),j.init;throw new Error("no atom init")}const z=h(j);return m.set(j,z),jt(z)};let x,E;const V={get signal(){return x||(x=new AbortController),x.signal},get setSelf(){return!E&&rn(b)&&(E=(...j)=>{if(!_)return I(b,...j)}),E}};try{const j=b.read(M,V);return c(b,j,m,()=>x?.abort())}catch(j){return u(b,j,m)}finally{_=!1}},f=b=>jt(h(b)),g=b=>{let w=e.get(b);return w||(w=A(b)),w},v=(b,w)=>!w.l.size&&(!w.t.size||w.t.size===1&&w.t.has(b)),S=b=>{const w=e.get(b);w&&v(b,w)&&X(b)},L=b=>{const w=new Map,y=new WeakMap,m=x=>{var E;const V=new Set((E=e.get(x))==null?void 0:E.t);return t.forEach((j,z)=>{var q;(q=i(z))!=null&&q.d.has(x)&&V.add(z)}),V},_=x=>{m(x).forEach(E=>{E!==x&&(w.set(E,(w.get(E)||new Set).add(x)),y.set(E,(y.get(E)||0)+1),_(E))})};_(b);const M=x=>{m(x).forEach(E=>{var V;if(E!==x){let j=y.get(E);if(j&&y.set(E,--j),!j){let z=!!((V=w.get(E))!=null&&V.size);if(z){const q=i(E),Es=h(E,!0);z=!lt(q,Es)}z||w.forEach(q=>q.delete(E))}M(E)}})};M(b)},P=(b,...w)=>{let y=!0;const m=x=>jt(h(x)),_=(x,...E)=>{let V;if(x===b){if(!sn(x))throw new Error("atom not writable");const j=i(x),z=c(x,E[0]);lt(j,z)||L(x)}else V=P(x,...E);if(!y){const j=T()}return V},M=b.write(m,_,...w);return y=!1,M},I=(b,...w)=>{const y=P(b,...w),m=T();return y},A=(b,w,y)=>{var m;const _=y||[];(m=i(b))==null||m.d.forEach((x,E)=>{const V=e.get(E);V?V.t.add(b):E!==b&&A(E,b,_)}),h(b);const M={t:new Set(w&&[w]),l:new Set};if(e.set(b,M),rn(b)&&b.onMount){const{onMount:x}=b;_.push(()=>{const E=x((...V)=>I(b,...V));E&&(M.u=E)})}return y||_.forEach(x=>x()),M},X=b=>{var w;const y=(w=e.get(b))==null?void 0:w.u;y&&y(),e.delete(b);const m=i(b);m&&(Ne(m)&&an(m.v),m.d.forEach((_,M)=>{if(M!==b){const x=e.get(M);x&&(x.t.delete(b),v(M,x)&&X(M))}}))},Z=(b,w,y)=>{const m=new Set(w.d.keys());y?.forEach((_,M)=>{if(m.has(M)){m.delete(M);return}const x=e.get(M);x&&(x.t.delete(b),v(M,x)&&X(M))}),m.forEach(_=>{const M=e.get(_);M?M.t.add(b):e.has(b)&&A(_,b)})},T=()=>{let b;for(;t.size;){const w=Array.from(t);t.clear(),w.forEach(([y,m])=>{const _=i(y);if(_){const M=e.get(y);M&&_.d!==m?.d&&Z(y,_,m?.d),M&&!(!Ne(m)&&(lt(m,_)||dn(m,_)))&&M.l.forEach(x=>x())}})}};return{get:f,set:I,sub:(b,w)=>{const y=g(b),m=T(),_=y.l;return _.add(w),()=>{_.delete(w),S(b)}}}};let po;const fc=()=>(po||(po=No()),po),fs=p.createContext(void 0),gc=o=>{const e=p.useContext(fs);return o?.store||e||fc()},mc=({children:o,store:e})=>{const t=p.useRef();return!e&&!t.current&&(t.current=No()),p.createElement(fs.Provider,{value:e||t.current},o)},vc=o=>typeof o?.then=="function",bc=_n.use||(o=>{if(o.status==="pending")throw o;if(o.status==="fulfilled")return o.value;throw o.status==="rejected"?o.reason:(o.status="pending",o.then(e=>{o.status="fulfilled",o.value=e},e=>{o.status="rejected",o.reason=e}),o)});function wc(o,e){const t=gc(e),[[n,s,i],r]=p.useReducer(c=>{const u=t.get(o);return Object.is(c[0],u)&&c[1]===t&&c[2]===o?c:[u,t,o]},void 0,()=>[t.get(o),t,o]);let a=n;(s!==t||i!==o)&&(r(),a=t.get(o));const d=e?.delay;return p.useEffect(()=>{const c=t.sub(o,()=>{if(typeof d=="number"){setTimeout(r,d);return}r()});return r(),c},[t,o,d]),p.useDebugValue(a),vc(a)?bc(a):a}const gs="@open-pioneer/spatial-bookmarks",yc=Lt.bind(void 0,gs),Sc=le.bind(void 0,gs),ve=pe("spatial-bookmark:SpatialBookmarkViewModel");class _c{map;packageNamespace;writableBookmarks=dc([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,t){this.map=e,this.packageNamespace=t.getNamespace("spatial-bookmarks"),this.store=No(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const t=this.map.olMap,n=t.getView().calculateExtent(),s=t.getView().getProjection().getCode(),i={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},r={id:Nn(),title:e,extent:i,projection:s};ve.debug("Created a new bookmark",r);const a=this.writableBookmarks;this.store.set(a,[...this.store.get(a),r])}activateBookmark(e){ve.debug("Activating bookmark",e);const t=this.getBookmarkExtent(e);ve.debug("Attempting to apply extent",t),this.applyExtent(t)}deleteBookmark(e){ve.debug("Deleting bookmark",e);const t=this.writableBookmarks;this.store.set(t,[...this.store.get(t).filter(n=>n.id!==e)])}deleteAllBookmarks(){ve.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){ve.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{xc(e),this.store.set(this.writableBookmarks,e)}catch(t){ve.error("Bookmarks data in local storage is invalid, resetting to default value.",t),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){ve.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const n=this.map.olMap.getView(),s=e.extent,i=[s.minX,s.minY,s.maxX,s.maxY],r=n.getProjection(),a=e.projection;return Li(i,a,r)}applyExtent(e){const n=this.map.olMap.getView(),s=Ai(e),i=n.getResolutionForExtent(e);n.setCenter(s),n.setResolution(i)}}function xc(o){if(!Array.isArray(o))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of o)kc(e)}function kc(o){if(!o||typeof o!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=o;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(Cc(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function Cc(o){if(!o||typeof o!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=o;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const Ec=o=>{const{map:e}=Y(o.mapId),t=yc("local-storage.LocalStorageService"),n=Ic(e,t);return n&&l.jsx(mc,{store:n.store,children:l.jsx(Pc,{...o,viewModel:n})})};function Pc(o){const{viewModel:e}=o,t=Sc(),n=p.useRef([]),[s,i]=p.useState(!1),r=wc(e.bookmarks),[a,d]=p.useState(""),c=a.trim().length>0,{containerProps:u}=te("spatial-bookmarks",o),[h,f]=p.useState("list"),g=()=>{e.deleteAllBookmarks(),f("list")},v=()=>{c&&(e.createBookmark(a),f("list"),d(""),i(!0))};p.useEffect(()=>{if(s){const A=n.current;A&&A[r.length-1]?.scrollIntoView?.(),i(!1)}},[r,s]);const S=()=>l.jsxs(vo,{children:[l.jsxs(no,{rounded:"md",status:"warning",children:[l.jsx(so,{}),t.formatMessage({id:"bookmark.alert.delete"})]}),l.jsx(Tc,{intl:t,onClear:g,onCancel:()=>f("list")})]}),L=()=>l.jsxs(vo,{children:[l.jsxs(no,{rounded:"md",status:"info",children:[l.jsx(so,{}),t.formatMessage({id:"bookmark.alert.create"})]}),l.jsx($n,{"aria-label":t.formatMessage({id:"bookmark.input.label"}),placeholder:t.formatMessage({id:"bookmark.input.placeholder"}),value:a,onChange:A=>{d(A.target.value)},onKeyDown:A=>{A.key==="Enter"&&v()},isRequired:!0,isInvalid:!c,autoFocus:!0}),l.jsx(Rc,{intl:t,isInvalid:!c,onCancel:()=>{d(""),f("list")},onSave:v})]}),P=()=>l.jsxs(l.Fragment,{children:[r.length?Mc(r,e,t,n):l.jsxs(no,{rounded:"md",status:"info",children:[l.jsx(so,{}),t.formatMessage({id:"bookmark.alert.noSaved"})]}),l.jsx(Ac,{intl:t,bookmarks:r,showCreate:()=>f("create"),showDelete:()=>f("delete")})]}),I=l.jsxs(l.Fragment,{children:[h==="list"&&P(),h==="create"&&L(),h==="delete"&&S()]});return l.jsx(de,{flexDirection:"column",...u,children:I})}function Mc(o,e,t,n){const s=t.formatMessage({id:"bookmark.button.deleteOne"}),i=o.map((r,a)=>l.jsx(Lc,{index:a,listItemNodes:n,bookmark:r,onActivate:()=>e.activateBookmark(r),onDelete:()=>e.deleteBookmark(r.id),deleteBtnLabel:s},r.id));return l.jsx(Hn,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":t.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:i})}const un={ArrowDown:1,ArrowUp:-1};function Lc(o){const{index:e,listItemNodes:t,bookmark:n,onDelete:s,onActivate:i,deleteBtnLabel:r}=o,a=n.title,d=c=>{const u=c.key;if(u==="Enter"){c.target===c.currentTarget&&i();return}if(un[u]!=null){const h=t.current?.length;if(!h)return;let f=(e+un[u])%h;f<0&&(f=h-1),t.current[f]?.focus()}};return l.jsx(N,{as:"li",p:1,ref:c=>{if(!c){t.current.splice(e,1);return}t.current[e]=c},className:Mt("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:d,onClick:i,children:l.jsxs(de,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[l.jsx(Yn,{children:l.jsx(Gn,{})}),l.jsx(he,{ps:2,noOfLines:1,children:a}),l.jsx(ar,{}),l.jsx(kn,{hasArrow:!0,label:r,placement:"right",children:l.jsx(Zt,{className:"spatial-bookmarks-item-delete","aria-label":r,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:l.jsx(zn,{}),onClick:c=>{s(),c.stopPropagation()}})},e)]})})}function Ac(o){const{intl:e,bookmarks:t,showCreate:n,showDelete:s}=o;return l.jsxs(Fo,{children:[l.jsx(ot,{isDisabled:t.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:l.jsx(zn,{}),onClick:s,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),l.jsx(ot,{onClick:n,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function Tc(o){const{intl:e,onCancel:t,onClear:n}=o;return l.jsxs(Fo,{children:[l.jsx(ot,{variant:"outline",onClick:t,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),l.jsx(ot,{onClick:n,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function Rc(o){const{intl:e,onCancel:t,onSave:n,isInvalid:s}=o;return l.jsxs(Fo,{children:[l.jsx(ot,{variant:"outline",onClick:()=>t(),children:e.formatMessage({id:"bookmark.button.cancel"})}),l.jsx(ot,{isDisabled:s,onClick:()=>n(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function Fo(o){return l.jsx(de,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:o.children})}function ot(o){return l.jsx(Zt,{width:"100%",...o})}function Ic(o,e){const[t,n]=p.useState();return p.useEffect(()=>{let s;return o?s=new _c(o,e):s=void 0,n(s),()=>s?.destroy()},[o,e]),t}function Oc(){const o=p.useId(),e=Ce();return l.jsx(N,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:l.jsx(N,{role:"dialog","aria-labelledby":o,children:l.jsx(De,{title:l.jsx(je,{id:o,size:"md",mb:2,children:e.formatMessage({id:"spatialBookmarkTitle"})}),children:l.jsx(Ec,{mapId:B})})})})}const ms="@open-pioneer/printing",Dc=Lt.bind(void 0,ms),jc=le.bind(void 0,ms),Nc="map",hn="printing-hide";class Fc{olMap;title="";fileFormat="pdf";running=!1;i18n;drawInformation=[];scaleLine=void 0;overlay=void 0;constructor(e,t){this.olMap=e,this.i18n=t}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat)){if(this.running)throw new Error("Printing already running.");try{await this.beginExport();const e=await this.exportToCanvas(this.olMap.getViewport());if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}}async exportToCanvas(e){const t={useCORS:!0,ignoreElements:function(i){if(i.classList&&typeof i.classList=="object"){const r=i.classList;return r.contains("map-anchors")||r.contains(hn)}return!1}},n=(await Bt(()=>import("./f16e60ff8734.js"),[],import.meta.url)).default;return await n(e,t)}async beginExport(){this.running=!0;const e=this.olMap.getInteractions().getArray().filter(t=>t.getActive()&&t instanceof Do);this.drawInformation=[],e?.forEach(t=>{const n=t,s=n.getOverlay().getStyle();n.getOverlay().setStyle(null),this.drawInformation?.push({draw:n,style:s})}),this.addOverlay(),await this.addScaleLine()}reset(){this.removeScaleLine(),this.removeOverlay(),this.running=!1,this.drawInformation?.length&&this.drawInformation.forEach(e=>{e.draw.getOverlay().setStyle(e.style)})}async addScaleLine(){this.scaleLine=new hs({className:"printing-scale-bar ol-scale-bar",bar:!0,text:!0,minWidth:125});const e=xn(),t=this.scaleLine.render;this.scaleLine.render=(...n)=>{t.apply(this.scaleLine,n),e.resolve()},this.olMap.addControl(this.scaleLine),await e.promise,await new Promise(n=>{requestAnimationFrame(n)})}removeScaleLine(){this.scaleLine&&(this.olMap.removeControl(this.scaleLine),this.scaleLine=void 0)}addOverlay(){const e=this.olMap.getTargetElement(),t=this.overlay=document.createElement("div");t.classList.add("printing-overlay",hn),e.appendChild(t);const n=document.createElement("div");n.classList.add("printing-overlay-status"),n.textContent=this.i18n.overlayText,t.appendChild(n)}removeOverlay(){this.overlay?.remove(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",t=this.title||Nc;return{title:e,fileName:t}}async exportMapInPNG(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height+50,t.style.backgroundColor="#fff";const n=t.getContext("2d");if(!n)throw new Error("2d canvas rendering context not available");const{title:s,fileName:i}=this.getTitleAndFileName();n.fillStyle="#fff",n.fillRect(0,0,t.width,t.height),n.font="20px bold sans-serif",n.textAlign="center",n.fillStyle="#000";const r=t.width/2;n.fillText(s,r,20),n.drawImage(e,0,50);const a=document.createElement("a");a.setAttribute("download",i+".png"),a.href=t.toDataURL("image/png",.8),a.click()}async exportMapInPDF(e){const{jsPDF:t}=await Bt(()=>import("./a148b8e8ae0c.js"),["./a148b8e8ae0c.js","./a419295615be.js","./a3e2da54293c.js","./7b9bf2e5ae39.js","./a43dafd8eb62.js","./6e72ec7ae19c.js","./5a63b44b9c7d.js","./347424816aed.js","./2f6cd8ce72f0.js","./960f2965a833.js","./e9fe14d5121b.js","./d8dbd56b87bf.js","./a9a99471e045.js","./03b560c892f8.js","./49cf3dea6739.js","./b22e372ccca3.js"],import.meta.url),n=new t({orientation:"landscape",unit:"mm",format:"a4"}),s=n.internal.pageSize.getWidth(),i=n.internal.pageSize.getHeight(),r=15,a=20,d=i-a;n.setFontSize(20);const{title:c,fileName:u}=this.getTitleAndFileName();n.text(c,s/2,r,{align:"center"});const h=e.width/e.height;let f=d,g=f*h;g>=s&&(g=s,f=g/h);const v=(s-g)/2,S=a+(d-f)/2;n.addImage(e,"",v,S,g,f),n.save(u+".pdf")}}const Vc=pe("printing"),Bc=o=>{const e=jc(),{mapId:t}=o,{containerProps:n}=te("printing",o),[s,i]=p.useState("pdf"),[r,a]=p.useState(""),[d,c]=p.useState(!1),u=Dc("notifier.NotificationService"),{map:h}=Y(t),f=Gc(h,e);p.useEffect(()=>{f?.setFileFormat(s)},[f,s]),p.useEffect(()=>{f?.setTitle(r)},[f,r]);function g(S){(S==="png"||S==="pdf")&&i(S)}function v(){d||!f||(c(!0),f.handleMapExport().catch(S=>{const L=e.formatMessage({id:"printingFailed"});u.notify({level:"error",message:L}),Vc.error("Failed to print the map",S)}).finally(()=>c(!1)))}return l.jsxs(N,{...n,children:[l.jsxs(Gt,{mb:4,alignItems:"center",children:[l.jsxs(bo,{mb:2,children:[l.jsx(pt,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),l.jsx($n,{placeholder:e.formatMessage({id:"input.placeholder"}),value:r,onChange:S=>{a(S.target.value)},isRequired:!0,autoFocus:!0})]}),l.jsxs(bo,{mb:2,children:[l.jsx(pt,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),l.jsxs(qn,{value:s,onChange:S=>g(S.target.value),className:"printing-select",children:[l.jsx("option",{value:"png",children:"PNG"}),l.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),l.jsx(Zt,{isLoading:d,loadingText:e.formatMessage({id:"printingMap"}),disabled:d,padding:2,className:"printing-export-button",onClick:v,width:"100%",children:e.formatMessage({id:"export"})})]})};function Gc(o,e){const[t,n]=p.useState(void 0);return p.useEffect(()=>{if(!o)return;const s=new Fc(o.olMap,{overlayText:e.formatMessage({id:"printingMap"})});return n(s),()=>{s.destroy(),n(void 0)}},[o,e]),t}function zc(){const o=p.useId(),e=Ce();return l.jsx(N,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:l.jsx(N,{role:"dialog","aria-labelledby":o,children:l.jsx(De,{title:l.jsx(je,{id:o,size:"md",mb:2,children:e.formatMessage({id:"printingTitle"})}),children:l.jsx(Bc,{mapId:B})})})})}const Uc="@open-pioneer/legend",vs=le.bind(void 0,Uc),Wc=o=>{const{mapId:e,showBaseLayers:t=!1}=o,{containerProps:n}=te("legend",o),{map:s}=Y(e);return l.jsx(N,{...n,children:s?l.jsx(Hc,{map:s,showBaseLayers:t}):null})};function Hc(o){const{map:e,showBaseLayers:t}=o,s=Kc(e).map(i=>l.jsx(bs,{layer:i,showBaseLayers:t},i.id));return l.jsx(Hn,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:s})}function bs(o){const{layer:e,showBaseLayers:t}=o,{isVisible:n}=Xc(e),s=Yc(e);if(!n||!t&&!("parentLayer"in e)&&e.isBaseLayer)return;const i=[];return s?.length&&s.forEach(r=>{i.push(l.jsx(bs,{layer:r,showBaseLayers:t},r.id))}),l.jsxs(l.Fragment,{children:[l.jsx($c,{layer:e,showBaseLayers:t}),i]})}function $c(o){const e=vs(),{layer:t,showBaseLayers:n}=o,s=Zc(t),i=qc(t);let r;s?.Component?r=l.jsx(s.Component,{layer:t}):s?.imageUrl?r=l.jsx(pn,{layer:t,imageUrl:s.imageUrl}):i&&(r=l.jsx(pn,{layer:t,imageUrl:i}));const a=!("parentLayer"in t)&&t.isBaseLayer;return r?l.jsxs(N,{as:"li",className:Mt("legend-item",`layer-${Jc(t.id)}`),children:[n&&a?l.jsx(he,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,r]}):void 0}function pn(o){const e=vs(),{layer:t,imageUrl:n}=o;return l.jsxs(N,{children:[l.jsx(he,{children:t.title}),l.jsx(Kn,{maxW:"none",maxH:"none",src:n,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:l.jsx(N,{children:l.jsxs(he,{children:[l.jsx(er,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function qc(o){const e=p.useCallback(()=>o.legend,[o]),t=p.useCallback(n=>{const s=o.on("changed:legend",n);return()=>s.destroy()},[o]);return p.useSyncExternalStore(t,e)}function Kc(o){const e=p.useCallback(n=>{const s=o.layers.on("changed",n);return()=>s.destroy()},[o]),t=p.useCallback(()=>{let n=o.layers.getAllLayers({sortByDisplayOrder:!0})??[];return n=n.reverse(),n},[o]);return ws(e,t)}function Yc(o){const e=p.useCallback(n=>{const s=o.sublayers?.on("changed",n);return()=>s?.destroy()},[o]),t=p.useCallback(()=>{if(!o.sublayers)return;let s=o.sublayers?.getSublayers({sortByDisplayOrder:!0});return s=s.reverse(),s},[o]);return ws(e,t)}function ws(o,e){const t=p.useRef(),n=p.useCallback(i=>{const r=o(()=>{t.current=void 0,i()});return()=>{t.current=void 0,r()}},[o]),s=p.useCallback(()=>{if(t.current)return t.current.value;const i=e();return t.current={value:i},i},[e]);return p.useSyncExternalStore(n,s)}function Xc(o){const e=p.useCallback(()=>o.visible,[o]),t=p.useCallback(s=>{const i=o.on("changed:visible",s);return()=>i.destroy()},[o]);return{isVisible:p.useSyncExternalStore(t,e)}}function Zc(o){const[e,t]=p.useState(void 0);return p.useEffect(()=>{t(o.attributes.legend);const n=o.on("changed:attributes",()=>{t(o.attributes.legend)});return()=>n.destroy()},[o]),e}function Jc(o){return o.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function Qc(){const o=p.useId(),e=Ce();return l.jsx(N,{role:"dialog","aria-labelledby":o,children:l.jsx(De,{title:l.jsx(je,{id:o,size:"md",mb:2,children:e.formatMessage({id:"legendTitle"})}),children:l.jsx(N,{overflowY:"auto",maxHeight:300,children:l.jsx(Wc,{mapId:B,showBaseLayers:!0})})})})}const ys="@open-pioneer/geolocation",ed=Lt.bind(void 0,ys),td=le.bind(void 0,ys);function od(o){return lr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(o)}const fn=pe("geolocation:GeolocationController"),gn=17;class nd extends To{olMap;positionHighlightLayer;geolocation;maxZoom=gn;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,t){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Ee,this.accuracyFeature.setStyle(vn()),this.positionFeature=new Ee,this.positionFeature.setStyle(mn()),this.positionHighlightLayer=new fe({source:new Oe({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(Lo);const n=t||sd();this.geolocation=new Sa({tracking:!1,trackingOptions:n,projection:e.getView()?.getProjection()}),this.trackingOptions=n,this.geolocation.on("error",s=>this.handleGeolocationError(s))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(n=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const s=this.geolocation.on("change:accuracyGeometry",()=>{const d=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(d),this.accuracyFeature?.getGeometry()!==void 0&&n(),this.isInitialZoom){const c=this?.accuracyFeature?.getGeometry()?.getExtent();if(c){const u=Va(c);if(!u)return;e.getView().fit(u,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),i=this.geolocation.on("change:position",()=>{const d=this.geolocation.getPosition();d&&(d[0]||d[1])!==void 0&&(this.positionFeature?.setGeometry(new Ge(d)),this.setMapToPosition&&e.getView().setCenter(d),this.positionFeature?.getGeometry()!==void 0&&n())}),r=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),a=e.on("pointermove",d=>{d.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(s,i,r,a),e.addLayer(this.positionHighlightLayer)}).catch(n=>{fn.error("Failed to determine location",n)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{ae(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??mn())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??vn())}setMaxZoom(e){this.maxZoom=e??gn}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){fn.error("Error from geolocation API:",e.message);const t=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",t)}}const mn=()=>new Re({image:new Mo({radius:6,fill:new Je({color:"#3399CC"}),stroke:new Ae({color:"#fff",width:2})})}),vn=()=>new Re({stroke:new Ae({color:"#3399CC",width:3}),fill:new Je({color:"rgba(0, 0, 255, 0.05)"})}),sd=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),id=p.forwardRef(function(e,t){const{mapId:n,maxZoom:s,positionFeatureStyle:i,accuracyFeatureStyle:r,trackingOptions:a}=e,{containerProps:d}=te("geolocation",e),c=!!navigator.geolocation,[u,h]=p.useState(!1),[f,g]=p.useState(!1),{map:v}=Y(n),S=td(),L=ed("notifier.NotificationService"),P=rd(v,s,a,i,r),I=(()=>c?u?S.formatMessage({id:"locateMeEnd"}):S.formatMessage({id:"locateMeStart"}):S.formatMessage({id:"locateNotSupported"}))();p.useEffect(()=>{if(P===void 0)return;const X=P.on("error",function(Z){const T=S.formatMessage({id:"error"}),W=(()=>{switch(Z){case"permission-denied":return S.formatMessage({id:"permissionDenied"});case"position-unavailable":return S.formatMessage({id:"positionUnavailable"});case"timeout":return S.formatMessage({id:"timeout"});case"unknown":return S.formatMessage({id:"unknownError"})}})();g(!1),h(!1),L.notify({level:"error",title:T,message:W})});return()=>{X.destroy()}},[P,S,L]),p.useEffect(()=>{if(!P){g(!1);return}return u&&(g(!0),P.startGeolocation().then(()=>{g(!1)})),()=>{P?.stopGeolocation(),g(!1)}},[P,u]);const A=()=>{v&&h(!u)};return l.jsx(ee,{ref:t,label:I,icon:l.jsx(od,{}),onClick:()=>A(),isActive:u,isLoading:f,isDisabled:!c,...d})});function rd(o,e,t,n,s){const[i,r]=p.useState();return p.useEffect(()=>{if(!o)return;const a=new nd(o.olMap,t);return r(a),()=>{a.destroy(),r(void 0)}},[o,t]),p.useEffect(()=>{i?.setPositionFeatureStyle(n)},[i,n]),p.useEffect(()=>{i?.setAccuracyFeatureStyle(s)},[i,s]),p.useEffect(()=>{i?.setMaxZoom(e)},[i,e]),i}function ad(o){const{toolState:e,onToolStateChange:t}=o,n=Ce(),s=ke("ol-app.AppModel"),i=et(s.state).resultListState,r=i.open,{map:a}=Y(B),d=ke("editing.EditingService"),c=ke("notifier.NotificationService"),u=Ie((h,f)=>{t(h,f??!e[h])});return ld(a,d,c,n,e,u),l.jsxs(de,{role:"toolbar","aria-label":n.formatMessage({id:"ariaLabel.toolbar"}),direction:"column",gap:1,padding:1,children:[l.jsx(ee,{label:e.editingActive?n.formatMessage({id:"stopEditingTitle"}):n.formatMessage({id:"startEditingTitle"}),icon:e.editingActive?l.jsx(Fi,{}):l.jsx(Vi,{}),isActive:e.editingActive,onClick:()=>u("editingActive")}),l.jsx(ee,{label:n.formatMessage({id:"resetEditingTitle"}),icon:l.jsx(Bi,{}),onClick:()=>d.reset(B)}),i.input&&l.jsx(ee,{label:n.formatMessage({id:"resultListTitle"}),icon:l.jsx(Gi,{}),isActive:i.open,onClick:()=>s.setResultListVisibility(!r)}),l.jsx(ee,{label:n.formatMessage({id:"printingTitle"}),icon:l.jsx(zi,{}),isActive:e.printingActive,onClick:()=>u("printingActive")}),l.jsx(ee,{label:n.formatMessage({id:"spatialBookmarkTitle"}),icon:l.jsx(Ui,{}),isActive:e.bookmarksActive,onClick:()=>u("bookmarksActive")}),l.jsx(id,{mapId:B}),l.jsx(ee,{label:n.formatMessage({id:"tocTitle"}),icon:l.jsx(Wi,{}),isActive:e.tocActive,onClick:()=>u("tocActive")}),l.jsx(ee,{label:n.formatMessage({id:"legendTitle"}),icon:l.jsx(Hi,{}),isActive:e.legendActive,onClick:()=>u("legendActive")}),l.jsx(ee,{label:n.formatMessage({id:"measurementTitle"}),icon:l.jsx($i,{}),isActive:e.measurementActive,onClick:()=>u("measurementActive")}),l.jsx(ee,{label:n.formatMessage({id:"selectionTitle"}),icon:l.jsx(qi,{}),isActive:e.selectionActive,onClick:()=>u("selectionActive")}),l.jsx(ee,{label:n.formatMessage({id:"overviewMapTitle"}),icon:l.jsx(Gn,{}),isActive:e.overviewMapActive,onClick:()=>u("overviewMapActive")}),l.jsx(sr,{mapId:B}),l.jsx(ir,{mapId:B}),l.jsx(rr,{mapId:B})]})}function ld(o,e,t,n,s,i){p.useEffect(()=>{if(!o)return;function r(){if(!o)throw Error("map is undefined");try{const d=o.layers.getLayerById("krankenhaus"),c=new URL(d.attributes.collectionURL+"/items");e.start(o,c).whenComplete().then(h=>{if(!h)return;t.notify({level:"info",message:n.formatMessage({id:"editing.featureCreated"},{featureId:h}),displayDuration:4e3}),(d?.olLayer).getSource()?.refresh()}).catch(h=>{console.error(h)}).finally(()=>{i("editingActive",!1)})}catch(d){console.log(d)}}function a(){e.stop(B)}s.editingActive?r():a()},[o,e,t,n,s.editingActive,i])}const cd="@open-pioneer/measurement",dd=le.bind(void 0,cd);class ud{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,t){this.olMap=e,this.messages=t;const n=this.source=new Oe;this.layer=new fe({source:n}),this.layer.setZIndex(Lo),e.addLayer(this.layer);const s=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){ae(s)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const t=Ti(e);this.activeFeatureStyle=(n,...s)=>{const i=n?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return t(n,...s)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",n=this.draw=new Do({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(n);let s,i;n.on("drawstart",r=>{s=this.measureTooltip=this.createMeasureTooltip();const a=this.sketch=r.feature;if(!a)return;let d;i=a.getGeometry()?.on("change",c=>{const u=c.target,h=this.olMap.getView().getProjection();let f="";u instanceof Jt?(f=pd(u,h,this.messages),d=u.getInteriorPoint().getCoordinates()||null):u instanceof ze&&(f=fd(u,h,this.messages),d=u.getLastCoordinate()||null),s&&(s.element.innerHTML=f,d&&s?.overlay.setPosition(d))})}),n.on("drawend",()=>{if(s){const r=s.element.classList;r.remove("measurement-active-tooltip"),r.remove("printing-hide"),r.add("measurement-finished-tooltip"),s.overlay.setOffset([0,-7]),this.overlayTooltips.push(s),this.measureTooltip=s=void 0}this.sketch=void 0,i&&ae(i)}),n.on("drawabort",()=>{s&&(s.destroy(),this.measureTooltip=s=void 0),this.sketch=void 0,i&&ae(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=new ft({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),n=this.olMap;return n.addOverlay(t),{overlay:t,element:e,destroy(){n.removeOverlay(t)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const t=new ft({element:e,offset:[15,0],positioning:"center-left"}),n=this.olMap;return n.addOverlay(t),{overlay:t,element:e,destroy(){n.removeOverlay(t)}}}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,n=hd(this.messages,this.sketch);t.element.textContent=n,t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}}function hd(o,e){if(e){const t=e.getGeometry();if(t instanceof Jt||t instanceof ze)return o.getContinueMessage()}return o.getHelpMessage()}function pd(o,e,t){const n=Ri(o,{projection:e});let s;return n>=1e6?s=`${t.formatNumber(n/1e6)} km<sup>2</sup>`:s=`${t.formatNumber(n)} m<sup>2</sup>`,s}function fd(o,e,t){const n=Ii(o,{projection:e});let s;return n>=1e3?s=`${t.formatNumber(n/1e3)} km`:s=`${t.formatNumber(n)} m`,s}const gd=o=>{const e=dd(),{mapId:t,activeFeatureStyle:n,finishedFeatureStyle:s}=o,{containerProps:i}=te("measurement",o),[r,a]=p.useState("distance"),d=g=>e.formatMessage({id:g}),c=Y(t),u=md(c.map,e);p.useEffect(()=>{u?.setActiveFeatureStyle(n??vd())},[u,n]),p.useEffect(()=>{u?.setFinishedFeatureStyle(s??bd())},[u,s]),p.useEffect(()=>{if(u)return u.startMeasurement(r),()=>{u.stopMeasurement()}},[u,r]);function h(g){if(g==="distance"||g==="area")a(g);else throw new Error(`Unexpected measurement type: '${g}'.`)}function f(){u?.clearMeasurements()}return l.jsxs(N,{...i,children:[l.jsx(he,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),l.jsx(Gt,{mb:4,alignItems:"center",children:l.jsxs(bo,{mb:2,children:[l.jsx(pt,{mb:1,children:d("measurementLabel")}),l.jsxs(qn,{value:r,onChange:g=>h(g.target.value),className:"measurement-select",children:[l.jsx("option",{value:"distance",children:d("distance")}),l.jsx("option",{value:"area",children:d("area")})]})]})}),l.jsx(Zt,{padding:2,className:"measurement-delete-button",onClick:f,width:"100%",children:d("deleteMeasurementLabel")})]})};function md(o,e){const[t,n]=p.useState(void 0);return p.useEffect(()=>{if(!o)return;const s=new ud(o.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(i){return e.formatNumber(i,{maximumFractionDigits:2})}});return n(s),()=>{s.destroy(),n(void 0)}},[o,e]),t}function vd(){return[new Re({stroke:new Ae({color:"#fff",lineDash:[10,10],width:5})}),new Re({fill:new Je({color:"rgba(0,0,0,0.15)"}),stroke:new Ae({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new Mo({radius:5,stroke:new Ae({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new Je({color:"rgba(255, 255, 255, 0.2)"})})})]}function bd(){return[new Re({stroke:new Ae({color:"#fff",width:5})}),new Re({stroke:new Ae({color:"#0b96fc",width:3}),fill:new Je({color:"rgba(11,150,252,0.15)"})})]}function wd(){const o=p.useId(),e=Ce();return l.jsx(N,{role:"dialog","aria-labelledby":o,children:l.jsx(De,{title:l.jsx(je,{id:o,size:"md",mb:2,children:e.formatMessage({id:"measurementTitle"})}),children:l.jsx(gd,{mapId:B})})})}const yd="200px",Sd="300px",_d=o=>{const{mapId:e,olLayer:t,height:n=yd,width:s=Sd}=o,{containerProps:i}=te("overview-map",o),r=p.useRef(null),{map:a}=Y(e);return p.useEffect(()=>{if(r.current&&a&&t){const d=a.olMap,c=new oc({className:"ol-overviewmap",layers:[t],collapsible:!1,collapsed:!1,target:r.current});return d.addControl(c),()=>{d.removeControl(c)}}},[a,t]),l.jsx(N,{height:n,width:s,ref:r,...i})};function xd(){const o=p.useMemo(()=>new Po({source:new In}),[]);return l.jsx(N,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",maxWidth:325,children:l.jsx(N,{role:"dialog",children:l.jsx(_d,{mapId:B,olLayer:o})})})}function kd(){const o=ke("ol-app.AppModel"),e=et(o.state).resultListState,[t,n]=p.useState([]),[s,i]=p.useState([]),r=p.useCallback(a=>{n(a.features),i(a.getFeatureIds())},[]);return p.useEffect(()=>{console.log("Anzahl Features: "+t.length),console.log("SelectedIds: "+s.toString())},[t,s]),e.input&&l.jsx(N,{className:"result-list-container",position:"absolute",visibility:e.open?"visible":"hidden",bottom:"0",backgroundColor:"white",width:"100%",height:"400px",zIndex:1,borderTop:"2px solid",borderBottom:"2px solid",borderColor:"trails.100",children:l.jsx(dr,{input:e.input,mapId:B,onSelectionChange:r},e.key)})}const Cd="@open-pioneer/search",to=le.bind(void 0,Cd);function Ed(o){const e=o.selectProps.inputValue.length>0,t={...o,className:Mt(o.className,{"search-invisible":!e})};return l.jsx(ge.Menu,{...t,children:o.children})}function Pd(o){const t=to().formatMessage({id:"noOptionsText"});return l.jsx(ge.NoOptionsMessage,{...o,children:l.jsx(ue.span,{className:"search-no-match",children:t})})}function Md(o){const t=to().formatMessage({id:"loadingText"});return l.jsx(ge.LoadingMessage,{...o,children:l.jsx(ue.span,{className:"search-loading-text",children:t})})}function Ld({children:o,...e}){const t={...e,className:Mt(e.className,"search-value-container")};return l.jsxs(ge.ValueContainer,{...t,children:[!!o&&l.jsx(ec,{style:{position:"absolute",left:8}}),o]})}function Ad(o){const e={...o,isHidden:!1};return l.jsx(ge.Input,{...e})}function Td(o){return null}function Rd(o){return l.jsxs(ge.IndicatorsContainer,{...o,children:[o.children,!o.selectProps.isLoading&&o.selectProps.inputValue&&l.jsx(Id,{selectProps:o.selectProps,clearValue:o.clearValue})]})}function Id(o){const t=to().formatMessage({id:"ariaLabel.clearButton"}),n=s=>{s.preventDefault(),s.stopPropagation(),o.clearValue()};return l.jsx(Rs,{role:"button",size:"md",mr:1,"aria-label":t,onClick:n,onTouchEnd:n,onMouseDown:s=>s.preventDefault()})}function Od(o){return null}function Dd(o){const e=o.selectProps.inputValue,t=o.data.label,n={...o,className:Mt(o.className,"search-option")};return l.jsx(ge.Option,{...n,children:l.jsx(ue.div,{className:"search-option-label",children:e.trim().length>0?jd(t,e):t})})}function jd(o,e){const t=o.toLowerCase().indexOf(e.toLowerCase());return t>=0?l.jsxs(l.Fragment,{children:[o.substring(0,t),l.jsx(ue.span,{className:"search-highlighted-match",children:o.substring(t,t+e.length)},"highlighted"),o.substring(t+e.length)]}):o}const bn=pe("search:SearchController"),wn=200,yn=5;var xt,Ye,Xe,Ze,se,Yt,Ss;class Nd{constructor(e,t){R(this,Yt);R(this,xt,void 0);R(this,Ye,[]);R(this,Xe,yn);R(this,Ze,wn);R(this,se,void 0);O(this,xt,e),O(this,Ye,t)}destroy(){k(this,se)?.abort(),O(this,se,void 0)}async search(e){if(k(this,se)?.abort(),O(this,se,void 0),!e)return[];const t=O(this,se,new AbortController);try{return await Fd(t.signal,k(this,Ze)),t.signal.aborted&&(bn.debug(`search canceled with ${e}`),Is()),(await Promise.all(k(this,Ye).map(s=>H(this,Yt,Ss).call(this,s,e,t.signal)))).filter(s=>s!=null)}finally{k(this,se)===t&&O(this,se,void 0)}}get searchTypingDelay(){return k(this,Ze)}set searchTypingDelay(e){O(this,Ze,e??wn)}get maxResultsPerSource(){return k(this,Xe)}set maxResultsPerSource(e){O(this,Xe,e??yn)}get sources(){return k(this,Ye)}}xt=new WeakMap,Ye=new WeakMap,Xe=new WeakMap,Ze=new WeakMap,se=new WeakMap,Yt=new WeakSet,Ss=async function(e,t,n){const s=e.label,i=k(this,xt).olMap.getView().getProjection();try{const r=k(this,Xe);let a=await e.search(t,{maxResults:r,signal:n,mapProjection:i});return a.length>r&&(a=a.slice(0,r)),{label:s,source:e,results:a}}catch(r){Vt(r)||bn.error(`search for source ${s} failed`,r);return}};async function Fd(o,e){o.aborted||await new Promise(t=>{const n=()=>{o.removeEventListener("abort",n),clearTimeout(s),t()};o.addEventListener("abort",n);const s=setTimeout(n,e)})}const Ut=pe("search:Search"),Vd=o=>{const{mapId:e,sources:t,searchTypingDelay:n,maxResultsPerGroup:s,onSelect:i,onClear:r}=o,{containerProps:a}=te("search",o),{map:d}=Y(e),c=to(),u=Ud(t,n,s,d),{input:h,search:f,selectedOption:g,onInputChanged:v,onResultConfirmed:S}=Wd(u),L=zd(),P=Bd(c),I=Gd(),A=Ie((T,W)=>{W.action==="input-change"&&v(T)}),X=Ie((T,W)=>{switch(W.action){case"select-option":T&&(S(T),i?.({source:T.source,result:T.result}));break;case"clear":v(""),Z.current?.blur(),Z.current?.focus(),r?.();break;default:Ut.debug(`Unhandled action type '${W.action}'.`);break}}),Z=p.useRef(null);return l.jsx(N,{...a,children:l.jsx(wo,{className:"search-component",classNamePrefix:"react-select",ref:Z,inputValue:h,onInputChange:A,"aria-label":c.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:P,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:L,isClearable:!0,placeholder:c.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:f.kind==="loading",options:f.kind==="ready"?f.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:I,onChange:X,value:g,menuPosition:"fixed"})})};function Bd(o){return p.useMemo(()=>({onFocus:({focused:i})=>`${i.label} ${o.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:i,label:r})=>{let a="";switch(i){case"select-option":a=`${r} ${o.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":a=`${r} ${o.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return a},guidance:()=>`${o.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[o])}function Gd(){return p.useMemo(()=>({Menu:Ed,Input:Ad,SingleValue:Td,Option:Dd,NoOptionsMessage:Pd,LoadingMessage:Md,ValueContainer:Ld,IndicatorsContainer:Rd,ClearIndicator:Od}),[])}function zd(){const[o,e]=Cn("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return p.useMemo(()=>({groupHeading:n=>({...n,backgroundColor:o,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:n=>({...n,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:n=>({...n,display:"none"})}),[o,e])}function Ud(o,e,t,n){const[s,i]=p.useState(void 0);return p.useEffect(()=>{if(!n)return;const r=new Nd(n,o);return i(r),()=>{r.destroy(),i(void 0)}},[n,o]),p.useEffect(()=>{s&&(s.searchTypingDelay=e)},[s,e]),p.useEffect(()=>{s&&(s.maxResultsPerSource=t)},[s,t]),s}function Wd(o){const[e,t]=p.useReducer((a,d)=>{switch(d.kind){case"input":return{...a,query:d.query,selectedOption:null};case"select-option":return{...a,selectedOption:d.option,query:d.option.label};case"load-results":return{...a,search:{kind:"loading"}};case"accept-results":return{...a,search:{kind:"ready",results:d.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),n=p.useRef(),s=Ie(a=>{if(!o){n.current=void 0,t({kind:"accept-results",results:[]});return}Ut.isDebug()&&Ut.debug(`Starting new search for query ${JSON.stringify(a)}.`),t({kind:"load-results"});const d=n.current=Hd(o,a).then(c=>{n.current===d&&t({kind:"accept-results",results:c})})}),i=p.useCallback(a=>{t({kind:"select-option",option:a})},[]),r=p.useCallback(a=>{t({kind:"input",query:a}),s(a)},[s]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:i,onInputChanged:r}}async function Hd(o,e){let t;try{t=await o.search(e)}catch(n){Vt(n)||Ut.error("Search failed",n),t=[]}return $d(t)}function $d(o){return o.map((t,n)=>({label:t.label,options:t.results.map(s=>({value:`${n}-${s.id}`,label:s.label,source:t.source,result:s}))}))}function _s(o,e){const t=o.olMap.getViewport();o.highlightAndZoom(e,{viewPadding:t&&t.offsetWidth<1e3?{top:150,right:75,bottom:50,left:75}:{top:150,right:400,bottom:50,left:400}})}function qd(){const{map:o}=Y(B),e=ke("ol-app.AppModel"),t=et(e.state).searchSources;function n(i){if(console.debug("The user selected the following item: ",i.result),!o)return;const r=i.result.geometry;r&&_s(o,[r])}function s(){console.debug("The user cleared the search"),o?.removeHighlight()}return l.jsx(N,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",mt:5,className:"search-box",children:l.jsx(Vd,{mapId:B,sources:t,maxResultsPerGroup:10,onSelect:n,onClear:s})})}const xs="@open-pioneer/selection",Kd=Lt.bind(void 0,xs),Vo=le.bind(void 0,xs),ct="selection-active",Nt="selection-inactive";class Yd{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,n,s,i){let r;switch(t){case Bo.extent:default:r=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,i,r,this.interactionResources)),this.interactionResources.push(this.createDrag(e,r,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,n),this.olMap=e,this.tooltipMessage=n,this.tooltipDisabledMessage=s}initViewport(e){const t=e.getViewport();return t.classList.add(ct),t.oncontextmenu=n=>(n.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(n=>this.olMap.addInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipMessage,t.classList.remove(Nt),t.classList.add(ct),this.isActive=!0):(this.interactionResources.forEach(n=>this.olMap.removeInteraction(n.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,t.classList.remove(ct),t.classList.add(Nt),this.isActive=!1)}createDragBox(e,t,n,s){const i=new Yo({className:"selection-drag-box",condition:Oi});return e.addInteraction(i),i.on("boxend",function(){t(i.getGeometry())}),{interaction:i,destroy(){e.removeInteraction(i),s.splice(s.indexOf(this)),i.dispose(),n.classList.remove(ct),n.classList.remove(Nt),n.oncontextmenu=null}}}createDrag(e,t,n){const s=function(a){return a.originalEvent.button==2},i=new Xo({condition:s});return e.addInteraction(i),{interaction:i,destroy(){e.removeInteraction(i),n.splice(n.indexOf(this)),i.dispose(),t.classList.remove(ct),t.classList.remove(Nt),t.oncontextmenu=null}}}createHelpTooltip(e,t){const n=document.createElement("div");n.className="selection-tooltip printing-hide",n.textContent=t;const s=new ft({element:n,offset:[15,0],positioning:"center-left"}),i=e.on("pointermove",r=>{s.setPosition(r.coordinate)});return e.addOverlay(s),{overlay:s,element:n,destroy(){e.removeOverlay(s),s.dispose(),ae(i)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Yo)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Xo)}}const fo=pe("selection:SelectionController"),Xd=1e4;var kt,Ct,Et,Xt,ks;class Zd{constructor(e){R(this,Xt);R(this,kt,void 0);R(this,Ct,void 0);R(this,Et,void 0);const{mapModel:t,onError:n,maxResults:s=Xd}=e;O(this,kt,t),O(this,Ct,s),O(this,Et,n)}destroy(){}async select(e,t){if(t)return await H(this,Xt,ks).call(this,e,t)}}kt=new WeakMap,Ct=new WeakMap,Et=new WeakMap,Xt=new WeakSet,ks=async function(e,t){const n=k(this,kt).olMap.getView().getProjection();try{fo.debug(`Starting selection on source '${e.label}'`);const s=k(this,Ct);let i=await e.select({type:"extent",extent:t},{maxResults:s,mapProjection:n,signal:new AbortController().signal});return i.length>s&&(i=i.slice(0,s)),fo.debug(`Found ${i.length} results on source '${e.label}'`),{source:e,results:i}}catch(s){fo.error(`selection from source ${e.label} failed`,s),k(this,Et).call(this);return}};var Bo=(o=>(o.extent="EXTENT",o.polygon="POLYGON",o.free="FREEPOLYGON",o.circle="CIRCLE",o))(Bo||{});const Sn={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},Jd=o=>{const e=Vo(),{mapId:t,sources:n,onSelectionComplete:s,onSelectionSourceChanged:i}=o,{containerProps:r}=te("selection",o),[a,d]=p.useState(()=>n.find(T=>(T.status??"available")==="available")),c=Y(t),{onExtentSelected:u}=tu(c.map,n,a,s),h=su(),g=p.useCallback(T=>{const W=[];if(T||(T=["EXTENT"]),T.forEach(b=>{Object.values(Bo).includes(b)&&W.push({label:e.formatMessage({id:b}),value:b})}),W.length===0)throw new Error("methods does not contain valid values");return W},[e])(void 0),[v,S]=p.useState(g[0]),L=Ie(T=>{S(T)}),[P,I]=p.useState(!0);nu(c.map,v,e,u,P);const A=p.useMemo(()=>n.map(T=>({label:T.label,value:T})),[n]),X=p.useMemo(()=>A.find(T=>T.value===a),[A,a]),Z=Ie(T=>{d(T?.value),i&&i({source:T?.value})});return p.useEffect(()=>{if(!a){I(!1);return}const T=e.formatMessage({id:"sourceNotAvailable"}),W=()=>a&&Co(a,T).kind==="available";I(W());const b=a.on("changed:status",()=>{I(W())});return()=>b.destroy()},[a,I,e]),l.jsxs(vo,{...r,spacing:2,children:[g.length>1&&l.jsxs(Gt,{children:[l.jsx(pt,{children:e.formatMessage({id:"selectMethod"})}),l.jsx(wo,{className:"selection-method react-select",...Sn,options:g,onChange:L,value:v,chakraStyles:h})]}),l.jsxs(Gt,{children:[l.jsx(pt,{children:e.formatMessage({id:"selectSource"})}),l.jsx(wo,{className:"selection-source react-select",...Sn,options:A,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:X,onChange:Z,components:{Option:Qd,SingleValue:eu},isOptionDisabled:T=>T.value===void 0||T.value.status==="unavailable",getOptionLabel:T=>T.label+(T.value===void 0||T.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:h})]})]})};function Qd(o){const{value:e}=o.data,{isAvailable:t,content:n}=Cs(e,!1);return l.jsx(ge.Option,{...o,isDisabled:!t,className:"selection-source-option",children:n})}function eu(o){const{value:e}=o.data,{isAvailable:t,content:n}=Cs(e,!0),s=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return l.jsx(ge.SingleValue,{...o,isDisabled:!t,className:s,children:n})}function Cs(o,e){const t=o?.label,n=ou(o);return{isAvailable:n.kind==="available",content:l.jsxs(de,{direction:"row",alignItems:"center",grow:1,children:[!e&&l.jsx(de,{grow:1,children:t}),n.kind==="unavailable"&&l.jsx(N,{ml:2,children:l.jsx(kn,{label:n.reason,placement:"right",openDelay:500,children:l.jsx(ue.span,{children:l.jsx(Os,{as:cr,color:"red",className:"warning-icon","aria-label":n.reason})})})}),e&&t]})}}function tu(o,e,t,n){const s=Kd("notifier.NotificationService"),i=Vo(),[r,a]=p.useState(void 0);p.useEffect(()=>{if(!o)return;const c=new Zd({mapModel:o,onError(){s.notify({level:"error",message:i.formatMessage({id:"selectionFailed"})})}});return a(c),()=>{c.destroy()}},[o,s,e,i]);const d=Ie(async c=>{if(!r||!t)return;const u=await r.select(t,c.getExtent());u&&n?.(u)});return{controller:r,onExtentSelected:d}}function Co(o,e){const t=o.status??"available",n=typeof t=="string"?{kind:t}:t;return n.kind==="available"?n:{kind:"unavailable",reason:n.reason??e}}function ou(o){const e=Vo(),[t,n]=p.useState(()=>({kind:"available"}));return p.useEffect(()=>{if(!o){n({kind:"available"});return}const s=e.formatMessage({id:"sourceNotAvailable"});n(Co(o,s));const i=o.on?.("changed:status",()=>{n(Co(o,s))});return()=>i?.destroy()},[o,e]),t}function nu(o,e,t,n,s){p.useEffect(()=>{if(!o)return;const i=new Yd(o.olMap,e.value,t.formatMessage({id:"tooltip"}),t.formatMessage({id:"disabledTooltip"}),n);return i.setActive(s),()=>{i?.destroy()}},[o,e,t,n,s])}function su(){const[o,e]=Cn("colors",["background_body","border"],["#ffffff","#ffffff"]);return p.useMemo(()=>({control:n=>({...n,cursor:"pointer"}),indicatorSeparator:n=>({...n,borderColor:e}),dropdownIndicator:n=>({...n,backgroundColor:o})}),[o,e])}function iu(){const o=Ce(),e=ke("notifier.NotificationService"),t=p.useId(),{map:n}=Y(B),s=ke("ol-app.AppModel"),i=et(s.state).selectionSources,r=et(s.state).sourceMetadata,a={numberOptions:{maximumFractionDigits:3},dateOptions:{dateStyle:"medium",timeStyle:"medium",timeZone:"UTC"}};function d(u){const{source:h,results:f}=u;if(!n){console.debug("Map not ready");return}n?.removeHighlight();const g=f.map(S=>S.geometry);g.length>0&&_s(n,g);const v=r.get(h);if(!v){console.warn("Can not show results because no metadata could be found");return}s.setResultListInput({columns:v,data:f,formatOptions:a}),e.notify({level:"info",message:o.formatMessage({id:"foundResults"},{resultsCount:f.length}),displayDuration:4e3})}function c(u){n?.removeHighlight()}return l.jsx(N,{role:"dialog","aria-labelledby":t,children:l.jsx(De,{title:l.jsx(je,{id:t,size:"md",mb:2,children:o.formatMessage({id:"selectionTitle"})}),children:l.jsx(Jd,{mapId:B,sources:i,onSelectionComplete:d,onSelectionSourceChanged:c})})})}function ru(o){const e=p.useId(),t=Ce();return l.jsx(N,{role:"dialog","aria-labelledby":e,children:l.jsx(De,{title:l.jsx(je,{id:e,size:"md",mb:2,children:l.jsx(he,{children:t.formatMessage({id:"tocTitle"})})}),children:l.jsx(N,{overflowY:"auto",maxHeight:o.maxHeight,children:l.jsx(Ji,{mapId:B,showTools:!0,basemapSwitcherProps:{allowSelectingEmptyBasemap:!0}})})})})}const au={bookmarksActive:!1,legendActive:!0,overviewMapActive:!0,tocActive:!0,printingActive:!1};function lu(){const o=Ce(),{map:e}=Y(B),[t,n]=p.useState(),[s,i]=p.useState(au),r={...s,editingActive:t==="editing",measurementActive:t==="measurement",selectionActive:t==="selection"},a=(f,g)=>{if(f==="selectionActive"||f==="measurementActive"||f==="editingActive"){let v;switch(f){case"editingActive":v="editing";break;case"measurementActive":v="measurement";break;case"selectionActive":v="selection";break}v!==t&&g?(n(v),e?.removeHighlight()):v===t&&!g&&(n(void 0),e?.removeHighlight())}else i({...s,[f]:g})},d=ke("ol-app.AppModel"),c=et(d.state).resultListState,u=c.input&&c.open,h=[r.tocActive&&l.jsx(ru,{maxHeight:r.legendActive||t?"300px":"75vh"},"toc"),r.legendActive&&l.jsx(Qc,{},"legend"),t==="selection"?l.jsx(iu,{},"selection"):t==="measurement"?l.jsx(wd,{},"measurement"):void 0];return l.jsxs(de,{height:"100%",direction:"column",overflow:"hidden",children:[l.jsx(tr,{position:"top-right"}),l.jsxs(De,{title:l.jsx(N,{role:"region","aria-label":o.formatMessage({id:"ariaLabel.header"}),textAlign:"center",py:1,children:l.jsx(je,{size:"md",children:"OpenLayers Base Packages - Default Sample"})}),children:[l.jsx(de,{flex:"1",direction:"column",position:"relative",children:l.jsxs(Di,{mapId:B,role:"main","aria-label":o.formatMessage({id:"ariaLabel.map"}),viewPadding:u?{bottom:400}:void 0,children:[l.jsx(hr,{centerContent:!0,children:l.jsx(qd,{})}),l.jsx(st,{position:"top-left",horizontalGap:20,verticalGap:20,children:l.jsx(cu,{children:h})}),l.jsx(st,{position:"top-right",horizontalGap:20,verticalGap:20,children:r.overviewMapActive&&l.jsx(xd,{})}),l.jsx(st,{horizontalGap:20,position:"bottom-left",children:r.bookmarksActive&&l.jsx(Oc,{})}),l.jsx(st,{horizontalGap:20,position:"bottom-left",children:r.printingActive&&l.jsx(zc,{})}),l.jsx(st,{position:"bottom-right",horizontalGap:10,verticalGap:45,children:l.jsx(ad,{toolState:r,onToolStateChange:a})}),l.jsx(kd,{})]})}),l.jsxs(de,{role:"region","aria-label":o.formatMessage({id:"ariaLabel.footer"}),gap:3,alignItems:"center",justifyContent:"center",children:[l.jsx(Yl,{mapId:B,precision:2,displayProjectionCode:"EPSG:4326"}),l.jsx(ic,{mapId:B}),l.jsx(lc,{mapId:B})]})]})]})}function cu(o){const e=o.children,t=[];for(const n of e)n&&(t.length&&t.push(l.jsx(pr,{mt:4,mb:4},t.length)),t.push(n));if(t.length!==0)return l.jsx(N,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",width:350,maxWidth:350,children:t})}const du=Ds({component:lu,theme:js,appMetadata:Hl,config:{properties:{"@open-pioneer/local-storage":{storageId:"ol-app-state"},"@open-pioneer/editing":{polygonDrawStyle:{"stroke-color":"red","stroke-width":2,"fill-color":"rgba(0, 0, 0, 0.1)","circle-radius":5,"circle-fill-color":"rgba(255, 0, 0, 0.2)","circle-stroke-color":"rgba(255, 0, 0, 0.7)","circle-stroke-width":2}}}},async resolveConfig(o){const e=o.getAttribute("forced-locale");if(e)return{locale:e}}});customElements.define("ol-map-app",du);const uu=document.getElementsByTagName("body")[0];hu();function hu(){const o=window.location.search,t=new URLSearchParams(o).get("lang"),n=document.createElement("ol-map-app");n.classList.add("full-height"),n.classList.add("app"),n.setAttribute("id","test"),t&&n.setAttribute("forced-locale",t),uu.appendChild(n)}
