const __vite__fileDeps=["./WNa8RaVV2USn.js","./Dch09mLNbtBx.js","./OhQst40zhlB5.js","./CiUyy5JGrTO0.js","./CtYFX0ekGb_N.js","./DSgb2N9zFlE4.js","./DQY-f9GXVRCE.js","./D1Xkh_Dwx2k5.js","./B4wg2ROQW--n.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var br=Object.defineProperty;var wr=(n,e,t)=>e in n?br(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var A=(n,e,t)=>(wr(n,typeof e!="symbol"?e+"":e,t),t),Wt=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var C=(n,e,t)=>(Wt(n,e,"read from private field"),t?t.call(n):e.get(n)),O=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},N=(n,e,t,o)=>(Wt(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t);var U=(n,e,t)=>(Wt(n,e,"access private method"),t);import{u as _r,a as Sr,r as f,c as xr,f as Gt,b as vo,o as yo,d as bo,j as d,e as X,g as kr,l as Er,h as Cr,R as wo,i as ge,k as _o,E as ie,m as Mr,A as qt,n as Kt,F as So,B as zt,C as Pr,t as Lr,p as xo,q as ko,I as Ar,s as Ir}from"./CiUyy5JGrTO0.js";import{t as Tr}from"./BYS0UgAILKIi.js";import{B as Eo,i as jr,g as Fr,a as In,t as Rr,c as Or,b as yn,C as Nr,r as Dr,d as Vr,u as Gr,l as Co,M as Mo,o as zr,e as Br,f as Po,W as Hr,h as Ur,j as K,k as $r,m as Wr,n as R,V as Lo,S as rt,T as Ao,O as Io,p as _e,q as J,s as Pe,v as bn,F as $e,P as qr,w as Kr,x as Yr,y as To,z as Zr,R as Jr,A as We,D as Tn,E as Ne,G as an,H as ce,I as Yt,J as Le,K as ut,L as kt,N as jn,Q as ae,U as Z,X as xe,Y as ln,Z as Xr,_ as Qr,$ as ei,a0 as cn,a1 as ti,a2 as ni,a3 as jo,a4 as oi,a5 as ri,a6 as Fn,a7 as ii,a8 as Rn,a9 as si,aa as On,ab as ai,ac as li,ad as ci,ae as di,af as Nn,ag as ui,ah as Zt,ai as Dn,aj as hi,ak as pi,al as gi,am as fi,an as mi,ao as vi,ap as Vn,aq as Bt,ar as Ht,as as Fo,at as yi,au as bi,av as le,aw as Q,ax as q,ay as wi,az as Xe,aA as _i,aB as Si,aC as ue,aD as _t,aE as Ie,aF as Te,aG as Ce,aH as Y,aI as xi,aJ as Ro,aK as ki,aL as Ei,aM as Gn,aN as Ci,aO as zn,aP as Mi,aQ as Qe}from"./CtYFX0ekGb_N.js";import{W as St,P as Oo,a as No,b as Pi,c as Li,d as Ai,e as Ii,f as Ti,g as ji,h as Fi,i as Ri,j as Oi,k as Ni}from"./BdB5psyk--nr.js";import{G as xt,T as Di}from"./Bs_mFkaKU2Q3.js";import{T as pe,V as dn,L as Do}from"./D1Xkh_Dwx2k5.js";import{D as Vo,N as Vi,P as Gi,S as zi,c as Bi,a as Hi,I as Ui}from"./zvQ820oopvq2.js";import{V as $i,S as Wi,I as qi,Z as Ki,a as Yi}from"./C1e5ycRzBKHs.js";import{M as Zi}from"./BilevCrMCks_.js";import{_ as un}from"./Dch09mLNbtBx.js";import{c as Go}from"./CYle_AiyB2mo.js";import{S as Ji}from"./2A2YV2-XUzK7.js";import{u as zo,F as At}from"./DQY-f9GXVRCE.js";import{F as ht}from"./C-xDost-Kqob.js";import{H as hn}from"./DOmElOXZsr8j.js";import{G as wn,F as Xi}from"./DSgb2N9zFlE4.js";import{u as Ae,R as Qi}from"./DKqX0lsNHuZ7.js";import{L as Bo}from"./9xEIJByv5Gn3.js";import{c as fe,S as pn,D as es}from"./OhQst40zhlB5.js";import{C as ts}from"./BZVDEq3zKHc1.js";import"./B4wg2ROQW--n.js";import"./ByygOOv7jabG.js";import"./CvwMjfnefoop.js";function ns(n){const{theme:e}=_r(),t=Sr();return f.useMemo(()=>xr(e.direction,{...t,...n}),[n,e.direction,t])}var Ut=Gt(function(e,t){const{htmlSize:o,...r}=e,i=vo("Input",r),s=yo(r),a=zo(s),l=bo("chakra-input",e.className);return d.jsx(X.input,{size:o,...a,__css:i.field,ref:t,className:l})});Ut.displayName="Input";Ut.id="Input";var Ho=X("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Ho.displayName="Center";var os={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Gt(function(e,t){const{axis:o="both",...r}=e;return d.jsx(X.div,{ref:t,__css:os[o],...r,position:"absolute"})});var Uo=Gt(function(e,t){const{children:o,placeholder:r,className:i,...s}=e;return d.jsxs(X.select,{...s,ref:t,className:bo("chakra-select",i),children:[r&&d.jsx("option",{value:"",children:r}),o]})});Uo.displayName="SelectField";function rs(n,e){const t={},o={};for(const[r,i]of Object.entries(n))e.includes(r)?t[r]=i:o[r]=i;return[t,o]}var _n=Gt((n,e)=>{var t;const o=vo("Select",n),{rootProps:r,placeholder:i,icon:s,color:a,height:l,h:c,minH:u,minHeight:p,iconColor:g,iconSize:h,...y}=yo(n),[S,M]=rs(y,Er),E=zo(M),j={width:"100%",height:"fit-content",position:"relative",color:a},F={paddingEnd:"2rem",...o.field,_focus:{zIndex:"unset",...(t=o.field)==null?void 0:t._focus}};return d.jsxs(X.div,{className:"chakra-select__wrapper",__css:j,...S,...r,children:[d.jsx(Uo,{ref:e,height:c??l,minH:u??p,placeholder:i,...E,__css:F,children:n.children}),d.jsx($o,{"data-disabled":kr(E.disabled),...(g||a)&&{color:g||a},__css:o.icon,...h&&{fontSize:h},children:s})]})});_n.displayName="Select";var is=n=>d.jsx("svg",{viewBox:"0 0 24 24",...n,children:d.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),ss=X("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),$o=n=>{const{children:e=d.jsx(is,{}),...t}=n,o=f.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return d.jsx(ss,{...t,className:"chakra-select__icon-wrapper",children:f.isValidElement(e)?o:null})};$o.displayName="SelectIcon";const G={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},as={ERROR:"error"};class ls extends yn{constructor(e){super(as.ERROR),this.code=e.code,this.message=e.message}}let cs=class extends Eo{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=jr,this.watchId_=void 0,this.addChangeListener(G.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(G.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Fr(In("EPSG:4326"),e),this.position_&&this.set(G.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(G.ACCURACY,t.accuracy),this.set(G.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(G.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(G.HEADING,t.heading===null?void 0:Rr(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const o=this.transform_(this.position_);this.set(G.POSITION,o.slice()),this.set(G.SPEED,t.speed===null?void 0:t.speed);const r=Or(this.position_,t.accuracy);r.applyTransform(this.transform_),this.set(G.ACCURACY_GEOMETRY,r),this.changed()}positionError_(e){this.dispatchEvent(new ls(e))}getAccuracy(){return this.get(G.ACCURACY)}getAccuracyGeometry(){return this.get(G.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(G.ALTITUDE)}getAltitudeAccuracy(){return this.get(G.ALTITUDE_ACCURACY)}getHeading(){return this.get(G.HEADING)}getPosition(){return this.get(G.POSITION)}getProjection(){return this.get(G.PROJECTION)}getSpeed(){return this.get(G.SPEED)}getTracking(){return this.get(G.TRACKING)}getTrackingOptions(){return this.get(G.TRACKING_OPTIONS)}setProjection(e){this.set(G.PROJECTION,In(e))}setTracking(e){this.set(G.TRACKING,e)}setTrackingOptions(e){this.set(G.TRACKING_OPTIONS,e)}};const W={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class qe extends Eo{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Nr,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(W.ELEMENT,this.handleElementChanged),this.addChangeListener(W.MAP,this.handleMapChanged),this.addChangeListener(W.OFFSET,this.handleOffsetChanged),this.addChangeListener(W.POSITION,this.handlePositionChanged),this.addChangeListener(W.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(W.ELEMENT)}getId(){return this.id}getMap(){return this.get(W.MAP)||null}getOffset(){return this.get(W.OFFSET)}getPosition(){return this.get(W.POSITION)}getPositioning(){return this.get(W.POSITIONING)}handleElementChanged(){Dr(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Vr(this.element),Gr(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Co(e,Mo.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(W.ELEMENT,e)}setMap(e){this.set(W.MAP,e)}setOffset(e){this.set(W.OFFSET,e)}setPosition(e){this.set(W.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(W.POSITION))return;const o=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),i=this.getRect(r,[zr(r),Br(r)]);e=e||{};const s=e.margin===void 0?20:e.margin;if(!Po(o,i)){const a=i[0]-o[0],l=o[2]-i[2],c=i[1]-o[1],u=o[3]-i[3],p=[0,0];if(a<0?p[0]=a-s:l<0&&(p[0]=Math.abs(l)+s),c<0?p[1]=c-s:u<0&&(p[1]=Math.abs(u)+s),p[0]!==0||p[1]!==0){const g=t.getView().getCenterInternal(),h=t.getPixelFromCoordinateInternal(g);if(!h)return;const y=[h[0]+p[0],h[1]+p[1]],S=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(y),duration:S.duration,easing:S.easing})}}}getRect(e,t){const o=e.getBoundingClientRect(),r=o.left+window.pageXOffset,i=o.top+window.pageYOffset;return[r,i,r+t[0],i+t[1]]}setPositioning(e){this.set(W.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const o=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(o,r)}updateRenderedPosition(e,t){const o=this.element.style,r=this.getOffset(),i=this.getPositioning();this.setVisible(!0);const s=Math.round(e[0]+r[0])+"px",a=Math.round(e[1]+r[1])+"px";let l="0%",c="0%";i=="bottom-right"||i=="center-right"||i=="top-right"?l="-100%":(i=="bottom-center"||i=="center-center"||i=="top-center")&&(l="-50%"),i=="bottom-left"||i=="bottom-center"||i=="bottom-right"?c="-100%":(i=="center-left"||i=="center-center"||i=="center-right")&&(c="-50%");const u=`translate(${l}, ${c}) translate(${s}, ${a})`;this.rendered.transform_!=u&&(this.rendered.transform_=u,o.transform=u)}getOptions(){return this.options}}const Bn=Hr,ds=25.4/.28,us=39.37;function Sn(n){return xn(n,hs,ps)}function hs(n){return n.getView()}function ps(n,e){return n.on("change:view",e)}function Wo(n){return Sn(n)?.getProjection()}function gs(n){const e=Sn(n);return xn(e,fs,ms)}function fs(n){return n.getResolution()}function ms(n,e){return n.on("change:resolution",e)}function vs(n){const e=Sn(n);return xn(e,ys,bs)}function ys(n){return n.getCenter()}function bs(n,e){return n.on("change:center",e)}function ws(n){const e=vs(n),t=gs(n),o=Wo(n);return f.useMemo(()=>{if(o==null||t==null||e==null)return;const i=Ur(o,t,e);return Math.round(i*us*ds)},[o,t,e])}function xn(n,e,t){const o=f.useCallback(()=>n?e(n):void 0,[n,e]),r=f.useCallback(i=>{if(!n)return()=>{};const s=t(n,i);return()=>K(s)},[n,t]);return f.useSyncExternalStore(r,o)}const _s=1.2;function Ss(n,e=_s){xs(n);const t=$r(n),o=Wr(n),r=t*e,i=o*e;return[n[0]-(r-t)/2,n[1]-(i-o)/2,n[2]+(r-t)/2,n[3]+(i-o)/2]}function xs(n){if(n.length!==4)throw new Error(`Invalid extent (expected length 4, but got length ${n.length}).`)}const ks={height:"25px",width:"25px",borderColor:"#4cb3ff",borderWidth:"3px",borderRadius:"50%",display:"inline-block "};function Es(n){return d.jsxs(R,{children:[d.jsx(pe,{children:n.layer.title}),d.jsx(R,{style:ks})]})}const V="main";class Cs{mapId=V;vectorSourceFactory;constructor(e){this.vectorSourceFactory=e.references.vectorSourceFactory}async getMapConfig(){const e={Component:Es};return{advanced:{view:new Lo({center:[404747,5757920],zoom:13,constrainResolution:!0,projection:"EPSG:25832"})},layers:[new St({title:"Linfos",visible:!0,url:"https://www.wms.nrw.de/umwelt/linfos",sublayers:[{name:"SonstigeSchutzgebiete",title:"SonstigeSchutzgebiete"},{name:"SCH_GSG",title:"SCH_GSG"}]}),new Bn({isBaseLayer:!0,title:"Topplus grau",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_grau",matrixSet:"EPSG_25832_14",visible:!1,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new Bn({isBaseLayer:!0,title:"Topplus farbig",url:"https://www.wmts.nrw.de/topplus_open/1.0.0/WMTSCapabilities.xml",name:"topplus_col",matrixSet:"EPSG_25832_14",visible:!0,sourceOptions:{attributions:`Kartendarstellung und Präsentationsgraphiken: &copy; Bundesamt für Kartographie und Geodäsie ${new Date().getFullYear()}, <a title="Datenquellen öffnen" aria-label="Datenquellen öffnen" href="https://sg.geodatenzentrum.de/web_public/gdz/datenquellen/Datenquellen_TopPlusOpen.html " target="_blank">Datenquellen</a>`}}),new rt({title:"OSM",visible:!1,isBaseLayer:!0,olLayer:new Ao({source:new Io})}),new rt({title:"Haltestellen Stadt Rostock",visible:!0,description:"Haltestellen des öffentlichen Personenverkehrs in der Hanse- und Universitätsstadt Rostock.",olLayer:Ms(),attributes:{legend:e}}),new rt({id:"ogc_kitas",title:"Kindertagesstätten",visible:!0,olLayer:Ps(),attributes:{legend:e,resultListMetadata:[{id:"id",displayName:"ID",width:100,getPropertyValue(t){return t.id}},{propertyName:"pointOfContact.address.postCode",displayName:"PLZ",width:120},{propertyName:"name",displayName:"Name"},{propertyName:"inspireId",displayName:"inspireID"},{displayName:"Gefördert",width:160,getPropertyValue(t){switch(t.properties?.gefoerdert){case"ja":return!0;case"nein":return!1;default:return t.properties?.gefoerdert}}}]}}),new rt({id:"ogc_kataster",title:"Liegenschaftskatasterbezirke in NRW (viele Daten)",visible:!1,olLayer:Ls(this.vectorSourceFactory),attributes:{resultListMetadata:[{propertyName:"id",displayName:"ID",width:600,getPropertyValue(t){return t.id}},{displayName:"Aktualit",width:600,getPropertyValue(t){const o=t.properties?.aktualit;return typeof o=="string"&&!isNaN(Date.parse(o))?new Date(o):o}}]}}),Ts(this.vectorSourceFactory),js(),Fs(),As(),Is()]}}}function Ms(){const n=new _e({url:"https://geo.sv.rostock.de/download/opendata/haltestellen/haltestellen.json",format:new xt,attributions:"Haltestellen Stadt Rostock, Creative Commons CC Zero License (cc-zero)"});return new J({source:n})}function Ps(){const n=new _e({url:"https://ogc-api.nrw.de/inspire-us-kindergarten/v1/collections/governmentalservice/items?f=json&limit=10000",format:new xt,attributions:'&copy; <a href="http://www.bkg.bund.de" target="_blank">Bundesamt f&uuml;r Kartographie und Geod&auml;sie</a> 2017, <a href="http://sg.geodatenzentrum.de/web_public/Datenquellen_TopPlus_Open.pdf" target="_blank">Datenquellen</a>'});return new J({source:n,style:new Pe({image:new bn({fill:new $e({color:"blue"}),radius:4})})})}function Ls(n){const e=n.createVectorSource({baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"katasterbezirk",limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`});return new J({source:e})}function As(){return new St({title:"Verwaltungsgebiete",visible:!0,url:"https://www.wms.nrw.de/geobasis/wms_nw_dvg",sublayers:[{name:"nw_dvg_bld",title:"NRW"}]})}function Is(){return new St({title:"Bodenkarte zur Landwirtschaftlichen Standorterkundung",visible:!0,url:"https://www.wms.nrw.de/gd/bk05l",sublayers:[{name:"Versickerung_und_Stofftransport",title:"Versickerung und Stofftransport",sublayers:[{name:"Sickerwasserrate",title:"Sickerwasserrate",sublayers:[{name:"Szenario_Wald",title:"Szenario Wald",sublayers:[{name:"Sickerwasserrate_Wald",title:"Sickerwasserrate Wald"},{name:"Direktabfluss_Wald",title:"Direktabfluss Wald"}]},{name:"Szenario_Gruenland",title:"Szenario Grünland",sublayers:[{name:"Sickerwasserrate_Gruenland",title:"Sickerwasserrate Grünland"},{name:"Direktabfluss_Gruenland",title:"Direktabfluss Grünland"}]}]}]},{name:"Wasserhaushalt",title:"Wasserhaushalt",sublayers:[{name:"Kapillaraufstieg_von_Grundwasser",title:"Kapillaraufstieg von Grundwasser",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/gd/bk05l?request=GetLegendGraphic%26version=1.3.0%26format=image/png%26layer=Kapillaraufstieg_von_Grundwasser"}}},{name:"Luftkapazitaet_We",title:"Luftkapazitaet (We)",attributes:{legend:{}}}]}]})}function Ts(n){const e="https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1",t="governmentalservice",o=n.createVectorSource({baseUrl:e,collectionId:t,limit:1e3,crs:"http://www.opengis.net/def/crs/EPSG/0/25832",attributions:`Land NRW (${new Date().getFullYear()}), <a href='https://www.govdata.de/dl-de/by-2-0'>Datenlizenz Deutschland - Namensnennung - Version 2.0</a>, <a href='https://ogc-api-test.nrw.de/inspire-us-krankenhaus/v1'>Datenquelle</a>`}),r=new J({source:o});return new rt({id:"krankenhaus",title:"Krankenhäuser",visible:!0,olLayer:r,attributes:{collectionURL:e+"/collections/"+t}})}function js(){return new St({title:"Schulstandorte",description:"Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.Der vorliegende Datenbestand / Dienst zu den Schulstandorten in NRW stammt aus der Schuldatenbank. Die Informationen werden von den Schulträgern bzw. Schulen selbst eingetragen und aktuell gehalten. Die Daten werden tagesaktuell bereitgestellt und enthalten alle grundlegenden Informationen zu Schulen wie Schulnummer, Schulbezeichnung und Adresse.",visible:!0,url:"https://www.wms.nrw.de/wms/wms_nw_inspire-schulen",sublayers:[{name:"US.education",title:"INSPIRE - WMS Schulstandorte NRW",attributes:{legend:{}}}],sourceOptions:{ratio:1}})}function Fs(){return new St({title:"Straßennetz Landesbetrieb Straßenbau NRW",url:"https://www.wms.nrw.de/wms/strassen_nrw_wms",visible:!0,sublayers:[{name:"1",title:"Verwaltungen",attributes:{legend:{imageUrl:"https://www.wms.nrw.de/legends/wms/strassen_nrw_wms/1.png"}}},{name:"4",title:"Abschnitte und Äste"},{name:"6",title:"Unfälle"}]})}const Rs=Symbol(),kn=Symbol(),et="a",lt="w";let Os=(n,e)=>new Proxy(n,e);const gn=Object.getPrototypeOf,fn=new WeakMap,qo=n=>n&&(fn.has(n)?fn.get(n):gn(n)===Object.prototype||gn(n)===Array.prototype),It=n=>typeof n=="object"&&n!==null,Ns=n=>{if(Array.isArray(n))return Array.from(n);const e=Object.getOwnPropertyDescriptors(n);return Object.values(e).forEach(t=>{t.configurable=!0}),Object.create(gn(n),e)},En=n=>n[kn]||n,Ko=(n,e,t,o)=>{if(!qo(n))return n;let r=o&&o.get(n);if(!r){const l=En(n);r=(c=>Object.values(Object.getOwnPropertyDescriptors(c)).some(u=>!u.configurable&&!u.writable))(l)?[l,Ns(l)]:[l],o?.set(n,r)}const[i,s]=r;let a=t&&t.get(i);return a&&a[1].f===!!s||(a=((l,c)=>{const u={f:c};let p=!1;const g=(y,S)=>{if(!p){let M=u[et].get(l);if(M||(M={},u[et].set(l,M)),y===lt)M[lt]=!0;else{let E=M[y];E||(E=new Set,M[y]=E),E.add(S)}}},h={get:(y,S)=>S===kn?l:(g("k",S),Ko(Reflect.get(y,S),u[et],u.c,u.t)),has:(y,S)=>S===Rs?(p=!0,u[et].delete(l),!0):(g("h",S),Reflect.has(y,S)),getOwnPropertyDescriptor:(y,S)=>(g("o",S),Reflect.getOwnPropertyDescriptor(y,S)),ownKeys:y=>(g(lt),Reflect.ownKeys(y))};return c&&(h.set=h.deleteProperty=()=>!1),[h,u]})(i,!!s),a[1].p=Os(s||i,a[0]),t&&t.set(i,a)),a[1][et]=e,a[1].c=t,a[1].t=o,a[1].p},Yo=(n,e,t,o,r=Object.is)=>{if(r(n,e))return!1;if(!It(n)||!It(e))return!0;const i=t.get(En(n));if(!i)return!0;if(o){const a=o.get(n);if(a&&a.n===e)return a.g;o.set(n,{n:e,g:!1})}let s=null;try{for(const a of i.h||[])if(s=Reflect.has(n,a)!==Reflect.has(e,a),s)return s;if(i[lt]===!0){if(s=((a,l)=>{const c=Reflect.ownKeys(a),u=Reflect.ownKeys(l);return c.length!==u.length||c.some((p,g)=>p!==u[g])})(n,e),s)return s}else for(const a of i.o||[])if(s=!!Reflect.getOwnPropertyDescriptor(n,a)!=!!Reflect.getOwnPropertyDescriptor(e,a),s)return s;for(const a of i.k||[])if(s=Yo(n[a],e[a],t,o,r),s)return s;return s===null&&(s=!0),s}finally{o&&o.set(n,{n:e,g:s})}},Ds=n=>qo(n)&&n[kn]||null,Hn=(n,e=!0)=>{fn.set(n,e)},Vs=(n,e,t)=>{const o=[],r=new WeakSet,i=(s,a)=>{if(r.has(s))return;It(s)&&r.add(s);const l=It(s)&&e.get(En(s));if(l){var c,u;if((c=l.h)==null||c.forEach(g=>{const h=`:has(${String(g)})`;o.push(a?[...a,h]:[h])}),l[lt]===!0){const g=":ownKeys";o.push(a?[...a,g]:[g])}else{var p;(p=l.o)==null||p.forEach(g=>{const h=`:hasOwn(${String(g)})`;o.push(a?[...a,h]:[h])})}(u=l.k)==null||u.forEach(g=>{!("value"in(Object.getOwnPropertyDescriptor(s,g)||{}))||i(s[g],a?[...a,g]:[g])})}else a&&o.push(a)};return i(n),o};var Tt={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Jt=n=>typeof n=="object"&&n!==null,ve=new WeakMap,it=new WeakSet,Gs=(n=Object.is,e=(c,u)=>new Proxy(c,u),t=c=>Jt(c)&&!it.has(c)&&(Array.isArray(c)||!(Symbol.iterator in c))&&!(c instanceof WeakMap)&&!(c instanceof WeakSet)&&!(c instanceof Error)&&!(c instanceof Number)&&!(c instanceof Date)&&!(c instanceof String)&&!(c instanceof RegExp)&&!(c instanceof ArrayBuffer),o=c=>{switch(c.status){case"fulfilled":return c.value;case"rejected":throw c.reason;default:throw c}},r=new WeakMap,i=(c,u,p=o)=>{const g=r.get(c);if(g?.[0]===u)return g[1];const h=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c));return Hn(h,!0),r.set(c,[u,h]),Reflect.ownKeys(c).forEach(y=>{if(Object.getOwnPropertyDescriptor(h,y))return;const S=Reflect.get(c,y),{enumerable:M}=Reflect.getOwnPropertyDescriptor(c,y),E={value:S,enumerable:M,configurable:!0};if(it.has(S))Hn(S,!1);else if(S instanceof Promise)delete E.value,E.get=()=>p(S);else if(ve.has(S)){const[j,F]=ve.get(S);E.value=i(j,F(),p)}Object.defineProperty(h,y,E)}),Object.preventExtensions(h)},s=new WeakMap,a=[1,1],l=c=>{if(!Jt(c))throw new Error("object required");const u=s.get(c);if(u)return u;let p=a[0];const g=new Set,h=(b,w=++a[0])=>{p!==w&&(p=w,g.forEach(v=>v(b,w)))};let y=a[1];const S=(b=++a[1])=>(y!==b&&!g.size&&(y=b,E.forEach(([w])=>{const v=w[1](b);v>p&&(p=v)})),p),M=b=>(w,v)=>{const _=[...w];_[1]=[b,..._[1]],h(_,v)},E=new Map,j=(b,w)=>{if((Tt?"production":void 0)!=="production"&&E.has(b))throw new Error("prop listener already exists");if(g.size){const v=w[3](M(b));E.set(b,[w,v])}else E.set(b,[w])},F=b=>{var w;const v=E.get(b);v&&(E.delete(b),(w=v[1])==null||w.call(v))},$=b=>(g.add(b),g.size===1&&E.forEach(([v,_],x)=>{if((Tt?"production":void 0)!=="production"&&_)throw new Error("remove already exists");const k=v[3](M(x));E.set(x,[v,k])}),()=>{g.delete(b),g.size===0&&E.forEach(([v,_],x)=>{_&&(_(),E.set(x,[v]))})}),B=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c)),z=e(B,{deleteProperty(b,w){const v=Reflect.get(b,w);F(w);const _=Reflect.deleteProperty(b,w);return _&&h(["delete",[w],v]),_},set(b,w,v,_){const x=Reflect.has(b,w),k=Reflect.get(b,w,_);if(x&&(n(k,v)||s.has(v)&&n(k,s.get(v))))return!0;F(w),Jt(v)&&(v=Ds(v)||v);let P=v;if(v instanceof Promise)v.then(T=>{v.status="fulfilled",v.value=T,h(["resolve",[w],T])}).catch(T=>{v.status="rejected",v.reason=T,h(["reject",[w],T])});else{!ve.has(v)&&t(v)&&(P=l(v));const T=!it.has(P)&&ve.get(P);T&&j(w,T)}return Reflect.set(b,w,P,_),h(["set",[w],v,k]),!0}});s.set(c,z);const m=[B,S,i,$];return ve.set(z,m),Reflect.ownKeys(c).forEach(b=>{const w=Object.getOwnPropertyDescriptor(c,b);"value"in w&&(z[b]=c[b],delete w.value,delete w.writable),Object.defineProperty(B,b,w)}),z})=>[l,ve,it,n,e,t,o,r,i,s,a],[zs]=Gs();function Zo(n={}){return zs(n)}function Bs(n,e,t){const o=ve.get(n);(Tt?"production":void 0)!=="production"&&!o&&console.warn("Please use proxy object");let r;const i=[],s=o[3];let a=!1;const c=s(u=>{i.push(u),r||(r=Promise.resolve().then(()=>{r=void 0,a&&e(i.splice(0))}))});return a=!0,()=>{a=!1,c()}}function Un(n,e){const t=ve.get(n);(Tt?"production":void 0)!=="production"&&!t&&console.warn("Please use proxy object");const[o,r,i]=t;return i(o,r(),e)}function je(n){return it.add(n),n}var Jo={exports:{}},Xo={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ke=f;function Hs(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Us=typeof Object.is=="function"?Object.is:Hs,$s=Ke.useState,Ws=Ke.useEffect,qs=Ke.useLayoutEffect,Ks=Ke.useDebugValue;function Ys(n,e){var t=e(),o=$s({inst:{value:t,getSnapshot:e}}),r=o[0].inst,i=o[1];return qs(function(){r.value=t,r.getSnapshot=e,Xt(r)&&i({inst:r})},[n,t,e]),Ws(function(){return Xt(r)&&i({inst:r}),n(function(){Xt(r)&&i({inst:r})})},[n]),Ks(t),t}function Xt(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Us(n,t)}catch{return!0}}function Zs(n,e){return e()}var Js=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Zs:Ys;Xo.useSyncExternalStore=Ke.useSyncExternalStore!==void 0?Ke.useSyncExternalStore:Js;Jo.exports=Xo;var Xs=Jo.exports;const Qs=Cr(Xs);var ea={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{use:$n}=wo,{useSyncExternalStore:ta}=Qs,na=(n,e)=>{const t=f.useRef();f.useEffect(()=>{t.current=Vs(n,e)}),f.useDebugValue(t.current)},oa=new WeakMap;function Ye(n,e){const o=f.useRef(),r=f.useRef();let i=!0;const s=ta(f.useCallback(c=>{const u=Bs(n,c);return c(),u},[n,void 0]),()=>{const c=Un(n,$n);try{if(!i&&o.current&&r.current&&!Yo(o.current,c,r.current,new WeakMap))return o.current}catch{}return c},()=>Un(n,$n));i=!1;const a=new WeakMap;f.useEffect(()=>{o.current=s,r.current=a}),(ea?"production":void 0)!=="production"&&na(s,a);const l=f.useMemo(()=>new WeakMap,[]);return Ko(s,a,l,oa)}function ra(n){const e=Zo({data:Array.from([]),has(t){return this.data.some(o=>o[0]===t)},set(t,o){const r=this.data.find(i=>i[0]===t);return r?r[1]=o:this.data.push([t,o]),this},get(t){var o;return(o=this.data.find(r=>r[0]===t))==null?void 0:o[1]},delete(t){const o=this.data.findIndex(r=>r[0]===t);return o===-1?!1:(this.data.splice(o,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(t){this.data.forEach(o=>{t(o[1],o[0],this)})},keys(){return this.data.map(t=>t[0]).values()},values(){return this.data.map(t=>t[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}class ia{label;filteredTypes;httpService;constructor(e,t,o){this.label=e,this.filteredTypes=t,this.httpService=o}async search(e,{mapProjection:t,signal:o}){const r=await this.request(e,100,o),i=new xt({dataProjection:"EPSG:4326",featureProjection:t});return r.features.filter(s=>this.filteredTypes.includes(s.properties.type)).map((s,a)=>{const l=i.readGeometry(s.geometry);return{id:s.properties.osm_id||a,label:this.createLabel(s),geometry:l,properties:s.properties}})}async request(e,t,o){const r=new URL("https://photon.komoot.io/api?");r.searchParams.set("q",e),r.searchParams.set("lang","de"),r.searchParams.set("lat","51.961563"),r.searchParams.set("lon","7.628202"),r.searchParams.set("limit",t.toString());const i=await this.httpService.fetch(r,{signal:o});if(!i.ok)throw new Error("Request failed: "+i.status);return await i.json()}createLabel(e){return`${e.properties.name} (${e.properties.osm_value?e.properties.osm_value+", ":""}${e.properties.postcode?e.properties.postcode+", ":""}${e.properties.city?e.properties.city+", ":""}${e.properties.country?e.properties.country+")":")"}`}}const sa=ge("ol-app:AppModel");class aa{_intl;_mapRegistry;_ogcSearchSourceFactory;_vectorSelectionSourceFactory;_httpService;_state;_resources=[];_featureHighlight=void 0;constructor({references:e,intl:t}){this._mapRegistry=e.mapRegistry,this._intl=t,this._ogcSearchSourceFactory=e.ogcSearchSourceFactory,this._vectorSelectionSourceFactory=e.vectorSelectionSourceFactory,this._httpService=e.httpService,this._state=Zo({searchSources:[],selectionSources:[],sourceMetadata:ra(),resultListState:{input:void 0,open:!1,key:0}}),this.initSearchSources(),this.initSelectionSources().catch(o=>{sa.error("Failed to initialize selection sources",o)})}destroy(){this._resources.forEach(e=>e.destroy())}get state(){return this._state}setResultListInput(e){const t=this._state.resultListState.key;this._state.resultListState={open:!0,key:t+1,input:je(e)}}setResultListVisibility(e){this._state.resultListState.open=e}highlightAndZoom(e,t){const o=e.olMap.getViewport();this.clearPreviousHighlight(),this._featureHighlight=e.highlightAndZoom(t,{viewPadding:o&&o.offsetWidth<1e3?{top:150,right:75,bottom:50,left:75}:{top:150,right:400,bottom:50,left:400}})}zoom(e,t){const o=e.olMap.getViewport();e.zoom(t,{viewPadding:o&&o.offsetWidth<1e3?{top:150,right:75,bottom:50,left:75}:{top:150,right:400,bottom:50,left:400}})}clearPreviousHighlight(){this._featureHighlight&&(this._featureHighlight.destroy(),this._featureHighlight=void 0)}initSearchSources(){const e=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.lika"}),baseUrl:"https://ogc-api.nrw.de/lika/v1",collectionId:"flurstueck",searchProperty:"flurstid",labelProperty:"objid"}),t=this._ogcSearchSourceFactory.createSearchSource({label:this._intl.formatMessage({id:"searchSources.miningPermissions"}),baseUrl:"https://ogc-api.nrw.de/inspire-am-bergbauberechtigungen/v1",collectionId:"managementrestrictionorregulationzone",searchProperty:"thematicId",labelProperty:"name",renderLabel(r){const i=r?.properties?.name,s=r?.id;return typeof i=="string"?i+" ("+s+")":String(s)},rewriteUrl(r){return r.searchParams.set("properties","name"),r}}),o=new ia("Photon Geocoder",["city","street"],this._httpService);this._state.searchSources=[je(e),je(t),je(o)]}async initSelectionSources(){const e=["ogc_kitas","ogc_kataster"],o=(await this._mapRegistry.expectMapModel(V)).layers.getOperationalLayers({sortByDisplayOrder:!0});for(const r of o){if(!e.includes(r.id)||!la(r.olLayer))continue;const i=this._vectorSelectionSourceFactory.createSelectionSource({vectorLayer:r.olLayer,label:r.title}),s=i.on("changed:status",()=>{i.status!=="available"&&(i.status==="unavailable"||i.status?.kind==="unavailable")&&this.clearPreviousHighlight()});this._resources.push(s,i),this._state.selectionSources.unshift(je(i)),this._state.sourceMetadata.set(je(i),r.attributes.resultListMetadata)}}}function la(n){return n instanceof J&&n.getSource()instanceof _e}const Wn=0,ct=1,qn=[0,0,0,0],De=[],Qt={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class en extends yn{constructor(e,t,o){super(e),this.features=t,this.mapBrowserEvent=o}}class ca extends qr{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Kr,this.defaultDeleteCondition_=function(o){return Yr(o)&&To(o)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Zr,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Jr,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new J({source:new _e({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:ua(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new We(this.source_.getFeatures()),this.source_.addEventListener(Tn.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Tn.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ne.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ne.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}const o=this.getMap();o&&o.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,o),e.addEventListener(an.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new We;const o=this.featuresBeingModified_.getArray();for(let r=0,i=t.length;r<i;++r){const s=t[r];for(let a=0,l=s.length;a<l;++a){const c=s[a].feature;c&&!o.includes(c)&&this.featuresBeingModified_.push(c)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new en(Qt.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(an.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,o=[];t.forEach(function(r){e===r.feature&&o.push(r)});for(let r=o.length-1;r>=0;--r){const i=o[r];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===i&&this.dragSegments_.splice(s,1);t.remove(i)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const o=t.getCoordinates(),r={feature:e,geometry:t,segment:[o,o]};this.rBush_.insert(t.getExtent(),r)}writeMultiPointGeometry_(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const s=o[r],a={feature:e,geometry:t,depth:[r],index:r,segment:[s,s]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const o=t.getCoordinates();for(let r=0,i=o.length-1;r<i;++r){const s=o.slice(r,r+2),a={feature:e,geometry:t,index:r,segment:s};this.rBush_.insert(ce(s),a)}}writeMultiLineStringGeometry_(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const s=o[r];for(let a=0,l=s.length-1;a<l;++a){const c=s.slice(a,a+2),u={feature:e,geometry:t,depth:[r],index:a,segment:c};this.rBush_.insert(ce(c),u)}}}writePolygonGeometry_(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const s=o[r];for(let a=0,l=s.length-1;a<l;++a){const c=s.slice(a,a+2),u={feature:e,geometry:t,depth:[r],index:a,segment:c};this.rBush_.insert(ce(c),u)}}}writeMultiPolygonGeometry_(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const s=o[r];for(let a=0,l=s.length;a<l;++a){const c=s[a];for(let u=0,p=c.length-1;u<p;++u){const g=c.slice(u,u+2),h={feature:e,geometry:t,depth:[a,r],index:u,segment:g};this.rBush_.insert(ce(g),h)}}}}writeCircleGeometry_(e,t){const o=t.getCenter(),r={feature:e,geometry:t,index:Wn,segment:[o,o]},i={feature:e,geometry:t,index:ct,segment:[o,o]},s=[r,i];r.featureSegments=s,i.featureSegments=s,this.rBush_.insert(Yt(o),r);let a=t;this.rBush_.insert(a.getExtent(),i)}writeGeometryCollectionGeometry_(e,t){const o=t.getGeometriesArray();for(let r=0;r<o.length;++r){const i=o[r],s=this.SEGMENT_WRITERS_[i.getType()];s(e,i)}}createOrUpdateVertexFeature_(e,t,o){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new Le(new ut(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",o),r}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==kt.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=kt.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==kt.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],o=[],r=[];for(let i=0,s=this.dragSegments_.length;i<s;++i){const a=this.dragSegments_[i],l=a[0],c=l.feature;o.includes(c)||o.push(c);const u=l.geometry;r.includes(u)||r.push(u);const p=l.depth;let g;const h=l.segment,y=a[1];for(;t.length<u.getStride();)t.push(h[y][t.length]);switch(u.getType()){case"Point":g=t,h[0]=t,h[1]=t;break;case"MultiPoint":g=u.getCoordinates(),g[l.index]=t,h[0]=t,h[1]=t;break;case"LineString":g=u.getCoordinates(),g[l.index+y]=t,h[y]=t;break;case"MultiLineString":g=u.getCoordinates(),g[p[0]][l.index+y]=t,h[y]=t;break;case"Polygon":g=u.getCoordinates(),g[p[0]][l.index+y]=t,h[y]=t;break;case"MultiPolygon":g=u.getCoordinates(),g[p[1]][p[0]][l.index+y]=t,h[y]=t;break;case"Circle":if(h[0]=t,h[1]=t,l.index===Wn)this.changingFeature_=!0,u.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let S=jn(ae(u.getCenter()),ae(t));u.setRadius(S),this.changingFeature_=!1}break}g&&this.setGeometryCoordinates_(u,g)}this.createOrUpdateVertexFeature_(t,o,r)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const o=this.vertexFeature_;if(o){e.map.getView().getProjection();const r=[],i=o.getGeometry().getCoordinates(),s=ce([i]),a=this.rBush_.getInExtent(s),l={};a.sort(da);for(let c=0,u=a.length;c<u;++c){const p=a[c],g=p.segment;let h=Z(p.geometry);const y=p.depth;if(y&&(h+="-"+y.join("-")),l[h]||(l[h]=new Array(2)),p.geometry.getType()==="Circle"&&p.index===ct){const S=Yn(t,p);xe(S,i)&&!l[h][0]&&(this.dragSegments_.push([p,0]),l[h][0]=p);continue}if(xe(g[0],i)&&!l[h][0]){this.dragSegments_.push([p,0]),l[h][0]=p;continue}if(xe(g[1],i)&&!l[h][1]){if(l[h][0]&&l[h][0].index===0){let S=p.geometry.getCoordinates();switch(p.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":S=S[y[1]];case"Polygon":if(p.index!==S[y[0]].length-2)continue;break}}this.dragSegments_.push([p,1]),l[h][1]=p;continue}Z(g)in this.vertexSegments_&&!l[h][0]&&!l[h][1]&&this.insertVertexCondition_(e)&&r.push(p)}r.length&&this.willModifyFeatures_(e,[r]);for(let c=r.length-1;c>=0;--c)this.insertVertex_(r[c],i)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const o=this.dragSegments_[t][0],r=o.geometry;if(r.getType()==="Circle"){const i=r.getCenter(),s=o.featureSegments[0],a=o.featureSegments[1];s.segment[0]=i,s.segment[1]=i,a.segment[0]=i,a.segment[1]=i,this.rBush_.update(Yt(i),s);let l=r;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(ce(o.segment),o)}return this.featuresBeingModified_&&(this.dispatchEvent(new en(Qt.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,o){const r=o||t.getCoordinateFromPixel(e);t.getView().getProjection();const i=function(l,c){return Kn(r,l)-Kn(r,c)};let s,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(c,u,p)=>{p&&p.getType()==="Point"&&(p=new ut(ln(p.getCoordinates())));const g=p||c.getGeometry();if(c instanceof Le&&this.features_.getArray().includes(c)){a=g;const h=c.getGeometry().getFlatCoordinates().slice(0,2);s=[{feature:c,geometry:a,segment:[h,h]}]}return!0},{layerFilter:l})}if(!s){const l=Xr(Yt(r,qn)),c=t.getView().getResolution()*this.pixelTolerance_,u=Qr(ei(l,c,qn));s=this.rBush_.getInExtent(u)}if(s&&s.length>0){const l=s.sort(i)[0],c=l.segment;let u=Yn(r,l);const p=t.getPixelFromCoordinate(u);let g=jn(e,p);if(a||g<=this.pixelTolerance_){const h={};if(h[Z(c)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-r[0],this.delta_[1]=u[1]-r[1]),l.geometry.getType()==="Circle"&&l.index===ct)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);else{const y=t.getPixelFromCoordinate(c[0]),S=t.getPixelFromCoordinate(c[1]),M=cn(p,y),E=cn(p,S);g=Math.sqrt(Math.min(M,E)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(u=M>E?c[1]:c[0]),this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry]);const j={};j[Z(l.geometry)]=!0;for(let F=1,$=s.length;F<$;++F){const B=s[F].segment;if(xe(c[0],B[0])&&xe(c[1],B[1])||xe(c[0],B[1])&&xe(c[1],B[0])){const L=Z(s[F].geometry);L in j||(j[L]=!0,h[Z(B)]=!0)}else break}}this.vertexSegments_=h;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const o=e.segment,r=e.feature,i=e.geometry,s=e.depth,a=e.index;let l;for(;t.length<i.getStride();)t.push(0);switch(i.getType()){case"MultiLineString":l=i.getCoordinates(),l[s[0]].splice(a+1,0,t);break;case"Polygon":l=i.getCoordinates(),l[s[0]].splice(a+1,0,t);break;case"MultiPolygon":l=i.getCoordinates(),l[s[1]][s[0]].splice(a+1,0,t);break;case"LineString":l=i.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(i,l);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(i,a,s,1);const u={segment:[o[0],t],feature:r,geometry:i,depth:s,index:a};c.insert(ce(u.segment),u),this.dragSegments_.push([u,1]);const p={segment:[t,o[1]],feature:r,geometry:i,depth:s,index:a+1};c.insert(ce(p.segment),p),this.dragSegments_.push([p,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=kt.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new en(Qt.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let o=!1,r,i,s,a,l,c,u,p,g,h,y;for(l=e.length-1;l>=0;--l)s=e[l],h=s[0],y=Z(h.feature),h.depth&&(y+="-"+h.depth.join("-")),y in t||(t[y]={}),s[1]===0?(t[y].right=h,t[y].index=h.index):s[1]==1&&(t[y].left=h,t[y].index=h.index+1);for(y in t){switch(g=t[y].right,u=t[y].left,c=t[y].index,p=c-1,u!==void 0?h=u:h=g,p<0&&(p=0),a=h.geometry,i=a.getCoordinates(),r=i,o=!1,a.getType()){case"MultiLineString":i[h.depth[0]].length>2&&(i[h.depth[0]].splice(c,1),o=!0);break;case"LineString":i.length>2&&(i.splice(c,1),o=!0);break;case"MultiPolygon":r=r[h.depth[1]];case"Polygon":r=r[h.depth[0]],r.length>4&&(c==r.length-1&&(c=0),r.splice(c,1),o=!0,c===0&&(r.pop(),r.push(r[0]),p=r.length-1));break}if(o){this.setGeometryCoordinates_(a,i);const S=[];if(u!==void 0&&(this.rBush_.remove(u),S.push(u.segment[0])),g!==void 0&&(this.rBush_.remove(g),S.push(g.segment[1])),u!==void 0&&g!==void 0){const M={depth:h.depth,feature:h.feature,geometry:h.geometry,index:p,segment:S};this.rBush_.insert(ce(M.segment),M)}this.updateSegmentIndices_(a,c,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return o}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,o,r){this.rBush_.forEachInExtent(e.getExtent(),function(i){i.geometry===e&&(o===void 0||i.depth===void 0||ti(i.depth,o))&&i.index>t&&(i.index+=r)})}}function da(n,e){return n.index-e.index}function Kn(n,e,t){const o=e.geometry;if(o.getType()==="Circle"){let i=o;if(e.index===ct){const s=cn(i.getCenter(),ae(n)),a=Math.sqrt(s)-i.getRadius();return a*a}}const r=ae(n);return De[0]=ae(e.segment[0]),De[1]=ae(e.segment[1]),oi(r,De)}function Yn(n,e,t){const o=e.geometry;if(o.getType()==="Circle"&&e.index===ct)return ln(o.getClosestPoint(ae(n)));const r=ae(n);return De[0]=ae(e.segment[0]),De[1]=ae(e.segment[1]),ln(ni(r,De))}function ua(){const n=jo();return function(e,t){return n.Point}}const ha={SELECT:"select"};class pa extends yn{constructor(e,t,o,r){super(e),this.selected=t,this.deselected=o,this.mapBrowserEvent=r}}const Et={};class Cn extends ri{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:To,this.addCondition_=e.addCondition?e.addCondition:Fn,this.removeCondition_=e.removeCondition?e.removeCondition:Fn,this.toggleCondition_=e.toggleCondition?e.toggleCondition:ii,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:Rn,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:ga(),this.features_=e.features||new We;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const o=e.layers;t=function(r){return o.includes(r)}}else t=Rn;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[Z(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[Z(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(Ne.ADD,this.boundAddFeature_),this.features_.addEventListener(Ne.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Ne.ADD,this.boundAddFeature_),this.features_.removeEventListener(Ne.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const o=this.getMap().getAllLayers().find(function(r){if(r instanceof J&&r.getSource()&&r.getSource().hasFeature(t))return r});o&&this.addFeatureLayerAssociation_(t,o)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=Z(e);t in Et||(Et[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let r=t.length-1;r>=0;--r){const i=t[r];if(i!==this&&i instanceof Cn&&i.getStyle()&&i.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(i.getStyle());return}}const o=Z(e);e.setStyle(Et[o]),delete Et[o]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[Z(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),o=this.removeCondition_(e),r=this.toggleCondition_(e),i=!t&&!o&&!r,s=e.map,a=this.getFeatures(),l=[],c=[];if(i){si(this.featureLayerAssociation_),s.forEachFeatureAtPixel(e.pixel,(u,p)=>{if(!(!(u instanceof Le)||!this.filter_(u,p)))return this.addFeatureLayerAssociation_(u,p),c.push(u),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=a.getLength()-1;u>=0;--u){const p=a.item(u),g=c.indexOf(p);g>-1?c.splice(g,1):(a.remove(p),l.push(p))}c.length!==0&&a.extend(c)}else{s.forEachFeatureAtPixel(e.pixel,(u,p)=>{if(!(!(u instanceof Le)||!this.filter_(u,p)))return(t||r)&&!a.getArray().includes(u)?(this.addFeatureLayerAssociation_(u,p),c.push(u)):(o||r)&&a.getArray().includes(u)&&(l.push(u),this.removeFeatureLayerAssociation_(u)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=l.length-1;u>=0;--u)a.remove(l[u]);a.extend(c)}return(c.length>0||l.length>0)&&this.dispatchEvent(new pa(ha.SELECT,c,l,e)),!0}}function ga(){const n=jo();return On(n.Polygon,n.LineString),On(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}const tn=.75,Ct=.1;let fa=class extends ai{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",o=e.tipLabel!==void 0?e.tipLabel:"Overview map",r=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r):this.collapseLabel_=r;const i=e.label!==void 0?e.label:"›";typeof i=="string"?(this.label_=document.createElement("span"),this.label_.textContent=i):this.label_=i;const s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=o,a.appendChild(s),a.addEventListener(an.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new li({view:e.view,controls:new We,interactions:new We});this.ovmap_=l,e.layers&&e.layers.forEach(function(j){l.addLayer(j)});const c=document.createElement("div");c.className="ol-overviewmap-box",c.style.boxSizing="border-box",this.boxOverlay_=new qe({position:[0,0],positioning:"center-center",element:c}),this.ovmap_.addOverlay(this.boxOverlay_);const u=t+" "+ci+" "+di+(this.collapsed_&&this.collapsible_?" "+Nn:"")+(this.collapsible_?"":" ol-uncollapsible"),p=this.element;p.className=u,p.appendChild(this.ovmapDiv_),p.appendChild(a);const g=this,h=this.boxOverlay_,y=this.boxOverlay_.getElement(),S=function(j){return{clientX:j.clientX,clientY:j.clientY}},M=function(j){const F=S(j),$=l.getEventCoordinateInternal(F);h.setPosition($)},E=function(j){const F=l.getEventCoordinateInternal(j);g.getMap().getView().setCenterInternal(F),window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",E)};y.addEventListener("mousedown",function(){window.addEventListener("mousemove",M),window.addEventListener("mouseup",E)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const o=t.getView();o&&this.unbindView_(o),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(Co(e,ui.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const o=e.getView();o&&(this.bindView_(o),o.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===Zt.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const o=this.getMap().getView();this.bindView_(o)}else!this.ovmap_.isRendered()&&(e.key===Zt.TARGET||e.key===Zt.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new Lo({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(Dn.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(Dn.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const o=e.getSize(),i=e.getView().calculateExtentInternal(o);if(this.viewExtent_&&hi(i,this.viewExtent_))return;this.viewExtent_=i;const s=t.getSize(),l=t.getView().calculateExtentInternal(s),c=t.getPixelFromCoordinateInternal(pi(i)),u=t.getPixelFromCoordinateInternal(gi(i)),p=Math.abs(c[0]-u[0]),g=Math.abs(c[1]-u[1]),h=s[0],y=s[1];p<h*Ct||g<y*Ct||p>h*tn||g>y*tn?this.resetExtent_():Po(l,i)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,o=e.getSize(),i=e.getView().calculateExtentInternal(o),s=t.getView(),a=Math.log(tn/Ct)/Math.LN2,l=1/(Math.pow(2,a/2)*Ct);fi(i,l),s.fitInternal(mi(i))}recenter_(){const e=this.getMap(),t=this.ovmap_,o=e.getView();t.getView().setCenterInternal(o.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const o=e.getSize(),r=e.getView(),i=t.getView(),s=this.rotateWithView_?0:-r.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),c=r.getCenterInternal(),u=r.getResolution(),p=i.getResolution(),g=o[0]*u/p,h=o[1]*u/p;if(a.setPosition(c),l){l.style.width=g+"px",l.style.height=h+"px";const y="rotate("+s+"rad)";l.style.transform=y}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=vi(this.ovmap_,Mo.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Nn),this.collapsed_?Vn(this.collapseLabel_,this.label_):Vn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}};async function ma(n,e,t,o){const i=o.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),s=await n.fetch(e,{method:"POST",body:JSON.stringify({type:"Feature",properties:{},geometry:t}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${i}>`}});if(!s||!s.ok||s.status!==201)throw new Error("Request failed: "+s.status);const a=s.headers.get("location");if(!a)throw new Error("Request failed: no Location response header");const l=a.substring(a.lastIndexOf("/")+1);return Promise.resolve(l)}async function va(n,e,t,o,r){const s=r.getCode().replace("EPSG:","http://www.opengis.net/def/crs/EPSG/0/"),a=new URL(`${e.toString()}/${t}`),l=await n.fetch(a,{method:"PATCH",body:JSON.stringify({type:"Feature",properties:{},geometry:o}),headers:{"Content-Type":"application/geo+json; charset=utf-8","Content-Crs":`<${s}>`}});if(!l||!l.ok||l.status!==204)throw new Error("Request failed: "+l.status);return Promise.resolve(t)}function Qo(n,e){const t=document.createElement("div");t.className="editing-tooltip editing-tooltip-hidden",t.textContent=e;const o=new qe({element:t,offset:[15,0],positioning:"center-left"}),r=n.on("pointermove",i=>{i.dragging||o.setPosition(i.coordinate)});return n.addOverlay(o),{destroy(){K(r),n.removeOverlay(o)},setVisible(i){t.classList.toggle("editing-tooltip-hidden",!i)},setText(i){t.textContent=i}}}function er(n){let e=Zn(n.polygon);Array.isArray(e)&&(e=e[0]);let t=Zn(n.vertex);Array.isArray(t)&&(t=t[0]);const o=[];return e&&o.push(e),t&&(t.setGeometry(ya),o.push(t)),o}const ya=n=>{if(n){const e=n.getGeometry();if(e&&e.getType()==="Polygon"){const t=e.getCoordinates()[0];if(t)return new Zi(t)}}},Zn=n=>{const e=new Le,o=new J({style:n}).getStyleFunction();if(!o)throw new Error("can't retrieve style function");const r=o(e,1);if(!r)throw new Error("can't retrieve styles from feature style function");return Array.isArray(r)&&r.length?r.length>1?r:r[0]:r},ba=ge("editing:EditingCreateWorkflowImpl");var de;class wa extends Bt{constructor(t){super();O(this,de,void 0);A(this,"_httpService");A(this,"_intl");A(this,"_map");A(this,"_polygonStyle");A(this,"_vertexStyle");A(this,"_state");A(this,"_editLayerURL");A(this,"_featureId");A(this,"_editingSource");A(this,"_editingLayer");A(this,"_drawInteraction");A(this,"_olMap");A(this,"_mapContainer");A(this,"_tooltip");A(this,"_enterHandler");A(this,"_escapeHandler");A(this,"_error");A(this,"_interactionListener");A(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._editingSource=new _e,this._editingLayer=new J({source:this._editingSource,zIndex:Ht,properties:{name:"editing-layer"}}),this._drawInteraction=new Vo({source:this._editingSource,type:"Polygon",style:er({polygon:this._polygonStyle,vertex:this._vertexStyle})}),this._tooltip=Qo(this._olMap,this._intl.formatMessage({id:"create.tooltip.begin"})),this._enterHandler=o=>{if((o.code==="Enter"||o.code==="NumpadEnter")&&o.target===this._olMap.getTargetElement()){const r=this._drawInteraction.getOverlay().getSource().getFeatures();r[0]&&r[0].getGeometry().getCoordinates()[0].length>4&&this.triggerSave()}},this._escapeHandler=o=>{o.code==="Escape"&&o.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getDrawInteraction(){return this._drawInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const o=this._editLayerURL,r=t.getGeometry();if(!r){this._destroy(),this._error=new Error("no geometry available"),C(this,de)?.reject(this._error);return}const i=this._olMap.getView().getProjection(),a=new xt({dataProjection:i}).writeGeometryObject(r,{rightHanded:!0,decimals:10});ma(this._httpService,o,a,i).then(l=>{this._featureId=l,this._destroy(),C(this,de)?.resolve({featureId:this._featureId})}).catch(l=>{ba.error(l),this._destroy(),this._error=new Error("Failed to save feature",{cause:l}),C(this,de)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._drawInteraction),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const t=this._drawInteraction.on("drawstart",()=>{this._setState("active:drawing"),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.continue"}))}),o=this._drawInteraction.on("drawend",i=>{const s=i.feature;if(!s){this._destroy(),this._error=new Error("no feature available"),C(this,de)?.reject(this._error);return}this._save(s)}),r=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(t,o),this._mapListener.push(r)}reset(){this._drawInteraction.abortDrawing(),this._tooltip.setText(this._intl.formatMessage({id:"create.tooltip.begin"})),this._setState("active:initialized")}stop(){this._destroy(),C(this,de)?.resolve(void 0)}_destroy(){this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._drawInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{K(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){this._drawInteraction.finishDrawing()}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(C(this,de)??N(this,de,_o())).promise}}de=new WeakMap;var te;class _a extends Bt{constructor(t){super();O(this,te,void 0);A(this,"_httpService");A(this,"_intl");A(this,"_map");A(this,"_polygonStyle");A(this,"_vertexStyle");A(this,"_state");A(this,"_editLayerURL");A(this,"_featureId");A(this,"_initialFeature");A(this,"_editFeature");A(this,"_editingSource");A(this,"_editingLayer");A(this,"_modifyInteraction");A(this,"_olMap");A(this,"_mapContainer");A(this,"_tooltip");A(this,"_enterHandler");A(this,"_escapeHandler");A(this,"_error");A(this,"_interactionListener");A(this,"_mapListener");this._httpService=t.httpService,this._intl=t.intl,this._polygonStyle=t.polygonStyle,this._vertexStyle=t.vertexStyle,this._map=t.map,this._olMap=t.map.olMap,this._state="active:initialized",this._editLayerURL=t.ogcApiFeatureLayerUrl,this._initialFeature=t.feature.clone(),this._initialFeature.setId(t.feature.getId()),this._editFeature=t.feature.clone(),this._editFeature.setId(t.feature.getId()),this._editFeature.setStyle(er({polygon:this._polygonStyle,vertex:this._vertexStyle})),this._editingSource=new _e({features:new We([this._editFeature])}),this._editingLayer=new J({source:this._editingSource,zIndex:Ht,properties:{name:"editing-layer"}}),this._modifyInteraction=new ca({source:this._editingSource}),this._tooltip=Qo(this._olMap,this._intl.formatMessage({id:"create.tooltip.deselect"})),this._enterHandler=o=>{if((o.code==="Enter"||o.code==="NumpadEnter")&&o.target===this._olMap.getTargetElement()){const r=this._editingSource.getFeatures()[0];if(!r)throw Error("no updated feature found");this._save(r)}},this._escapeHandler=o=>{o.code==="Escape"&&o.target===this._olMap.getTargetElement()&&this.reset()},this._interactionListener=[],this._mapListener=[],this._start()}getModifyInteraction(){return this._modifyInteraction}getState(){return this._state}_setState(t){this._state=t,this.emit(t)}_save(t){this._setState("active:saving");const o=this._editLayerURL;if(this._featureId=t.getId()?.toString(),!this._featureId){this._destroy(),this._error=new Error("no feature id available"),C(this,te)?.reject(this._error);return}const r=t?.getGeometry();if(!r){this._destroy(),this._error=new Error("no geometry available"),C(this,te)?.reject(this._error);return}const i=this._olMap.getView().getProjection(),a=new xt({dataProjection:i}).writeGeometryObject(r,{rightHanded:!0,decimals:10});va(this._httpService,o,this._featureId,a,i).then(l=>{this._destroy(),C(this,te)?.resolve({featureId:l})}).catch(l=>{this._destroy(),this._error=new Error("Failed to save feature",{cause:l}),C(this,te)?.reject(this._error)})}_start(){this._olMap.addLayer(this._editingLayer),this._olMap.addInteraction(this._modifyInteraction);const t=this._editingSource.getFeatures()[0];if(t&&!t.getId()?.toString()){this._destroy(),this._error=new Error("no feature id available"),C(this,te)?.reject(this._error);return}this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1)),this._tooltip.setVisible(!0);const o=this._map.olMap.on("click",s=>{const a=s.coordinate,l=s.originalEvent.altKey,c=this._editingSource.getFeaturesAtCoordinate(a);l||c.length===0&&this.triggerSave()}),r=this._modifyInteraction.on("modifystart",()=>{this._setState("active:drawing")}),i=this._map.on("changed:container",()=>{this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._mapContainer=this._olMap.getTargetElement()??void 0,this._mapContainer&&(this._mapContainer.addEventListener("keydown",this._enterHandler,!1),this._mapContainer.addEventListener("keydown",this._escapeHandler,!1))});this._interactionListener.push(o,r),this._mapListener.push(i)}reset(){const t=this._initialFeature.getGeometry()?.clone(),o=this._editingSource.getFeatures()[0];if(!o)throw Error("no updated feature found");o.setGeometry(t),this._setState("active:initialized")}stop(){this._destroy(),C(this,te)?.resolve(void 0)}_destroy(){this._editingSource.clear(),this._olMap.removeLayer(this._editingLayer),this._olMap.removeInteraction(this._modifyInteraction),this._tooltip.destroy(),this._interactionListener.map(t=>{K(t)}),this._mapListener.map(t=>{t.destroy()}),this._mapContainer?.removeEventListener("keydown",this._enterHandler),this._mapContainer?.removeEventListener("keydown",this._escapeHandler),this._setState("destroyed")}triggerSave(){const t=this._editingSource.getFeatures()[0];if(!t)throw Error("no updated feature found");this._save(t)}whenComplete(){return this._state==="destroyed"?this._error?Promise.reject(this._error):this._featureId?Promise.resolve({featureId:this._featureId}):Promise.resolve(void 0):(C(this,te)??N(this,te,_o())).promise}}te=new WeakMap;class Sa{_serviceOptions;_workflows;constructor(e){this._serviceOptions=e,this._workflows=new Map}createFeature(e,t){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const o=e.id;let r=this._workflows.get(o);if(r)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return r=new wa({map:e,ogcApiFeatureLayerUrl:t,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(o,r),this._connectToWorkflowDestroyEvent(r,o),r}updateFeature(e,t,o){if(!t||!e||!e.id)throw new Error("Map, mapId or url is undefined.");const r=e.id;let i=this._workflows.get(r);if(i)throw new Error("EditingWorkflow could not be started. EditingWorkflow already in progress for this map.");return i=new _a({map:e,ogcApiFeatureLayerUrl:t,feature:o,polygonStyle:this._serviceOptions.properties.polygonStyle,vertexStyle:this._serviceOptions.properties.vertexStyle,httpService:this._serviceOptions.references.httpService,intl:this._serviceOptions.intl}),this._workflows.set(r,i),this._connectToWorkflowDestroyEvent(i,r),i}stop(e){const t=this._workflows.get(e);t&&t.stop()}reset(e){const t=this._workflows.get(e);if(t)t.reset();else throw new Error("No workflow found for mapId: "+e)}_connectToWorkflowDestroyEvent(e,t){e.on("destroyed",()=>{this._workflows.get(t)===e&&this._workflows.delete(t)})}}new ut([407354,5754673]),new ut([404740,5757893]);var ke,ye,pt,gt,ft,mn;class xa extends Bt{constructor(t,o,r){super();O(this,ft);A(this,"label");O(this,ke,{kind:"available"});O(this,ye,void 0);O(this,pt,void 0);O(this,gt,void 0);this.label=o,N(this,ye,t),N(this,gt,r),U(this,ft,mn).call(this),N(this,pt,C(this,ye).on("change:visible",()=>{U(this,ft,mn).call(this)}))}destroy(){K(C(this,pt))}get status(){return C(this,ke)}async select(t,o){if(t.type!=="extent")throw new Error(`Unsupported selection kind: ${t.type}`);if(C(this,ke).kind!=="available"||C(this,ye).getSource()===null)return[];const r=[];C(this,ye).getSource().forEachFeatureIntersectingExtent(t.extent,a=>{if(!a.getGeometry())return;const l={...a.getProperties()};delete l.geometries;const c={id:a.getId()?.toString()||Fo(),geometry:a.getGeometry(),properties:l};r.push(c)});const i=r.filter(a=>a!=null);return i.length>o.maxResults?i.slice(0,o.maxResults):i}}ke=new WeakMap,ye=new WeakMap,pt=new WeakMap,gt=new WeakMap,ft=new WeakSet,mn=function(){const o=C(this,ye).getVisible()?{kind:"available"}:{kind:"unavailable",reason:C(this,gt)};o.kind!==C(this,ke).kind&&(N(this,ke,o),this.emit("changed:status"))};var mt;class ka{constructor({intl:e}){O(this,mt,void 0);N(this,mt,e)}createSelectionSource(e){return new xa(e.vectorLayer,e.label,C(this,mt).formatMessage({id:"layerNotVisibleReason"}))}}mt=new WeakMap;const Me=ge("local-storage"),Ea=0,se={CORRUPTED_DATA:"local-storage:corrupted-data",INVALID_PATH:"local-storage:invalid-path",INVALID_VALUE:"local-storage:invalid-value",NOT_SUPPORTED:"local-storage:not-supported",INTERNAL:"local-storage:internal-error"};var Ge,ne,be,ze,oe,Rt,tr,Ot,nr,Ee,st,we,Re,Nt,or;class Ca{constructor(e){O(this,Rt);O(this,Ot);O(this,Ee);O(this,we);O(this,Nt);O(this,Ge,void 0);O(this,ne,{});O(this,be,void 0);O(this,ze,void 0);O(this,oe,void 0);N(this,Ge,Aa(e.properties)),N(this,be,Ia()),C(this,be)&&(U(this,Ot,nr).call(this),N(this,ze,U(this,Nt,or).call(this)))}destroy(){C(this,oe)&&(clearTimeout(C(this,oe)),N(this,oe,void 0)),C(this,be)&&U(this,Ee,st).call(this)}get isSupported(){return!!C(this,ze)}get(e){return U(this,we,Re).call(this).get(e)}set(e,t){return U(this,we,Re).call(this).set(e,t)}remove(e){return U(this,we,Re).call(this).remove(e)}removeAll(){return U(this,we,Re).call(this).removeAll()}getNamespace(e){return U(this,we,Re).call(this).getNamespace(e)}}Ge=new WeakMap,ne=new WeakMap,be=new WeakMap,ze=new WeakMap,oe=new WeakMap,Rt=new WeakSet,tr=function(){C(this,oe)&&clearTimeout(C(this,oe)),N(this,oe,setTimeout(()=>{N(this,oe,void 0),U(this,Ee,st).call(this)},Ea))},Ot=new WeakSet,nr=function(){try{const e=C(this,be);if(!e)throw new ie(se.INTERNAL,"Local storage is not available.");const t=e.getItem(C(this,Ge));if(t==null){N(this,ne,{}),U(this,Ee,st).call(this);return}try{const o=JSON.parse(t);if(!Ze(o))throw new ie(se.CORRUPTED_DATA,"Persisted value should be an object.");N(this,ne,o)}catch(o){Me.warn("Invalid persisted data, reverting to default.",o),N(this,ne,{}),U(this,Ee,st).call(this)}}catch(e){Me.error("Failed to load from local storage",e)}},Ee=new WeakSet,st=function(){try{const e=C(this,be);if(!e)throw new ie(se.INTERNAL,"Local storage is not available.");const t=JSON.stringify(C(this,ne));e.setItem(C(this,Ge),t)}catch(e){Me.error("Failed to save to local storage",e)}},we=new WeakSet,Re=function(){const e=C(this,ze);if(!e)throw new ie(se.NOT_SUPPORTED,"Local storage is not supported by this browser.");return e},Nt=new WeakSet,or=function(){const e={getByPath:t=>Xn(Ma(C(this,ne),t)),setByPath:(t,o)=>{if(!La(o))throw new ie(se.INVALID_VALUE,"The value is not supported by local storage.");if(o=Xn(o),t.length===0){if(!Ze(o))throw new ie(se.INVALID_VALUE,"The root value must be a plain object.");N(this,ne,o)}else Pa(C(this,ne),t,o);U(this,Rt,tr).call(this)}};return new Mn([],e)};class Mn{path;access;constructor(e,t){this.path=e,this.access=t}get(e){return this.access.getByPath([...this.path,e])}set(e,t){this.access.setByPath([...this.path,e],t)}remove(e){this.access.setByPath([...this.path,e],void 0)}removeAll(){this.access.setByPath(this.path,{})}getNamespace(e){const t=this.get(e);if(t===void 0)this.set(e,{});else if(!Ze(t))throw new ie(se.INVALID_PATH,`Cannot use '${e}' as a namespace because it is not associated with an object.`);return new Mn(this.path.concat([e]),this.access)}}const Jn="trails-state";function Ma(n,e){let t=n;for(const o of e){if(!Ze(t))throw new ie(se.INVALID_PATH,`Cannot get nested property '${o}' because the parent is no object.`);t=t[o]}return t}function Pa(n,e,t){if(!e.length)throw new ie(se.INTERNAL,"Path must not be empty.");let o=n;for(let i=0,s=e.length-1;i<s;++i){const a=e[i],l=o[a];if(!Ze(l))throw new ie(se.INVALID_PATH,`Cannot set property on '${a}' because it is no object.`);o=l}const r=e[e.length-1];o[r]=t}function Ze(n){return!!(n&&typeof n=="object"&&!Array.isArray(n))}function La(n){const e=typeof n;return e==="boolean"||e==="number"||e==="string"||e==="undefined"||n===null||Array.isArray(n)||Ze(n)}function Aa(n){const e=n.storageId;return!e||typeof e!="string"?(Me.warn(`The 'storageId' property of the 'local-storage' package should be set to a valid string to avoid collisions with other applications. Defaulting to '${Jn}'.`),Jn):e}function Ia(){if(typeof Storage>"u"){Me.warn("Local storage is not supported by this browser.");return}try{const n=globalThis.localStorage;if(!n){Me.warn("Local storage is not supported by this browser.");return}return n}catch(n){Me.warn("Local storage is not supported by this browser.",n);return}}function Xn(n){return n!=null&&(n=JSON.parse(JSON.stringify(n))),n}const Ta={"ol-map":{name:"ol-map",services:{MapConfigProviderImpl:{name:"MapConfigProviderImpl",clazz:Cs,provides:[{name:"map.MapConfigProvider",qualifier:void 0}],references:{vectorSourceFactory:{name:"ogc-features.VectorSourceFactory",qualifier:void 0,all:!1}}},AppModel:{name:"AppModel",clazz:aa,provides:[{name:"ol-app.AppModel",qualifier:void 0}],references:{ogcSearchSourceFactory:{name:"ogc-features.SearchSourceFactory",qualifier:void 0,all:!1},vectorSelectionSourceFactory:{name:"selection.VectorSelectionSourceFactory",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1},mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1},{name:"ol-app.AppModel",qualifier:void 0,all:!1},{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"editing.EditingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/chakra-integration":{name:"@open-pioneer/chakra-integration",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime":{name:"@open-pioneer/runtime",services:{},ui:{references:[]},properties:{}},"@open-pioneer/http":{name:"@open-pioneer/http",services:{HttpServiceImpl:{name:"HttpServiceImpl",clazz:yi,provides:[{name:"http.HttpService",qualifier:"http.HttpService"}],references:{interceptors:{name:"http.Interceptor",qualifier:void 0,all:!0}}}},ui:{references:[]},properties:{}},"@open-pioneer/notifier":{name:"@open-pioneer/notifier",services:{NotificationServiceImpl:{name:"NotificationServiceImpl",clazz:Vi,provides:[{name:"notifier.NotificationService",qualifier:"notifier.NotificationService"}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/map":{name:"@open-pioneer/map",services:{MapRegistryImpl:{name:"MapRegistryImpl",clazz:bi,provides:[{name:"map.MapRegistry",qualifier:void 0}],references:{providers:{name:"map.MapConfigProvider",qualifier:void 0,all:!0},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[{name:"map.MapRegistry",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/react-utils":{name:"@open-pioneer/react-utils",services:{},ui:{references:[]},properties:{}},"@open-pioneer/theme":{name:"@open-pioneer/theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/coordinate-viewer":{name:"@open-pioneer/coordinate-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/ogc-features":{name:"@open-pioneer/ogc-features",services:{VectorSourceFactory:{name:"VectorSourceFactory",clazz:$i,provides:[{name:"ogc-features.VectorSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}},SearchSourceFactory:{name:"SearchSourceFactory",clazz:Wi,provides:[{name:"ogc-features.SearchSourceFactory",qualifier:void 0}],references:{httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{}},"@open-pioneer/scale-bar":{name:"@open-pioneer/scale-bar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/overview-map":{name:"@open-pioneer/overview-map",services:{},ui:{references:[]},properties:{}},"@open-pioneer/scale-viewer":{name:"@open-pioneer/scale-viewer",services:{},ui:{references:[]},properties:{}},"@open-pioneer/experimental-layout-sidebar":{name:"@open-pioneer/experimental-layout-sidebar",services:{},ui:{references:[]},properties:{}},"@open-pioneer/printing":{name:"@open-pioneer/printing",services:{PrintingServiceImpl:{name:"PrintingServiceImpl",clazz:Gi,provides:[{name:"printing.PrintingService",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1},{name:"printing.PrintingService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/result-list":{name:"@open-pioneer/result-list",services:{},ui:{references:[]},properties:{}},"@open-pioneer/editing":{name:"@open-pioneer/editing",services:{EditingServiceImpl:{name:"EditingServiceImpl",clazz:Sa,provides:[{name:"editing.EditingService",qualifier:void 0}],references:{mapRegistry:{name:"map.MapRegistry",qualifier:void 0,all:!1},httpService:{name:"http.HttpService",qualifier:void 0,all:!1}}}},ui:{references:[]},properties:{polygonStyle:{value:{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"red","stroke-width":1.25,"circle-radius":3,"circle-fill-color":"red","circle-stroke-width":1.25,"circle-stroke-color":"red"},required:!1},vertexStyle:{value:{"circle-radius":3,"circle-fill-color":"red","circle-stroke-width":1.25,"circle-stroke-color":"red"},required:!1}}},"@open-pioneer/geolocation":{name:"@open-pioneer/geolocation",services:{},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/legend":{name:"@open-pioneer/legend",services:{},ui:{references:[]},properties:{}},"@open-pioneer/map-navigation":{name:"@open-pioneer/map-navigation",services:{},ui:{references:[]},properties:{}},"@open-pioneer/measurement":{name:"@open-pioneer/measurement",services:{},ui:{references:[]},properties:{}},"@open-pioneer/search":{name:"@open-pioneer/search",services:{},ui:{references:[]},properties:{}},"@open-pioneer/selection":{name:"@open-pioneer/selection",services:{VectorSelectionSourceFactory:{name:"VectorSelectionSourceFactory",clazz:ka,provides:[{name:"selection.VectorSelectionSourceFactory",qualifier:void 0}],references:{}}},ui:{references:[{name:"notifier.NotificationService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/spatial-bookmarks":{name:"@open-pioneer/spatial-bookmarks",services:{},ui:{references:[{name:"local-storage.LocalStorageService",qualifier:void 0,all:!1}]},properties:{}},"@open-pioneer/toc":{name:"@open-pioneer/toc",services:{},ui:{references:[]},properties:{}},"@open-pioneer/runtime-react-support":{name:"@open-pioneer/runtime-react-support",services:{},ui:{references:[]},properties:{}},"@open-pioneer/core":{name:"@open-pioneer/core",services:{},ui:{references:[]},properties:{}},"@open-pioneer/base-theme":{name:"@open-pioneer/base-theme",services:{},ui:{references:[]},properties:{}},"@open-pioneer/basemap-switcher":{name:"@open-pioneer/basemap-switcher",services:{},ui:{references:[]},properties:{}},"@open-pioneer/local-storage":{name:"@open-pioneer/local-storage",services:{LocalStorageServiceImpl:{name:"LocalStorageServiceImpl",clazz:Ca,provides:[{name:"local-storage.LocalStorageService",qualifier:"local-storage.LocalStorageService"}],references:{}}},ui:{references:[]},properties:{storageId:{value:null,required:!1}}}},ja='.search-box{position:absolute;width:500px;max-width:100%;z-index:1}.spatial-bookmarks{max-height:300px}:root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.printing-overlay{position:absolute;top:0;right:0;bottom:0;left:0;z-index:10000;-webkit-user-select:none;user-select:none;pointer-events:all;cursor:wait;display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:#b4b4b4cc}.printing-overlay-status{flex:1 1 auto;font-size:1.5em;text-align:center}.editing-tooltip{position:relative;background:#fffc;border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.editing-tooltip-hidden{visibility:hidden}.measurement-tooltip{position:relative;background:#fffc;border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.measurement-active-tooltip{background:#000000e6;border-radius:4px;border-color:#000000e6;opacity:.9;color:#fff}.measurement-finished-tooltip{background-color:#4cb3ffe6;color:#000;border:1px solid white}.measurement-active-tooltip:before,.measurement-finished-tooltip:before{border-top:6px solid rgba(0,0,0,.9);border-right:6px solid transparent;border-left:6px solid transparent;content:"";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.measurement-finished-tooltip:before{border-top-color:#4cb3ff}.search-component .chakra-divider{display:none}.search-component .search-highlighted-match{font-weight:700}.search-component .search-value-container{cursor:text;padding-left:30px!important}.search-component .search-invisible{display:none}.selection-drag-box{background-color:#ffffff4d!important;border:3px solid var(--chakra-colors-background_primary)!important}.selection-tooltip{position:relative;background:#fffc;border-radius:4px;color:#000;padding:4px 8px;opacity:1;white-space:nowrap;font-size:12px;cursor:default;-webkit-user-select:none;user-select:none;font-weight:700}.selection .react-select{cursor:default}.map-container .selection-active{cursor:crosshair}.map-container .selection-inactive{cursor:no-drop}.selection-source-value.selection-source-value--disabled{opacity:.4}.selection-source-value.selection-source-value--disabled span{margin:0 6px 0 0}.scale-bar .ol-scale-bar{margin-bottom:8px;margin-right:8px}.scale-bar .ol-scale-bar,.scale-bar .ol-scale-line{position:relative;bottom:0;left:0;background:none}.scale-bar .ol-scale-bar .ol-scale-bar-inner,.scale-bar .ol-scale-bar .ol-scale-line-inner,.scale-bar .ol-scale-line .ol-scale-bar-inner,.scale-bar .ol-scale-line .ol-scale-line-inner{color:var(--chakra-white);border-color:var(--chakra-white)}.overview-map .ol-overviewmap{position:relative;height:100%;width:100%}.overview-map .ol-overviewmap:not(.ol-collapsed){border:1px solid black}.overview-map .ol-overviewmap .ol-overviewmap-map{border:none;width:100%;height:100%}.overview-map .ol-overviewmap .ol-overviewmap-box{border:2px solid red}.layout-sidebar{height:100%;position:absolute;top:0}.layout-sidebar[data-theme=light]{background-color:var(--chakra-colors-whiteAlpha-700)}.layout-sidebar[data-theme=dark]{background-color:var(--chakra-colors-blackAlpha-700)}.layout-sidebar .layout-sidebar-main{transition:width .3s ease-out 0s;border-right:1px solid var(--chakra-colors-chakra-border-color)}.layout-sidebar .layout-sidebar-content{overflow:auto;transition:width .3s ease-out 0s}.layout-sidebar .layout-sidebar-content .content-section .content-header{font-size:1.5em;background-color:var(--chakra-colors-blackAlpha-500);padding:.5rem 1rem}.layout-sidebar .layout-sidebar-content .content-section .content-body{padding:1rem}.result-list-no-data-message{text-align:center;margin-top:50px;font-weight:700;font-size:larger}.result-list-table th,.result-list-table td{overflow-wrap:break-word}.result-list-table.result-list-table--is-resizing *{cursor:col-resize}.result-list-table thead{position:sticky;top:0;z-index:1;background:var(--chakra-colors-background_body)}.result-list-table th{position:relative;border-right-width:thin}.result-list-table tbody tr:hover{background:var(--chakra-colors-background_light)}.result-list-table .result-list-resizer{position:absolute;top:0;height:100%;right:0;width:8px;background:var(--chakra-colors-trails-100);transform:scaleX(.25);cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none;padding-left:0}.result-list-table th:last-child .result-list-resizer{width:8px;transform:translate(50%) scaleX(.25)}.result-list-table th .result-list-resizer.result-list-resizer--is-resizing{background:var(--chakra-colors-trails-500);transform:scale(1)}.result-list-table th .result-list-resizer:hover{transform:scale(1)}',Fa=["en","de"];function Ra(n){switch(n){case"en":return un(()=>import("./3a1kvKT9GCqm.js"),[],import.meta.url).then(e=>e.default);case"de":return un(()=>import("./Dw6oiSWyPQpS.js"),[],import.meta.url).then(e=>e.default)}throw new Error(`Unsupported locale: '${n}'`)}const Oa=Mr(ja),Na=Object.freeze(Object.defineProperty({__proto__:null,loadMessages:Ra,locales:Fa,packages:Ta,styles:Oa},Symbol.toStringTag,{value:"Module"})),Da="@open-pioneer/coordinate-viewer",Va=le.bind(void 0,Da),Ga=4,za=n=>{const{mapId:e,precision:t,displayProjectionCode:o}=n,{containerProps:r}=Q("coordinate-viewer",n),{map:i}=q(e),s=i?.olMap,a=Wo(s)?.getCode()??"";let{coordinates:l}=Ha(s);l=l&&o?$a(l,a,o):l;const c=Ba(l,t),u=o||a,p=c?c+" "+u:"";return d.jsx(R,{...r,children:d.jsx(pe,{className:"coordinate-viewer-text",children:p})})};function Ba(n,e){const t=Va();return n?Ua(n,e,t):""}function Ha(n){const[e,t]=f.useState();return f.useEffect(()=>{if(!n)return;const o=n.on("pointermove",r=>{t(r.coordinate)});return()=>K(o)},[n]),{coordinates:e}}function Ua(n,e,t){if(n[0]==null||n[1]==null)return"";const o=e??Ga,[r,i]=n,s=t.formatNumber(r,{maximumFractionDigits:o,minimumFractionDigits:o}),a=t.formatNumber(i,{maximumFractionDigits:o,minimumFractionDigits:o});return s+" "+a}function $a(n,e,t){return wi(n,e,t)}function Qn(n){const e=f.useRef(null);return f.useLayoutEffect(()=>{e.current=n}),f.useCallback((...o)=>{const r=e.current;return r(...o)},[])}const Wa="@open-pioneer/notifier",qa=Xe.bind(void 0,Wa);var rr=Go({displayName:"WarningTwoIcon",d:"M23.119,20,13.772,2.15h0a2,2,0,0,0-3.543,0L.881,20a2,2,0,0,0,1.772,2.928H21.347A2,2,0,0,0,23.119,20ZM11,8.423a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Zm1.05,11.51h-.028a1.528,1.528,0,0,1-1.522-1.47,1.476,1.476,0,0,1,1.448-1.53h.028A1.527,1.527,0,0,1,13.5,18.4,1.475,1.475,0,0,1,12.05,19.933Z"}),Ka=Go({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"});const Ya=!1;function Za(n){const{position:e="top-right"}=n,t=ns(),o=qa("notifier.NotificationService"),[r,i]=f.useState(!Ya),s=Qn(l=>{const c=l.level==="error"?d.jsx(rr,{h:"100%",w:"100%"}):void 0;t({position:e,title:l.title,description:l.message||null,status:l.level,isClosable:!0,duration:l.displayDuration??null,icon:c})}),a=Qn(()=>{t.closeAll()});return f.useEffect(()=>{const l=o.registerHandler({showNotification:s,closeAll:a});return()=>l.destroy()},[r,o,s,a]),d.jsx(d.Fragment,{})}const Ja=n=>{const{mapId:e,displayMode:t="line"}=n,{containerProps:o}=Q("scale-bar",n),{map:r}=q(e),i=f.useRef(null);return f.useEffect(()=>{if(i.current&&r){const s=r.olMap,a=new zi({units:"metric",target:i.current,bar:t==="bar"});return s.addControl(a),()=>{s.removeControl(a)}}},[t,r]),d.jsx(R,{...o,ref:i})},Xa="@open-pioneer/scale-viewer",Qa=le.bind(void 0,Xa),el=n=>{const{mapId:e}=n,{containerProps:t}=Q("scale-viewer",n),{map:o}=q(e),r=Qa(),i=ws(o?.olMap),s=i?r.formatNumber(i):void 0;return d.jsx(R,{...t,children:s&&d.jsxs(pe,{children:["1:",s]})})},ir="ol-map",he=Xe.bind(void 0,ir),Se=le.bind(void 0,ir);var H={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let tl=0;function nl(n,e){const t=`atom${++tl}`,o={toString:()=>t};return typeof n=="function"?o.read=n:(o.init=n,o.read=ol,o.write=rl),o}function ol(n){return n(this)}function rl(n,e,t){return e(this,typeof t=="function"?t(n(this)):t)}const nn=(n,e)=>n.unstable_is?n.unstable_is(e):e===n,on=n=>"init"in n,rn=n=>!!n.write,jt=new WeakMap,il=(n,e)=>{jt.set(n,e),n.catch(()=>{}).finally(()=>jt.delete(n))},eo=(n,e)=>{const t=jt.get(n);t&&(jt.delete(n),t(e))},to=(n,e)=>{n.status="fulfilled",n.value=e},no=(n,e)=>{n.status="rejected",n.reason=e},sl=n=>typeof n?.then=="function",tt=(n,e)=>!!n&&"v"in n&&"v"in e&&Object.is(n.v,e.v),oo=(n,e)=>!!n&&"e"in n&&"e"in e&&Object.is(n.e,e.e),Fe=n=>!!n&&"v"in n&&n.v instanceof Promise,al=(n,e)=>"v"in n&&"v"in e&&n.v.orig&&n.v.orig===e.v.orig,Mt=n=>{if("e"in n)throw n.e;return n.v},sr=()=>{const n=new WeakMap,e=new WeakMap,t=[],o=new WeakMap;let r,i;(H?"production":void 0)!=="production"&&(r=new Set,i=new Set);const s=m=>n.get(m),a=(m,b)=>{b.d.forEach((w,v)=>{var _;if(!o.has(v)){const x=s(v);(_=t[t.length-1])==null||_.add(v),o.set(v,[x,new Set]),x&&a(v,x)}o.get(v)[1].add(m)})},l=(m,b)=>{var w;(H?"production":void 0)!=="production"&&Object.freeze(b);const v=s(m);if(n.set(m,b),o.has(m)||((w=t[t.length-1])==null||w.add(m),o.set(m,[v,new Set]),a(m,b)),Fe(v)){const _="v"in b?b.v instanceof Promise?b.v:Promise.resolve(b.v):Promise.reject(b.e);v.v!==_&&eo(v.v,_)}},c=(m,b,w,v)=>{const _=new Map(v?b.d:null);let x=!1;w.forEach((k,P)=>{!k&&nn(m,P)&&(k=b),k?(_.set(P,k),b.d.get(P)!==k&&(x=!0)):(H?"production":void 0)!=="production"&&console.warn("[Bug] atom state not found")}),(x||b.d.size!==_.size)&&(b.d=_)},u=(m,b,w,v)=>{const _=s(m),x={d:_?.d||new Map,v:b};if(w&&c(m,x,w,v),tt(_,x)&&_.d===x.d)return _;if(Fe(_)&&Fe(x)&&al(_,x)){if(_.d===x.d)return _;x.v=_.v}return l(m,x),x},p=(m,b,w,v)=>{if(sl(b)){let _;const x=()=>{const P=s(m);if(!Fe(P)||P.v!==k)return;const T=u(m,k,w);e.has(m)&&P.d!==T.d&&B(m,T,P.d)},k=new Promise((P,T)=>{let I=!1;b.then(D=>{I||(I=!0,to(k,D),P(D),x())},D=>{I||(I=!0,no(k,D),T(D),x())}),_=D=>{I||(I=!0,D.then(ee=>to(k,ee),ee=>no(k,ee)),P(D))}});return k.orig=b,k.status="pending",il(k,P=>{P&&_(P),v?.()}),u(m,k,w,!0)}return u(m,b,w)},g=(m,b,w)=>{const v=s(m),_={d:v?.d||new Map,e:b};return w&&c(m,_,w),oo(v,_)&&v.d===_.d?v:(l(m,_),_)},h=(m,b)=>{const w=s(m);if(!b&&w&&(e.has(m)||Array.from(w.d).every(([I,D])=>{if(I===m)return!0;const ee=h(I);return ee===D||tt(ee,D)})))return w;const v=new Map;let _=!0;const x=I=>{if(nn(m,I)){const ee=s(I);if(ee)return v.set(I,ee),Mt(ee);if(on(I))return v.set(I,void 0),I.init;throw new Error("no atom init")}const D=h(I);return v.set(I,D),Mt(D)};let k,P;const T={get signal(){return k||(k=new AbortController),k.signal},get setSelf(){return(H?"production":void 0)!=="production"&&!rn(m)&&console.warn("setSelf function cannot be used with read-only atom"),!P&&rn(m)&&(P=(...I)=>{if((H?"production":void 0)!=="production"&&_&&console.warn("setSelf function cannot be called in sync"),!_)return E(m,...I)}),P}};try{const I=m.read(x,T);return p(m,I,v,()=>k?.abort())}catch(I){return g(m,I,v)}finally{_=!1}},y=m=>Mt(h(m)),S=m=>{const b=k=>{var P,T;const I=new Set((P=e.get(k))==null?void 0:P.t);return(T=o.get(k))==null||T[1].forEach(D=>{I.add(D)}),I},w=new Array,v=new Set,_=k=>{if(!v.has(k)){v.add(k);for(const P of b(k))k!==P&&_(P);w.push(k)}};_(m);const x=new Set([m]);for(let k=w.length-1;k>=0;--k){const P=w[k],T=s(P);if(!T)continue;let I=!1;for(const D of T.d.keys())if(D!==P&&x.has(D)){I=!0;break}if(I){const D=h(P,!0);tt(T,D)||x.add(P)}}},M=(m,...b)=>{const w=x=>Mt(h(x)),v=(x,...k)=>{const P=t.length>0;P||t.push(new Set([x]));let T;if(nn(m,x)){if(!on(x))throw new Error("atom not writable");const I=s(x),D=p(x,k[0]);tt(I,D)||S(x)}else T=M(x,...k);if(!P){const I=L(t.pop());(H?"production":void 0)!=="production"&&r.forEach(D=>D({type:"async-write",flushed:I}))}return T};return m.write(w,v,...b)},E=(m,...b)=>{t.push(new Set([m]));const w=M(m,...b),v=L(t.pop());return(H?"production":void 0)!=="production"&&r.forEach(_=>_({type:"write",flushed:v})),w},j=(m,b,w)=>{var v;const _=e.get(m);if(_)return b&&_.t.add(b),_;const x=w||[];(v=s(m))==null||v.d.forEach((P,T)=>{T!==m&&j(T,m,x)}),h(m);const k={t:new Set(b&&[b]),l:new Set};if(e.set(m,k),(H?"production":void 0)!=="production"&&i.add(m),rn(m)&&m.onMount){const{onMount:P}=m;x.push(()=>{const T=P((...I)=>E(m,...I));T&&(k.u=T)})}return w||x.forEach(P=>P()),k},F=(m,b)=>!b.l.size&&(!b.t.size||b.t.size===1&&b.t.has(m)),$=(m,b)=>{if(!F(m,b))return;const w=b.u;w&&w(),e.delete(m),(H?"production":void 0)!=="production"&&i.delete(m);const v=s(m);v?(Fe(v)&&eo(v.v),v.d.forEach((_,x)=>{if(x!==m){const k=e.get(x);k&&(k.t.delete(m),$(x,k))}})):(H?"production":void 0)!=="production"&&console.warn("[Bug] could not find atom state to unmount",m)},B=(m,b,w)=>{const v=new Set(b.d.keys()),_=new Set;w?.forEach((x,k)=>{if(v.has(k)){v.delete(k);return}_.add(k);const P=e.get(k);P&&P.t.delete(m)}),v.forEach(x=>{j(x,m)}),_.forEach(x=>{const k=e.get(x);k&&$(x,k)})},L=m=>{let b;(H?"production":void 0)!=="production"&&(b=new Set);const w=[],v=_=>{var x;if(!o.has(_))return;const[k,P]=o.get(_);o.delete(_),w.push([_,k]),P.forEach(v),(x=s(_))==null||x.d.forEach((T,I)=>v(I))};if(m.forEach(v),w.forEach(([_,x])=>{const k=s(_);if(!k){(H?"production":void 0)!=="production"&&console.warn("[Bug] no atom state to flush");return}if(k!==x){const P=e.get(_);P&&k.d!==x?.d&&B(_,k,x?.d),P&&!(!Fe(x)&&(tt(x,k)||oo(x,k)))&&(P.l.forEach(T=>T()),(H?"production":void 0)!=="production"&&b.add(_))}}),(H?"production":void 0)!=="production")return b},z=(m,b)=>{const w=j(m),v=L([m]),_=w.l;return _.add(b),(H?"production":void 0)!=="production"&&r.forEach(x=>x({type:"sub",flushed:v})),()=>{_.delete(b),$(m,w),(H?"production":void 0)!=="production"&&r.forEach(x=>x({type:"unsub"}))}};return(H?"production":void 0)!=="production"?{get:y,set:E,sub:z,dev_subscribe_store:m=>(r.add(m),()=>{r.delete(m)}),dev_get_mounted_atoms:()=>i.values(),dev_get_atom_state:m=>n.get(m),dev_get_mounted:m=>e.get(m),dev_restore_atoms:m=>{t.push(new Set);for(const[w,v]of m)on(w)&&(p(w,v),S(w));const b=L(t.pop());r.forEach(w=>w({type:"restore",flushed:b}))}}:{get:y,set:E,sub:z}};let nt;const ll=()=>(nt||(nt=sr(),(H?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=nt),globalThis.__JOTAI_DEFAULT_STORE__!==nt&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),nt),ar=sr,cl=ll,lr=f.createContext(void 0),dl=n=>f.useContext(lr)||cl(),ul=({children:n,store:e})=>{const t=f.useRef();return!e&&!t.current&&(t.current=ar()),f.createElement(lr.Provider,{value:e||t.current},n)},hl=n=>typeof n?.then=="function",pl=wo.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}),n)});function gl(n,e){const t=dl(),[[o,r,i],s]=f.useReducer(c=>{const u=t.get(n);return Object.is(c[0],u)&&c[1]===t&&c[2]===n?c:[u,t,n]},void 0,()=>[t.get(n),t,n]);let a=o;return(r!==t||i!==n)&&(s(),a=t.get(n)),f.useEffect(()=>{const c=t.sub(n,()=>{s()});return s(),c},[t,n,void 0]),f.useDebugValue(a),hl(a)?pl(a):a}const cr="@open-pioneer/spatial-bookmarks",fl=Xe.bind(void 0,cr),ml=le.bind(void 0,cr),me=ge("spatial-bookmark:SpatialBookmarkViewModel");class vl{map;packageNamespace;writableBookmarks=nl([]);stopBookmarksListener;store;get bookmarks(){return this.writableBookmarks}constructor(e,t){this.map=e,this.packageNamespace=t.getNamespace("spatial-bookmarks"),this.store=ar(),this.loadState(),this.stopBookmarksListener=this.store.sub(this.bookmarks,()=>{this.saveState()})}destroy(){this.stopBookmarksListener()}createBookmark(e){const t=this.map.olMap,o=t.getView().calculateExtent(),r=t.getView().getProjection().getCode(),i={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]},s={id:Fo(),title:e,extent:i,projection:r};me.debug("Created a new bookmark",s);const a=this.writableBookmarks;this.store.set(a,[...this.store.get(a),s])}activateBookmark(e){me.debug("Activating bookmark",e);const t=this.getBookmarkExtent(e);me.debug("Attempting to apply extent",t),this.applyExtent(t)}deleteBookmark(e){me.debug("Deleting bookmark",e);const t=this.writableBookmarks;this.store.set(t,[...this.store.get(t).filter(o=>o.id!==e)])}deleteAllBookmarks(){me.debug("Deleting all bookmarks"),this.store.set(this.writableBookmarks,[])}loadState(){me.debug("Restoring bookmarks from local storage");const e=this.packageNamespace.get("bookmarks")??[];try{yl(e),this.store.set(this.writableBookmarks,e)}catch(t){me.error("Bookmarks data in local storage is invalid, resetting to default value.",t),this.store.set(this.writableBookmarks,[]),this.saveState()}}saveState(){me.debug("Saving bookmarks to local storage"),this.packageNamespace.set("bookmarks",this.store.get(this.bookmarks))}getBookmarkExtent(e){const o=this.map.olMap.getView(),r=e.extent,i=[r.minX,r.minY,r.maxX,r.maxY],s=o.getProjection(),a=e.projection;return _i(i,a,s)}applyExtent(e){const o=this.map.olMap.getView(),r=Si(e),i=o.getResolutionForExtent(e);o.setCenter(r),o.setResolution(i)}}function yl(n){if(!Array.isArray(n))throw new Error("Expected bookmarks from local storage to be an array.");for(const e of n)bl(e)}function bl(n){if(!n||typeof n!="object")throw new Error("Expected bookmark from local storage to be an object.");const e=n;if(typeof e.id!="string")throw new Error("Bookmark does not have a valid id.");if(typeof e.title!="string")throw new Error("Bookmark does not have a valid title.");if(wl(e.extent),typeof e.projection!="string")throw new Error("Bookmark does not have a valid projection value.")}function wl(n){if(!n||typeof n!="object")throw new Error("Expected bookmark extent from local storage to be an object.");const e=n;if(typeof e.minX!="number"||typeof e.minY!="number"||typeof e.maxX!="number"||typeof e.maxY!="number")throw new Error("Expected bookmark extent from local storage to have valid coordinates.")}const _l=n=>{const{map:e}=q(n.mapId),t=fl("local-storage.LocalStorageService"),o=Pl(e,t);return o&&d.jsx(ul,{store:o.store,children:d.jsx(Sl,{...n,viewModel:o})})};function Sl(n){const{viewModel:e}=n,t=ml(),o=f.useRef([]),[r,i]=f.useState(!1),s=gl(e.bookmarks),[a,l]=f.useState(""),c=a.trim().length>0,{containerProps:u}=Q("spatial-bookmarks",n),[p,g]=f.useState("list"),h=()=>{e.deleteAllBookmarks(),g("list")},y=()=>{c&&(e.createBookmark(a),g("list"),l(""),i(!0))};f.useEffect(()=>{if(r){const F=o.current;F&&F[s.length-1]?.scrollIntoView?.(),i(!1)}},[s,r]);const S=()=>d.jsxs(dn,{children:[d.jsxs(qt,{rounded:"md",status:"warning",children:[d.jsx(Kt,{}),t.formatMessage({id:"bookmark.alert.delete"})]}),d.jsx(Cl,{intl:t,onClear:h,onCancel:()=>g("list")})]}),M=()=>d.jsxs(dn,{children:[d.jsxs(qt,{rounded:"md",status:"info",children:[d.jsx(Kt,{}),t.formatMessage({id:"bookmark.alert.create"})]}),d.jsx(Ut,{"aria-label":t.formatMessage({id:"bookmark.input.label"}),placeholder:t.formatMessage({id:"bookmark.input.placeholder"}),value:a,onChange:F=>{l(F.target.value)},onKeyDown:F=>{F.key==="Enter"&&y()},isRequired:!0,isInvalid:!c,autoFocus:!0}),d.jsx(Ml,{intl:t,isInvalid:!c,onCancel:()=>{l(""),g("list")},onSave:y})]}),E=()=>d.jsxs(d.Fragment,{children:[s.length?xl(s,e,t,o):d.jsxs(qt,{rounded:"md",status:"info",children:[d.jsx(Kt,{}),t.formatMessage({id:"bookmark.alert.noSaved"})]}),d.jsx(El,{intl:t,bookmarks:s,showCreate:()=>g("create"),showDelete:()=>g("delete")})]}),j=d.jsxs(d.Fragment,{children:[p==="list"&&E(),p==="create"&&M(),p==="delete"&&S()]});return d.jsx(ue,{flexDirection:"column",...u,children:j})}function xl(n,e,t,o){const r=t.formatMessage({id:"bookmark.button.deleteOne"}),i=n.map((s,a)=>d.jsx(kl,{index:a,listItemNodes:o,bookmark:s,onActivate:()=>e.activateBookmark(s),onDelete:()=>e.deleteBookmark(s.id),deleteBtnLabel:r},s.id));return d.jsx(Do,{as:"ul",className:"spatial-bookmark-list",role:"listbox","aria-label":t.formatMessage({id:"bookmark.list.label"}),flexShrink:1,flexGrow:1,p:1,spacing:1,overflowY:"auto",listStyleType:"none",children:i})}const ro={ArrowDown:1,ArrowUp:-1};function kl(n){const{index:e,listItemNodes:t,bookmark:o,onDelete:r,onActivate:i,deleteBtnLabel:s}=n,a=o.title,l=c=>{const u=c.key;if(u==="Enter"){c.target===c.currentTarget&&i();return}if(ro[u]!=null){const p=t.current?.length;if(!p)return;let g=(e+ro[u])%p;g<0&&(g=p-1),t.current[g]?.focus()}};return d.jsx(R,{as:"li",p:1,ref:c=>{if(!c){t.current.splice(e,1);return}t.current[e]=c},className:_t("spatial-bookmarks-item"),tabIndex:0,rounded:"md",role:"option",cursor:"pointer",outline:0,_hover:{background:"trails.50"},_focusVisible:{boxShadow:"outline"},onKeyDown:l,onClick:i,children:d.jsxs(ue,{width:"100%",flexDirection:"row",align:"center",gap:1,children:[d.jsx(Ho,{children:d.jsx(Oo,{})}),d.jsx(pe,{ps:2,noOfLines:1,children:a}),d.jsx(Ji,{}),d.jsx(So,{hasArrow:!0,label:s,placement:"right",children:d.jsx(zt,{className:"spatial-bookmarks-item-delete","aria-label":s,borderRadius:"full",iconSpacing:0,padding:0,colorScheme:"red",variant:"ghost",leftIcon:d.jsx(No,{}),onClick:c=>{r(),c.stopPropagation()}})},e)]})})}function El(n){const{intl:e,bookmarks:t,showCreate:o,showDelete:r}=n;return d.jsxs(Pn,{children:[d.jsx(Je,{isDisabled:t.length===0,colorScheme:"red",width:void 0,iconSpacing:0,leftIcon:d.jsx(No,{}),onClick:r,"aria-label":e.formatMessage({id:"bookmark.button.deleteAll"}),variant:"outline"}),d.jsx(Je,{onClick:o,width:"100%",children:e.formatMessage({id:"bookmark.button.create"})})]})}function Cl(n){const{intl:e,onCancel:t,onClear:o}=n;return d.jsxs(Pn,{children:[d.jsx(Je,{variant:"outline",onClick:t,children:e.formatMessage({id:"bookmark.button.cancelDelete"})}),d.jsx(Je,{onClick:o,children:e.formatMessage({id:"bookmark.button.confirmDelete"})})]})}function Ml(n){const{intl:e,onCancel:t,onSave:o,isInvalid:r}=n;return d.jsxs(Pn,{children:[d.jsx(Je,{variant:"outline",onClick:()=>t(),children:e.formatMessage({id:"bookmark.button.cancel"})}),d.jsx(Je,{isDisabled:r,onClick:()=>o(),children:e.formatMessage({id:"bookmark.button.save"})})]})}function Pn(n){return d.jsx(ue,{width:"100%",flexDirection:"row",mt:2,gap:1,flexGrow:0,flexShrink:0,children:n.children})}function Je(n){return d.jsx(zt,{width:"100%",...n})}function Pl(n,e){const[t,o]=f.useState();return f.useEffect(()=>{let r;return n?r=new vl(n,e):r=void 0,o(r),()=>r?.destroy()},[n,e]),t}function Ll(){const n=f.useId(),e=Se();return d.jsx(R,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:d.jsx(R,{role:"dialog","aria-labelledby":n,children:d.jsx(Ie,{title:d.jsx(Te,{id:n,size:"md",mb:2,children:e.formatMessage({id:"spatialBookmarkTitle"})}),children:d.jsx(_l,{mapId:V})})})})}const dr="@open-pioneer/printing",io=Xe.bind(void 0,dr),Al=le.bind(void 0,dr),Il="map";class Tl{olMap;title="";fileFormat="pdf";i18n;printingService;printMap=void 0;overlay=void 0;constructor(e,t,o){this.olMap=e,this.printingService=t,this.i18n=o}destroy(){this.reset()}setTitle(e){this.title=e}setFileFormat(e){this.fileFormat=e}async handleMapExport(){if(!(!this.olMap||!this.fileFormat))try{this.begin(),this.printMap=await this.printingService.printMap(this.olMap,{blockUserInteraction:!1});const e=this.printMap.getCanvas();if(e)this.fileFormat=="png"?await this.exportMapInPNG(e):await this.exportMapInPDF(e);else throw new Error("Canvas export failed")}finally{this.reset()}}begin(){const e=this.olMap.getTargetElement();e&&(this.overlay=Bi(e,this.i18n.overlayText))}reset(){this.overlay?.destroy(),this.overlay=void 0}getTitleAndFileName(){const e=this.title||"",t=this.title||Il;return{title:e,fileName:t}}async exportMapInPNG(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height+50,t.style.backgroundColor="#fff";const o=t.getContext("2d");if(!o)throw new Error("2d canvas rendering context not available");const{title:r,fileName:i}=this.getTitleAndFileName();o.fillStyle="#fff",o.fillRect(0,0,t.width,t.height),o.font="20px bold sans-serif",o.textAlign="center",o.fillStyle="#000";const s=t.width/2;o.fillText(r,s,20),o.drawImage(e,0,50);const a=document.createElement("a");a.setAttribute("download",i+".png");const l=Hi(t);if(!l)throw new Error("Failed to get image data URL");a.href=l,a.click()}async exportMapInPDF(e){const{jsPDF:t}=await un(()=>import("./WNa8RaVV2USn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url),o=new t({orientation:"landscape",unit:"mm",format:"a4"}),r=o.internal.pageSize.getWidth(),i=o.internal.pageSize.getHeight(),s=15,a=20,l=i-a;o.setFontSize(20);const{title:c,fileName:u}=this.getTitleAndFileName();o.text(c,r/2,s,{align:"center"});const p=e.width/e.height;let g=l,h=g*p;h>=r&&(h=r,g=h/p);const y=(r-h)/2,S=a+(l-g)/2;o.addImage(e,"",y,S,h,g),o.save(u+".pdf")}}const jl=ge("printing"),Fl=n=>{const e=Al(),{mapId:t}=n,{containerProps:o}=Q("printing",n),[r,i]=f.useState("pdf"),[s,a]=f.useState(""),[l,c]=f.useState(!1),u=io("printing.PrintingService"),p=io("notifier.NotificationService"),{map:g}=q(t),h=Rl(g,e,u);f.useEffect(()=>{h?.setFileFormat(r)},[h,r]),f.useEffect(()=>{h?.setTitle(s)},[h,s]);function y(M){(M==="png"||M==="pdf")&&i(M)}function S(){l||!h||(c(!0),h.handleMapExport().catch(M=>{const E=e.formatMessage({id:"printingFailed"});p.notify({level:"error",message:E}),jl.error("Failed to print the map",M)}).finally(()=>{c(!1)}))}return d.jsxs(R,{...o,children:[d.jsxs(At,{mb:4,alignItems:"center",children:[d.jsxs(hn,{mb:2,children:[d.jsx(ht,{minWidth:"82",mb:1,children:e.formatMessage({id:"title"})}),d.jsx(Ut,{placeholder:e.formatMessage({id:"input.placeholder"}),value:s,onChange:M=>{a(M.target.value)},autoFocus:!0})]}),d.jsxs(hn,{mb:2,children:[d.jsx(ht,{minWidth:"82",mb:1,children:e.formatMessage({id:"fileFormat"})}),d.jsxs(_n,{value:r,onChange:M=>y(M.target.value),className:"printing-select",children:[d.jsx("option",{value:"png",children:"PNG"}),d.jsx("option",{value:"pdf",children:"PDF"})]})]})]}),d.jsx(zt,{isLoading:l,loadingText:e.formatMessage({id:"printingMap"}),disabled:l,padding:2,className:"printing-export-button",onClick:S,width:"100%",children:e.formatMessage({id:"export"})})]})};function Rl(n,e,t){const[o,r]=f.useState(void 0);return f.useEffect(()=>{if(!n)return;const i=new Tl(n.olMap,t,{overlayText:e.formatMessage({id:"printingMap"})});return r(i),()=>{i.destroy(),r(void 0)}},[n,e,t]),o}function Ol(){const n=f.useId(),e=Se();return d.jsx(R,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",role:"dialog",width:350,children:d.jsx(R,{role:"dialog","aria-labelledby":n,children:d.jsx(Ie,{title:d.jsx(Te,{id:n,size:"md",mb:2,children:e.formatMessage({id:"printingTitle"})}),children:d.jsx(Fl,{mapId:V})})})})}const Nl="@open-pioneer/legend",ur=le.bind(void 0,Nl),Dl=n=>{const{mapId:e,showBaseLayers:t=!1}=n,{containerProps:o}=Q("legend",n),{map:r}=q(e);return d.jsx(R,{...o,children:r?d.jsx(Vl,{map:r,showBaseLayers:t}):null})};function Vl(n){const{map:e,showBaseLayers:t}=n,r=Bl(e).map(i=>d.jsx(hr,{layer:i,showBaseLayers:t},i.id));return d.jsx(Do,{as:"ul",className:"legend-layer-list",listStyleType:"none",spacing:2,children:r})}function hr(n){const{layer:e,showBaseLayers:t}=n,{isVisible:o}=Ul(e),r=Hl(e);if(!o||!t&&!("parentLayer"in e)&&e.isBaseLayer)return;const i=[];return r?.length&&r.forEach(s=>{i.push(d.jsx(hr,{layer:s,showBaseLayers:t},s.id))}),d.jsxs(d.Fragment,{children:[d.jsx(Gl,{layer:e,showBaseLayers:t}),i]})}function Gl(n){const e=ur(),{layer:t,showBaseLayers:o}=n,r=$l(t),i=zl(t);let s;r?.Component?s=d.jsx(r.Component,{layer:t}):r?.imageUrl?s=d.jsx(so,{layer:t,imageUrl:r.imageUrl}):i&&(s=d.jsx(so,{layer:t,imageUrl:i}));const a=!("parentLayer"in t)&&t.isBaseLayer;return s?d.jsxs(R,{as:"li",className:_t("legend-item",`layer-${Wl(t.id)}`),children:[o&&a?d.jsx(pe,{as:"b",children:e.formatMessage({id:"basemapLabel"})}):null,s]}):void 0}function so(n){const e=ur(),{layer:t,imageUrl:o}=n;return d.jsxs(R,{children:[d.jsx(pe,{children:t.title}),d.jsx(Ui,{maxW:"none",maxH:"none",src:o,alt:e.formatMessage({id:"altLabel"},{layerName:t.title}),className:"legend-item__image",fallbackStrategy:"onError",fallback:d.jsx(R,{children:d.jsxs(pe,{children:[d.jsx(rr,{me:2}),e.formatMessage({id:"fallbackLabel"})]})})})]})}function zl(n){const e=f.useCallback(()=>n.legend,[n]),t=f.useCallback(o=>{const r=n.on("changed:legend",o);return()=>r.destroy()},[n]);return f.useSyncExternalStore(t,e)}function Bl(n){const e=f.useCallback(o=>{const r=n.layers.on("changed",o);return()=>r.destroy()},[n]),t=f.useCallback(()=>{let o=n.layers.getAllLayers({sortByDisplayOrder:!0})??[];return o=o.reverse(),o},[n]);return pr(e,t)}function Hl(n){const e=f.useCallback(o=>{const r=n.sublayers?.on("changed",o);return()=>r?.destroy()},[n]),t=f.useCallback(()=>{if(!n.sublayers)return;let r=n.sublayers?.getSublayers({sortByDisplayOrder:!0});return r=r.reverse(),r},[n]);return pr(e,t)}function pr(n,e){const t=f.useRef(),o=f.useCallback(i=>{const s=n(()=>{t.current=void 0,i()});return()=>{t.current=void 0,s()}},[n]),r=f.useCallback(()=>{if(t.current)return t.current.value;const i=e();return t.current={value:i},i},[e]);return f.useSyncExternalStore(o,r)}function Ul(n){const e=f.useCallback(()=>n.visible,[n]),t=f.useCallback(r=>{const i=n.on("changed:visible",r);return()=>i.destroy()},[n]);return{isVisible:f.useSyncExternalStore(t,e)}}function $l(n){const[e,t]=f.useState(void 0);return f.useEffect(()=>{t(n.attributes.legend);const o=n.on("changed:attributes",()=>{t(n.attributes.legend)});return()=>o.destroy()},[n]),e}function Wl(n){return n.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function ql(){const n=f.useId(),e=Se();return d.jsx(R,{role:"dialog","aria-labelledby":n,children:d.jsx(Ie,{title:d.jsx(Te,{id:n,size:"md",mb:2,children:e.formatMessage({id:"legendTitle"})}),children:d.jsx(R,{overflowY:"auto",maxHeight:300,children:d.jsx(Dl,{mapId:V,showBaseLayers:!0})})})})}const gr="@open-pioneer/geolocation",Kl=Xe.bind(void 0,gr),Yl=le.bind(void 0,gr);function Zl(n){return wn({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0013 3.06V1h-2v2.06A8.994 8.994 0 003.06 11H1v2h2.06A8.994 8.994 0 0011 20.94V23h2v-2.06A8.994 8.994 0 0020.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"}}]})(n)}const ao=ge("geolocation:GeolocationController"),lo=17;class Jl extends Bt{olMap;positionHighlightLayer;geolocation;maxZoom=lo;accuracyFeature;positionFeature;changeHandlers=[];isCurrentlyActive=!1;setMapToPosition=!0;trackingOptions={};isInitialZoom=!0;constructor(e,t){super(),this.olMap=e,this.isInitialZoom=!0,this.accuracyFeature=new Le,this.accuracyFeature.setStyle(uo()),this.positionFeature=new Le,this.positionFeature.setStyle(co()),this.positionHighlightLayer=new J({source:new _e({features:[this.accuracyFeature,this.positionFeature]})}),this.positionHighlightLayer.setZIndex(Ht);const o=t||Xl();this.geolocation=new cs({tracking:!1,trackingOptions:o,projection:e.getView()?.getProjection()}),this.trackingOptions=o,this.geolocation.on("error",r=>this.handleGeolocationError(r))}destroy(){this.stopGeolocation(),this.geolocation?.setTracking(!1),this.geolocation.dispose(),this.accuracyFeature=void 0,this.positionFeature=void 0,this.positionHighlightLayer.dispose()}startGeolocation(){if(this.isCurrentlyActive)return Promise.resolve();const e=this.olMap;return new Promise(o=>{this.isCurrentlyActive=!0,this.geolocation?.setProjection(e.getView()?.getProjection()),this.geolocation?.setTracking(!0);const r=this.geolocation.on("change:accuracyGeometry",()=>{const l=this.geolocation.getAccuracyGeometry()||void 0;if(this.accuracyFeature?.setGeometry(l),this.accuracyFeature?.getGeometry()!==void 0&&o(),this.isInitialZoom){const c=this?.accuracyFeature?.getGeometry()?.getExtent();if(c){const u=Ss(c);if(!u)return;e.getView().fit(u,{maxZoom:this.maxZoom}),this.isInitialZoom=!1}}}),i=this.geolocation.on("change:position",()=>{const l=this.geolocation.getPosition();l&&(l[0]||l[1])!==void 0&&(this.positionFeature?.setGeometry(new ut(l)),this.setMapToPosition&&e.getView().setCenter(l),this.positionFeature?.getGeometry()!==void 0&&o())}),s=e.getView().on("change:resolution",()=>{this.setMapToPosition=this.isInitialZoom}),a=e.on("pointermove",l=>{l.dragging&&(this.setMapToPosition=!1)});this.changeHandlers.push(r,i,s,a),e.addLayer(this.positionHighlightLayer)}).catch(o=>{ao.error("Failed to determine location",o)})}stopGeolocation(){this.geolocation?.setTracking(!1),this.isCurrentlyActive=!1,this.trackingOptions={},this.setMapToPosition=!0,this.isInitialZoom=!0,this.changeHandlers.forEach(e=>{K(e)}),this.changeHandlers=[],this.accuracyFeature?.setGeometry(void 0),this.positionFeature?.setGeometry(void 0),this.olMap.removeLayer(this.positionHighlightLayer)}setPositionFeatureStyle(e){this.positionFeature?.setStyle(e??co())}setAccuracyFeatureStyle(e){this.accuracyFeature?.setStyle(e??uo())}setMaxZoom(e){this.maxZoom=e??lo}getMaxZoom(){return this.maxZoom}getPositionFeature(){return this.positionFeature}getAccuracyFeature(){return this.accuracyFeature}getTrackingOptions(){return this.trackingOptions}getGeolocation(){return this.geolocation}handleGeolocationError(e){ao.error("Error from geolocation API:",e.message);const t=(()=>{switch(e.code){case 1:return"permission-denied";case 2:return"position-unavailable";case 3:return"timeout";default:return"unknown"}})();this.emit("error",t)}}const co=()=>new Pe({image:new bn({radius:6,fill:new $e({color:"#3399CC"}),stroke:new Ce({color:"#fff",width:2})})}),uo=()=>new Pe({stroke:new Ce({color:"#3399CC",width:3}),fill:new $e({color:"rgba(0, 0, 255, 0.05)"})}),Xl=()=>({enableHighAccuracy:!0,timeout:6e4,maximumAge:6e5}),Ql=f.forwardRef(function(e,t){const{mapId:o,maxZoom:r,positionFeatureStyle:i,accuracyFeatureStyle:s,trackingOptions:a}=e,{containerProps:l}=Q("geolocation",e),c=!!navigator.geolocation,[u,p]=f.useState(!1),[g,h]=f.useState(!1),{map:y}=q(o),S=Yl(),M=Kl("notifier.NotificationService"),E=ec(y,r,a,i,s),j=c?u?S.formatMessage({id:"locateMeEnd"}):S.formatMessage({id:"locateMeStart"}):S.formatMessage({id:"locateNotSupported"});f.useEffect(()=>{if(E===void 0)return;const $=E.on("error",function(B){const L=S.formatMessage({id:"error"}),z=(()=>{switch(B){case"permission-denied":return S.formatMessage({id:"permissionDenied"});case"position-unavailable":return S.formatMessage({id:"positionUnavailable"});case"timeout":return S.formatMessage({id:"timeout"});case"unknown":return S.formatMessage({id:"unknownError"})}})();h(!1),p(!1),M.notify({level:"error",title:L,message:z})});return()=>{$.destroy()}},[E,S,M]),f.useEffect(()=>{if(!E){h(!1);return}return u&&(h(!0),E.startGeolocation().then(()=>{h(!1)})),()=>{E?.stopGeolocation(),h(!1)}},[E,u]);const F=()=>{y&&p(!u)};return d.jsx(Y,{ref:t,label:j,icon:d.jsx(Zl,{}),onClick:()=>F(),isActive:u,isLoading:g,isDisabled:!c,...l})});function ec(n,e,t,o,r){const[i,s]=f.useState();return f.useEffect(()=>{if(!n)return;const a=new Jl(n.olMap,t);return s(a),()=>{a.destroy(),s(void 0)}},[n,t]),f.useEffect(()=>{i?.setPositionFeatureStyle(o)},[i,o]),f.useEffect(()=>{i?.setAccuracyFeatureStyle(r)},[i,r]),f.useEffect(()=>{i?.setMaxZoom(e)},[i,e]),i}function tc(n){return wn({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"path",attr:{d:"M12 5m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M19 8m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M5 11m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M15 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M6.5 9.5l1.546 -1.311"}},{tag:"path",attr:{d:"M14 5.5l3 1.5"}},{tag:"path",attr:{d:"M18.5 10l-1.185 3.318m-1.062 2.972l-.253 .71"}},{tag:"path",attr:{d:"M13.5 17.5l-7 -5"}},{tag:"path",attr:{d:"M3 3l18 18"}}]})(n)}function nc(n){return wn({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"path",attr:{d:"M12 5m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M19 8m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M5 11m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M15 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}},{tag:"path",attr:{d:"M6.5 9.5l3.5 -3"}},{tag:"path",attr:{d:"M14 5.5l3 1.5"}},{tag:"path",attr:{d:"M18.5 10l-2.5 7"}},{tag:"path",attr:{d:"M13.5 17.5l-7 -5"}}]})(n)}function oc(n){const{toolState:e,onToolStateChange:t}=n,o=Se(),r=he("ol-app.AppModel"),i=Ye(r.state).resultListState,s=i.open,a=he("editing.EditingService"),l=Ae((c,u)=>{t(c,u??!e[c])});return d.jsxs(ue,{role:"toolbar","aria-label":o.formatMessage({id:"ariaLabel.toolbar"}),direction:"column",gap:1,padding:1,children:[d.jsx(Y,{label:e.editingCreateActive?o.formatMessage({id:"editing.stopTitle"}):o.formatMessage({id:"editing.create.startTitle"}),icon:e.editingCreateActive?d.jsx(tc,{}):d.jsx(nc,{}),isActive:e.editingCreateActive,onClick:()=>l("editingCreateActive")}),d.jsx(Y,{label:e.editingUpdateActive?o.formatMessage({id:"editing.stopTitle"}):o.formatMessage({id:"editing.update.startTitle"}),icon:e.editingUpdateActive?d.jsx(Pi,{}):d.jsx(Li,{}),isActive:e.editingUpdateActive,onClick:()=>l("editingUpdateActive")}),d.jsx(Y,{label:o.formatMessage({id:"editing.resetTitle"}),icon:d.jsx(Ai,{}),onClick:()=>a.reset(V)}),i.input&&d.jsx(Y,{label:o.formatMessage({id:"resultListTitle"}),icon:d.jsx(Ii,{}),isActive:i.open,onClick:()=>r.setResultListVisibility(!s)}),d.jsx(Y,{label:o.formatMessage({id:"printingTitle"}),icon:d.jsx(Ti,{}),isActive:e.printingActive,onClick:()=>l("printingActive")}),d.jsx(Y,{label:o.formatMessage({id:"spatialBookmarkTitle"}),icon:d.jsx(ji,{}),isActive:e.bookmarksActive,onClick:()=>l("bookmarksActive")}),d.jsx(Ql,{mapId:V}),d.jsx(Y,{label:o.formatMessage({id:"tocTitle"}),icon:d.jsx(Fi,{}),isActive:e.tocActive,onClick:()=>l("tocActive")}),d.jsx(Y,{label:o.formatMessage({id:"legendTitle"}),icon:d.jsx(Ri,{}),isActive:e.legendActive,onClick:()=>l("legendActive")}),d.jsx(Y,{label:o.formatMessage({id:"measurementTitle"}),icon:d.jsx(Oi,{}),isActive:e.measurementActive,onClick:()=>l("measurementActive")}),d.jsx(Y,{label:o.formatMessage({id:"selectionTitle"}),icon:d.jsx(Ni,{}),isActive:e.selectionActive,onClick:()=>l("selectionActive")}),d.jsx(Y,{label:o.formatMessage({id:"overviewMapTitle"}),icon:d.jsx(Oo,{}),isActive:e.overviewMapActive,onClick:()=>l("overviewMapActive")}),d.jsx(qi,{mapId:V}),d.jsx(Ki,{mapId:V}),d.jsx(Yi,{mapId:V})]})}const rc="@open-pioneer/measurement",ic=le.bind(void 0,rc);class sc{olMap;messages;activeFeatureStyle;layer;source;draw=void 0;sketch=void 0;helpTooltip;measureTooltip;overlayTooltips=[];resources=[];constructor(e,t){this.olMap=e,this.messages=t;const o=this.source=new _e;this.layer=new J({source:o}),this.layer.setZIndex(Ht),e.addLayer(this.layer);const r=e.on("pointermove",this.handlePointerMove.bind(this));this.resources.push({destroy(){K(r)}});const i=()=>{this.helpTooltip.element.classList.add("hidden")};e.getViewport().addEventListener("mouseout",i),this.resources.push({destroy(){e.getViewport().removeEventListener("mouseout",i)}}),this.helpTooltip=this.createHelpTooltip()}destroy(){this.stopMeasurement();for(const e of this.resources)e.destroy();this.resources=[],this.helpTooltip.destroy(),this.measureTooltip?.destroy();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[],this.olMap.removeLayer(this.layer),this.layer.dispose(),this.source.dispose()}getVectorLayer(){return this.layer}setFinishedFeatureStyle(e){this.layer.setStyle(e)}setActiveFeatureStyle(e){const t=xi(e);this.activeFeatureStyle=(o,...r)=>{const i=o?.getGeometry()?.getType();if(i==="Polygon"||i==="LineString"||i==="Point")return t(o,...r)},this.draw?.getOverlay().setStyle(this.activeFeatureStyle)}clearMeasurements(){this.source.clear();for(const e of this.overlayTooltips)e.destroy();this.overlayTooltips=[]}startMeasurement(e){if(this.draw)throw new Error("Internal error: another measurement interaction is still active.");const t=e==="area"?"Polygon":"LineString",o=this.draw=new Vo({source:this.source,type:t,style:this.activeFeatureStyle});this.olMap.addInteraction(o);let r,i;o.on("drawstart",s=>{r=this.measureTooltip=this.createMeasureTooltip();const a=this.sketch=s.feature;if(!a)return;let l;i=a.getGeometry()?.on("change",c=>{const u=c.target,p=this.olMap.getView().getProjection();let g="";u instanceof Ro?(g=lc(u,p,this.messages),l=u.getInteriorPoint().getCoordinates()||null):u instanceof Bo&&(g=cc(u,p,this.messages),l=u.getLastCoordinate()||null),r&&(r.element.innerHTML=g,l&&r?.overlay.setPosition(l))})}),o.on("drawend",()=>{if(r){const s=r.element.classList;s.remove("measurement-active-tooltip"),s.remove("printing-hide"),s.add("measurement-finished-tooltip"),r.overlay.setOffset([0,-7]),this.overlayTooltips.push(r),this.measureTooltip=r=void 0}this.sketch=void 0,i&&K(i)}),o.on("drawabort",()=>{r&&(r.destroy(),this.measureTooltip=r=void 0),this.sketch=void 0,i&&K(i)})}stopMeasurement(){this.draw&&(this.olMap.removeInteraction(this.draw),this.draw.abortDrawing(),this.draw.dispose(),this.draw=void 0),this.sketch=void 0,this.measureTooltip?.destroy(),this.measureTooltip=void 0}createMeasureTooltip(){const e=document.createElement("div");e.className="measurement-tooltip measurement-active-tooltip printing-hide";const t=new qe({element:e,offset:[0,-15],positioning:"bottom-center",stopEvent:!1,insertFirst:!1}),o=this.olMap;return o.addOverlay(t),{overlay:t,element:e,destroy(){o.removeOverlay(t)}}}createHelpTooltip(){const e=document.createElement("div");e.className="measurement-tooltip printing-hide hidden";const t=new qe({element:e,offset:[15,0],positioning:"center-left"}),o=this.olMap;return o.addOverlay(t),{overlay:t,element:e,destroy(){o.removeOverlay(t)}}}handlePointerMove(e){if(e.dragging)return;const t=this.helpTooltip,o=ac(this.messages,this.sketch);t.element.textContent=o,t.overlay.setPosition(e.coordinate),t.element.classList.remove("hidden")}}function ac(n,e){if(e){const t=e.getGeometry();if(t instanceof Ro||t instanceof Bo)return n.getContinueMessage()}return n.getHelpMessage()}function lc(n,e,t){const o=ki(n,{projection:e});let r;return o>=1e6?r=`${t.formatNumber(o/1e6)} km<sup>2</sup>`:r=`${t.formatNumber(o)} m<sup>2</sup>`,r}function cc(n,e,t){const o=Ei(n,{projection:e});let r;return o>=1e3?r=`${t.formatNumber(o/1e3)} km`:r=`${t.formatNumber(o)} m`,r}const dc=n=>{const e=ic(),{mapId:t,activeFeatureStyle:o,finishedFeatureStyle:r}=n,{containerProps:i}=Q("measurement",n),[s,a]=f.useState("distance"),l=h=>e.formatMessage({id:h}),c=q(t),u=uc(c.map,e);f.useEffect(()=>{u?.setActiveFeatureStyle(o??hc())},[u,o]),f.useEffect(()=>{u?.setFinishedFeatureStyle(r??pc())},[u,r]),f.useEffect(()=>{if(u)return u.startMeasurement(s),()=>{u.stopMeasurement()}},[u,s]);function p(h){if(h==="distance"||h==="area")a(h);else throw new Error(`Unexpected measurement type: '${h}'.`)}function g(){u?.clearMeasurements()}return d.jsxs(R,{...i,children:[d.jsx(pe,{mb:3,children:e.formatMessage({id:"measurementInfoText"})}),d.jsx(At,{mb:4,alignItems:"center",children:d.jsxs(hn,{mb:2,children:[d.jsx(ht,{mb:1,children:l("measurementLabel")}),d.jsxs(_n,{value:s,onChange:h=>p(h.target.value),className:"measurement-select",children:[d.jsx("option",{value:"distance",children:l("distance")}),d.jsx("option",{value:"area",children:l("area")})]})]})}),d.jsx(zt,{padding:2,className:"measurement-delete-button",onClick:g,width:"100%",children:l("deleteMeasurementLabel")})]})};function uc(n,e){const[t,o]=f.useState(void 0);return f.useEffect(()=>{if(!n)return;const r=new sc(n.olMap,{getContinueMessage(){return e.formatMessage({id:"tooltips.continue"})},getHelpMessage(){return e.formatMessage({id:"tooltips.help"})},formatNumber(i){return e.formatNumber(i,{maximumFractionDigits:2})}});return o(r),()=>{r.destroy(),o(void 0)}},[n,e]),t}function hc(){return[new Pe({stroke:new Ce({color:"#fff",lineDash:[10,10],width:5})}),new Pe({fill:new $e({color:"rgba(0,0,0,0.15)"}),stroke:new Ce({color:"rgba(0, 0, 0, 0.7)",lineDash:[10,10],width:3}),image:new bn({radius:5,stroke:new Ce({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new $e({color:"rgba(255, 255, 255, 0.2)"})})})]}function pc(){return[new Pe({stroke:new Ce({color:"#fff",width:5})}),new Pe({stroke:new Ce({color:"#0b96fc",width:3}),fill:new $e({color:"rgba(11,150,252,0.15)"})})]}function gc(){const n=f.useId(),e=Se();return d.jsx(R,{role:"dialog","aria-labelledby":n,children:d.jsx(Ie,{title:d.jsx(Te,{id:n,size:"md",mb:2,children:e.formatMessage({id:"measurementTitle"})}),children:d.jsx(dc,{mapId:V})})})}const fc="200px",mc="300px",vc=n=>{const{mapId:e,olLayer:t,height:o=fc,width:r=mc}=n,{containerProps:i}=Q("overview-map",n),s=f.useRef(null),{map:a}=q(e);return f.useEffect(()=>{if(s.current&&a&&t){const l=a.olMap,c=new fa({className:"ol-overviewmap",layers:[t],collapsible:!1,collapsed:!1,target:s.current});return l.addControl(c),()=>{l.removeControl(c)}}},[a,t]),d.jsx(R,{height:o,width:r,ref:s,...i})};function yc(){const n=f.useMemo(()=>new Ao({source:new Io}),[]);return d.jsx(R,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",maxWidth:325,children:d.jsx(R,{role:"dialog",children:d.jsx(vc,{mapId:V,olLayer:n})})})}function bc(){const n=he("ol-app.AppModel"),e=Ye(n.state).resultListState,[t,o]=f.useState([]),[r,i]=f.useState([]),s=f.useCallback(a=>{o(a.features),i(a.getFeatureIds())},[]);return f.useEffect(()=>{console.log("Anzahl Features: "+t.length),console.log("SelectedIds: "+r.toString())},[t,r]),e.input&&d.jsx(R,{className:"result-list-container",position:"absolute",visibility:e.open?"visible":"hidden",bottom:"0",backgroundColor:"white",width:"100%",height:"400px",zIndex:1,borderTop:"2px solid",borderBottom:"2px solid",borderColor:"trails.100",children:d.jsx(Qi,{input:e.input,mapId:V,onSelectionChange:s},e.key)})}const wc="@open-pioneer/search",$t=le.bind(void 0,wc);function _c(n){const e=n.selectProps.inputValue.length>0,t={...n,className:_t(n.className,{"search-invisible":!e})};return d.jsx(fe.Menu,{...t,children:n.children})}function Sc(n){const t=$t().formatMessage({id:"noOptionsText"});return d.jsx(fe.NoOptionsMessage,{...n,children:d.jsx(X.span,{className:"search-no-match",children:t})})}function xc(n){const t=$t().formatMessage({id:"loadingText"});return d.jsx(fe.LoadingMessage,{...n,children:d.jsx(X.span,{className:"search-loading-text",children:t})})}function kc({children:n,...e}){const t={...e,className:_t(e.className,"search-value-container")};return d.jsxs(fe.ValueContainer,{...t,children:[!!n&&d.jsx(Ka,{style:{position:"absolute",left:8}}),n]})}function Ec(n){const e={...n,isHidden:!1};return d.jsx(fe.Input,{...e})}function Cc(n){return null}function Mc(n){return d.jsxs(fe.IndicatorsContainer,{...n,children:[n.children,!n.selectProps.isLoading&&n.selectProps.inputValue&&d.jsx(Pc,{selectProps:n.selectProps,clearValue:n.clearValue})]})}function Pc(n){const t=$t().formatMessage({id:"ariaLabel.clearButton"}),o=r=>{r.preventDefault(),r.stopPropagation(),n.clearValue()};return d.jsx(Pr,{role:"button",size:"md",mr:1,"aria-label":t,onClick:o,onTouchEnd:o,onMouseDown:r=>r.preventDefault()})}function Lc(n){return null}function Ac(n){const e=n.selectProps.inputValue,t=n.data.label,o={...n,className:_t(n.className,"search-option")};return d.jsx(fe.Option,{...o,children:d.jsx(X.div,{className:"search-option-label",children:e.trim().length>0?Ic(t,e):t})})}function Ic(n,e){const t=n.toLowerCase().indexOf(e.toLowerCase());return t>=0?d.jsxs(d.Fragment,{children:[n.substring(0,t),d.jsx(X.span,{className:"search-highlighted-match",children:n.substring(t,t+e.length)},"highlighted"),n.substring(t+e.length)]}):n}const ho=ge("search:SearchController"),po=200,go=5;var vt,Be,He,Ue,re,Dt,fr;class Tc{constructor(e,t){O(this,Dt);O(this,vt,void 0);O(this,Be,[]);O(this,He,go);O(this,Ue,po);O(this,re,void 0);N(this,vt,e),N(this,Be,t)}destroy(){C(this,re)?.abort(),N(this,re,void 0)}async search(e){if(C(this,re)?.abort(),N(this,re,void 0),!e)return[];const t=N(this,re,new AbortController);try{return await jc(t.signal,C(this,Ue)),t.signal.aborted&&(ho.debug(`search canceled with ${e}`),Lr()),(await Promise.all(C(this,Be).map(r=>U(this,Dt,fr).call(this,r,e,t.signal)))).filter(r=>r!=null)}finally{C(this,re)===t&&N(this,re,void 0)}}get searchTypingDelay(){return C(this,Ue)}set searchTypingDelay(e){N(this,Ue,e??po)}get maxResultsPerSource(){return C(this,He)}set maxResultsPerSource(e){N(this,He,e??go)}get sources(){return C(this,Be)}}vt=new WeakMap,Be=new WeakMap,He=new WeakMap,Ue=new WeakMap,re=new WeakMap,Dt=new WeakSet,fr=async function(e,t,o){const r=e.label,i=C(this,vt).olMap.getView().getProjection();try{const s=C(this,He);let a=await e.search(t,{maxResults:s,signal:o,mapProjection:i});return a.length>s&&(a=a.slice(0,s)),{label:r,source:e,results:a}}catch(s){xo(s)||ho.error(`search for source ${r} failed`,s);return}};async function jc(n,e){n.aborted||await new Promise(t=>{const o=()=>{n.removeEventListener("abort",o),clearTimeout(r),t()};n.addEventListener("abort",o);const r=setTimeout(o,e)})}const Ft=ge("search:Search"),Fc=n=>{const{mapId:e,sources:t,searchTypingDelay:o,maxResultsPerGroup:r,onSelect:i,onClear:s}=n,{containerProps:a}=Q("search",n),{map:l}=q(e),c=$t(),u=Dc(t,o,r,l),{input:p,search:g,selectedOption:h,onInputChanged:y,onResultConfirmed:S}=Vc(u),M=Nc(),E=Rc(c),j=Oc(),F=Ae((L,z)=>{z.action==="input-change"&&y(L)}),$=Ae((L,z)=>{switch(z.action){case"select-option":L&&(S(L),i?.({source:L.source,result:L.result}));break;case"clear":y(""),B.current?.blur(),B.current?.focus(),s?.();break;default:Ft.debug(`Unhandled action type '${z.action}'.`);break}}),B=f.useRef(null);return d.jsx(R,{...a,children:d.jsx(pn,{className:"search-component",classNamePrefix:"react-select",ref:B,inputValue:p,onInputChange:F,"aria-label":c.formatMessage({id:"ariaLabel.search"}),ariaLiveMessages:E,colorScheme:"trails",selectedOptionStyle:"color",selectedOptionColorScheme:"trails",chakraStyles:M,isClearable:!0,placeholder:c.formatMessage({id:"searchPlaceholder"}),closeMenuOnSelect:!0,isLoading:g.kind==="loading",options:g.kind==="ready"?g.results:void 0,filterOption:()=>!0,tabSelectsValue:!1,components:j,onChange:$,value:h,menuPosition:"fixed"})})};function Rc(n){return f.useMemo(()=>({onFocus:({focused:i})=>`${i.label} ${n.formatMessage({id:"ariaLabel.searchFocus"})}.`,onChange:({action:i,label:s})=>{let a="";switch(i){case"select-option":a=`${s} ${n.formatMessage({id:"ariaLabel.searchSelect"})}.`;break;case"clear":a=`${s} ${n.formatMessage({id:"ariaLabel.searchClear"})}.`;break}return a},guidance:()=>`${n.formatMessage({id:"ariaLabel.instructions"})}`,onFilter:()=>""}),[n])}function Oc(){return f.useMemo(()=>({Menu:_c,Input:Ec,SingleValue:Cc,Option:Ac,NoOptionsMessage:Sc,LoadingMessage:xc,ValueContainer:kc,IndicatorsContainer:Mc,ClearIndicator:Lc}),[])}function Nc(){const[n,e]=ko("colors",["trails.100","trails.50"],["#d5e5ec","#eaf2f5"]);return f.useMemo(()=>({groupHeading:o=>({...o,backgroundColor:n,padding:"8px 12px",fontSize:"inherit",fontWeight:"inherit"}),option:o=>({...o,backgroundColor:"inherit",_focus:{backgroundColor:e}}),dropdownIndicator:o=>({...o,display:"none"})}),[n,e])}function Dc(n,e,t,o){const[r,i]=f.useState(void 0);return f.useEffect(()=>{if(!o)return;const s=new Tc(o,n);return i(s),()=>{s.destroy(),i(void 0)}},[o,n]),f.useEffect(()=>{r&&(r.searchTypingDelay=e)},[r,e]),f.useEffect(()=>{r&&(r.maxResultsPerSource=t)},[r,t]),r}function Vc(n){const[e,t]=f.useReducer((a,l)=>{switch(l.kind){case"input":return{...a,query:l.query,selectedOption:null};case"select-option":return{...a,selectedOption:l.option,query:l.option.label};case"load-results":return{...a,search:{kind:"loading"}};case"accept-results":return{...a,search:{kind:"ready",results:l.results}}}},void 0,()=>({query:"",selectedOption:null,search:{kind:"ready",results:[]}})),o=f.useRef(),r=Ae(a=>{if(!n){o.current=void 0,t({kind:"accept-results",results:[]});return}Ft.isDebug()&&Ft.debug(`Starting new search for query ${JSON.stringify(a)}.`),t({kind:"load-results"});const l=o.current=Gc(n,a).then(c=>{o.current===l&&t({kind:"accept-results",results:c})})}),i=f.useCallback(a=>{t({kind:"select-option",option:a})},[]),s=f.useCallback(a=>{t({kind:"input",query:a}),r(a)},[r]);return{input:e.query,search:e.search,selectedOption:e.selectedOption,onResultConfirmed:i,onInputChanged:s}}async function Gc(n,e){let t;try{t=await n.search(e)}catch(o){xo(o)||Ft.error("Search failed",o),t=[]}return zc(t)}function zc(n){return n.map((t,o)=>({label:t.label,options:t.results.map(r=>({value:`${o}-${r.id}`,label:r.label,source:t.source,result:r}))}))}function Bc(){const{map:n}=q(V),e=he("ol-app.AppModel"),t=Ye(e.state).searchSources;function o(i){if(console.debug("The user selected the following item: ",i.result),!n)return;const s=i.result.geometry;s&&e.highlightAndZoom(n,[s])}function r(){console.debug("The user cleared the search"),e.clearPreviousHighlight()}return d.jsx(R,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",mt:5,className:"search-box",children:d.jsx(Fc,{mapId:V,sources:t,maxResultsPerGroup:10,onSelect:o,onClear:r})})}const mr="@open-pioneer/selection",Hc=Xe.bind(void 0,mr),Ln=le.bind(void 0,mr),ot="selection-active",Pt="selection-inactive";class Uc{tooltip;interactionResources=[];olMap;isActive=!0;tooltipMessage;tooltipDisabledMessage;constructor(e,t,o,r,i){let s;switch(t){case An.extent:default:s=this.initViewport(e),this.interactionResources.push(this.createDragBox(e,i,s,this.interactionResources)),this.interactionResources.push(this.createDrag(e,s,this.interactionResources));break}this.tooltip=this.createHelpTooltip(e,o),this.olMap=e,this.tooltipMessage=o,this.tooltipDisabledMessage=r}initViewport(e){const t=e.getViewport();return t.classList.add(ot),t.oncontextmenu=o=>(o.preventDefault(),!1),t}destroy(){this.tooltip.destroy(),this.interactionResources.forEach(e=>{e.destroy()})}setActive(e){if(this.isActive===e)return;const t=this.olMap.getViewport();e?(this.interactionResources.forEach(o=>this.olMap.addInteraction(o.interaction)),this.tooltip.element.textContent=this.tooltipMessage,t.classList.remove(Pt),t.classList.add(ot),this.isActive=!0):(this.interactionResources.forEach(o=>this.olMap.removeInteraction(o.interaction)),this.tooltip.element.textContent=this.tooltipDisabledMessage,t.classList.remove(ot),t.classList.add(Pt),this.isActive=!1)}createDragBox(e,t,o,r){const i=new Gn({className:"selection-drag-box",condition:Ci});return e.addInteraction(i),i.on("boxend",function(){t(i.getGeometry())}),{interaction:i,destroy(){e.removeInteraction(i),r.splice(r.indexOf(this)),i.dispose(),o.classList.remove(ot),o.classList.remove(Pt),o.oncontextmenu=null}}}createDrag(e,t,o){const r=function(a){return a.originalEvent.button==2},i=new zn({condition:r});return e.addInteraction(i),{interaction:i,destroy(){e.removeInteraction(i),o.splice(o.indexOf(this)),i.dispose(),t.classList.remove(ot),t.classList.remove(Pt),t.oncontextmenu=null}}}createHelpTooltip(e,t){const o=document.createElement("div");o.className="selection-tooltip printing-hide",o.textContent=t;const r=new qe({element:o,offset:[15,0],positioning:"center-left"}),i=e.on("pointermove",s=>{r.setPosition(s.coordinate)});return e.addOverlay(r),{overlay:r,element:o,destroy(){e.removeOverlay(r),r.dispose(),K(i)}}}getDragboxInteraction(){return this.interactionResources.find(e=>e.interaction instanceof Gn)}getDragPanInteraction(){return this.interactionResources.find(e=>e.interaction instanceof zn)}}const sn=ge("selection:SelectionController"),$c=1e4;var yt,bt,wt,Vt,vr;class Wc{constructor(e){O(this,Vt);O(this,yt,void 0);O(this,bt,void 0);O(this,wt,void 0);const{mapModel:t,onError:o,maxResults:r=$c}=e;N(this,yt,t),N(this,bt,r),N(this,wt,o)}destroy(){}async select(e,t){if(t)return await U(this,Vt,vr).call(this,e,t)}}yt=new WeakMap,bt=new WeakMap,wt=new WeakMap,Vt=new WeakSet,vr=async function(e,t){const o=C(this,yt).olMap.getView().getProjection();try{sn.debug(`Starting selection on source '${e.label}'`);const r=C(this,bt);let i=await e.select({type:"extent",extent:t},{maxResults:r,mapProjection:o,signal:new AbortController().signal});return i.length>r&&(i=i.slice(0,r)),sn.debug(`Found ${i.length} results on source '${e.label}'`),{source:e,results:i}}catch(r){sn.error(`selection from source ${e.label} failed`,r),C(this,wt).call(this);return}};var An=(n=>(n.extent="EXTENT",n.polygon="POLYGON",n.free="FREEPOLYGON",n.circle="CIRCLE",n))(An||{});const fo={classNamePrefix:"react-select",menuPosition:"fixed",isSearchable:!1,isClearable:!1},qc=n=>{const e=Ln(),{mapId:t,sources:o,onSelectionComplete:r,onSelectionSourceChanged:i}=n,{containerProps:s}=Q("selection",n),[a,l]=f.useState(()=>o.find(L=>(L.status??"available")==="available")),c=q(t),{onExtentSelected:u}=Zc(c.map,o,a,r),p=Qc(),h=f.useCallback(L=>{const z=[];if(L||(L=["EXTENT"]),L.forEach(m=>{Object.values(An).includes(m)&&z.push({label:e.formatMessage({id:m}),value:m})}),z.length===0)throw new Error("methods does not contain valid values");return z},[e])(void 0),[y,S]=f.useState(h[0]),M=Ae(L=>{S(L)}),[E,j]=f.useState(!0);Xc(c.map,y,e,u,E);const F=f.useMemo(()=>o.map(L=>({label:L.label,value:L})),[o]),$=f.useMemo(()=>F.find(L=>L.value===a),[F,a]),B=Ae(L=>{l(L?.value),i&&i({source:L?.value})});return f.useEffect(()=>{if(!a){j(!1);return}const L=e.formatMessage({id:"sourceNotAvailable"}),z=()=>a&&vn(a,L).kind==="available";j(z());const m=a.on("changed:status",()=>{j(z())});return()=>m.destroy()},[a,j,e]),d.jsxs(dn,{...s,spacing:2,children:[h.length>1&&d.jsxs(At,{children:[d.jsx(ht,{children:e.formatMessage({id:"selectMethod"})}),d.jsx(pn,{className:"selection-method react-select",...fo,options:h,onChange:M,value:y,chakraStyles:p})]}),d.jsxs(At,{children:[d.jsx(ht,{children:e.formatMessage({id:"selectSource"})}),d.jsx(pn,{className:"selection-source react-select",...fo,options:F,placeholder:e.formatMessage({id:"selectionPlaceholder"}),value:$,onChange:B,components:{Option:Kc,SingleValue:Yc},isOptionDisabled:L=>L.value===void 0||L.value.status==="unavailable",getOptionLabel:L=>L.label+(L.value===void 0||L.value.status==="unavailable"?" "+e.formatMessage({id:"sourceNotAvailable"}):""),chakraStyles:p})]})]})};function Kc(n){const{value:e}=n.data,{isAvailable:t,content:o}=yr(e,!1);return d.jsx(fe.Option,{...n,isDisabled:!t,className:"selection-source-option",children:o})}function Yc(n){const{value:e}=n.data,{isAvailable:t,content:o}=yr(e,!0),r=t?"selection-source-value":"selection-source-value selection-source-value--disabled";return d.jsx(fe.SingleValue,{...n,isDisabled:!t,className:r,children:o})}function yr(n,e){const t=n?.label,o=Jc(n);return{isAvailable:o.kind==="available",content:d.jsxs(ue,{direction:"row",alignItems:"center",grow:1,children:[!e&&d.jsx(ue,{grow:1,children:t}),o.kind==="unavailable"&&d.jsx(R,{ml:2,children:d.jsx(So,{label:o.reason,placement:"right",openDelay:500,children:d.jsx(X.span,{children:d.jsx(Ar,{as:Xi,color:"red",className:"warning-icon","aria-label":o.reason})})})}),e&&t]})}}function Zc(n,e,t,o){const r=Hc("notifier.NotificationService"),i=Ln(),[s,a]=f.useState(void 0);f.useEffect(()=>{if(!n)return;const c=new Wc({mapModel:n,onError(){r.notify({level:"error",message:i.formatMessage({id:"selectionFailed"})})}});return a(c),()=>{c.destroy()}},[n,r,e,i]);const l=Ae(async c=>{if(!s||!t)return;const u=await s.select(t,c.getExtent());u&&o?.(u)});return{controller:s,onExtentSelected:l}}function vn(n,e){const t=n.status??"available",o=typeof t=="string"?{kind:t}:t;return o.kind==="available"?o:{kind:"unavailable",reason:o.reason??e}}function Jc(n){const e=Ln(),[t,o]=f.useState(()=>({kind:"available"}));return f.useEffect(()=>{if(!n){o({kind:"available"});return}const r=e.formatMessage({id:"sourceNotAvailable"});o(vn(n,r));const i=n.on?.("changed:status",()=>{o(vn(n,r))});return()=>i?.destroy()},[n,e]),t}function Xc(n,e,t,o,r){f.useEffect(()=>{if(!n)return;const i=new Uc(n.olMap,e.value,t.formatMessage({id:"tooltip"}),t.formatMessage({id:"disabledTooltip"}),o);return i.setActive(r),()=>{i?.destroy()}},[n,e,t,o,r])}function Qc(){const[n,e]=ko("colors",["background_body","border"],["#ffffff","#ffffff"]);return f.useMemo(()=>({control:o=>({...o,cursor:"pointer"}),indicatorSeparator:o=>({...o,borderColor:e}),dropdownIndicator:o=>({...o,backgroundColor:n})}),[n,e])}function ed(){const n=Se(),e=he("notifier.NotificationService"),t=f.useId(),{map:o}=q(V),r=he("ol-app.AppModel"),i=Ye(r.state).selectionSources,s=Ye(r.state).sourceMetadata,a={numberOptions:{maximumFractionDigits:3},dateOptions:{dateStyle:"medium",timeStyle:"medium",timeZone:"UTC"}};function l(u){const{source:p,results:g}=u;if(!o){console.debug("Map not ready");return}const h=s.get(p);if(!h){console.warn("Can not show results because no metadata could be found");return}r.setResultListInput({columns:h,data:g,formatOptions:a}),e.notify({level:"info",message:n.formatMessage({id:"foundResults"},{resultsCount:g.length}),displayDuration:4e3})}function c(u){r.clearPreviousHighlight()}return d.jsx(R,{role:"dialog","aria-labelledby":t,children:d.jsx(Ie,{title:d.jsx(Te,{id:t,size:"md",mb:2,children:n.formatMessage({id:"selectionTitle"})}),children:d.jsx(qc,{mapId:V,sources:i,onSelectionComplete:l,onSelectionSourceChanged:c})})})}function td(n){const e=f.useId(),t=Se();return d.jsx(R,{role:"dialog","aria-labelledby":e,children:d.jsx(Ie,{title:d.jsx(Te,{id:e,size:"md",mb:2,children:d.jsx(pe,{children:t.formatMessage({id:"tocTitle"})})}),children:d.jsx(R,{overflowY:"auto",maxHeight:n.maxHeight,children:d.jsx(Di,{mapId:V,showTools:!0,basemapSwitcherProps:{allowSelectingEmptyBasemap:!0}})})})})}const nd={bookmarksActive:!1,legendActive:!0,overviewMapActive:!0,tocActive:!0,printingActive:!1,editingCreateActive:!1,editingUpdateActive:!1};let at=!1,Oe=!1,Lt,Ve,dt;function od(){const n=he("editing.EditingService"),e=he("notifier.NotificationService"),{map:t}=q(V),o=Se(),r=he("ol-app.AppModel"),[i,s]=f.useState(),[a,l]=f.useState(nd),c={...a,measurementActive:i==="measurement",selectionActive:i==="selection"},u=(y,S)=>{if(y==="selectionActive"||y==="measurementActive"){let M;switch(y){case"measurementActive":M="measurement";break;case"selectionActive":M="selection";break}M!==i&&S?(s(M),r.clearPreviousHighlight()):M===i&&!S&&(s(void 0),r.clearPreviousHighlight())}else S&&(y==="editingCreateActive"&&c.editingUpdateActive||y==="editingUpdateActive"&&c.editingCreateActive)?e.notify({level:"warning",message:o.formatMessage({id:"editing.toggleNotAllowed"})}):l({...a,[y]:S})},p=Ye(r.state).resultListState,g=p.input&&p.open,h=[c.tocActive&&d.jsx(td,{maxHeight:c.legendActive||i?"300px":"75vh"},"toc"),c.legendActive&&d.jsx(ql,{},"legend"),i==="selection"?d.jsx(ed,{},"selection"):i==="measurement"?d.jsx(gc,{},"measurement"):void 0];return rd(t,n,e,o,l,a),id(t,n,e,o,l,a),d.jsxs(ue,{height:"100%",direction:"column",overflow:"hidden",children:[d.jsx(Za,{position:"top-right"}),d.jsxs(Ie,{title:d.jsx(R,{role:"region","aria-label":o.formatMessage({id:"ariaLabel.header"}),textAlign:"center",py:1,children:d.jsx(Te,{size:"md",children:"OpenLayers Base Packages - Default Sample"})}),children:[d.jsx(ue,{flex:"1",direction:"column",position:"relative",children:d.jsxs(Mi,{mapId:V,role:"main","aria-label":o.formatMessage({id:"ariaLabel.map"}),viewPadding:g?{bottom:400}:void 0,children:[d.jsx(ts,{centerContent:!0,children:d.jsx(Bc,{})}),d.jsx(Qe,{position:"top-left",horizontalGap:20,verticalGap:20,children:d.jsx(sd,{children:h})}),d.jsx(Qe,{position:"top-right",horizontalGap:20,verticalGap:20,children:c.overviewMapActive&&d.jsx(yc,{})}),d.jsx(Qe,{horizontalGap:20,position:"bottom-left",children:c.bookmarksActive&&d.jsx(Ll,{})}),d.jsx(Qe,{horizontalGap:20,position:"bottom-left",children:c.printingActive&&d.jsx(Ol,{})}),d.jsx(Qe,{position:"bottom-right",horizontalGap:10,verticalGap:45,children:d.jsx(oc,{toolState:c,onToolStateChange:u})}),d.jsx(bc,{})]})}),d.jsxs(ue,{role:"region","aria-label":o.formatMessage({id:"ariaLabel.footer"}),gap:3,alignItems:"center",justifyContent:"center",children:[d.jsx(za,{mapId:V,precision:2,displayProjectionCode:"EPSG:4326"}),d.jsx(Ja,{mapId:V}),d.jsx(el,{mapId:V})]})]})]})}function rd(n,e,t,o,r,i){f.useEffect(()=>{if(!n)return;i.editingCreateActive&&!at&&!Oe?s():!i.editingCreateActive&&at&&a();function s(){if(!n)throw Error("map is undefined");try{at=!0;const l=n.layers.getLayerById("krankenhaus"),c=new URL(l.attributes.collectionURL+"/items");e.createFeature(n,c).whenComplete().then(p=>{if(!p)return;t.notify({level:"info",message:o.formatMessage({id:"editing.create.featureCreated"},{featureId:p.featureId})}),(l?.olLayer).getSource()?.refresh()}).catch(p=>{console.error(p)}).finally(()=>{r({...i,editingCreateActive:!1}),at=!1})}catch(l){console.error(l)}}function a(){e.stop(V)}},[n,e,t,o,r,i])}function id(n,e,t,o,r,i){f.useEffect(()=>{if(!n)return;i.editingUpdateActive&&!at&&!Oe?a():!i.editingUpdateActive&&Oe&&(mo(n),l(),Oe=!1);function s(c){const u=document.createElement("div");u.className="editing-tooltip editing-tooltip-hidden",u.textContent=o.formatMessage({id:"editing.update.tooltip.select"});const p=new qe({element:u,offset:[15,0],positioning:"center-left"}),g=c.on("pointermove",h=>{h.dragging||p.setPosition(h.coordinate)});return c.addOverlay(p),{overlay:p,element:u,destroy(){K(g),c.removeOverlay(p)}}}function a(){if(!n)throw Error("map is undefined");Oe=!0,dt=s(n.olMap);try{const c=n.layers.getLayerById("krankenhaus"),u=c?.olLayer;Ve=new Cn({layers:[u]}),n.olMap.addInteraction(Ve),dt.element.classList.remove("editing-tooltip-hidden");const p=new URL(c.attributes.collectionURL+"/items");Lt=Ve.on("select",g=>{const h=g.selected,y=g.deselected;if(h.length===1&&y.length===0){mo(n);const S=h[0];if(!S)throw Error("feature is undefined");e.updateFeature(n,p,S).whenComplete().then(E=>{E&&(t.notify({level:"info",message:o.formatMessage({id:"editing.update.featureModified"},{featureId:E.featureId})}),u.getSource()?.refresh())}).catch(E=>{console.error(E)}).finally(()=>{r({...i,editingUpdateActive:!1}),Oe=!1})}})}catch(c){console.error(c)}}function l(){e.stop(V)}},[n,e,t,o,r,i])}function mo(n){Ve&&n.olMap.removeInteraction(Ve),Lt&&K(Lt),dt&&dt.destroy(),Ve=void 0,Lt=void 0,dt=void 0}function sd(n){const e=n.children,t=[];for(const o of e)o&&(t.length&&t.push(d.jsx(es,{mt:4,mb:4},t.length)),t.push(o));if(t.length!==0)return d.jsx(R,{backgroundColor:"white",borderWidth:"1px",borderRadius:"lg",padding:2,boxShadow:"lg",width:350,maxWidth:350,children:t})}const ad=Ir({component:od,theme:Tr,appMetadata:Na,config:{properties:{"@open-pioneer/local-storage":{storageId:"ol-app-state"}}},async resolveConfig(n){const e=n.getAttribute("forced-locale");if(e)return{locale:e}}});customElements.define("ol-map-app",ad);const ld=document.getElementsByTagName("body")[0];cd();function cd(){const n=window.location.search,t=new URLSearchParams(n).get("lang"),o=document.createElement("ol-map-app");o.classList.add("full-height"),o.classList.add("app"),o.setAttribute("id","test"),t&&o.setAttribute("forced-locale",t),ld.appendChild(o)}
